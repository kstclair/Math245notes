<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Logistic Regression | Math 245 Notes</title>
  <meta name="description" content="Course notes and examples for Applied Regression Analysis" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Logistic Regression | Math 245 Notes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Course notes and examples for Applied Regression Analysis" />
  <meta name="github-repo" content="kstclair/Math245notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Logistic Regression | Math 245 Notes" />
  
  <meta name="twitter:description" content="Course notes and examples for Applied Regression Analysis" />
  

<meta name="author" content="Katie St. Clair, Carleton College" />


<meta name="date" content="2020-08-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mlr.html"/>
<link rel="next" href="poisson.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Math 245 Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Getting Started</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#getting-help"><i class="fa fa-check"></i>Getting help</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="review.html"><a href="review.html"><i class="fa fa-check"></i><b>1</b> Review of Statistical Inference</a><ul>
<li class="chapter" data-level="1.1" data-path="review.html"><a href="review.html#sampling-distribution"><i class="fa fa-check"></i><b>1.1</b> Sampling Distribution</a></li>
<li class="chapter" data-level="1.2" data-path="review.html"><a href="review.html#central-limit-theorem"><i class="fa fa-check"></i><b>1.2</b> Central Limit Theorem</a><ul>
<li class="chapter" data-level="1.2.1" data-path="review.html"><a href="review.html#standard-error"><i class="fa fa-check"></i><b>1.2.1</b> Standard error</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="review.html"><a href="review.html#hypothesis-testing"><i class="fa fa-check"></i><b>1.3</b> Hypothesis testing</a></li>
<li class="chapter" data-level="1.4" data-path="review.html"><a href="review.html#confidence-intervals"><i class="fa fa-check"></i><b>1.4</b> Confidence Intervals</a></li>
<li class="chapter" data-level="1.5" data-path="review.html"><a href="review.html#review_activity"><i class="fa fa-check"></i><b>1.5</b> Review activity (day 2)</a><ul>
<li class="chapter" data-level="1.5.1" data-path="review.html"><a href="review.html#general-questions"><i class="fa fa-check"></i><b>1.5.1</b> General questions</a></li>
<li class="chapter" data-level="1.5.2" data-path="review.html"><a href="review.html#comparing-two-means"><i class="fa fa-check"></i><b>1.5.2</b> Comparing two means</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="slr.html"><a href="slr.html"><i class="fa fa-check"></i><b>2</b> Simple Linear Regression</a><ul>
<li class="chapter" data-level="2.1" data-path="slr.html"><a href="slr.html#the-variables"><i class="fa fa-check"></i><b>2.1</b> The variables</a></li>
<li class="chapter" data-level="2.2" data-path="slr.html"><a href="slr.html#slr-model"><i class="fa fa-check"></i><b>2.2</b> The model form</a><ul>
<li class="chapter" data-level="2.2.1" data-path="slr.html"><a href="slr.html#interpretation"><i class="fa fa-check"></i><b>2.2.1</b> Interpretation</a></li>
<li class="chapter" data-level="2.2.2" data-path="slr.html"><a href="slr.html#slr-model-ex"><i class="fa fa-check"></i><b>2.2.2</b> Example: Woodpecker nests</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="slr.html"><a href="slr.html#slr-est"><i class="fa fa-check"></i><b>2.3</b> Theory: Estimation</a><ul>
<li class="chapter" data-level="2.3.1" data-path="slr.html"><a href="slr.html#sampling-distributions-for-slr-estimates"><i class="fa fa-check"></i><b>2.3.1</b> Sampling Distributions for SLR estimates</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="slr.html"><a href="slr.html#slr-sim"><i class="fa fa-check"></i><b>2.4</b> SLR model simulation</a><ul>
<li class="chapter" data-level="2.4.1" data-path="slr.html"><a href="slr.html#simulation-function"><i class="fa fa-check"></i><b>2.4.1</b> Simulation function</a></li>
<li class="chapter" data-level="2.4.2" data-path="slr.html"><a href="slr.html#run-the-function-once"><i class="fa fa-check"></i><b>2.4.2</b> Run the function once</a></li>
<li class="chapter" data-level="2.4.3" data-path="slr.html"><a href="slr.html#simulated-sampling-distribution-for-hatbeta_1"><i class="fa fa-check"></i><b>2.4.3</b> Simulated sampling distribution for <span class="math inline">\(\hat{\beta}_1\)</span></a></li>
<li class="chapter" data-level="2.4.4" data-path="slr.html"><a href="slr.html#slr-simcor"><i class="fa fa-check"></i><b>2.4.4</b> Are slope and intercept estimates correlated?</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="slr.html"><a href="slr.html#slr-inf"><i class="fa fa-check"></i><b>2.5</b> Inference for mean parameters</a><ul>
<li class="chapter" data-level="2.5.1" data-path="review.html"><a href="review.html#confidence-intervals"><i class="fa fa-check"></i><b>2.5.1</b> Confidence Intervals</a></li>
<li class="chapter" data-level="2.5.2" data-path="slr.html"><a href="slr.html#hypothesis-tests"><i class="fa fa-check"></i><b>2.5.2</b> Hypothesis tests</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="slr.html"><a href="slr.html#slr-inf2"><i class="fa fa-check"></i><b>2.6</b> Inference for average or predicted response</a><ul>
<li class="chapter" data-level="2.6.1" data-path="slr.html"><a href="slr.html#confidence-intervals-for-mu_y-mid-x"><i class="fa fa-check"></i><b>2.6.1</b> Confidence intervals for <span class="math inline">\(\mu_{y \mid x}\)</span></a></li>
<li class="chapter" data-level="2.6.2" data-path="slr.html"><a href="slr.html#prediction-intervals-for-new-cases"><i class="fa fa-check"></i><b>2.6.2</b> Prediction intervals for new cases</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="slr.html"><a href="slr.html#slr-example1"><i class="fa fa-check"></i><b>2.7</b> Example: SLR model (day 3)</a><ul>
<li class="chapter" data-level="2.7.1" data-path="slr.html"><a href="slr.html#load-data"><i class="fa fa-check"></i><b>2.7.1</b> Load data</a></li>
<li class="chapter" data-level="2.7.2" data-path="review.html"><a href="review.html#eda"><i class="fa fa-check"></i><b>2.7.2</b> EDA</a></li>
<li class="chapter" data-level="2.7.3" data-path="slr.html"><a href="slr.html#the-least-squares-line-the-estimated-slr-model"><i class="fa fa-check"></i><b>2.7.3</b> The least squares line (the estimated SLR model):</a></li>
<li class="chapter" data-level="2.7.4" data-path="slr.html"><a href="slr.html#inference-for-coefficients"><i class="fa fa-check"></i><b>2.7.4</b> Inference for coefficients</a></li>
<li class="chapter" data-level="2.7.5" data-path="slr.html"><a href="slr.html#additional-lm-information"><i class="fa fa-check"></i><b>2.7.5</b> Additional <code>lm</code> information</a></li>
<li class="chapter" data-level="2.7.6" data-path="slr.html"><a href="slr.html#slr-broom"><i class="fa fa-check"></i><b>2.7.6</b> <code>broom</code> package: Tidy <code>lm</code> output</a></li>
<li class="chapter" data-level="2.7.7" data-path="slr.html"><a href="slr.html#inference-for-the-mean-and-predicted-response"><i class="fa fa-check"></i><b>2.7.7</b> Inference for the mean and predicted response</a></li>
<li class="chapter" data-level="2.7.8" data-path="slr.html"><a href="slr.html#adding-confidence-bands-to-a-scatterplot"><i class="fa fa-check"></i><b>2.7.8</b> Adding confidence bands to a scatterplot</a></li>
<li class="chapter" data-level="2.7.9" data-path="slr.html"><a href="slr.html#tools-for-displaying-your-model"><i class="fa fa-check"></i><b>2.7.9</b> Tools for displaying your model</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="slr.html"><a href="slr.html#slr-assump"><i class="fa fa-check"></i><b>2.8</b> Checking model assumptions and fit</a><ul>
<li class="chapter" data-level="2.8.1" data-path="slr.html"><a href="slr.html#residuals"><i class="fa fa-check"></i><b>2.8.1</b> Residuals</a></li>
<li class="chapter" data-level="2.8.2" data-path="slr.html"><a href="slr.html#residual-plot-linearity-and-constant-variance"><i class="fa fa-check"></i><b>2.8.2</b> Residual plot: linearity and constant variance</a></li>
<li class="chapter" data-level="2.8.3" data-path="slr.html"><a href="slr.html#slr-normality"><i class="fa fa-check"></i><b>2.8.3</b> Residual normal QQ plot</a></li>
<li class="chapter" data-level="2.8.4" data-path="slr.html"><a href="slr.html#slr-indep"><i class="fa fa-check"></i><b>2.8.4</b> Independence</a></li>
<li class="chapter" data-level="2.8.5" data-path="slr.html"><a href="slr.html#slr-robust"><i class="fa fa-check"></i><b>2.8.5</b> Robustness against violations</a></li>
<li class="chapter" data-level="2.8.6" data-path="slr.html"><a href="slr.html#fixes-to-violations"><i class="fa fa-check"></i><b>2.8.6</b> “Fixes” to violations</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="slr.html"><a href="slr.html#slr-example2"><i class="fa fa-check"></i><b>2.9</b> Example: SLR assumptions (day 4/5)</a><ul>
<li class="chapter" data-level="2.9.1" data-path="slr.html"><a href="slr.html#drug-offender-sentences"><i class="fa fa-check"></i><b>2.9.1</b> Drug offender sentences</a></li>
<li class="chapter" data-level="2.9.2" data-path="slr.html"><a href="slr.html#case-study-15.2---global-warming"><i class="fa fa-check"></i><b>2.9.2</b> Case study 15.2 - Global Warming</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="slr.html"><a href="slr.html#slr-trans"><i class="fa fa-check"></i><b>2.10</b> Transformations</a><ul>
<li class="chapter" data-level="2.10.1" data-path="slr.html"><a href="slr.html#transformation-choices"><i class="fa fa-check"></i><b>2.10.1</b> Transformation choices</a></li>
<li class="chapter" data-level="2.10.2" data-path="slr.html"><a href="slr.html#transformations-in-r"><i class="fa fa-check"></i><b>2.10.2</b> Transformations in R</a></li>
<li class="chapter" data-level="2.10.3" data-path="slr.html"><a href="slr.html#interpretation-1"><i class="fa fa-check"></i><b>2.10.3</b> Interpretation</a></li>
<li class="chapter" data-level="2.10.4" data-path="slr.html"><a href="slr.html#slr-logs"><i class="fa fa-check"></i><b>2.10.4</b> Review: Logarithms</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="slr.html"><a href="slr.html#examples-transformations-day-6"><i class="fa fa-check"></i><b>2.11</b> Examples: Transformations (day 6)</a><ul>
<li class="chapter" data-level="2.11.1" data-path="slr.html"><a href="slr.html#cars-2004"><i class="fa fa-check"></i><b>2.11.1</b> Cars 2004</a></li>
<li class="chapter" data-level="2.11.2" data-path="slr.html"><a href="slr.html#residential-energy-survey-recs"><i class="fa fa-check"></i><b>2.11.2</b> 2005 Residential Energy Survey (RECS)</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="slr.html"><a href="slr.html#r2-and-anova-for-slr"><i class="fa fa-check"></i><b>2.12</b> <span class="math inline">\(R^2\)</span> and ANOVA for SLR</a><ul>
<li class="chapter" data-level="2.12.1" data-path="slr.html"><a href="slr.html#example-r2"><i class="fa fa-check"></i><b>2.12.1</b> Example: <span class="math inline">\(R^2\)</span></a></li>
<li class="chapter" data-level="2.12.2" data-path="slr.html"><a href="slr.html#slr-anova"><i class="fa fa-check"></i><b>2.12.2</b> ANOVA for SLR</a></li>
<li class="chapter" data-level="2.12.3" data-path="slr.html"><a href="slr.html#example-anova"><i class="fa fa-check"></i><b>2.12.3</b> Example: ANOVA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mlr.html"><a href="mlr.html"><i class="fa fa-check"></i><b>3</b> Multiple Regression</a><ul>
<li class="chapter" data-level="3.1" data-path="slr.html"><a href="slr.html#the-variables"><i class="fa fa-check"></i><b>3.1</b> The variables</a></li>
<li class="chapter" data-level="3.2" data-path="mlr.html"><a href="mlr.html#mlr-model"><i class="fa fa-check"></i><b>3.2</b> The model form</a><ul>
<li class="chapter" data-level="3.2.1" data-path="mlr.html"><a href="mlr.html#mlr-interpretation"><i class="fa fa-check"></i><b>3.2.1</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="mlr.html"><a href="mlr.html#mlr-example1"><i class="fa fa-check"></i><b>3.3</b> Example: MLR fit and visuals</a><ul>
<li class="chapter" data-level="3.3.1" data-path="mlr.html"><a href="mlr.html#lm-fit"><i class="fa fa-check"></i><b>3.3.1</b> <code>lm</code> fit</a></li>
<li class="chapter" data-level="3.3.2" data-path="mlr.html"><a href="mlr.html#graphics-for-mlr"><i class="fa fa-check"></i><b>3.3.2</b> Graphics for MLR</a></li>
<li class="chapter" data-level="3.3.3" data-path="mlr.html"><a href="mlr.html#mlr-resid1"><i class="fa fa-check"></i><b>3.3.3</b> Residual plots for MLR</a></li>
<li class="chapter" data-level="3.3.4" data-path="mlr.html"><a href="mlr.html#eda-for-interactions"><i class="fa fa-check"></i><b>3.3.4</b> EDA for interactions</a></li>
<li class="chapter" data-level="3.3.5" data-path="mlr.html"><a href="mlr.html#quadratic-models-corn-yields-exercise-9.15"><i class="fa fa-check"></i><b>3.3.5</b> Quadratic models: Corn yields (exercise 9.15)</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="mlr.html"><a href="mlr.html#mlr-cat"><i class="fa fa-check"></i><b>3.4</b> Categorical Predictors</a><ul>
<li class="chapter" data-level="3.4.1" data-path="mlr.html"><a href="mlr.html#interpretation-adding-a-categorical"><i class="fa fa-check"></i><b>3.4.1</b> Interpretation: adding a categorical</a></li>
<li class="chapter" data-level="3.4.2" data-path="mlr.html"><a href="mlr.html#interpretation-adding-a-categorical-interaction"><i class="fa fa-check"></i><b>3.4.2</b> Interpretation: adding a categorical interaction</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="mlr.html"><a href="mlr.html#mlr-inf"><i class="fa fa-check"></i><b>3.5</b> Inference for MLR</a><ul>
<li class="chapter" data-level="3.5.1" data-path="mlr.html"><a href="mlr.html#mlr-inf2"><i class="fa fa-check"></i><b>3.5.1</b> Inference for a linear combination of <span class="math inline">\(\beta\)</span>’s</a></li>
<li class="chapter" data-level="3.5.2" data-path="mlr.html"><a href="mlr.html#mlr-agstrat2"><i class="fa fa-check"></i><b>3.5.2</b> Example: Agstrat</a></li>
<li class="chapter" data-level="3.5.3" data-path="mlr.html"><a href="mlr.html#mlr-sleep2"><i class="fa fa-check"></i><b>3.5.3</b> Example: Sleep</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="mlr.html"><a href="mlr.html#mlr-anova"><i class="fa fa-check"></i><b>3.6</b> ANOVA for MLR</a><ul>
<li class="chapter" data-level="3.6.1" data-path="mlr.html"><a href="mlr.html#mean-squares"><i class="fa fa-check"></i><b>3.6.1</b> Mean Squares</a></li>
<li class="chapter" data-level="3.6.2" data-path="mlr.html"><a href="mlr.html#r2-and-adjusted-r2"><i class="fa fa-check"></i><b>3.6.2</b> <span class="math inline">\(R^2\)</span> and adjusted <span class="math inline">\(R^2\)</span></a></li>
<li class="chapter" data-level="3.6.3" data-path="mlr.html"><a href="mlr.html#anova-f-tests"><i class="fa fa-check"></i><b>3.6.3</b> ANOVA F-tests</a></li>
<li class="chapter" data-level="3.6.4" data-path="mlr.html"><a href="mlr.html#mlr-sleep3"><i class="fa fa-check"></i><b>3.6.4</b> Example: Sleep</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="mlr.html"><a href="mlr.html#model-checking"><i class="fa fa-check"></i><b>3.7</b> Model Checking</a><ul>
<li class="chapter" data-level="3.7.1" data-path="mlr.html"><a href="mlr.html#residual-plots"><i class="fa fa-check"></i><b>3.7.1</b> Residual plots</a></li>
<li class="chapter" data-level="3.7.2" data-path="mlr.html"><a href="mlr.html#outliers"><i class="fa fa-check"></i><b>3.7.2</b> Outliers</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="mlr.html"><a href="mlr.html#mlr-visualizing-effects"><i class="fa fa-check"></i><b>3.8</b> MLR: Visualizing effects</a><ul>
<li class="chapter" data-level="3.8.1" data-path="mlr.html"><a href="mlr.html#partial-residual-plots"><i class="fa fa-check"></i><b>3.8.1</b> Partial residual plots</a></li>
<li class="chapter" data-level="3.8.2" data-path="mlr.html"><a href="mlr.html#example-sleep-1"><i class="fa fa-check"></i><b>3.8.2</b> Example: Sleep</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="mlr.html"><a href="mlr.html#collinearity"><i class="fa fa-check"></i><b>3.9</b> Collinearity</a><ul>
<li class="chapter" data-level="3.9.1" data-path="mlr.html"><a href="mlr.html#example-sleep-2"><i class="fa fa-check"></i><b>3.9.1</b> Example: Sleep</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="logistic.html"><a href="logistic.html"><i class="fa fa-check"></i><b>4</b> Logistic Regression</a><ul>
<li class="chapter" data-level="4.1" data-path="slr.html"><a href="slr.html#the-variables"><i class="fa fa-check"></i><b>4.1</b> The variables</a><ul>
<li class="chapter" data-level="4.1.1" data-path="logistic.html"><a href="logistic.html#logistic-donner1"><i class="fa fa-check"></i><b>4.1.1</b> Example: Donner party EDA</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="logistic.html"><a href="logistic.html#logistic-bernoulli"><i class="fa fa-check"></i><b>4.2</b> The Bernoulli distribution</a></li>
<li class="chapter" data-level="4.3" data-path="logistic.html"><a href="logistic.html#logistic-model"><i class="fa fa-check"></i><b>4.3</b> The logistic model form</a><ul>
<li class="chapter" data-level="4.3.1" data-path="logistic.html"><a href="logistic.html#logistic-int"><i class="fa fa-check"></i><b>4.3.1</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="logistic.html"><a href="logistic.html#logistic-est"><i class="fa fa-check"></i><b>4.4</b> Inference and estimation</a><ul>
<li class="chapter" data-level="4.4.1" data-path="logistic.html"><a href="logistic.html#confidence-intervals-for-pmbbeta_i"><i class="fa fa-check"></i><b>4.4.1</b> Confidence intervals for <span class="math inline">\(\pmb{\beta_i}\)</span></a></li>
<li class="chapter" data-level="4.4.2" data-path="logistic.html"><a href="logistic.html#hypothesis-tests-for-pmbbeta_i"><i class="fa fa-check"></i><b>4.4.2</b> Hypothesis tests for <span class="math inline">\(\pmb{\beta_i}\)</span></a></li>
<li class="chapter" data-level="4.4.3" data-path="logistic.html"><a href="logistic.html#r-glm"><i class="fa fa-check"></i><b>4.4.3</b> R <code>glm</code></a></li>
<li class="chapter" data-level="4.4.4" data-path="logistic.html"><a href="logistic.html#logistic-donner2"><i class="fa fa-check"></i><b>4.4.4</b> Example: Donner party model</a></li>
<li class="chapter" data-level="4.4.5" data-path="logistic.html"><a href="logistic.html#logistic-donner3"><i class="fa fa-check"></i><b>4.4.5</b> Example: Donner party, adding sex</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="logistic.html"><a href="logistic.html#logistic-dev"><i class="fa fa-check"></i><b>4.5</b> Deviance</a><ul>
<li class="chapter" data-level="4.5.1" data-path="logistic.html"><a href="logistic.html#drop-in-deviance-test"><i class="fa fa-check"></i><b>4.5.1</b> Drop in Deviance test</a></li>
<li class="chapter" data-level="4.5.2" data-path="logistic.html"><a href="logistic.html#example-nes"><i class="fa fa-check"></i><b>4.5.2</b> Example: NES</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="logistic.html"><a href="logistic.html#logistic-assump"><i class="fa fa-check"></i><b>4.6</b> Checking Assumptions</a><ul>
<li class="chapter" data-level="4.6.1" data-path="logistic.html"><a href="logistic.html#example-bwca1"><i class="fa fa-check"></i><b>4.6.1</b> Example: Boundary Waters Canoe Area (BWCA) blowdown</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="logistic.html"><a href="logistic.html#logistic-resid"><i class="fa fa-check"></i><b>4.7</b> Residuals and Case influence</a><ul>
<li class="chapter" data-level="4.7.1" data-path="logistic.html"><a href="logistic.html#example-bwca2"><i class="fa fa-check"></i><b>4.7.1</b> Example: Boundary Waters Canoe Area (BWCA) blowdown</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="logistic.html"><a href="logistic.html#binomial-responses"><i class="fa fa-check"></i><b>4.8</b> Binomial responses</a><ul>
<li class="chapter" data-level="4.8.1" data-path="logistic.html"><a href="logistic.html#connection-to-binary-responses"><i class="fa fa-check"></i><b>4.8.1</b> Connection to binary responses</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="logistic.html"><a href="logistic.html#inference-for-binomial-response-models"><i class="fa fa-check"></i><b>4.9</b> Inference for Binomial response models</a><ul>
<li class="chapter" data-level="4.9.1" data-path="logistic.html"><a href="logistic.html#example-krunnit-islands-archipelago-sleuth-case-study-21.1"><i class="fa fa-check"></i><b>4.9.1</b> Example: Krunnit Islands archipelago (Sleuth Case Study 21.1)</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="logistic.html"><a href="logistic.html#logistic-binomDev"><i class="fa fa-check"></i><b>4.10</b> Deviance for Binomial responses</a><ul>
<li class="chapter" data-level="4.10.1" data-path="logistic.html"><a href="logistic.html#logistic-gof"><i class="fa fa-check"></i><b>4.10.1</b> Goodness-of-fit test</a></li>
<li class="chapter" data-level="4.10.2" data-path="logistic.html"><a href="logistic.html#example-krunnit-islands-archipelago-sleuth-case-study-21.1-1"><i class="fa fa-check"></i><b>4.10.2</b> Example: Krunnit Islands archipelago (Sleuth Case Study 21.1)</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="logistic.html"><a href="logistic.html#logistic-assump"><i class="fa fa-check"></i><b>4.11</b> Checking Assumptions</a><ul>
<li class="chapter" data-level="4.11.1" data-path="logistic.html"><a href="logistic.html#example-krunnit-islands-archipelago-sleuth-case-study-21.1-2"><i class="fa fa-check"></i><b>4.11.1</b> Example: Krunnit Islands archipelago (Sleuth Case Study 21.1)</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="logistic.html"><a href="logistic.html#logistic-binomResid"><i class="fa fa-check"></i><b>4.12</b> Residuals and case influence for binomial responses</a><ul>
<li class="chapter" data-level="4.12.1" data-path="logistic.html"><a href="logistic.html#example-krunnit-islands-archipelago-sleuth-case-study-21.1-3"><i class="fa fa-check"></i><b>4.12.1</b> Example: Krunnit Islands archipelago (Sleuth Case Study 21.1)</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="logistic.html"><a href="logistic.html#logistic-quasi"><i class="fa fa-check"></i><b>4.13</b> Quasi-binomial logistic model</a><ul>
<li class="chapter" data-level="4.13.1" data-path="logistic.html"><a href="logistic.html#example-moth-predation-case-study-21.2"><i class="fa fa-check"></i><b>4.13.1</b> Example: Moth predation (Case Study 21.2)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="poisson.html"><a href="poisson.html"><i class="fa fa-check"></i><b>5</b> Poisson Regression</a><ul>
<li class="chapter" data-level="5.1" data-path="poisson.html"><a href="poisson.html#pois-dist"><i class="fa fa-check"></i><b>5.1</b> The Poisson distribution</a></li>
<li class="chapter" data-level="5.2" data-path="logistic.html"><a href="logistic.html#logistic-model"><i class="fa fa-check"></i><b>5.2</b> The Poisson model form</a><ul>
<li class="chapter" data-level="5.2.1" data-path="slr.html"><a href="slr.html#interpretation"><i class="fa fa-check"></i><b>5.2.1</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="review.html"><a href="review.html#eda"><i class="fa fa-check"></i><b>5.3</b> EDA</a><ul>
<li class="chapter" data-level="5.3.1" data-path="poisson.html"><a href="poisson.html#example-possums"><i class="fa fa-check"></i><b>5.3.1</b> Example: Possums</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="poisson.html"><a href="poisson.html#poisson-est"><i class="fa fa-check"></i><b>5.4</b> Inference and estimation</a><ul>
<li class="chapter" data-level="5.4.1" data-path="logistic.html"><a href="logistic.html#confidence-intervals-for-pmbbeta_i"><i class="fa fa-check"></i><b>5.4.1</b> Confidence intervals for <span class="math inline">\(\pmb{\beta_i}\)</span></a></li>
<li class="chapter" data-level="5.4.2" data-path="logistic.html"><a href="logistic.html#hypothesis-tests-for-pmbbeta_i"><i class="fa fa-check"></i><b>5.4.2</b> Hypothesis tests for <span class="math inline">\(\pmb{\beta_i}\)</span></a></li>
<li class="chapter" data-level="5.4.3" data-path="logistic.html"><a href="logistic.html#r-glm"><i class="fa fa-check"></i><b>5.4.3</b> R <code>glm</code></a></li>
<li class="chapter" data-level="5.4.4" data-path="poisson.html"><a href="poisson.html#pois-ex2"><i class="fa fa-check"></i><b>5.4.4</b> Example: Possums</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="poisson.html"><a href="poisson.html#pois-dev"><i class="fa fa-check"></i><b>5.5</b> Deviance for Binomial responses</a><ul>
<li class="chapter" data-level="5.5.1" data-path="poisson.html"><a href="poisson.html#pois-did"><i class="fa fa-check"></i><b>5.5.1</b> Drop-in-deviance test</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="poisson.html"><a href="poisson.html#pois-assump"><i class="fa fa-check"></i><b>5.6</b> Checking Assumptions</a><ul>
<li class="chapter" data-level="5.6.1" data-path="poisson.html"><a href="poisson.html#pois-gof"><i class="fa fa-check"></i><b>5.6.1</b> Goodness-of-fit test</a></li>
<li class="chapter" data-level="5.6.2" data-path="poisson.html"><a href="poisson.html#gof-alternative"><i class="fa fa-check"></i><b>5.6.2</b> GOF alternative</a></li>
<li class="chapter" data-level="5.6.3" data-path="poisson.html"><a href="poisson.html#example-possums-1"><i class="fa fa-check"></i><b>5.6.3</b> Example: Possums</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="poisson.html"><a href="poisson.html#pois-resid"><i class="fa fa-check"></i><b>5.7</b> Residuals and case influence for binomial responses</a><ul>
<li class="chapter" data-level="5.7.1" data-path="poisson.html"><a href="poisson.html#example-possums-2"><i class="fa fa-check"></i><b>5.7.1</b> Example: Possums</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="poisson.html"><a href="poisson.html#pois-quasi"><i class="fa fa-check"></i><b>5.8</b> Quasi-Poisson logistic model</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="rrstudio.html"><a href="rrstudio.html"><i class="fa fa-check"></i><b>A</b> R and Rstudio</a><ul>
<li class="chapter" data-level="A.1" data-path="rrstudio.html"><a href="rrstudio.html#running-rstudio"><i class="fa fa-check"></i><b>A.1</b> Running Rstudio</a></li>
<li class="chapter" data-level="A.2" data-path="rrstudio.html"><a href="rrstudio.html#r"><i class="fa fa-check"></i><b>A.2</b> Installing R</a></li>
<li class="chapter" data-level="A.3" data-path="rrstudio.html"><a href="rrstudio.html#rstudio"><i class="fa fa-check"></i><b>A.3</b> Installing Rstudio</a></li>
<li class="chapter" data-level="A.4" data-path="rrstudio.html"><a href="rrstudio.html#packages"><i class="fa fa-check"></i><b>A.4</b> Installing R packages</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="renviron.html"><a href="renviron.html"><i class="fa fa-check"></i><b>B</b> The R enviroment</a><ul>
<li class="chapter" data-level="B.1" data-path="renviron.html"><a href="renviron.html#workspace"><i class="fa fa-check"></i><b>B.1</b> Workspace</a></li>
<li class="chapter" data-level="B.2" data-path="renviron.html"><a href="renviron.html#working-directory"><i class="fa fa-check"></i><b>B.2</b> Working directory</a></li>
<li class="chapter" data-level="B.3" data-path="renviron.html"><a href="renviron.html#project"><i class="fa fa-check"></i><b>B.3</b> Rstudio projects</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="rreview.html"><a href="rreview.html"><i class="fa fa-check"></i><b>C</b> R for basic data analysis</a><ul>
<li class="chapter" data-level="C.1" data-path="rreview.html"><a href="rreview.html#basics"><i class="fa fa-check"></i><b>C.1</b> Basics</a><ul>
<li class="chapter" data-level="C.1.1" data-path="rreview.html"><a href="rreview.html#quick-tips"><i class="fa fa-check"></i><b>C.1.1</b> Quick Tips</a></li>
<li class="chapter" data-level="C.1.2" data-path="rreview.html"><a href="rreview.html#objects"><i class="fa fa-check"></i><b>C.1.2</b> Objects</a></li>
<li class="chapter" data-level="C.1.3" data-path="rreview.html"><a href="rreview.html#vectors"><i class="fa fa-check"></i><b>C.1.3</b> Vectors</a></li>
<li class="chapter" data-level="C.1.4" data-path="rreview.html"><a href="rreview.html#arithmetic"><i class="fa fa-check"></i><b>C.1.4</b> Arithmetic</a></li>
<li class="chapter" data-level="C.1.5" data-path="rreview.html"><a href="rreview.html#subsetting"><i class="fa fa-check"></i><b>C.1.5</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="review.html"><a href="review.html#data"><i class="fa fa-check"></i><b>C.2</b> Data</a><ul>
<li class="chapter" data-level="C.2.1" data-path="rreview.html"><a href="rreview.html#reading-data-into-r"><i class="fa fa-check"></i><b>C.2.1</b> Reading Data into R</a></li>
<li class="chapter" data-level="C.2.2" data-path="rreview.html"><a href="rreview.html#investigating-a-data-frame"><i class="fa fa-check"></i><b>C.2.2</b> Investigating a Data Frame</a></li>
<li class="chapter" data-level="C.2.3" data-path="rreview.html"><a href="rreview.html#access"><i class="fa fa-check"></i><b>C.2.3</b> Accessing Data</a></li>
<li class="chapter" data-level="C.2.4" data-path="rreview.html"><a href="rreview.html#Rreview-subset"><i class="fa fa-check"></i><b>C.2.4</b> Subsetting a Data Frame</a></li>
<li class="chapter" data-level="C.2.5" data-path="rreview.html"><a href="rreview.html#creating-a-data-frame"><i class="fa fa-check"></i><b>C.2.5</b> Creating a data frame</a></li>
<li class="chapter" data-level="C.2.6" data-path="rreview.html"><a href="rreview.html#adding-a-new-column-to-a-data-frame"><i class="fa fa-check"></i><b>C.2.6</b> Adding a new column to a data frame</a></li>
<li class="chapter" data-level="C.2.7" data-path="rreview.html"><a href="rreview.html#missing-data"><i class="fa fa-check"></i><b>C.2.7</b> Missing Data</a></li>
</ul></li>
<li class="chapter" data-level="C.3" data-path="review.html"><a href="review.html#eda"><i class="fa fa-check"></i><b>C.3</b> EDA</a><ul>
<li class="chapter" data-level="C.3.1" data-path="rreview.html"><a href="rreview.html#categorical"><i class="fa fa-check"></i><b>C.3.1</b> Categorical:</a></li>
<li class="chapter" data-level="C.3.2" data-path="rreview.html"><a href="rreview.html#quantitative"><i class="fa fa-check"></i><b>C.3.2</b> Quantitative:</a></li>
<li class="chapter" data-level="C.3.3" data-path="rreview.html"><a href="rreview.html#Rreview-stats"><i class="fa fa-check"></i><b>C.3.3</b> Quantitative grouped by a categorical</a></li>
<li class="chapter" data-level="C.3.4" data-path="rreview.html"><a href="rreview.html#Rreview-graphs"><i class="fa fa-check"></i><b>C.3.4</b> Graphs</a></li>
<li class="chapter" data-level="C.3.5" data-path="rreview.html"><a href="rreview.html#reporting-results"><i class="fa fa-check"></i><b>C.3.5</b> Reporting Results</a></li>
</ul></li>
<li class="chapter" data-level="C.4" data-path="rreview.html"><a href="rreview.html#factors"><i class="fa fa-check"></i><b>C.4</b> Factor variables</a><ul>
<li class="chapter" data-level="C.4.1" data-path="rreview.html"><a href="rreview.html#renaming-factor-levels"><i class="fa fa-check"></i><b>C.4.1</b> Renaming factor levels</a></li>
<li class="chapter" data-level="C.4.2" data-path="rreview.html"><a href="rreview.html#recode-a-categorical-variable-with-many-levels"><i class="fa fa-check"></i><b>C.4.2</b> Recode a categorical variable with many levels</a></li>
<li class="chapter" data-level="C.4.3" data-path="rreview.html"><a href="rreview.html#converting-some-factor-levels-to-nas"><i class="fa fa-check"></i><b>C.4.3</b> Converting some factor levels to <code>NA</code>s</a></li>
<li class="chapter" data-level="C.4.4" data-path="rreview.html"><a href="rreview.html#changing-the-order-of-levels"><i class="fa fa-check"></i><b>C.4.4</b> Changing the order of levels</a></li>
<li class="chapter" data-level="C.4.5" data-path="rreview.html"><a href="rreview.html#recode-a-numerically-coded-categorical-variable"><i class="fa fa-check"></i><b>C.4.5</b> Recode a numerically coded categorical variable</a></li>
<li class="chapter" data-level="C.4.6" data-path="rreview.html"><a href="rreview.html#recode-a-factor-into-a-numeric"><i class="fa fa-check"></i><b>C.4.6</b> Recode a factor into a numeric</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="D" data-path="markdown.html"><a href="markdown.html"><i class="fa fa-check"></i><b>D</b> R Markdown</a><ul>
<li class="chapter" data-level="D.1" data-path="markdown.html"><a href="markdown.html#how-to-write-an-r-markdown-document"><i class="fa fa-check"></i><b>D.1</b> How to write an R Markdown document</a></li>
<li class="chapter" data-level="D.2" data-path="markdown.html"><a href="markdown.html#changing-r-markdown-chunk-evaluation-behavior"><i class="fa fa-check"></i><b>D.2</b> Changing R Markdown chunk evaluation behavior</a></li>
<li class="chapter" data-level="D.3" data-path="markdown.html"><a href="markdown.html#creating-a-new-r-markdown-document"><i class="fa fa-check"></i><b>D.3</b> Creating a new R Markdown document</a></li>
<li class="chapter" data-level="D.4" data-path="markdown.html"><a href="markdown.html#markdown-graphs"><i class="fa fa-check"></i><b>D.4</b> Extra: Graph formatting</a><ul>
<li class="chapter" data-level="D.4.1" data-path="markdown.html"><a href="markdown.html#adding-figure-numbers-and-captions"><i class="fa fa-check"></i><b>D.4.1</b> Adding figure numbers and captions</a></li>
<li class="chapter" data-level="D.4.2" data-path="markdown.html"><a href="markdown.html#resizing-graphs-in-markdown"><i class="fa fa-check"></i><b>D.4.2</b> Resizing graphs in Markdown</a></li>
<li class="chapter" data-level="D.4.3" data-path="markdown.html"><a href="markdown.html#changing-graph-formatting-in-r"><i class="fa fa-check"></i><b>D.4.3</b> Changing graph formatting in R</a></li>
<li class="chapter" data-level="D.4.4" data-path="markdown.html"><a href="markdown.html#hiding-r-commands"><i class="fa fa-check"></i><b>D.4.4</b> Hiding R commands</a></li>
<li class="chapter" data-level="D.4.5" data-path="markdown.html"><a href="markdown.html#global-changes-in-graph-format"><i class="fa fa-check"></i><b>D.4.5</b> Global changes in graph format</a></li>
<li class="chapter" data-level="D.4.6" data-path="markdown.html"><a href="markdown.html#comments"><i class="fa fa-check"></i><b>D.4.6</b> Comments:</a></li>
</ul></li>
<li class="chapter" data-level="D.5" data-path="markdown.html"><a href="markdown.html#markdown-tables"><i class="fa fa-check"></i><b>D.5</b> Extra: Table formatting</a><ul>
<li class="chapter" data-level="D.5.1" data-path="markdown.html"><a href="markdown.html#hiding-r-commands-and-r-output"><i class="fa fa-check"></i><b>D.5.1</b> Hiding R commands and R output</a></li>
<li class="chapter" data-level="D.5.2" data-path="markdown.html"><a href="markdown.html#markdown-tables-1"><i class="fa fa-check"></i><b>D.5.2</b> Markdown tables</a></li>
<li class="chapter" data-level="D.5.3" data-path="markdown.html"><a href="markdown.html#markdown-tables-via-kable"><i class="fa fa-check"></i><b>D.5.3</b> Markdown tables via <code>kable</code></a></li>
<li class="chapter" data-level="D.5.4" data-path="markdown.html"><a href="markdown.html#the-pander-package"><i class="fa fa-check"></i><b>D.5.4</b> The <code>pander</code> package</a></li>
<li class="chapter" data-level="D.5.5" data-path="markdown.html"><a href="markdown.html#the-stargazer-package"><i class="fa fa-check"></i><b>D.5.5</b> The <code>stargazer</code> package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="E" data-path="mathreview.html"><a href="mathreview.html"><i class="fa fa-check"></i><b>E</b> Math review</a><ul>
<li class="chapter" data-level="E.1" data-path="mathreview.html"><a href="mathreview.html#math-linear"><i class="fa fa-check"></i><b>E.1</b> Linear equations</a></li>
<li class="chapter" data-level="E.2" data-path="mathreview.html"><a href="mathreview.html#math-log"><i class="fa fa-check"></i><b>E.2</b> Logarithms</a><ul>
<li class="chapter" data-level="E.2.1" data-path="slr.html"><a href="slr.html#interpreting-logged-variables"><i class="fa fa-check"></i><b>E.2.1</b> Interpreting logged variables</a></li>
<li class="chapter" data-level="E.2.2" data-path="slr.html"><a href="slr.html#inverse-i.e.-reversing-the-log-getting-rid-of-the-log"><i class="fa fa-check"></i><b>E.2.2</b> Inverse (i.e. reversing the log, getting rid of the log, …)</a></li>
<li class="chapter" data-level="E.2.3" data-path="mathreview.html"><a href="mathreview.html#logarithms-in-r"><i class="fa fa-check"></i><b>E.2.3</b> Logarithms in R</a></li>
</ul></li>
<li class="chapter" data-level="E.3" data-path="mathreview.html"><a href="mathreview.html#math-exercises"><i class="fa fa-check"></i><b>E.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Math 245 Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="logistic" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Logistic Regression</h1>
<p>This chapter covers material from chapters 20-22 of Sleuth.</p>
<div id="the-variables" class="section level2">
<h2><span class="header-section-number">4.1</span> The variables</h2>
<p>Suppose we have a <strong>categorical</strong> response variable <span class="math inline">\(Y\)</span> that can take one of two values, which we will generically call a <strong>success</strong> or <strong>failure</strong>. We want to relate the <strong>probability of success</strong> to <span class="math inline">\(p\)</span> explantory variables (aka predictors, covariates) <span class="math inline">\(x_1, \dotsc, x_p\)</span>. There is no restriction on the type of covariates, they can be both quantitative and categorical variables.</p>
<div id="logistic-donner1" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Example: Donner party EDA</h3>
<p>Sleuth case study 20.1 looks at data from the infamous <a href="https://en.wikipedia.org/wiki/Donner_Party">Donner party</a>. This wagon train was migrating to the west coast of the US in the mid-1800s and became snow-bound in the Sierra Nevada mountains during the winter of 1846-7. We are interested in modeling the categorical variable “survival” (or not) as a function of individual covariates like age or sex.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="logistic.html#cb158-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(Sleuth3)</span>
<span id="cb158-2"><a href="logistic.html#cb158-2"></a><span class="op">&gt;</span><span class="st"> </span>donner &lt;-<span class="st"> </span>case2001 </span>
<span id="cb158-3"><a href="logistic.html#cb158-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(donner)</span>
<span id="cb158-4"><a href="logistic.html#cb158-4"></a><span class="co">##       Age           Sex          Status  </span></span>
<span id="cb158-5"><a href="logistic.html#cb158-5"></a><span class="co">##  Min.   :15.0   Female:15   Died    :25  </span></span>
<span id="cb158-6"><a href="logistic.html#cb158-6"></a><span class="co">##  1st Qu.:24.0   Male  :30   Survived:20  </span></span>
<span id="cb158-7"><a href="logistic.html#cb158-7"></a><span class="co">##  Median :28.0                            </span></span>
<span id="cb158-8"><a href="logistic.html#cb158-8"></a><span class="co">##  Mean   :31.8                            </span></span>
<span id="cb158-9"><a href="logistic.html#cb158-9"></a><span class="co">##  3rd Qu.:40.0                            </span></span>
<span id="cb158-10"><a href="logistic.html#cb158-10"></a><span class="co">##  Max.   :65.0</span></span></code></pre></div>
<p>A stacked bar graph shows that females had a higher surival rate than males:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="logistic.html#cb159-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</span>
<span id="cb159-2"><a href="logistic.html#cb159-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(donner, <span class="kw">aes</span>(<span class="dt">fill =</span> Status, <span class="dt">x =</span> Sex)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb159-3"><a href="logistic.html#cb159-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;fill&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb159-4"><a href="logistic.html#cb159-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;proportion&quot;</span>, <span class="dt">title=</span><span class="st">&quot;Surival rates by Sex&quot;</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-175-1.png" width="672" /></p>
<p>We can use the <code>dplyr</code> package’s <code>group_by</code> function to divide the data into the two <code>Sex</code> groups and compute the proportion who <code>Survived</code> within each group. Here we see that 2/3 of females survived while only 1/3 of males survived.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="logistic.html#cb160-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</span>
<span id="cb160-2"><a href="logistic.html#cb160-2"></a><span class="op">&gt;</span><span class="st"> </span>donner <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-3"><a href="logistic.html#cb160-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(Sex) <span class="op">%&gt;%</span><span class="st">     </span><span class="co"># for each Sex group</span></span>
<span id="cb160-4"><a href="logistic.html#cb160-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="kw">mean</span>(Status <span class="op">==</span><span class="st"> &quot;Survived&quot;</span>))  <span class="co"># proportion who survived</span></span>
<span id="cb160-5"><a href="logistic.html#cb160-5"></a><span class="co">## # A tibble: 2 x 2</span></span>
<span id="cb160-6"><a href="logistic.html#cb160-6"></a><span class="co">##   Sex    `mean(Status == &quot;Survived&quot;)`</span></span>
<span id="cb160-7"><a href="logistic.html#cb160-7"></a><span class="co">##   &lt;fct&gt;                         &lt;dbl&gt;</span></span>
<span id="cb160-8"><a href="logistic.html#cb160-8"></a><span class="co">## 1 Female                        0.667</span></span>
<span id="cb160-9"><a href="logistic.html#cb160-9"></a><span class="co">## 2 Male                          0.333</span></span></code></pre></div>
<p>A side-by-side boxplot shows that people who survived tended to be younger:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="logistic.html#cb161-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</span>
<span id="cb161-2"><a href="logistic.html#cb161-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(donner, <span class="kw">aes</span>(<span class="dt">x =</span> Status, <span class="dt">y =</span> Age)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb161-3"><a href="logistic.html#cb161-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb161-4"><a href="logistic.html#cb161-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-177-1.png" width="672" /></p>
<p>We can get stats by status group:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="logistic.html#cb162-1"></a><span class="op">&gt;</span><span class="st"> </span>donner <span class="op">%&gt;%</span></span>
<span id="cb162-2"><a href="logistic.html#cb162-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(Status) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># for each status group</span></span>
<span id="cb162-3"><a href="logistic.html#cb162-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="kw">mean</span>(Age), <span class="kw">sd</span>(Age), <span class="kw">median</span>(Age))  <span class="co"># get summary stats</span></span>
<span id="cb162-4"><a href="logistic.html#cb162-4"></a><span class="co">## # A tibble: 2 x 4</span></span>
<span id="cb162-5"><a href="logistic.html#cb162-5"></a><span class="co">##   Status   `mean(Age)` `sd(Age)` `median(Age)`</span></span>
<span id="cb162-6"><a href="logistic.html#cb162-6"></a><span class="co">##   &lt;fct&gt;          &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span id="cb162-7"><a href="logistic.html#cb162-7"></a><span class="co">## 1 Died            35.5     14.3             30</span></span>
<span id="cb162-8"><a href="logistic.html#cb162-8"></a><span class="co">## 2 Survived        27.2      8.00            25</span></span></code></pre></div>
<p>But these stats are not quite what we want when trying to model survival as a function of age. E.g. of people who survived, we know that the mean age was 27.2 while of people who died, the mean age was 35.5. But this is the wrong direction of conditioning, we would like to say how survival rates change as we increase age by a year, for example. We could employ a scatterplot for this purpose, but we need to recode (in <code>dplyr</code>) <code>Status</code> into a binary variable that recodes survival as a 1 and death as a 0:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="logistic.html#cb163-1"></a><span class="op">&gt;</span><span class="st"> </span>donner<span class="op">$</span>Ind_surv &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">recode</span>(donner<span class="op">$</span>Status, <span class="dt">Survived =</span> <span class="dv">1</span>, <span class="dt">Died =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>Then use a <code>jitter</code> plot to avoid overplotting:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="logistic.html#cb164-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(donner, <span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> Ind_surv)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb164-2"><a href="logistic.html#cb164-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Status), <span class="dt">height =</span> <span class="fl">.01</span>) </span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-180-1.png" width="672" /></p>
<p>As we increase age, try vertically “slicing” these points. The proportion of survivals in these similar age groups will just be the mean of the binary 0’s and 1’s in each slice. We have more blue points than red in the low age slices than in high age, so we see that the probability of survival tends to decrease as age increases. We will next consider how to construct a model that gives us a “best fit” curve for this probability of surival.</p>
</div>
</div>
<div id="logistic-bernoulli" class="section level2">
<h2><span class="header-section-number">4.2</span> The Bernoulli distribution</h2>
<p>The Bernoulli distribution is a probability model for a random trial that has two possible outcomes: success or failure. A Bernoulli <strong>random variable</strong> <span class="math inline">\(Y\)</span> “counts” the number of successes in a Bernoulli random trial. If a “success” occurred then <span class="math inline">\(Y=1\)</span> and if a “failure” occurred then <span class="math inline">\(Y=0\)</span>.</p>
<p>We will let <span class="math inline">\(\pi\)</span> be the probability of success:
<span class="math display">\[
\pi = P(Y=1) = P(success), \ \ \ \ \ 1-\pi = P(Y=0) = P(failure) 
\]</span>
If <span class="math inline">\(Y\)</span> is a Bernoulli random variable, then we can use the shorthand notation <span class="math inline">\(Y \sim Bern(\pi)\)</span> to denote this.</p>
<p>The <strong>expected value</strong>, or mean, of <span class="math inline">\(Y\)</span> is equal to
<span class="math display">\[
E(Y) = \mu = \pi
\]</span>
and the standard deviation of <span class="math inline">\(Y\)</span> is equal to
<span class="math display">\[
SD(Y) = \sigma = \sqrt{\pi(1-\pi)}
\]</span>
The expected value (or mean) of a random variable measures the “long run” average value that we would see from <span class="math inline">\(Y\)</span> if we were to repeat the random trial many, many times. The standard deviation tells us how these values of <span class="math inline">\(Y\)</span> will vary over these repeated trials.</p>
</div>
<div id="logistic-model" class="section level2">
<h2><span class="header-section-number">4.3</span> The logistic model form</h2>
<p>The population, or data generating, model for a <strong>logistic</strong> regression model for <span class="math inline">\(Y\)</span> assumes that each <span class="math inline">\(Y_i\)</span> is a Bernoulli random variable whose probability of success <strong>depends on covariates</strong> <span class="math inline">\(\pmb{x_{1,i}, \dotsc, x_{p,i}}\)</span>. Specifically,</p>
<ul>
<li><span class="math inline">\(Y_i \mid X_i \overset{indep.}{\sim} Bern(\pi(X_i))\)</span>
<ul>
<li>binary response: <span class="math inline">\(Y_i\)</span>’s are categorical with only two options</li>
<li>independence: Given <span class="math inline">\(X_i\)</span> values, <span class="math inline">\(Y_i\)</span>’s are independent</li>
</ul></li>
</ul>
<p>We connect the linear combination of predictors
<span class="math display">\[
\eta_i = \beta_0 + \beta_1 x_{1,i} + \dotsm +  \beta_p x_{p,i}
\]</span>
to the probability of success using the logistic function form:
<span class="math display">\[
\pi(X_i) = \dfrac{e^{\eta_i}}{1 + e^{\eta_i}} = \dfrac{e^{\beta_0 + \beta_1 x_{1,i} + \dotsm +  \beta_p x_{p,i}}}{1 + e^{\beta_0 + \beta_1 x_{1,i} + \dotsm +  \beta_p x_{p,i}}}
\]</span></p>
<p>This function form is used because its inverse is equal to
<span class="math display">\[
\eta_i =  \beta_0 + \beta_1 x_{1,i} + \dotsm +  \beta_p x_{p,i}=  \ln \left(  \dfrac{\pi(X_i)}{1-\pi(X_i)}\right)
\]</span>
This function is called the <strong>logit function</strong>: <span class="math inline">\(logit(\pi) = \ln \left( \dfrac{\pi}{1-\pi}\right)\)</span>. This means that a one unit increase in <span class="math inline">\(x_1\)</span> can be interpreted as an additive <span class="math inline">\(\beta_1\)</span> change in in the logit function, holding other terms fixed. But what does this mean?</p>
<p>The <strong>odds of success</strong> is defined as the ratio of the probability of success to the probability of failure:
<span class="math display">\[
odds = \dfrac{\pi(X)}{1-\pi(X)}
\]</span>
For example, if the probability of success is 0.6 then the odds of success is <span class="math inline">\(0.6/0.4 = 1.5\)</span>. Meaning for every 6 successes, we see 4 failures. If the probability of success is 0.1, then the odds of success is <span class="math inline">\(0.1/0.9 \approx 0.111\)</span>, meaning for every 1 success we see 9 failures. Odds greater than 1 indicate the probability of success is above 50% while odds less than 1 indicate the probability of success is less than 50%.</p>
<p>So, we now can see that the logit function equals the <strong>log-odds of success</strong>:
<span class="math display">\[
\ln \left(  \dfrac{\pi(X_i)}{1-\pi(X_i)}\right) = \beta_0 + \beta_1 x_{1,i} + \dotsm +  \beta_p x_{p,i}
\]</span>
This model form is an example of a <strong>generalized linear model</strong> which relates the response <span class="math inline">\(Y\)</span> to predictors through a linear combination <span class="math inline">\(\eta\)</span> of predictors. Is does this by defining the following functions:</p>
<ul>
<li>The <strong>kernel mean function</strong> defines the expected value (mean) of <span class="math inline">\(Y\)</span> as a function of <span class="math inline">\(\eta\)</span>.
<ul>
<li>in a logistic model, the kernel mean function is the logistic function <span class="math inline">\(E(Y \mid X) = \pi(X) = \dfrac{e^{\eta}}{1+e^{\eta}}\)</span></li>
</ul></li>
<li>The <strong>link function</strong> defines the linear combination <span class="math inline">\(\eta\)</span> as a function of the mean of <span class="math inline">\(Y\)</span>.
<ul>
<li>in a logistic model, the link function is the logit function <span class="math inline">\(\eta = \ln(\pi/(1-\pi))\)</span></li>
</ul></li>
<li>These two functions are inverses of one another.</li>
</ul>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-181-1.png" width="864" /></p>
<div id="logistic-int" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Interpretation</h3>
<p>Changes in predictors can be interpreted as changes in the <strong>odds</strong> of success (we can’t make general statement about changes in the <strong>probability</strong> of success). Specifically, we “unlog” the logit equation to get an expression for the odds of success for predictors <span class="math inline">\(x_1, \dotsc, x_p\)</span>:
<span class="math display">\[
odds(x_1, \dotsc, x_p) = \dfrac{\pi(X)}{1-\pi(X)} = e^{\beta_0 + \beta_1 x_{1} + \dotsm +  \beta_p x_{p}}
\]</span></p>
<p>What happens if we increase <span class="math inline">\(x_1\)</span> by one unit, holding other predictors fixed?
<span class="math display">\[
odds(x_1+1, \dotsc, x_p)  = e^{\beta_0 + \beta_1 (x_{1}+1) + \dotsm +  \beta_p x_{p}} = e^{\beta_0 + \beta_1 x_{1} + \dotsm +  \beta_p x_{p}} \times e^{\beta_1}
\]</span>
Increasing <span class="math inline">\(x_1\)</span> by one unit has a <strong>multiplicative</strong> change of <span class="math inline">\(e^{\beta_1}\)</span> in the <strong>odds of success</strong>. Note that this is a similar interpretation to the exponential model in SLR or MLR.</p>
<p>The multiplicative change of <span class="math inline">\(e^{\beta_1}\)</span> is also called the <strong>odds ratio</strong> for a one unit increase in <span class="math inline">\(x_1\)</span>. An odds <em>ratio</em> is just the ratio of the odds for two different groups, here groups with <span class="math inline">\(x_1+1\)</span> vs. <span class="math inline">\(x_1\)</span>:
<span class="math display">\[
\dfrac{\textrm{odds of succes at } x_1+1}{\textrm{odds of succes at } x_1} = \dfrac{odds(x_1+1, \dotsc, x_p) }{odds(x_1, \dotsc, x_p) } = e^{\beta_1}
\]</span></p>
<p>What is we have a predictor that is logged?
<span class="math display">\[
odds(x_1, \dotsc, x_p) = e^{\beta_0 + \beta_1 \ln(x_{1}) + \dotsm +  \beta_p x_{p}} =   e^{\beta_0}x_1^{\beta_1} e^{\beta_2 x_2 + \dotsm +  \beta_p x_{p}}
\]</span></p>
<p>Then our interpretation is similar to a power model. Changing <span class="math inline">\(x_1\)</span> by a factor of <span class="math inline">\(m\)</span>:
<span class="math display">\[
odds(mx_1, \dotsc, x_p) =    e^{\beta_0}(mx_1)^{\beta_1} e^{\beta_2 x_2 + \dotsm +  \beta_p x_{p}} =    e^{\beta_0}x_1^{\beta_1} e^{\beta_2 x_2 + \dotsm +  \beta_p x_{p}} \times m^{\beta_1}
\]</span>
results in a multiplicative change of <span class="math inline">\(m^{\beta_1}\)</span> in the odds of success.</p>
</div>
</div>
<div id="logistic-est" class="section level2">
<h2><span class="header-section-number">4.4</span> Inference and estimation</h2>
<p>Estimation of logistic model parameters <span class="math inline">\(\beta_0, \dotsc, \beta_p\)</span> is done using <strong>maximum likelihood</strong> estimation (MLE). The likelihood function is the probability of the observed data, writen as a function of our unknown <span class="math inline">\(\beta\)</span>’s *(which are used to compute <span class="math inline">\(\pi(X_i)\)</span>’s)
<span class="math display">\[
L(\beta) = \prod_{i=1}^n \pi(X_i)^{y_i} (1-\pi(X_i))^{1-y_i}
\]</span>
Notice that for each case <span class="math inline">\(i\)</span>, the term in this product is equal to just <span class="math inline">\(\pi(X_i)\)</span> when case <span class="math inline">\(i\)</span> is a success (<span class="math inline">\(y_i=1\)</span>) and equal to <span class="math inline">\(1-\pi(X_i)\)</span> when case <span class="math inline">\(i\)</span> is a failure (<span class="math inline">\(y_i=0\)</span>).</p>
<p>Our MLE method says to find the <span class="math inline">\(\beta\)</span>’s that maximize the likelihood <span class="math inline">\(L(\beta)\)</span> of the observed data. Unlike SLR or MLR, there is no “closed form” for these MLE <span class="math inline">\(\hat{\beta}_i\)</span> estimates (meaning we can’t write down a formula for the estimates). Rather, software uses a numerical optimization method to compute the MLEs <span class="math inline">\(\hat{\beta}_i\)</span> <strong>and</strong> the standard errors <span class="math inline">\(SE(\hat{\beta}_i)\)</span>. (The R function <code>glm</code> uses Iterative reweighted least squares.)</p>
<p>These MLE estimates of <span class="math inline">\(\beta\)</span> parameters are approximately normally distributed and unbiased when n is “large enough.” Much like with “intro stats” inference, when your response variable is categorical (or, equivalently, binary 0/1), we usually use the normal distribution for inference (CI and tests). When your response variable is quantitative (like in SLR/MLR models), we usually use the t-distribution for inference.</p>
<div id="confidence-intervals-for-pmbbeta_i" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Confidence intervals for <span class="math inline">\(\pmb{\beta_i}\)</span></h3>
<p>A <span class="math inline">\(C\)</span>% confidence interval for <span class="math inline">\(\beta_i\)</span> equals
<span class="math display">\[
\hat{\beta}_i \pm z^*SE(\hat{\beta}_i)
\]</span>
where <span class="math inline">\(z^*\)</span> is the <span class="math inline">\((100-C)/2\)</span> percentile from the <span class="math inline">\(N(0,1)\)</span> distribution.</p>
</div>
<div id="hypothesis-tests-for-pmbbeta_i" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Hypothesis tests for <span class="math inline">\(\pmb{\beta_i}\)</span></h3>
<p>We can test the hypothesis
<span class="math display">\[
H_0: \beta_i = \beta^*_i
\]</span>
with the following z-test statistic:
<span class="math display">\[
z =\dfrac{\hat{\beta}_i - \beta^*_i}{SE(\hat{\beta}_i)}
\]</span>
where <span class="math inline">\(\beta^*_i\)</span> is our hypothesized value of <span class="math inline">\(\beta_i\)</span> . The <span class="math inline">\(N(0,1)\)</span> is used to compute the p-value that is appropriate for whatever <span class="math inline">\(H_A\)</span> is specified.</p>
<p>The usual test results given by standard regression output tests whether a parameter value (intercept or slope) is equal to 0 vs. not equal to 0:
<span class="math display">\[
H_0: \beta_i = 0 \ \ \ \ \ H_A: \beta_i \neq 0
\]</span>
with a test stat of
<span class="math display">\[
z =\dfrac{\hat{\beta}_i - 0}{SE(\hat{\beta}_i)}
\]</span></p>
</div>
<div id="r-glm" class="section level3">
<h3><span class="header-section-number">4.4.3</span> R <code>glm</code></h3>
<p>We fit a logistic regression model in R with the <code>glm</code> function. The basic syntax is</p>
<pre><code>glm(y ~ x1 + x2, family = binomial, data= )</code></pre>
<p>Careful not to forget the <code>family=binomial</code> argument! If you omit this, you will just be trying to fit a regular MLR model which is not appropriate for a categorical response.</p>
<p>The variable <code>y</code> can be either form:</p>
<ul>
<li><code>y</code> can be binary 0/1 coded response where <code>1</code> is a “success”</li>
<li><code>y</code> can be a <code>factor</code> variable with two levels. The <strong>second</strong> level is what R will call a “success”</li>
</ul>
<p>Once you fit a <code>glm</code> model, you can extract attributes of the model</p>
<ul>
<li><code>fitted(my.glm)</code> gives the estimated probabilities of success for each case in your data</li>
<li><code>predict(my.glm)</code> gives estimated log-odds of success for each case in your data. Add <code>newdata=</code> to get predicted log-odds for new data.</li>
<li><code>predict(my.glm, type = "response")</code> gives estimated probabilities of success for each case in your data. Add <code>newdata=</code> to get predicted probabilities for new data.</li>
</ul>
<p>The <code>broom</code> package also allows us to get fitted probabilities or log odds for all cases in the data, or for new data:</p>
<ul>
<li><code>augment(my.glm)</code> gets estimated log-odds of success added to the variables used in the <code>glm</code> fit.
<ul>
<li>add <code>data=my.data</code> to get estimated log-odds added to the full data set <code>my.data</code> used in the <code>glm</code> fit</li>
<li>add <code>newdata= new.data</code> to get predicted log-odds added to the new data set <code>new.data</code></li>
</ul></li>
<li><code>augment(my.glm, type.predict= "response")</code> gets estimated probabilities of success added to the variables used in the <code>glm</code> fit.
<ul>
<li>add <code>data=my.data</code> to get estimated probabilities added to the full data set <code>my.data</code> used in the <code>glm</code> fit</li>
<li>add <code>newdata= new.data</code> to get predicted probabilities added to the new data set <code>new.data</code></li>
</ul></li>
</ul>
</div>
<div id="logistic-donner2" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Example: Donner party model</h3>
<p>Let’s revist the Donner party data and start with considering the logistic regression of survival status on age (only). We can add the fitted logistic model probability curve the scatterplot we created in Section <a href="logistic.html#logistic-donner1">4.1.1</a>. We use the <code>glm</code> smoothing method with an <code>args</code> that specifies the <code>binomial</code> family:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="logistic.html#cb166-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(donner, <span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> Ind_surv)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb166-2"><a href="logistic.html#cb166-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Status), <span class="dt">height =</span> <span class="fl">.01</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb166-3"><a href="logistic.html#cb166-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;glm&quot;</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span>binomial), <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb166-4"><a href="logistic.html#cb166-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;probability of survival&quot;</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-182-1.png" width="672" /></p>
<p>We can see that an age of about 30 yields an estimated survival probability of 50% while an age of about 45 yields an estimated survival probability of 25%. We can better quantify these values by fitting the model using the <code>glm</code> function.</p>
<p>Here is our simple model, the logistic regression of survival on age:
<span class="math display">\[
logit(\pi) = \log(\dfrac{\pi}{1-\pi}) = \beta_0 + \beta_1 Age 
\]</span></p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="logistic.html#cb167-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">levels</span>(donner<span class="op">$</span>Status)  <span class="co"># second level = Surived</span></span>
<span id="cb167-2"><a href="logistic.html#cb167-2"></a><span class="co">## [1] &quot;Died&quot;     &quot;Survived&quot;</span></span>
<span id="cb167-3"><a href="logistic.html#cb167-3"></a><span class="op">&gt;</span><span class="st"> </span>donner.glm1 &lt;-<span class="st"> </span><span class="kw">glm</span>( Status <span class="op">~</span><span class="st"> </span>Age , <span class="dt">family=</span>binomial, <span class="dt">data=</span>donner)</span>
<span id="cb167-4"><a href="logistic.html#cb167-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(donner.glm1)</span>
<span id="cb167-5"><a href="logistic.html#cb167-5"></a><span class="co">## </span></span>
<span id="cb167-6"><a href="logistic.html#cb167-6"></a><span class="co">## Call:</span></span>
<span id="cb167-7"><a href="logistic.html#cb167-7"></a><span class="co">## glm(formula = Status ~ Age, family = binomial, data = donner)</span></span>
<span id="cb167-8"><a href="logistic.html#cb167-8"></a><span class="co">## </span></span>
<span id="cb167-9"><a href="logistic.html#cb167-9"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb167-10"><a href="logistic.html#cb167-10"></a><span class="co">##     Min       1Q   Median       3Q      Max  </span></span>
<span id="cb167-11"><a href="logistic.html#cb167-11"></a><span class="co">## -1.5401  -1.1594  -0.4651   1.0842   1.7283  </span></span>
<span id="cb167-12"><a href="logistic.html#cb167-12"></a><span class="co">## </span></span>
<span id="cb167-13"><a href="logistic.html#cb167-13"></a><span class="co">## Coefficients:</span></span>
<span id="cb167-14"><a href="logistic.html#cb167-14"></a><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)  </span></span>
<span id="cb167-15"><a href="logistic.html#cb167-15"></a><span class="co">## (Intercept)  1.81852    0.99937   1.820   0.0688 .</span></span>
<span id="cb167-16"><a href="logistic.html#cb167-16"></a><span class="co">## Age         -0.06647    0.03222  -2.063   0.0391 *</span></span>
<span id="cb167-17"><a href="logistic.html#cb167-17"></a><span class="co">## ---</span></span>
<span id="cb167-18"><a href="logistic.html#cb167-18"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb167-19"><a href="logistic.html#cb167-19"></a><span class="co">## </span></span>
<span id="cb167-20"><a href="logistic.html#cb167-20"></a><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb167-21"><a href="logistic.html#cb167-21"></a><span class="co">## </span></span>
<span id="cb167-22"><a href="logistic.html#cb167-22"></a><span class="co">##     Null deviance: 61.827  on 44  degrees of freedom</span></span>
<span id="cb167-23"><a href="logistic.html#cb167-23"></a><span class="co">## Residual deviance: 56.291  on 43  degrees of freedom</span></span>
<span id="cb167-24"><a href="logistic.html#cb167-24"></a><span class="co">## AIC: 60.291</span></span>
<span id="cb167-25"><a href="logistic.html#cb167-25"></a><span class="co">## </span></span>
<span id="cb167-26"><a href="logistic.html#cb167-26"></a><span class="co">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb167-27"><a href="logistic.html#cb167-27"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">confint</span>(donner.glm1)</span>
<span id="cb167-28"><a href="logistic.html#cb167-28"></a><span class="co">##                    2.5 %      97.5 %</span></span>
<span id="cb167-29"><a href="logistic.html#cb167-29"></a><span class="co">## (Intercept) -0.005987258  3.99016010</span></span>
<span id="cb167-30"><a href="logistic.html#cb167-30"></a><span class="co">## Age         -0.139737905 -0.01016096</span></span></code></pre></div>
<p>The estimated log odds of survival is
<span class="math display">\[
logit(\hat{\pi}) = \dfrac{\hat{\pi}}{1-\hat{\pi}} = 1.81852  -0.06647  Age
\]</span>
and the estimated odds of survival is
<span class="math display">\[
\hat{odds}(age) = \dfrac{\hat{\pi}}{1-\hat{\pi}} = e^{1.81852}e^{-0.06647 Age}
\]</span>
and the estimated probability of survival is
<span class="math display">\[
\hat{\pi}(age) =  \dfrac{e^{1.81852  -0.06647  Age}}{1+e^{1.81852  -0.06647  Age}}
\]</span></p>
<p>A one year increase in age will have a <span class="math inline">\(e^{-0.06647} = 0.936\)</span> multiplicative change on the odds of survival. A one year increase in age decreases the odds of survival by 6.4% (95% CI 0.3% to 12.2%).</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="logistic.html#cb168-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.06647</span>)   <span class="co"># factor change</span></span>
<span id="cb168-2"><a href="logistic.html#cb168-2"></a><span class="co">## [1] 0.935691</span></span>
<span id="cb168-3"><a href="logistic.html#cb168-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(<span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.06647</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)  <span class="co"># percent change</span></span>
<span id="cb168-4"><a href="logistic.html#cb168-4"></a><span class="co">## [1] -6.430901</span></span>
<span id="cb168-5"><a href="logistic.html#cb168-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.06647</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="fl">0.03222</span>)   <span class="co"># factor change CI</span></span>
<span id="cb168-6"><a href="logistic.html#cb168-6"></a><span class="co">## [1] 0.8784291 0.9966855</span></span>
<span id="cb168-7"><a href="logistic.html#cb168-7"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(<span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.06647</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="fl">0.03222</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)  <span class="co"># % change CI</span></span>
<span id="cb168-8"><a href="logistic.html#cb168-8"></a><span class="co">## [1] -12.1570864  -0.3314455</span></span></code></pre></div>
<p>The <code>broom</code> package’s <code>tidy</code> function can also be used to get estimates, SEs and confidence intervals. If we add <code>exponentiate=TRUE</code>, then we we get exponentiated estiamtes and confidence intervals (but SE, test stat and p-values are untouched).</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="logistic.html#cb169-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(broom)</span>
<span id="cb169-2"><a href="logistic.html#cb169-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tidy</span>(donner.glm1, <span class="dt">conf.int=</span><span class="ot">TRUE</span>)</span>
<span id="cb169-3"><a href="logistic.html#cb169-3"></a><span class="co">## # A tibble: 2 x 7</span></span>
<span id="cb169-4"><a href="logistic.html#cb169-4"></a><span class="co">##   term        estimate std.error statistic p.value conf.low conf.high</span></span>
<span id="cb169-5"><a href="logistic.html#cb169-5"></a><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb169-6"><a href="logistic.html#cb169-6"></a><span class="co">## 1 (Intercept)   1.82      0.999       1.82  0.0688 -0.00599    3.99  </span></span>
<span id="cb169-7"><a href="logistic.html#cb169-7"></a><span class="co">## 2 Age          -0.0665    0.0322     -2.06  0.0391 -0.140     -0.0102</span></span>
<span id="cb169-8"><a href="logistic.html#cb169-8"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tidy</span>(donner.glm1, <span class="dt">conf.int=</span><span class="ot">TRUE</span>, <span class="dt">exponentiate =</span> <span class="ot">TRUE</span>)</span>
<span id="cb169-9"><a href="logistic.html#cb169-9"></a><span class="co">## # A tibble: 2 x 7</span></span>
<span id="cb169-10"><a href="logistic.html#cb169-10"></a><span class="co">##   term        estimate std.error statistic p.value conf.low conf.high</span></span>
<span id="cb169-11"><a href="logistic.html#cb169-11"></a><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb169-12"><a href="logistic.html#cb169-12"></a><span class="co">## 1 (Intercept)    6.16     0.999       1.82  0.0688    0.994    54.1  </span></span>
<span id="cb169-13"><a href="logistic.html#cb169-13"></a><span class="co">## 2 Age            0.936    0.0322     -2.06  0.0391    0.870     0.990</span></span></code></pre></div>
<p>We can use the <code>predict</code> command with <code>response</code> type values to get predicted survival rates for 30 and 45 year olds:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="logistic.html#cb170-1"></a><span class="op">&gt;</span><span class="st"> </span>new.ages &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Age =</span> <span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">45</span>))</span>
<span id="cb170-2"><a href="logistic.html#cb170-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">predict</span>(donner.glm1, <span class="dt">newdata =</span> new.ages, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb170-3"><a href="logistic.html#cb170-3"></a><span class="co">##         1         2 </span></span>
<span id="cb170-4"><a href="logistic.html#cb170-4"></a><span class="co">## 0.4562149 0.2363774</span></span>
<span id="cb170-5"><a href="logistic.html#cb170-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="fl">1.81852</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.06647</span><span class="op">*</span><span class="dv">30</span>)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(<span class="fl">1.81852</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.06647</span><span class="op">*</span><span class="dv">30</span>))  <span class="co"># prob age=30</span></span>
<span id="cb170-6"><a href="logistic.html#cb170-6"></a><span class="co">## [1] 0.4562174</span></span>
<span id="cb170-7"><a href="logistic.html#cb170-7"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="fl">1.81852</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.06647</span><span class="op">*</span><span class="dv">45</span>)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(<span class="fl">1.81852</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.06647</span><span class="op">*</span><span class="dv">45</span>))  <span class="co"># prob age=45</span></span>
<span id="cb170-8"><a href="logistic.html#cb170-8"></a><span class="co">## [1] 0.2363799</span></span></code></pre></div>
<p>So we have
<span class="math display">\[
\hat{\pi}(age = 30)  =  \dfrac{e^{1.81852  -0.06647(30)}}{1+e^{1.81852  -0.06647(30)}} \approx 0.456
\]</span>
and
<span class="math display">\[
\hat{\pi}(age = 45)  =  \dfrac{e^{1.81852  -0.06647(45)}}{1+e^{1.81852  -0.06647(45)}} \approx 0.236
\]</span></p>
<p>Finally, what if we want to understand how the odds of <em>death</em> change as a function of age? Well, odds of death is equal to the ratio death to survival probabilities:
<span class="math display">\[
\hat{odds.death}(age) = \dfrac{1-\hat{\pi}}{\hat{\pi}} = \dfrac{1}{e^{1.81852}e^{-0.06647 Age}} = e^{-1.81852}e^{0.06647 Age}
\]</span>
A one year increase in age will have a <span class="math inline">\(e^{0.06647} = 1.069\)</span> multiplicative change on the odds of survival. A one year increase in age increases the odds of death by 6.9% (95% CI 0.3% to 13.8%).</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="logistic.html#cb171-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="fl">0.06647</span>)   <span class="co"># factor change in odds of death</span></span>
<span id="cb171-2"><a href="logistic.html#cb171-2"></a><span class="co">## [1] 1.068729</span></span>
<span id="cb171-3"><a href="logistic.html#cb171-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(<span class="kw">exp</span>(<span class="fl">0.06647</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)  <span class="co"># percent change</span></span>
<span id="cb171-4"><a href="logistic.html#cb171-4"></a><span class="co">## [1] 6.87289</span></span>
<span id="cb171-5"><a href="logistic.html#cb171-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="fl">0.06647</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="fl">0.03222</span>)   <span class="co"># factor change CI</span></span>
<span id="cb171-6"><a href="logistic.html#cb171-6"></a><span class="co">## [1] 1.003325 1.138396</span></span>
<span id="cb171-7"><a href="logistic.html#cb171-7"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(<span class="kw">exp</span>(<span class="fl">0.06647</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="fl">0.03222</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)  <span class="co"># % change CI</span></span>
<span id="cb171-8"><a href="logistic.html#cb171-8"></a><span class="co">## [1]  0.3325478 13.8395756</span></span></code></pre></div>
<p>We can verify our mathematical work by refitting a <code>glm</code> with an indicator of <em>death</em>:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="logistic.html#cb172-1"></a><span class="op">&gt;</span><span class="st"> </span>donner<span class="op">$</span>Ind_death &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">recode</span>(donner<span class="op">$</span>Status, <span class="dt">Survived =</span> <span class="dv">0</span>, <span class="dt">Died =</span> <span class="dv">1</span>)</span>
<span id="cb172-2"><a href="logistic.html#cb172-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tidy</span>(<span class="kw">glm</span>(Ind_death <span class="op">~</span><span class="st"> </span>Age, <span class="dt">family =</span> binomial, <span class="dt">data=</span>donner))</span>
<span id="cb172-3"><a href="logistic.html#cb172-3"></a><span class="co">## # A tibble: 2 x 5</span></span>
<span id="cb172-4"><a href="logistic.html#cb172-4"></a><span class="co">##   term        estimate std.error statistic p.value</span></span>
<span id="cb172-5"><a href="logistic.html#cb172-5"></a><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb172-6"><a href="logistic.html#cb172-6"></a><span class="co">## 1 (Intercept)  -1.82      0.999      -1.82  0.0688</span></span>
<span id="cb172-7"><a href="logistic.html#cb172-7"></a><span class="co">## 2 Age           0.0665    0.0322      2.06  0.0391</span></span></code></pre></div>
</div>
<div id="logistic-donner3" class="section level3">
<h3><span class="header-section-number">4.4.5</span> Example: Donner party, adding sex</h3>
<p>We will fit the logistic regression of survival on age and sex:
<span class="math display">\[
logit(\pi) = \log(\dfrac{\pi}{1-\pi}) = \beta_0 + \beta_1 Age + \beta_2 Male
\]</span></p>
<p>The estimated mode fit is:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="logistic.html#cb173-1"></a><span class="op">&gt;</span><span class="st"> </span>donner.glm2 &lt;-<span class="st"> </span><span class="kw">glm</span>( Status <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Sex, <span class="dt">family=</span>binomial, <span class="dt">data=</span>donner)</span>
<span id="cb173-2"><a href="logistic.html#cb173-2"></a><span class="op">&gt;</span><span class="st"> </span>donner.glm2</span>
<span id="cb173-3"><a href="logistic.html#cb173-3"></a><span class="co">## </span></span>
<span id="cb173-4"><a href="logistic.html#cb173-4"></a><span class="co">## Call:  glm(formula = Status ~ Age + Sex, family = binomial, data = donner)</span></span>
<span id="cb173-5"><a href="logistic.html#cb173-5"></a><span class="co">## </span></span>
<span id="cb173-6"><a href="logistic.html#cb173-6"></a><span class="co">## Coefficients:</span></span>
<span id="cb173-7"><a href="logistic.html#cb173-7"></a><span class="co">## (Intercept)          Age      SexMale  </span></span>
<span id="cb173-8"><a href="logistic.html#cb173-8"></a><span class="co">##      3.2304      -0.0782      -1.5973  </span></span>
<span id="cb173-9"><a href="logistic.html#cb173-9"></a><span class="co">## </span></span>
<span id="cb173-10"><a href="logistic.html#cb173-10"></a><span class="co">## Degrees of Freedom: 44 Total (i.e. Null);  42 Residual</span></span>
<span id="cb173-11"><a href="logistic.html#cb173-11"></a><span class="co">## Null Deviance:	    61.83 </span></span>
<span id="cb173-12"><a href="logistic.html#cb173-12"></a><span class="co">## Residual Deviance: 51.26 	AIC: 57.26</span></span>
<span id="cb173-13"><a href="logistic.html#cb173-13"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tidy</span>(donner.glm2, <span class="dt">conf.int=</span><span class="ot">TRUE</span>)</span>
<span id="cb173-14"><a href="logistic.html#cb173-14"></a><span class="co">## # A tibble: 3 x 7</span></span>
<span id="cb173-15"><a href="logistic.html#cb173-15"></a><span class="co">##   term        estimate std.error statistic p.value conf.low conf.high</span></span>
<span id="cb173-16"><a href="logistic.html#cb173-16"></a><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb173-17"><a href="logistic.html#cb173-17"></a><span class="co">## 1 (Intercept)   3.23      1.39        2.33  0.0198    0.851    6.43  </span></span>
<span id="cb173-18"><a href="logistic.html#cb173-18"></a><span class="co">## 2 Age          -0.0782    0.0373     -2.10  0.0359   -0.162   -0.0141</span></span>
<span id="cb173-19"><a href="logistic.html#cb173-19"></a><span class="co">## 3 SexMale      -1.60      0.755      -2.11  0.0345   -3.23    -0.195</span></span>
<span id="cb173-20"><a href="logistic.html#cb173-20"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tidy</span>(donner.glm2, <span class="dt">conf.int=</span><span class="ot">TRUE</span>, <span class="dt">exponentiate =</span> <span class="ot">TRUE</span>)</span>
<span id="cb173-21"><a href="logistic.html#cb173-21"></a><span class="co">## # A tibble: 3 x 7</span></span>
<span id="cb173-22"><a href="logistic.html#cb173-22"></a><span class="co">##   term        estimate std.error statistic p.value conf.low conf.high</span></span>
<span id="cb173-23"><a href="logistic.html#cb173-23"></a><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb173-24"><a href="logistic.html#cb173-24"></a><span class="co">## 1 (Intercept)   25.3      1.39        2.33  0.0198   2.34     618.   </span></span>
<span id="cb173-25"><a href="logistic.html#cb173-25"></a><span class="co">## 2 Age            0.925    0.0373     -2.10  0.0359   0.850      0.986</span></span>
<span id="cb173-26"><a href="logistic.html#cb173-26"></a><span class="co">## 3 SexMale        0.202    0.755      -2.11  0.0345   0.0396     0.823</span></span></code></pre></div>
<p>The estimated log odds of survival is
<span class="math display">\[
logit(\hat{\pi}) = \dfrac{\hat{\pi}}{1-\hat{\pi}} = 3.23041 -0.07820  Age -1.59729 Male
\]</span>
and the estimated odds of survival is
<span class="math display">\[
odds(Sex, Age) = \dfrac{\hat{\pi}}{1-\hat{\pi}} = e^{3.23041}e^{-0.07820 Age}e^{-1.59729 Male} = (25.3)(0.925)^{Age}(0.202)^{Male}
\]</span>
and the estimated probability of survival is
<span class="math display">\[
\hat{\pi}(Sex, Age) =  \dfrac{e^{3.23041 -0.07820  Age -1.59729 Male}}{1+e^{3.23041 -0.07820  Age -1.59729 Male}} 
\]</span></p>
<p>The exponentiated coefficient estimates give the odds ratios for a one unit increase in age or for males (compated to females).</p>
<p>Holding gender constant, a one year increase in age decreases the odds of survival by 7.5% (95% CI 0.5% to 14.0%).</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="logistic.html#cb174-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.07820</span>)  <span class="co"># age effect on odds</span></span>
<span id="cb174-2"><a href="logistic.html#cb174-2"></a><span class="co">## [1] 0.9247795</span></span>
<span id="cb174-3"><a href="logistic.html#cb174-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(<span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.07820</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)  <span class="co"># % change</span></span>
<span id="cb174-4"><a href="logistic.html#cb174-4"></a><span class="co">## [1] -7.522055</span></span>
<span id="cb174-5"><a href="logistic.html#cb174-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.07820</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="fl">0.03728</span>)  <span class="co"># CI for factor </span></span>
<span id="cb174-6"><a href="logistic.html#cb174-6"></a><span class="co">## [1] 0.8596178 0.9948806</span></span>
<span id="cb174-7"><a href="logistic.html#cb174-7"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(<span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.07820</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="fl">0.03728</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)  <span class="co"># CI for % change</span></span>
<span id="cb174-8"><a href="logistic.html#cb174-8"></a><span class="co">## [1] -14.0382243  -0.5119394</span></span></code></pre></div>
<p>Holding age constant, males had a 79.8% lower odds of survival compared to females (95% CI 11.0% to 95.4%).
<span class="math display">\[
\textrm{estimated odds ratio of survival for males vs females} = \dfrac{\hat{odds}(Sex=male,Age)}{\hat{odds}(Sex=female,Age)} = e^{-1.5973}
\]</span></p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="logistic.html#cb175-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">1.59729</span>)</span>
<span id="cb175-2"><a href="logistic.html#cb175-2"></a><span class="co">## [1] 0.2024444</span></span>
<span id="cb175-3"><a href="logistic.html#cb175-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(<span class="kw">exp</span>(<span class="op">-</span><span class="fl">1.59729</span>) <span class="dv">-1</span> )</span>
<span id="cb175-4"><a href="logistic.html#cb175-4"></a><span class="co">## [1] -79.75556</span></span>
<span id="cb175-5"><a href="logistic.html#cb175-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">1.59729</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="fl">0.75547</span>)</span>
<span id="cb175-6"><a href="logistic.html#cb175-6"></a><span class="co">## [1] 0.0460520 0.8899447</span></span>
<span id="cb175-7"><a href="logistic.html#cb175-7"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(<span class="kw">exp</span>(<span class="op">-</span><span class="fl">1.59729</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="fl">0.75547</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb175-8"><a href="logistic.html#cb175-8"></a><span class="co">## [1] -95.39480 -11.00553</span></span></code></pre></div>
<p>What if we wanted the odds ratio for comparing females to males?
<span class="math display">\[
\textrm{estimated odds ratio of survival for females vs males} = \dfrac{\hat{odds}(Sex=female,Age)}{\hat{odds}(Sex=male,Age)} = \dfrac{1}{e^{-1.5973}} = e^{1.5973}
\]</span>
Holding age constant, females had a 4.9-fold increased odds of survival (95% CI 1.1 to 21.7).</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="logistic.html#cb176-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># odds ratio Female/Male</span></span>
<span id="cb176-2"><a href="logistic.html#cb176-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">1.59729</span>)  </span>
<span id="cb176-3"><a href="logistic.html#cb176-3"></a><span class="co">## [1] 4.939628</span></span>
<span id="cb176-4"><a href="logistic.html#cb176-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">1.59729</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="fl">0.75547</span>)</span>
<span id="cb176-5"><a href="logistic.html#cb176-5"></a><span class="co">## [1] 21.714581  1.123665</span></span></code></pre></div>
<p>There are two separate log-odds, odds and probability functions for the two levels of <code>Sex</code> in the model. Since we do not have an interaction between <code>Sex</code> and <code>Age</code>, we have a parallel line log-odds model. To plot the probabilities for each <code>Sex</code> as <code>Age</code> varies, we need to get the fitted probabities for each case in the data set:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="logistic.html#cb177-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(broom)</span>
<span id="cb177-2"><a href="logistic.html#cb177-2"></a><span class="op">&gt;</span><span class="st"> </span>donner.aug2 &lt;-<span class="st"> </span><span class="kw">augment</span>(<span class="dt">data=</span>donner, donner.glm2, <span class="dt">type.predict =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb177-3"><a href="logistic.html#cb177-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(donner.aug2)</span>
<span id="cb177-4"><a href="logistic.html#cb177-4"></a><span class="co">## # A tibble: 6 x 12</span></span>
<span id="cb177-5"><a href="logistic.html#cb177-5"></a><span class="co">##     Age Sex   Status Ind_surv Ind_death .fitted .se.fit .resid   .hat .sigma</span></span>
<span id="cb177-6"><a href="logistic.html#cb177-6"></a><span class="co">##   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb177-7"><a href="logistic.html#cb177-7"></a><span class="co">## 1    23 Male  Died          0         1   0.459  0.111  -1.11  0.0492   1.10</span></span>
<span id="cb177-8"><a href="logistic.html#cb177-8"></a><span class="co">## 2    40 Fema~ Survi~        1         0   0.526  0.160   1.13  0.103    1.10</span></span>
<span id="cb177-9"><a href="logistic.html#cb177-9"></a><span class="co">## 3    40 Male  Survi~        1         0   0.183  0.0921  1.84  0.0567   1.08</span></span>
<span id="cb177-10"><a href="logistic.html#cb177-10"></a><span class="co">## 4    30 Male  Died          0         1   0.329  0.0924 -0.893 0.0387   1.11</span></span>
<span id="cb177-11"><a href="logistic.html#cb177-11"></a><span class="co">## 5    28 Male  Died          0         1   0.364  0.0949 -0.952 0.0389   1.11</span></span>
<span id="cb177-12"><a href="logistic.html#cb177-12"></a><span class="co">## 6    40 Male  Died          0         1   0.183  0.0921 -0.636 0.0567   1.11</span></span>
<span id="cb177-13"><a href="logistic.html#cb177-13"></a><span class="co">## # ... with 2 more variables: .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</span></span></code></pre></div>
<p>Then add <code>geom_line</code> with the <code>.fitted</code> probabilities for each <code>Sex</code> (by <code>linetype</code>) added to the y-axis of the jittered scatterplot:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="logistic.html#cb178-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(donner.aug2, <span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> Ind_surv)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-2"><a href="logistic.html#cb178-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Status), <span class="dt">height =</span> <span class="fl">.01</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-3"><a href="logistic.html#cb178-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>.fitted, <span class="dt">linetype=</span>Sex)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-4"><a href="logistic.html#cb178-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;probability of survival&quot;</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-194-1.png" width="672" /></p>
<p>Note that these lines are <em>not</em> parallel on the probability scale while they are on the log-odds scale. This is because we apply the logistic function to the log-odds to produce our probabilities. The logistic function is not a linear function, so it does not produce parallel lines (or even lines at all).</p>
</div>
</div>
<div id="logistic-dev" class="section level2">
<h2><span class="header-section-number">4.5</span> Deviance</h2>
<p>In a MLR, ANOVA is used to determine how much of the overall variability in a quantatitive response is explained by the model. With large <span class="math inline">\(n\)</span> and/or normally distributed errors, F tests can be used to compare models based on how much the residual sum of squares is reduced by adding terms.</p>
<p>In a GLM, <strong>deviance</strong> is the term used to measure “unexplained” variation in the response. When the GLM <em>is</em> a MLR model, deviance equals the residual sum of squares. In a logistic GLM deviance, denoted as <span class="math inline">\(G^2\)</span>, is the difference of two likelihoods (defined in @(logistic-est)):
<span class="math display">\[
G^2 = 2[\ln L(\bar{\pi}) - \ln L(\hat{\pi}(X))] = 2\sum_{i=1}^n \left[ y_i \ln \left( \dfrac{y_i}{\hat{\pi}(X_i)} \right) + (1- y_i) \ln \left( \dfrac{1-y_i}{1-\hat{\pi}(X_i)} \right) \right]
\]</span></p>
<ul>
<li><span class="math inline">\(L(\hat{\pi}(X)):\)</span> likelihood of the data that plugs in estimates <span class="math inline">\(\hat{\pi}(X_i)\)</span> from the logistic model.</li>
<li><span class="math inline">\(L(\bar{\pi}):\)</span> likelihood of the data that plugs in estimates <span class="math inline">\(\bar{\pi} = y_i\)</span>, basing a case’s “predicted” value soley on the response observed for that case. This is called a <strong>saturated</strong> model and it will always have a higher likelihood than the logistic model: <span class="math inline">\(L(\bar{\pi}) \geq L(\hat{\pi}(X))\)</span></li>
</ul>
<p>Deviance, sometimes called <em>residual</em> deviance, is close to 0 when the logistic model is a good predictor of the responses. Meaning <span class="math inline">\(\hat{\pi}(X_i)\)</span> are close to 1 when <span class="math inline">\(y_i = 1\)</span> and close to 0 when <span class="math inline">\(y_i = 0\)</span>. Residual deviance will decrease as model terms are added to the logistic model. We can compare nested logistic models by comparing deviance.</p>
<div id="drop-in-deviance-test" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Drop in Deviance test</h3>
<ol style="list-style-type: decimal">
<li><p>Hypotheses: <span class="math inline">\(H_0:\)</span> reduced model vs. <span class="math inline">\(H_A:\)</span> full model</p></li>
<li><p>Test Statistic: The likelihood ratio test (LRT) stat compares the <strong>drop in deviance</strong> from the reduced to the full models
<span class="math display">\[
LRT = G^2_{reduced} - G^2_{full}
\]</span></p></li>
<li><p>When <span class="math inline">\(n\)</span> is “large enough”, the LRT will have a chi-square (<span class="math inline">\(\chi^2\)</span>) distribution with <span class="math inline">\(df = df_{reduced} - df_{full}\)</span>.The p-value is a <strong>right tailed</strong> area
<span class="math display">\[
p-value = P(\chi^2 &gt; LRT) =  1- pchisq(LRT, df)
\]</span></p></li>
</ol>
<p>Special cases of drop in deviance tests:</p>
<ul>
<li><p>The <strong>overall</strong> drop in deviance test compares a null “intercept only” model to a logistic model:
<span class="math display">\[
H_0: \ln(odds) = \beta_0 \ \ \ \ H_A: \ln(odds) = \beta_0 + \beta_1 x_1 + \dotsm + \beta_p x_p
\]</span>
The deviance for the null model is computed by using the overall rate of success as the estimated <span class="math inline">\(\hat{\pi}\)</span> for all cases. This null deviance is similar in spirit to the total sum of squares in ANOVA.</p></li>
<li><p>If our reduced and full models differ by <strong>one term</strong>, then the drop in deviance test will test the same hypotheses as the z-test (a.k.a. Wald test) for the term, but the two methods of testing are not identical. The two types of tests will usually give results that agree, but if they do not agree you should use the drop in deviance LRT test results.</p></li>
</ul>
<p>We can compare two logistic models in R via a drop in deviance test using the command</p>
<pre><code>anova(reduced.glm, full.glm, test = &quot;Chisq&quot;)</code></pre>
<p>The <code>anova</code> command with just one model gives the residual deviance drops for adding each term listed to the model that already contains the terms above it. (Much like <code>anova</code> for a MLR.)</p>
</div>
<div id="example-nes" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Example: NES</h3>
<p>The National Election Studies project recorded party identification for two random samples of people during 1980 and 2000.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="logistic.html#cb180-1"></a><span class="op">&gt;</span><span class="st"> </span>nes &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://people.carleton.edu/~kstclair/data/NES.csv&quot;</span>)</span>
<span id="cb180-2"><a href="logistic.html#cb180-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(nes)</span>
<span id="cb180-3"><a href="logistic.html#cb180-3"></a><span class="co">##       year age gender  race region     income union dem       educ</span></span>
<span id="cb180-4"><a href="logistic.html#cb180-4"></a><span class="co">## 1 year1980  70   male black      S  lower 1/3    no   1 HS or less</span></span>
<span id="cb180-5"><a href="logistic.html#cb180-5"></a><span class="co">## 2 year1980  67   male white     NC middle 1/3   yes   1 HS or less</span></span>
<span id="cb180-6"><a href="logistic.html#cb180-6"></a><span class="co">## 3 year1980  47 female black      S  lower 1/3    no   1 HS or less</span></span>
<span id="cb180-7"><a href="logistic.html#cb180-7"></a><span class="co">## 4 year1980  52 female white      W  upper 1/3   yes   0    College</span></span>
<span id="cb180-8"><a href="logistic.html#cb180-8"></a><span class="co">## 5 year1980  30 female white     NC  upper 1/3    no   1 HS or less</span></span>
<span id="cb180-9"><a href="logistic.html#cb180-9"></a><span class="co">## 6 year1980  37   male black     NC  upper 1/3    no   1    College</span></span></code></pre></div>
<p>Here we recode the binary Democrat voter party affiliation <code>dem</code> variable to record two levels: <code>Democrat</code> and <code>Other</code>. Here we see the proportion of Democrats (in red) by region for the survey years of 1980 and 2000. In the south, we see a decrease in the proportion of Democrats between 1980 and 2000. In the north east, we see an increase in the proportion of Democrats between 1980 and 2000. This gives us evidence that the effect of year (1980 vs 2000) on the odds of being a Democrat depend on the region of the country.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="logistic.html#cb181-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># recode to make a factor version:</span></span>
<span id="cb181-2"><a href="logistic.html#cb181-2"></a><span class="er">&gt;</span><span class="st"> </span>nes<span class="op">$</span>party &lt;-<span class="st"> </span><span class="kw">recode_factor</span>(nes<span class="op">$</span>dem, <span class="st">`</span><span class="dt">1</span><span class="st">`</span>=<span class="st">&quot;Democrat&quot;</span>, <span class="st">`</span><span class="dt">0</span><span class="st">`</span>=<span class="st">&quot;Other&quot;</span>)</span>
<span id="cb181-3"><a href="logistic.html#cb181-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(nes, <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">fill =</span> party)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb181-4"><a href="logistic.html#cb181-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;fill&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb181-5"><a href="logistic.html#cb181-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">facet_wrap</span>(<span class="op">~</span>region)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-196-1.png" width="672" /></p>
<p>This EDA suggests that an interaction between year and region is needed, so our first model for the log odds of being a <strong>Democrat</strong> (<code>dem = 1</code>) looks like
<span class="math display">\[
\ln(odds) = \beta_0 + \beta_1NE + \beta_2S + \beta_3W +\beta_4Year2000 +  \beta_5NE:2000 + \beta_6S:2000 + \beta_7 W:2000 
\]</span></p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="logistic.html#cb182-1"></a><span class="op">&gt;</span><span class="st"> </span>nes.glm1 &lt;-<span class="st"> </span><span class="kw">glm</span>(dem <span class="op">~</span><span class="st"> </span>region<span class="op">*</span>year , <span class="dt">data=</span>nes, <span class="dt">family =</span> binomial)</span>
<span id="cb182-2"><a href="logistic.html#cb182-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(nes.glm1)</span>
<span id="cb182-3"><a href="logistic.html#cb182-3"></a><span class="co">## </span></span>
<span id="cb182-4"><a href="logistic.html#cb182-4"></a><span class="co">## Call:</span></span>
<span id="cb182-5"><a href="logistic.html#cb182-5"></a><span class="co">## glm(formula = dem ~ region * year, family = binomial, data = nes)</span></span>
<span id="cb182-6"><a href="logistic.html#cb182-6"></a><span class="co">## </span></span>
<span id="cb182-7"><a href="logistic.html#cb182-7"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb182-8"><a href="logistic.html#cb182-8"></a><span class="co">##     Min       1Q   Median       3Q      Max  </span></span>
<span id="cb182-9"><a href="logistic.html#cb182-9"></a><span class="co">## -1.3666  -1.2049   0.9993   1.1131   1.1969  </span></span>
<span id="cb182-10"><a href="logistic.html#cb182-10"></a><span class="co">## </span></span>
<span id="cb182-11"><a href="logistic.html#cb182-11"></a><span class="co">## Coefficients:</span></span>
<span id="cb182-12"><a href="logistic.html#cb182-12"></a><span class="co">##                       Estimate Std. Error z value Pr(&gt;|z|)   </span></span>
<span id="cb182-13"><a href="logistic.html#cb182-13"></a><span class="co">## (Intercept)           -0.04581    0.12359  -0.371  0.71090   </span></span>
<span id="cb182-14"><a href="logistic.html#cb182-14"></a><span class="co">## regionNE               0.02811    0.18159   0.155  0.87698   </span></span>
<span id="cb182-15"><a href="logistic.html#cb182-15"></a><span class="co">## regionS                0.45127    0.16199   2.786  0.00534 **</span></span>
<span id="cb182-16"><a href="logistic.html#cb182-16"></a><span class="co">## regionW                0.11035    0.19184   0.575  0.56515   </span></span>
<span id="cb182-17"><a href="logistic.html#cb182-17"></a><span class="co">## yearyear2000           0.19893    0.16924   1.175  0.23982   </span></span>
<span id="cb182-18"><a href="logistic.html#cb182-18"></a><span class="co">## regionNE:yearyear2000  0.25334    0.25923   0.977  0.32842   </span></span>
<span id="cb182-19"><a href="logistic.html#cb182-19"></a><span class="co">## regionS:yearyear2000  -0.63257    0.22136  -2.858  0.00427 **</span></span>
<span id="cb182-20"><a href="logistic.html#cb182-20"></a><span class="co">## regionW:yearyear2000  -0.08701    0.25748  -0.338  0.73540   </span></span>
<span id="cb182-21"><a href="logistic.html#cb182-21"></a><span class="co">## ---</span></span>
<span id="cb182-22"><a href="logistic.html#cb182-22"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb182-23"><a href="logistic.html#cb182-23"></a><span class="co">## </span></span>
<span id="cb182-24"><a href="logistic.html#cb182-24"></a><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb182-25"><a href="logistic.html#cb182-25"></a><span class="co">## </span></span>
<span id="cb182-26"><a href="logistic.html#cb182-26"></a><span class="co">##     Null deviance: 3083.3  on 2231  degrees of freedom</span></span>
<span id="cb182-27"><a href="logistic.html#cb182-27"></a><span class="co">## Residual deviance: 3065.5  on 2224  degrees of freedom</span></span>
<span id="cb182-28"><a href="logistic.html#cb182-28"></a><span class="co">## AIC: 3081.5</span></span>
<span id="cb182-29"><a href="logistic.html#cb182-29"></a><span class="co">## </span></span>
<span id="cb182-30"><a href="logistic.html#cb182-30"></a><span class="co">## Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
<p>The residual deviance for this model is <span class="math inline">\(G^2 = 3065.5\)</span> and the model has 2224 degrees of freedom. The null deviance of 3083.3 is for the “intercept only” model. The Wald z-tests suggest that terms involving the south are statistically significant.</p>
<p>The model without the interaction terms also has a null deviance of 3083.3 (since the response and models are the same). But the reduced, no interaction, model’s residual deviance is higher than the interaction model at 3081.9.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="logistic.html#cb183-1"></a><span class="op">&gt;</span><span class="st"> </span>nes.glm2 &lt;-<span class="st"> </span><span class="kw">glm</span>(dem <span class="op">~</span><span class="st"> </span>region<span class="op">+</span>year , <span class="dt">data=</span>nes, <span class="dt">family =</span> binomial)</span>
<span id="cb183-2"><a href="logistic.html#cb183-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(nes.glm2)</span>
<span id="cb183-3"><a href="logistic.html#cb183-3"></a><span class="co">## </span></span>
<span id="cb183-4"><a href="logistic.html#cb183-4"></a><span class="co">## Call:</span></span>
<span id="cb183-5"><a href="logistic.html#cb183-5"></a><span class="co">## glm(formula = dem ~ region + year, family = binomial, data = nes)</span></span>
<span id="cb183-6"><a href="logistic.html#cb183-6"></a><span class="co">## </span></span>
<span id="cb183-7"><a href="logistic.html#cb183-7"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb183-8"><a href="logistic.html#cb183-8"></a><span class="co">##    Min      1Q  Median      3Q     Max  </span></span>
<span id="cb183-9"><a href="logistic.html#cb183-9"></a><span class="co">## -1.261  -1.252   1.096   1.105   1.152  </span></span>
<span id="cb183-10"><a href="logistic.html#cb183-10"></a><span class="co">## </span></span>
<span id="cb183-11"><a href="logistic.html#cb183-11"></a><span class="co">## Coefficients:</span></span>
<span id="cb183-12"><a href="logistic.html#cb183-12"></a><span class="co">##              Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span id="cb183-13"><a href="logistic.html#cb183-13"></a><span class="co">## (Intercept)  0.059324   0.095847   0.619    0.536</span></span>
<span id="cb183-14"><a href="logistic.html#cb183-14"></a><span class="co">## regionNE     0.132352   0.128824   1.027    0.304</span></span>
<span id="cb183-15"><a href="logistic.html#cb183-15"></a><span class="co">## regionS      0.113739   0.110055   1.033    0.301</span></span>
<span id="cb183-16"><a href="logistic.html#cb183-16"></a><span class="co">## regionW      0.068130   0.127806   0.533    0.594</span></span>
<span id="cb183-17"><a href="logistic.html#cb183-17"></a><span class="co">## yearyear2000 0.002029   0.085211   0.024    0.981</span></span>
<span id="cb183-18"><a href="logistic.html#cb183-18"></a><span class="co">## </span></span>
<span id="cb183-19"><a href="logistic.html#cb183-19"></a><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb183-20"><a href="logistic.html#cb183-20"></a><span class="co">## </span></span>
<span id="cb183-21"><a href="logistic.html#cb183-21"></a><span class="co">##     Null deviance: 3083.3  on 2231  degrees of freedom</span></span>
<span id="cb183-22"><a href="logistic.html#cb183-22"></a><span class="co">## Residual deviance: 3081.9  on 2227  degrees of freedom</span></span>
<span id="cb183-23"><a href="logistic.html#cb183-23"></a><span class="co">## AIC: 3091.9</span></span>
<span id="cb183-24"><a href="logistic.html#cb183-24"></a><span class="co">## </span></span>
<span id="cb183-25"><a href="logistic.html#cb183-25"></a><span class="co">## Number of Fisher Scoring iterations: 3</span></span></code></pre></div>
<p>This reduced model form suggests that neither year nor region are statistically significant.</p>
<p>After fitting an interaction model for <code>region</code> and <code>year</code>, we can use a drop in deviance test to determine if the effect of year depends on region by comparing the interaction and no interaction models:
<span class="math display">\[
H_0: \ln(odds) = \beta_0 + \beta_1NE + \beta_2S + \beta_3W +\beta_4Year2000 
\]</span>
<span class="math display">\[
H_A: \ln(odds) = \beta_0 + \beta_1NE + \beta_2S + \beta_3W +\beta_4Year2000 +  \beta_5NE:2000 + \beta_6S:2000 + \beta_7 W:2000 
\]</span></p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="logistic.html#cb184-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">anova</span>(nes.glm2, nes.glm1, <span class="dt">test  =</span> <span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb184-2"><a href="logistic.html#cb184-2"></a><span class="co">## Analysis of Deviance Table</span></span>
<span id="cb184-3"><a href="logistic.html#cb184-3"></a><span class="co">## </span></span>
<span id="cb184-4"><a href="logistic.html#cb184-4"></a><span class="co">## Model 1: dem ~ region + year</span></span>
<span id="cb184-5"><a href="logistic.html#cb184-5"></a><span class="co">## Model 2: dem ~ region * year</span></span>
<span id="cb184-6"><a href="logistic.html#cb184-6"></a><span class="co">##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    </span></span>
<span id="cb184-7"><a href="logistic.html#cb184-7"></a><span class="co">## 1      2227     3081.9                          </span></span>
<span id="cb184-8"><a href="logistic.html#cb184-8"></a><span class="co">## 2      2224     3065.5  3   16.361 0.0009562 ***</span></span>
<span id="cb184-9"><a href="logistic.html#cb184-9"></a><span class="co">## ---</span></span>
<span id="cb184-10"><a href="logistic.html#cb184-10"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span></code></pre></div>
<p>The LRT stat equals
<span class="math display">\[
LRT = 3081.9 - 3065.5 = 16.361 
\]</span>
The degrees of freedom for the test is 3, so the p-value is
<span class="math display">\[
P(\chi^2 &gt; 16.361) = 1-pchisq(16.361, 3) = 0.00096
\]</span></p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="logistic.html#cb185-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="kw">pchisq</span>(<span class="fl">16.361</span>, <span class="dv">3</span>)</span>
<span id="cb185-2"><a href="logistic.html#cb185-2"></a><span class="co">## [1] 0.0009562069</span></span></code></pre></div>
<p>We can conclude that the full model is better than the smaller model. There is at least one region’s change in party affiliation between 1980 and 2000 that is different from the other regions. The statistical significance of the southern region show that this region’s change in affiliation between years is different than the change in the NC (baseline) region.</p>
</div>
</div>
<div id="logistic-assump" class="section level2">
<h2><span class="header-section-number">4.6</span> Checking Assumptions</h2>
<p>The two main assumptions that we can check with a binary logistic: independence of responses and linearity of the log odds of success.</p>
<ul>
<li><p>Independence: The probability of success for case <span class="math inline">\(i\)</span> only depends on the predictors for case <span class="math inline">\(i\)</span>, and not on any unmodeled characteristics.</p></li>
<li><p>Log-odds linearity: For quantitative predictors, we need a linear relationship between the log odds of success and the predictor (or a transformed version). To do this, plot the <strong>empirical</strong> (sample) log-odds against the predictor and look for linearity. Since the predictor is quantatitive, you often need to do this as follows:</p>
<ul>
<li>group cases into groups with similar predictor values</li>
<li>within each group, compute the proportion of successes <span class="math inline">\(\tilde{\pi}_{emp}\)</span></li>
<li>then compute the log odds of success <span class="math inline">\(logit_{emp} = \ln(\dfrac{\tilde{\pi}_{emp}}{1-\tilde{\pi}_{emp}})\)</span></li>
</ul></li>
</ul>
<div id="example-bwca1" class="section level3">
<h3><span class="header-section-number">4.6.1</span> Example: Boundary Waters Canoe Area (BWCA) blowdown</h3>
<p>A severe windstorm blew through northern MN the evening of July 4, 1999, impacting the a large portion of the BWCA. After the storm, foresters surveyed the area to assess damamge and understand how some trees survived the storm while others did not. The data set <code>blowBF.csv</code> contains data on 659 balsam fir trees: 426 survived the storm and while 233 did not.</p>
<p>For this first simple logistic model we are interested in modeling the probability that a tree died (or survived) during the storm as a function of its diameter (inches). We are phrasing this in terms of “died” because of the way the response <code>y</code> is coded: a 1 means died and 0 means survived. The coding matters only so we interpret model coefficients correctly. The same conclusions about the relationship between diameter and died/survived would be the same regardless of the coding.</p>
<p>To determine whether diameter needs to be transformed, we need to construct an empirical log odds plot. THere are 659 cases in the data set, so if we divide cases into 20 groups we will get just over 30 cases within each quantile bin. Here we use the <code>dplyr</code> function <code>ntile</code> to divide cases by diameter <code>D</code> into 20 groups based on the 5th, 10th, 15, …, 95th percentiles of <code>D</code>:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="logistic.html#cb186-1"></a><span class="op">&gt;</span><span class="st"> </span>blowBF &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://people.carleton.edu/~kstclair/data/blowBF.csv&quot;</span>)</span>
<span id="cb186-2"><a href="logistic.html#cb186-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">dim</span>(blowBF)</span>
<span id="cb186-3"><a href="logistic.html#cb186-3"></a><span class="co">## [1] 659   5</span></span>
<span id="cb186-4"><a href="logistic.html#cb186-4"></a><span class="op">&gt;</span><span class="st"> </span>blowBF &lt;-<span class="st"> </span><span class="kw">mutate</span>(blowBF, <span class="dt">D.grps =</span> <span class="kw">ntile</span>(D, <span class="dt">n =</span> <span class="dv">20</span>))</span>
<span id="cb186-5"><a href="logistic.html#cb186-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(blowBF<span class="op">$</span>D.grps)</span>
<span id="cb186-6"><a href="logistic.html#cb186-6"></a><span class="co">## </span></span>
<span id="cb186-7"><a href="logistic.html#cb186-7"></a><span class="co">##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 </span></span>
<span id="cb186-8"><a href="logistic.html#cb186-8"></a><span class="co">## 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 32</span></span></code></pre></div>
<p>Then we <code>group_by</code> our binning <code>D.grps</code> variable and compute the summaries: (1) the median diameter in each group, the proportion of success (<code>died</code>) in each group and the log-odds of success (<code>died</code>) in each group.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="logistic.html#cb187-1"></a><span class="op">&gt;</span><span class="st"> </span>blowBF.empLO &lt;-blowBF <span class="op">%&gt;%</span></span>
<span id="cb187-2"><a href="logistic.html#cb187-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(D.grps) <span class="op">%&gt;%</span></span>
<span id="cb187-3"><a href="logistic.html#cb187-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">D.grps.med =</span> <span class="kw">median</span>(D),    <span class="co"># median D of groups</span></span>
<span id="cb187-4"><a href="logistic.html#cb187-4"></a><span class="op">+</span><span class="st">             </span><span class="dt">pi.emp =</span> <span class="kw">mean</span>(y),         <span class="co"># proportion died</span></span>
<span id="cb187-5"><a href="logistic.html#cb187-5"></a><span class="op">+</span><span class="st">             </span><span class="dt">log.odds.emp =</span> <span class="kw">log</span>(pi.emp<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>pi.emp)))    <span class="co"># log odds</span></span></code></pre></div>
<p>A plot of the empirical log-odds against median diameter in each group shows some curvature:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="logistic.html#cb188-1"></a><span class="op">&gt;</span><span class="st"> </span>blowBF.empLO</span>
<span id="cb188-2"><a href="logistic.html#cb188-2"></a><span class="co">## # A tibble: 20 x 4</span></span>
<span id="cb188-3"><a href="logistic.html#cb188-3"></a><span class="co">##    D.grps D.grps.med pi.emp log.odds.emp</span></span>
<span id="cb188-4"><a href="logistic.html#cb188-4"></a><span class="co">##     &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb188-5"><a href="logistic.html#cb188-5"></a><span class="co">##  1      1        5   0.0606      -2.74  </span></span>
<span id="cb188-6"><a href="logistic.html#cb188-6"></a><span class="co">##  2      2        5   0.0606      -2.74  </span></span>
<span id="cb188-7"><a href="logistic.html#cb188-7"></a><span class="co">##  3      3        5   0.0909      -2.30  </span></span>
<span id="cb188-8"><a href="logistic.html#cb188-8"></a><span class="co">##  4      4        6   0.0909      -2.30  </span></span>
<span id="cb188-9"><a href="logistic.html#cb188-9"></a><span class="co">##  5      5        6   0.0303      -3.47  </span></span>
<span id="cb188-10"><a href="logistic.html#cb188-10"></a><span class="co">##  6      6        6.5 0.182       -1.50  </span></span>
<span id="cb188-11"><a href="logistic.html#cb188-11"></a><span class="co">##  7      7        7   0.212       -1.31  </span></span>
<span id="cb188-12"><a href="logistic.html#cb188-12"></a><span class="co">##  8      8        7   0.152       -1.72  </span></span>
<span id="cb188-13"><a href="logistic.html#cb188-13"></a><span class="co">##  9      9        8   0.182       -1.50  </span></span>
<span id="cb188-14"><a href="logistic.html#cb188-14"></a><span class="co">## 10     10        8   0.152       -1.72  </span></span>
<span id="cb188-15"><a href="logistic.html#cb188-15"></a><span class="co">## 11     11        9   0.212       -1.31  </span></span>
<span id="cb188-16"><a href="logistic.html#cb188-16"></a><span class="co">## 12     12        9   0.424       -0.305 </span></span>
<span id="cb188-17"><a href="logistic.html#cb188-17"></a><span class="co">## 13     13       10   0.364       -0.560 </span></span>
<span id="cb188-18"><a href="logistic.html#cb188-18"></a><span class="co">## 14     14       10.5 0.485       -0.0606</span></span>
<span id="cb188-19"><a href="logistic.html#cb188-19"></a><span class="co">## 15     15       11   0.636        0.560 </span></span>
<span id="cb188-20"><a href="logistic.html#cb188-20"></a><span class="co">## 16     16       13   0.727        0.981 </span></span>
<span id="cb188-21"><a href="logistic.html#cb188-21"></a><span class="co">## 17     17       14   0.606        0.431 </span></span>
<span id="cb188-22"><a href="logistic.html#cb188-22"></a><span class="co">## 18     18       15   0.788        1.31  </span></span>
<span id="cb188-23"><a href="logistic.html#cb188-23"></a><span class="co">## 19     19       17   0.818        1.50  </span></span>
<span id="cb188-24"><a href="logistic.html#cb188-24"></a><span class="co">## 20     20       21.5 0.812        1.47</span></span>
<span id="cb188-25"><a href="logistic.html#cb188-25"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(blowBF.empLO, <span class="kw">aes</span>(<span class="dt">x=</span>D.grps.med, <span class="dt">y=</span>log.odds.emp)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb188-26"><a href="logistic.html#cb188-26"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() </span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-203-1.png" width="672" /></p>
<p>Looking at diameter on the log-scale shows a more linear plot. This is our reason for using <code>log(D)</code> in our logistic model for tree survival status.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="logistic.html#cb189-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(blowBF.empLO, <span class="kw">aes</span>(<span class="dt">x=</span>D.grps.med, <span class="dt">y=</span>log.odds.emp)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb189-2"><a href="logistic.html#cb189-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb189-3"><a href="logistic.html#cb189-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-204-1.png" width="672" /></p>
</div>
</div>
<div id="logistic-resid" class="section level2">
<h2><span class="header-section-number">4.7</span> Residuals and Case influence</h2>
<p>The case influence statistics of leverage and Cook’s distance are used with logistic models, just as they are with regular linear models. Both can be obtained with the <code>broom</code> <code>augment</code> command and we can plot then against predictors using the <code>ggnostic</code> command from <code>GGally</code>. You can also see Cook’s distance against case number with <code>plot(my.glm, which = 4)</code>.</p>
<p>Residuals are not so clear cut for a GLM compared to a MLR. For now, we will just concern ourselves with response residuals which are a case’s binary response minus it’s predicted probabity of success (estimated mean value):
<span class="math display">\[
r_i = y_i - \hat{\pi}(X_i)
\]</span>
We can get these residuals by requesting the “response” type of residual:</p>
<ul>
<li><code>resid(my.glm, type = "response")</code></li>
<li><code>augment(my.glm, type.predict = "response", type.residuals = "response")</code></li>
</ul>
<p>These response residuals are always between -1 and 1, and should average out to 0. Values close to -1 or 1 are cases that could be of interest since they are poorly predicted. Using them in a “usual” residual plot doesn’t always lead to a usual visual model checking tool. <a href="http://www.stat.columbia.edu/~gelman/arm/">Gelman and Hill</a> suggest binning, or grouping, cases by a predictor and computing mean residual value within each group (much like the empirical log odds plot)</p>
<ul>
<li>group cases into groups with similar predictor values</li>
<li>within each group, compute the mean response residual</li>
<li>plot mean predictor value against mean response residual value for each group.</li>
</ul>
<p>A null plot will show mean residual values with no trend around the horizontal 0-line. We do not need to see constant variance in this plot because our Bernoulli response model does not assume constant variance.</p>
<div id="example-bwca2" class="section level3">
<h3><span class="header-section-number">4.7.1</span> Example: Boundary Waters Canoe Area (BWCA) blowdown</h3>
<p>Back to the BWCA data. Let’s fit the logistic regression of the binary indicator of death <code>y</code> against the log of diameter. We see that the odds of death increase as diameter increases, which agrees with our empirical log odds plot from Section <a href="logistic.html#example-bwca1">4.6.1</a></p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="logistic.html#cb190-1"></a><span class="op">&gt;</span><span class="st"> </span>fir.glm&lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(D), <span class="dt">family=</span>binomial, <span class="dt">data=</span>blowBF)</span>
<span id="cb190-2"><a href="logistic.html#cb190-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tidy</span>(fir.glm)</span>
<span id="cb190-3"><a href="logistic.html#cb190-3"></a><span class="co">## # A tibble: 2 x 5</span></span>
<span id="cb190-4"><a href="logistic.html#cb190-4"></a><span class="co">##   term        estimate std.error statistic  p.value</span></span>
<span id="cb190-5"><a href="logistic.html#cb190-5"></a><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb190-6"><a href="logistic.html#cb190-6"></a><span class="co">## 1 (Intercept)    -7.89     0.633     -12.5 9.92e-36</span></span>
<span id="cb190-7"><a href="logistic.html#cb190-7"></a><span class="co">## 2 log(D)          3.26     0.276      11.8 3.02e-32</span></span></code></pre></div>
<p>We’ve already computed a binning variable <code>D.grps</code> for diameter in Section <a href="logistic.html#example-bwca1">4.6.1</a>.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="logistic.html#cb191-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(blowBF)</span>
<span id="cb191-2"><a href="logistic.html#cb191-2"></a><span class="co">##   X  D         S y   status D.grps</span></span>
<span id="cb191-3"><a href="logistic.html#cb191-3"></a><span class="co">## 1 1  9 0.0242120 0 survived     11</span></span>
<span id="cb191-4"><a href="logistic.html#cb191-4"></a><span class="co">## 2 2 11 0.0305947 0 survived     14</span></span>
<span id="cb191-5"><a href="logistic.html#cb191-5"></a><span class="co">## 3 3  9 0.0305947 0 survived     11</span></span>
<span id="cb191-6"><a href="logistic.html#cb191-6"></a><span class="co">## 4 4  9 0.0341815 0 survived     11</span></span>
<span id="cb191-7"><a href="logistic.html#cb191-7"></a><span class="co">## 5 5  5 0.0341815 0 survived      1</span></span>
<span id="cb191-8"><a href="logistic.html#cb191-8"></a><span class="co">## 6 6  8 0.0341815 0 survived      9</span></span></code></pre></div>
<p>We now need to augment the (entire) data set with response residuals</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="logistic.html#cb192-1"></a><span class="op">&gt;</span><span class="st"> </span>blowBF.aug &lt;-<span class="st"> </span><span class="kw">augment</span>(<span class="dt">data=</span>blowBF, fir.glm, <span class="dt">type.predict =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">type.residuals =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb192-2"><a href="logistic.html#cb192-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(blowBF.aug)</span>
<span id="cb192-3"><a href="logistic.html#cb192-3"></a><span class="co">## # A tibble: 6 x 13</span></span>
<span id="cb192-4"><a href="logistic.html#cb192-4"></a><span class="co">##       X     D      S     y status D.grps .fitted .se.fit  .resid    .hat .sigma</span></span>
<span id="cb192-5"><a href="logistic.html#cb192-5"></a><span class="co">##   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb192-6"><a href="logistic.html#cb192-6"></a><span class="co">## 1     1     9 0.0242     0 survi~     11  0.327   0.0216 -0.327  0.00212  0.999</span></span>
<span id="cb192-7"><a href="logistic.html#cb192-7"></a><span class="co">## 2     2    11 0.0306     0 survi~     14  0.484   0.0258 -0.484  0.00267  0.998</span></span>
<span id="cb192-8"><a href="logistic.html#cb192-8"></a><span class="co">## 3     3     9 0.0306     0 survi~     11  0.327   0.0216 -0.327  0.00212  0.999</span></span>
<span id="cb192-9"><a href="logistic.html#cb192-9"></a><span class="co">## 4     4     9 0.0342     0 survi~     11  0.327   0.0216 -0.327  0.00212  0.999</span></span>
<span id="cb192-10"><a href="logistic.html#cb192-10"></a><span class="co">## 5     5     5 0.0342     0 survi~      1  0.0667  0.0127 -0.0667 0.00261  0.999</span></span>
<span id="cb192-11"><a href="logistic.html#cb192-11"></a><span class="co">## 6     6     8 0.0342     0 survi~      9  0.249   0.0204 -0.249  0.00223  0.999</span></span>
<span id="cb192-12"><a href="logistic.html#cb192-12"></a><span class="co">## # ... with 2 more variables: .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</span></span></code></pre></div>
<p>Plotting these residuals against log diameter shows an “odd” looking residual plot that is hard to interpret:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="logistic.html#cb193-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(blowBF.aug, <span class="kw">aes</span>(<span class="dt">x=</span>D, <span class="dt">y=</span>.resid)) <span class="op">+</span></span>
<span id="cb193-2"><a href="logistic.html#cb193-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_jitter</span>(<span class="dt">height =</span> <span class="fl">.05</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb193-3"><a href="logistic.html#cb193-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb193-4"><a href="logistic.html#cb193-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-208-1.png" width="672" /></p>
<p>To help understand if the <em>average</em> residual value for each diameter varies around 0 we can using the binning variable <code>D.grps</code> and find the mean residual value for each group.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="logistic.html#cb194-1"></a><span class="op">&gt;</span><span class="st"> </span>blowBF.resid &lt;-<span class="st"> </span>blowBF.aug <span class="op">%&gt;%</span></span>
<span id="cb194-2"><a href="logistic.html#cb194-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(D.grps) <span class="op">%&gt;%</span></span>
<span id="cb194-3"><a href="logistic.html#cb194-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">lnD.grps.med =</span> <span class="kw">median</span>(<span class="kw">log</span>(D)),    <span class="co"># median log(D) of groups</span></span>
<span id="cb194-4"><a href="logistic.html#cb194-4"></a><span class="op">+</span><span class="st">             </span><span class="dt">fitted.mean =</span> <span class="kw">mean</span>(.fitted),       <span class="co"># mean prob</span></span>
<span id="cb194-5"><a href="logistic.html#cb194-5"></a><span class="op">+</span><span class="st">             </span><span class="dt">resid.mean =</span> <span class="kw">mean</span>(.resid))        <span class="co"># mean residual</span></span></code></pre></div>
<p>We then plot the mean binned residual against the median (middle) log diameter value for each group. Here we see mean residual values that roughly vary around 0 which suggests that our transformation choice for diameter looks okay.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="logistic.html#cb195-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(blowBF.resid, <span class="kw">aes</span>(<span class="dt">x=</span>lnD.grps.med,<span class="dt">y=</span>resid.mean)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb195-2"><a href="logistic.html#cb195-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb195-3"><a href="logistic.html#cb195-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-210-1.png" width="672" /></p>
<p>What if we hadn’t logged diameter? The binned residual plot shows more of a trend then the log diameter model. Residuals are mostly negative for small diameters (trees that survived (0) that have probabilities of death that are “too high”) and mostly positive values for mid- to high-diameter bins (trees that died (1) that have probabilities of death that are “too low”).</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="logistic.html#cb196-1"></a><span class="op">&gt;</span><span class="st"> </span>fir.glmBad &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st">  </span>D, <span class="dt">family=</span>binomial, <span class="dt">data=</span>blowBF)</span>
<span id="cb196-2"><a href="logistic.html#cb196-2"></a><span class="op">&gt;</span><span class="st"> </span>blowBF.augBad &lt;-<span class="st"> </span><span class="kw">augment</span>(<span class="dt">data=</span>blowBF, fir.glmBad, <span class="dt">type.predict =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">type.residuals =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb196-3"><a href="logistic.html#cb196-3"></a><span class="op">&gt;</span><span class="st"> </span>blowBF.residBad &lt;-<span class="st"> </span>blowBF.augBad <span class="op">%&gt;%</span></span>
<span id="cb196-4"><a href="logistic.html#cb196-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(D.grps) <span class="op">%&gt;%</span></span>
<span id="cb196-5"><a href="logistic.html#cb196-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">D.grps.med =</span> <span class="kw">median</span>(D),    <span class="co"># median D of groups</span></span>
<span id="cb196-6"><a href="logistic.html#cb196-6"></a><span class="op">+</span><span class="st">             </span><span class="dt">fitted.mean =</span> <span class="kw">mean</span>(.fitted),       <span class="co"># mean prob</span></span>
<span id="cb196-7"><a href="logistic.html#cb196-7"></a><span class="op">+</span><span class="st">             </span><span class="dt">resid.mean =</span> <span class="kw">mean</span>(.resid))        <span class="co"># mean residual</span></span>
<span id="cb196-8"><a href="logistic.html#cb196-8"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(blowBF.residBad, <span class="kw">aes</span>(<span class="dt">x=</span>D.grps.med,<span class="dt">y=</span>resid.mean)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb196-9"><a href="logistic.html#cb196-9"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb196-10"><a href="logistic.html#cb196-10"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-211-1.png" width="672" /></p>
</div>
</div>
<div id="binomial-responses" class="section level2">
<h2><span class="header-section-number">4.8</span> Binomial responses</h2>
<p>Logistic models can also be used with responses that are <strong>Binomial counts</strong>. For each case <span class="math inline">\(i\)</span> we define:</p>
<ul>
<li><span class="math inline">\(Y_i=\)</span> number of successes in <span class="math inline">\(m_i\)</span> independent Bernoulli (success/failure) trials</li>
<li><span class="math inline">\(X_i = (x_{1,i}, \dotsc, x_{p,i})\)</span> be the predictors for this case</li>
<li><span class="math inline">\(\pi(X_i)\)</span> is the probability of success for each of the <span class="math inline">\(m_i\)</span> trials</li>
</ul>
<p>For example, suppose we have <span class="math inline">\(n\)</span> plots of land and we plant <span class="math inline">\(m_i\)</span> seeds on each. A reponse <span class="math inline">\(Y_i\)</span> could be the number of seeds that germinate in plot <span class="math inline">\(i\)</span>. Each seed has a <span class="math inline">\(\pi(X_i)\)</span> probability of germinating, and this probability could depend on plot-level predictors like amount of rain in plot <span class="math inline">\(i\)</span> or amount of fertilizer applied to plot <span class="math inline">\(i\)</span>. Here is an example of what this data could look like for a sample of <span class="math inline">\(n=3\)</span> plots</p>
<table>
<thead>
<tr class="header">
<th>plot ID</th>
<th>Y (# germinate)</th>
<th>m (# plants)</th>
<th>Fertilizer (lbs/plot)</th>
<th>Rain (inches)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>4</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>5</td>
<td>2.4</td>
<td>1.1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
<td>4</td>
<td>1.6</td>
<td>2.9</td>
</tr>
</tbody>
</table>
<p>Under the conditions listed above, each response is modeled by a <strong>Binomial</strong> distribution:
<span class="math display">\[Y_i \mid X_i \overset{indep.}{\sim} Binom(m_i, \pi(X_i))\]</span></p>
<p>The mean response for each case is
<span class="math display">\[
E(Y_i \mid X_i) = \mu_{y \mid x} = m_i \pi(X_i)
\]</span>
and the standard deviation is
<span class="math display">\[
SD(Y_i \mid X_i) = \sigma_{y \mid x} = \sqrt{m_i \pi(X_i)(1-\pi(X_i))}
\]</span></p>
<p>We again use a logistic function (kernel mean function) to express the probability of success as a function of predictors:
<span class="math display">\[
\pi(X_i) = \dfrac{e^{\eta_i}}{1 + e^{\eta_i}} = \dfrac{e^{\beta_0 + \beta_1 x_{1,i} + \dotsm +  \beta_p x_{p,i}}}{1 + e^{\beta_0 + \beta_1 x_{1,i} + \dotsm +  \beta_p x_{p,i}}}
\]</span>
and a logit (log odds) function to express the linear combination of predictors as a function of the probability of success:
<span class="math display">\[
\eta_i =  \beta_0 + \beta_1 x_{1,i} + \dotsm +  \beta_p x_{p,i}=  \ln \left(  \dfrac{\pi(X_i)}{1-\pi(X_i)}\right)
\]</span></p>
<p>Interpretation of a logistic model for a binomial response is exactly the same as a binary response model (<a href="logistic.html#logistic-int">4.3.1</a>).</p>
<div id="connection-to-binary-responses" class="section level3">
<h3><span class="header-section-number">4.8.1</span> Connection to binary responses</h3>
<p>When we only observed <span class="math inline">\(m_i = 1\)</span> trials, then the Binomial count is exactly the same as a binary Bernoullie count since it can only take on the value of 0 or 1:
<span class="math display">\[
Binom(m_i = 1, \pi(X_i)) = Bern(\pi(X_i))
\]</span></p>
<p>We can always “expand” binomial count data to represent all <span class="math inline">\(\sum m_i\)</span> Bernoulli trials that are recording success and failures across all trials. For example, in the plant scenario above, a “trial” represents the success or failure of one plant. So we could have recorded <em>plant-level</em> characteristics with 2 successes in plot 1 and 2 failures (out of <span class="math inline">\(m_1 = 4\)</span> plants), etc. This binary data representation would look like where <code>Binary_Y</code> is a 1 if a plant germinates and a 0 if it did not:</p>
<table>
<thead>
<tr class="header">
<th>plot ID</th>
<th>Binary_Y</th>
<th>m (# plants)</th>
<th>Fertilizer (lbs/plot)</th>
<th>Rain (inches)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>4</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td>1</td>
<td>0</td>
<td>4</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td>2</td>
<td>1</td>
<td>5</td>
<td>2.4</td>
<td>1.1</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>5</td>
<td>2.4</td>
<td>1.1</td>
</tr>
<tr class="odd">
<td>2</td>
<td>1</td>
<td>5</td>
<td>2.4</td>
<td>1.1</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>5</td>
<td>2.4</td>
<td>1.1</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0</td>
<td>5</td>
<td>2.4</td>
<td>1.1</td>
</tr>
<tr class="even">
<td>3</td>
<td>1</td>
<td>4</td>
<td>1.6</td>
<td>2.9</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0</td>
<td>4</td>
<td>1.6</td>
<td>2.9</td>
</tr>
<tr class="even">
<td>3</td>
<td>0</td>
<td>4</td>
<td>1.6</td>
<td>2.9</td>
</tr>
</tbody>
</table>
<p>Notice in this representation of the data, we are just repeated the common plot-level predictor values that are common to all plants within a plot. This is an inefficient way to represent our data unless we have <em>plant-level</em> measurements too. This binary representation also is not a great way to store this data because it limits our ability to check the model assumptions about independence. We will expand on this idea in our “goodness-of-fit” discussion below.</p>
</div>
</div>
<div id="inference-for-binomial-response-models" class="section level2">
<h2><span class="header-section-number">4.9</span> Inference for Binomial response models</h2>
<p>Here are the similarities between binomial and binary response logistic models:</p>
<ul>
<li>Interpretation of <span class="math inline">\(\beta\)</span> in the two models is the same.</li>
<li>“Wald” z-tests and confidence intervals for <span class="math inline">\(\beta\)</span> parameters are the same.</li>
<li>Drop-in-deviance model comparison tests are the same.</li>
<li>R functions of <code>fitted</code>, <code>predict</code>, <code>augment</code> are the same.</li>
</ul>
<p>Here are some key differences:</p>
<ul>
<li>The formula for deviance <span class="math inline">\(G^2\)</span> is different because our probability model is (slightly) different.</li>
<li>In binary models, Wald inference relies on “large <span class="math inline">\(n\)</span>”. In binomial models, we either need “large <span class="math inline">\(n\)</span>” and/or large <span class="math inline">\(m_i\)</span> values. E.g. In the binomial model, <span class="math inline">\(n=5\)</span> is fine if all <span class="math inline">\(m_1 = 1000\)</span>.</li>
<li>The R function <code>glm</code> wants a response equal to the empirical proportion of successes, <span class="math inline">\(Y_i/m_i\)</span>, along with the number of binomial trials <span class="math inline">\(m_i\)</span> in our <code>glm</code> specification:</li>
</ul>
<pre><code>glm(y/m ~ x1 + x2, family = binomial, weights = m, data=)</code></pre>
<div id="example-krunnit-islands-archipelago-sleuth-case-study-21.1" class="section level3">
<h3><span class="header-section-number">4.9.1</span> Example: Krunnit Islands archipelago (Sleuth Case Study 21.1)</h3>
<p>In case study 21.1, we have data collected from 18 islands in this archipelago. In 1949, scientists recorded the number of “at risk” species on each island. Ten years later, they recorded how many of these species were extinct. We want to model the extinction rate for each island as a function of the island size.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="logistic.html#cb198-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(Sleuth3)</span>
<span id="cb198-2"><a href="logistic.html#cb198-2"></a><span class="op">&gt;</span><span class="st"> </span>island &lt;-<span class="st"> </span>case2101</span>
<span id="cb198-3"><a href="logistic.html#cb198-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(island)</span>
<span id="cb198-4"><a href="logistic.html#cb198-4"></a><span class="co">##             Island        Area             AtRisk         Extinct     </span></span>
<span id="cb198-5"><a href="logistic.html#cb198-5"></a><span class="co">##  Hietakraasukka: 1   Min.   :  0.070   Min.   : 6.00   Min.   : 2.00  </span></span>
<span id="cb198-6"><a href="logistic.html#cb198-6"></a><span class="co">##  Isonkivenletto: 1   1st Qu.:  0.625   1st Qu.:22.00   1st Qu.: 3.25  </span></span>
<span id="cb198-7"><a href="logistic.html#cb198-7"></a><span class="co">##  Kraasukka     : 1   Median :  2.150   Median :31.00   Median : 5.50  </span></span>
<span id="cb198-8"><a href="logistic.html#cb198-8"></a><span class="co">##  Lansiletto    : 1   Mean   : 19.804   Mean   :35.11   Mean   : 6.00  </span></span>
<span id="cb198-9"><a href="logistic.html#cb198-9"></a><span class="co">##  Luusiletto    : 1   3rd Qu.:  4.725   3rd Qu.:42.25   3rd Qu.: 8.00  </span></span>
<span id="cb198-10"><a href="logistic.html#cb198-10"></a><span class="co">##  Maakrunni     : 1   Max.   :185.800   Max.   :75.00   Max.   :13.00  </span></span>
<span id="cb198-11"><a href="logistic.html#cb198-11"></a><span class="co">##  (Other)       :12</span></span>
<span id="cb198-12"><a href="logistic.html#cb198-12"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(island)</span>
<span id="cb198-13"><a href="logistic.html#cb198-13"></a><span class="co">## [1] 18</span></span></code></pre></div>
<p>Our variables are</p>
<ul>
<li><code>Island</code> gives us an identifier of each island (case)</li>
<li><code>Area</code> is our predictor <span class="math inline">\(x_i\)</span> for each island</li>
<li><code>AtRisk</code> is <span class="math inline">\(m_i\)</span>, the number of animals available for extinction</li>
<li><code>Extinct</code> is <span class="math inline">\(y_i\)</span>, the number (out of <span class="math inline">\(m_i\)</span>) that went extinct</li>
</ul>
<div id="logistic-BinomEDAex" class="section level4">
<h4><span class="header-section-number">4.9.1.1</span> EDA</h4>
<p>Our model of interest is the logistic regression of the number extinct against area, meaning the log odds is a linear function of area (or some function of area). Our first model attempt will look like:
<span class="math display">\[
\log \left( \dfrac{\pi(x_i)}{1-\pi(x_i)}\right) = \beta_0 + \beta_1 area_i
\]</span>
where <span class="math inline">\(\pi(X_i)\)</span> represents the probability of extinction (“success”) for island <span class="math inline">\(i\)</span>.</p>
<p>We check to see if area is linearly related to the log odds by first computing the proportion of extinctions (“successes”) for each island, then using this to compute the empirical log odds. Here we do this by using <code>mutate</code> to add <code>prop</code> and <code>logOdds</code> to the island data set:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="logistic.html#cb199-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</span>
<span id="cb199-2"><a href="logistic.html#cb199-2"></a><span class="op">&gt;</span><span class="st"> </span>island &lt;-<span class="st"> </span><span class="kw">mutate</span>(island, </span>
<span id="cb199-3"><a href="logistic.html#cb199-3"></a><span class="op">+</span><span class="st">                  </span><span class="dt">prop =</span> Extinct<span class="op">/</span>AtRisk, </span>
<span id="cb199-4"><a href="logistic.html#cb199-4"></a><span class="op">+</span><span class="st">                  </span><span class="dt">logOdds =</span> <span class="kw">log</span>(prop<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>prop)))</span></code></pre></div>
<p>Then we plot the <code>logOdds</code> against area, and see that we definitely don’t have a linear relationship:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="logistic.html#cb200-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</span>
<span id="cb200-2"><a href="logistic.html#cb200-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(island, <span class="kw">aes</span>(<span class="dt">x =</span> Area, <span class="dt">y =</span> logOdds)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb200-3"><a href="logistic.html#cb200-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb200-4"><a href="logistic.html#cb200-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;empirical log odds vs. area&quot;</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-214-1.png" width="672" /></p>
<p>Since area is very right skewed, the first transformation choice could be log. We do find that log of area is linearly related to the log odds of extinction.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="logistic.html#cb201-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(island, <span class="kw">aes</span>(<span class="dt">x =</span> Area, <span class="dt">y =</span> logOdds)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb201-2"><a href="logistic.html#cb201-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb201-3"><a href="logistic.html#cb201-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;empirical log odds vs. log(area)&quot;</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-215-1.png" width="672" /></p>
</div>
<div id="model-fit" class="section level4">
<h4><span class="header-section-number">4.9.1.2</span> Model fit</h4>
<p>Our logistic model says that given an island size <span class="math inline">\(x_i\)</span>, <span class="math inline">\(Y_i\)</span>, the number of extinctions on island <span class="math inline">\(i\)</span>, is a binomial variable
<span class="math display">\[
Y_i \mid X_i \sim Binom(\pi(x_i), m_i)
\]</span>
where <span class="math inline">\(\pi(X_i)\)</span> is the probability of extinction <strong>for each of the <span class="math inline">\(m_i\)</span> at risk species on island <span class="math inline">\(i\)</span></strong>. Based on the EDA, we will fit the logit model:
<span class="math display">\[
\log \left( \dfrac{\pi(x_i)}{1-\pi(x_i)}\right) = \beta_0 + \beta_1 \ln(area_i)
\]</span></p>
<p>The <code>glm</code> fit needs to use the ratio of <span class="math inline">\(y\)</span> (<code>Extinct</code>) to <span class="math inline">\(m\)</span> (<code>AtRisk</code>) as the response and <code>weights</code> equal to <span class="math inline">\(m\)</span> (<code>AtRisk</code>):</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="logistic.html#cb202-1"></a><span class="op">&gt;</span><span class="st"> </span>krunnit.glm &lt;-<span class="st"> </span><span class="kw">glm</span>(Extinct<span class="op">/</span>AtRisk <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(Area), <span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>, <span class="dt">weights=</span>AtRisk, <span class="dt">data=</span>island)</span>
<span id="cb202-2"><a href="logistic.html#cb202-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(krunnit.glm)</span>
<span id="cb202-3"><a href="logistic.html#cb202-3"></a><span class="co">## </span></span>
<span id="cb202-4"><a href="logistic.html#cb202-4"></a><span class="co">## Call:</span></span>
<span id="cb202-5"><a href="logistic.html#cb202-5"></a><span class="co">## glm(formula = Extinct/AtRisk ~ log(Area), family = &quot;binomial&quot;, </span></span>
<span id="cb202-6"><a href="logistic.html#cb202-6"></a><span class="co">##     data = island, weights = AtRisk)</span></span>
<span id="cb202-7"><a href="logistic.html#cb202-7"></a><span class="co">## </span></span>
<span id="cb202-8"><a href="logistic.html#cb202-8"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb202-9"><a href="logistic.html#cb202-9"></a><span class="co">##      Min        1Q    Median        3Q       Max  </span></span>
<span id="cb202-10"><a href="logistic.html#cb202-10"></a><span class="co">## -1.71726  -0.67722   0.09726   0.48365   1.49545  </span></span>
<span id="cb202-11"><a href="logistic.html#cb202-11"></a><span class="co">## </span></span>
<span id="cb202-12"><a href="logistic.html#cb202-12"></a><span class="co">## Coefficients:</span></span>
<span id="cb202-13"><a href="logistic.html#cb202-13"></a><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb202-14"><a href="logistic.html#cb202-14"></a><span class="co">## (Intercept) -1.19620    0.11845 -10.099  &lt; 2e-16 ***</span></span>
<span id="cb202-15"><a href="logistic.html#cb202-15"></a><span class="co">## log(Area)   -0.29710    0.05485  -5.416 6.08e-08 ***</span></span>
<span id="cb202-16"><a href="logistic.html#cb202-16"></a><span class="co">## ---</span></span>
<span id="cb202-17"><a href="logistic.html#cb202-17"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb202-18"><a href="logistic.html#cb202-18"></a><span class="co">## </span></span>
<span id="cb202-19"><a href="logistic.html#cb202-19"></a><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb202-20"><a href="logistic.html#cb202-20"></a><span class="co">## </span></span>
<span id="cb202-21"><a href="logistic.html#cb202-21"></a><span class="co">##     Null deviance: 45.338  on 17  degrees of freedom</span></span>
<span id="cb202-22"><a href="logistic.html#cb202-22"></a><span class="co">## Residual deviance: 12.062  on 16  degrees of freedom</span></span>
<span id="cb202-23"><a href="logistic.html#cb202-23"></a><span class="co">## AIC: 75.394</span></span>
<span id="cb202-24"><a href="logistic.html#cb202-24"></a><span class="co">## </span></span>
<span id="cb202-25"><a href="logistic.html#cb202-25"></a><span class="co">## Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
<p>The estimated odds log odds of extinction is <span class="math inline">\(-1.1962 - 0.29710\log(area)\)</span> and the estimated odds of extinction is
<span class="math display">\[
\dfrac{\hat{\pi}}{1-\hat{\pi}} = e^{-1.1962 - 0.29710\ln(area)} = e^{-1.1962}Area^{- 0.29710}
\]</span></p>
<p>The Wald z-test shows that the effect of area on extinction rates is statistically signicant (z=-5.416, p &lt; 0.0001). Doubling an island area is associated with an 18.6% reduction in the odds of extinction of at risk species. We are 95% confident that doubling the area of an island is associated with anywhere from a 12.3% to 24.5% decrease in extiction rates.</p>
<p><span class="math display">\[
OR = \dfrac{\hat{odds}(2 \times Area)}{\hat{odds}(Area)} = 2^{- 0.29710} = 0.814
\]</span></p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="logistic.html#cb203-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># factor change calcluations: </span></span>
<span id="cb203-2"><a href="logistic.html#cb203-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="dv">2</span><span class="op">^-</span>.<span class="dv">29710</span>  <span class="co"># factor change in odds for double</span></span>
<span id="cb203-3"><a href="logistic.html#cb203-3"></a><span class="co">## [1] 0.8138868</span></span>
<span id="cb203-4"><a href="logistic.html#cb203-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span><span class="op">^</span>(<span class="op">-</span>.<span class="dv">29710</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(.<span class="dv">975</span>)<span class="op">*</span><span class="fl">0.05485</span>)  <span class="co"># CI for factor</span></span>
<span id="cb203-5"><a href="logistic.html#cb203-5"></a><span class="co">## [1] 0.7554436 0.8768512</span></span>
<span id="cb203-6"><a href="logistic.html#cb203-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># percent change calculations:</span></span>
<span id="cb203-7"><a href="logistic.html#cb203-7"></a><span class="er">&gt;</span><span class="st"> </span>(<span class="dv">2</span><span class="op">^-</span>.<span class="dv">29710</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">*</span><span class="dv">100</span>   <span class="co"># % change for double</span></span>
<span id="cb203-8"><a href="logistic.html#cb203-8"></a><span class="co">## [1] -18.61132</span></span>
<span id="cb203-9"><a href="logistic.html#cb203-9"></a><span class="op">&gt;</span><span class="st"> </span>(<span class="dv">2</span><span class="op">^</span>(<span class="op">-</span>.<span class="dv">29710</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(.<span class="dv">975</span>)<span class="op">*</span><span class="fl">0.05485</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">*</span><span class="dv">100</span>  <span class="co"># CI for % change</span></span>
<span id="cb203-10"><a href="logistic.html#cb203-10"></a><span class="co">## [1] -24.45564 -12.31488</span></span></code></pre></div>
<p>We are 95% confident that a 10% increase in the area of an island is associated with a 1.8% to 3.8% decrease in the odds of extinction for at risk species.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="logistic.html#cb204-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># increase area by 10% = multiply by factor of 1.1</span></span>
<span id="cb204-2"><a href="logistic.html#cb204-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="fl">1.1</span><span class="op">^-</span>.<span class="dv">29710</span></span>
<span id="cb204-3"><a href="logistic.html#cb204-3"></a><span class="co">## [1] 0.9720805</span></span>
<span id="cb204-4"><a href="logistic.html#cb204-4"></a><span class="op">&gt;</span><span class="st"> </span>(<span class="fl">1.1</span><span class="op">^-</span>.<span class="dv">29710</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb204-5"><a href="logistic.html#cb204-5"></a><span class="co">## [1] -2.79195</span></span>
<span id="cb204-6"><a href="logistic.html#cb204-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># 95% CI for effect on odds</span></span>
<span id="cb204-7"><a href="logistic.html#cb204-7"></a><span class="er">&gt;</span><span class="st"> </span><span class="fl">1.1</span><span class="op">^</span>(<span class="op">-</span>.<span class="dv">29710</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(.<span class="dv">975</span>)<span class="op">*</span><span class="fl">0.05485</span>)</span>
<span id="cb204-8"><a href="logistic.html#cb204-8"></a><span class="co">## [1] 0.9621712 0.9820919</span></span>
<span id="cb204-9"><a href="logistic.html#cb204-9"></a><span class="op">&gt;</span><span class="st"> </span>(<span class="fl">1.1</span><span class="op">^</span>(<span class="op">-</span>.<span class="dv">29710</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">*</span><span class="kw">qnorm</span>(.<span class="dv">975</span>)<span class="op">*</span><span class="fl">0.05485</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb204-10"><a href="logistic.html#cb204-10"></a><span class="co">## [1] -3.782880 -1.790814</span></span></code></pre></div>
<p>The estimated log odds of extinction for a 5 km<span class="math inline">\(^2\)</span> island is
<span class="math display">\[
\dfrac{\hat{\pi}(x=5)}{1-\hat{\pi}(x=5)} = e^{-1.1962 - 0.29710\log(5)} = e^{-1.1962}5^{- 0.29710} = -1.674364
\]</span>
The estimated probability of exinction for at risk species on a 5 km<span class="math inline">\(^2\)</span> island is 15.7%.
<span class="math display">\[
\hat{\pi}(x=5) = \dfrac{e^{-1.1962 - 0.29710\log(5)}}{1+e^{-1.1962 - 0.29710\log(5)}}= \dfrac{e^{-1.674364}}{1+e^{-1.674364}} = 0.1578432
\]</span></p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="logistic.html#cb205-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># estimated probability of extiction on a 5 km^2 island</span></span>
<span id="cb205-2"><a href="logistic.html#cb205-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">predict</span>(krunnit.glm, <span class="dt">newdata=</span><span class="kw">list</span>(<span class="dt">Area=</span><span class="dv">5</span>), <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb205-3"><a href="logistic.html#cb205-3"></a><span class="co">##        1 </span></span>
<span id="cb205-4"><a href="logistic.html#cb205-4"></a><span class="co">## 0.157843</span></span>
<span id="cb205-5"><a href="logistic.html#cb205-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># verify (not needed, just make sure you can also do these calculations by hand for exam 3)</span></span>
<span id="cb205-6"><a href="logistic.html#cb205-6"></a><span class="er">&gt;</span><span class="st"> </span>( logit &lt;-<span class="st"> </span><span class="fl">-1.1962</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.2971</span><span class="op">*</span><span class="kw">log</span>(<span class="dv">5</span>) )</span>
<span id="cb205-7"><a href="logistic.html#cb205-7"></a><span class="co">## [1] -1.674364</span></span>
<span id="cb205-8"><a href="logistic.html#cb205-8"></a><span class="op">&gt;</span><span class="st"> </span>( prob &lt;-<span class="st"> </span><span class="kw">exp</span>(logit)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(logit)) )</span>
<span id="cb205-9"><a href="logistic.html#cb205-9"></a><span class="co">## [1] 0.1578432</span></span></code></pre></div>
</div>
<div id="logistic-exViz" class="section level4">
<h4><span class="header-section-number">4.9.1.3</span> Visualize</h4>
<p>We can add the estimated extinction probability curve using the <code>geom_smooth</code> function, adding <code>glm</code> as the smoothing method and <code>family</code> equal to Binomial. We also need to specify the <span class="math inline">\(m_i\)</span> used in the <code>glm</code> fit and this is done as an <code>aes</code> argument with <code>weight = AtRisk</code>. If you forget the <code>weight</code> argument you won’t be seeing the correct probability curve!</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="logistic.html#cb206-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(island, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">log</span>(Area), <span class="dt">y =</span> Extinct<span class="op">/</span>AtRisk, <span class="dt">weight =</span> AtRisk)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb206-2"><a href="logistic.html#cb206-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb206-3"><a href="logistic.html#cb206-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;glm&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>,  <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)) <span class="op">+</span></span>
<span id="cb206-4"><a href="logistic.html#cb206-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Extinction probability as a function of area&quot;</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-220-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="logistic-binomDev" class="section level2">
<h2><span class="header-section-number">4.10</span> Deviance for Binomial responses</h2>
<p>In Binomial logistic regression, the likelihood function is equal to
<span class="math display">\[
L(\beta) = \prod_{i=1}^n \binom{m_i}{y_i} \pi(X_i)^{y_i} (1-\pi(X_i))^{m_i-y_i}
\]</span>
In a binomial logistic regression the deviance is equal to
<span class="math display">\[
G^2 = 2[\ln L(\bar{\pi}) - \ln L(\hat{\pi}(X))] = 2\sum_{i=1}^n \left[ y_i \ln \left( \dfrac{y_i}{m_i\hat{\pi}(X_i)} \right) + (m_i- y_i) \ln \left( \dfrac{m_i-y_i}{m_i-m_i\hat{\pi}(X_i)} \right) \right]
\]</span>
Note that cases with large <span class="math inline">\(m_i\)</span> can contribute the most to this summation of individual case-level deviance.</p>
<p>Again, the two likelihoods that are used to construct residual deviance are:</p>
<ul>
<li><span class="math inline">\(L(\hat{\pi}(X)):\)</span> likelihood of the data that plugs in estimates <span class="math inline">\(\hat{\pi}(X_i)\)</span> from the logistic model.</li>
<li><span class="math inline">\(L(\bar{\pi}):\)</span> likelihood of the data that plugs in estimates <span class="math inline">\(\bar{\pi} = y_i/m_i\)</span>, basing a case’s “predicted” value soley on the response observed for that case. This is called a <strong>saturated</strong> model and it will always have a higher likelihood than the logistic model: <span class="math inline">\(L(\bar{\pi}) \geq L(\hat{\pi}(X))\)</span></li>
</ul>
<p>Deviance for binomial models can be used for two types of hypothesis tests:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Drop-in-deviance</strong>: Used to compare two models, just like in binary logistic models. Details are in Section <a href="logistic.html#logistic-dev">4.5</a>.</p></li>
<li><p><strong>Goodness-of-fit</strong>: Used to test binomial response model adequacy.</p></li>
</ol>
<div id="logistic-gof" class="section level3">
<h3><span class="header-section-number">4.10.1</span> Goodness-of-fit test</h3>
<p>In our binomial logistic model, we are assuming that an observed count for case <span class="math inline">\(i\)</span> behaves like a binomial random variable: <span class="math inline">\(Y_i \mid X_i \sim Binom(m_i, \pi(X_i))\)</span> where <span class="math inline">\(\pi(X_i)\)</span> is a function of <span class="math inline">\(p+1\)</span> <span class="math inline">\(\beta\)</span> parameters and the <span class="math inline">\(p\)</span> predictor terms.</p>
<p>A viable alternative model is the <em>saturated</em> “model” described above, which really isn’t a model that relates predictors to the response. Rather, it just uses the <span class="math inline">\(n\)</span> empirical proportion of successes <span class="math inline">\(\bar{\pi} = y_i/m_i\)</span> for each case as the probability of success for all <span class="math inline">\(m_i\)</span> trials. (So there are <span class="math inline">\(n\)</span> parameters in this “model”.)</p>
<p>The saturated model will have the best “fit” (highest likelihood) of the two models, but if the “fit” (likelihood) of the logistic model is “close” then we can claim that the logistic model is adequate. This is the motivation behind a “goodness-of-fit” test.</p>
<p>Our hypothese for the GOF test are:
<span class="math display">\[
H_0: \textrm{logistic model}
\]</span>
vs. 
<span class="math display">\[
H_A: \textrm{saturated model}
\]</span></p>
<p>The test statistic for this is equal to the <strong>residual deviance of the logistic model</strong> (difference in the <span class="math inline">\(H_A\)</span> and <span class="math inline">\(H_0\)</span> likelihoods):
<span class="math display">\[
G^2 = 2[\ln L(\bar{\pi}) - \ln L(\hat{\pi}(X))]
\]</span></p>
<p>If <span class="math inline">\(H_0\)</span> is true and the data does fit the logistic model, then when <span class="math inline">\(m_i\)</span>’s are large, <span class="math inline">\(G^2\)</span> will have an approximate <strong>chi-square distribution</strong> with <span class="math inline">\(n - (p+1)\)</span> (model) degrees of freedom. (Note that <span class="math inline">\(n-(p+1)\)</span> is the difference in the number of parameters in the two models.) Since large differences in the two likelihoods suggest that the null model is <em>not</em> adequate, the p-value is the probability of getting residual deviance values larger than the observed value:
<span class="math display">\[
p-value = 1-P(\chi^2 &gt; G^2) = 1-pchisq(G^2, df=n-(p+1))
\]</span>
The suggested rule of thumb for “large <span class="math inline">\(m\)</span>” is that we want most <span class="math inline">\(m_i\)</span>’s to be at least 5.</p>
<p>For a GOF test, you should consider the following interpretations for “large” or “small” p-values:</p>
<ul>
<li><strong>Do not reject the null:</strong> (large p-value)
<ul>
<li>Your logistic model is adequate.</li>
<li>You don’t have a large enough sample size <span class="math inline">\(n\)</span> to have the <em>power</em> to detect inadequacies in your model.</li>
</ul></li>
<li><strong>Reject the null:</strong> (small p-value)
<ul>
<li>You have outlier(s) that are inflating the residual deviance.</li>
<li>Your logistic model is inadequate.
<ul>
<li>Your log-odds model is inadequate, it is ill-fitting and transformations are needed</li>
<li>Extra-binomial variation: your response counts aren’t well modeled by a Binomial model. For each case:
<ul>
<li>trials are not independent</li>
<li>probability of success is not constant across trials</li>
<li>your choice of predictors isn’t sufficient (i.e. you are missing key explanatory variables)</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="example-krunnit-islands-archipelago-sleuth-case-study-21.1-1" class="section level3">
<h3><span class="header-section-number">4.10.2</span> Example: Krunnit Islands archipelago (Sleuth Case Study 21.1)</h3>
<p>For our extinction model, our GOF test hypotheses are
<span class="math display">\[
H_0: \ln(odds) = \beta_0 + \beta_1 \ln(area),  \ \ \ \ \ H_A: \ln odds= \alpha_i  \textrm{ (saturated model) }
\]</span>
We can conduct a GOF test because all our <span class="math inline">\(m_i\)</span>’s (<code>AtRisk</code>), are above 5:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="logistic.html#cb207-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(island<span class="op">$</span>AtRisk)</span>
<span id="cb207-2"><a href="logistic.html#cb207-2"></a><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb207-3"><a href="logistic.html#cb207-3"></a><span class="co">##    6.00   22.00   31.00   35.11   42.25   75.00</span></span></code></pre></div>
<p>Our test stat is the residual deviance of <span class="math inline">\(G^2 = 12.062\)</span> from the null model</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="logistic.html#cb208-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(krunnit.glm)</span>
<span id="cb208-2"><a href="logistic.html#cb208-2"></a><span class="co">## </span></span>
<span id="cb208-3"><a href="logistic.html#cb208-3"></a><span class="co">## Call:</span></span>
<span id="cb208-4"><a href="logistic.html#cb208-4"></a><span class="co">## glm(formula = Extinct/AtRisk ~ log(Area), family = &quot;binomial&quot;, </span></span>
<span id="cb208-5"><a href="logistic.html#cb208-5"></a><span class="co">##     data = island, weights = AtRisk)</span></span>
<span id="cb208-6"><a href="logistic.html#cb208-6"></a><span class="co">## </span></span>
<span id="cb208-7"><a href="logistic.html#cb208-7"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb208-8"><a href="logistic.html#cb208-8"></a><span class="co">##      Min        1Q    Median        3Q       Max  </span></span>
<span id="cb208-9"><a href="logistic.html#cb208-9"></a><span class="co">## -1.71726  -0.67722   0.09726   0.48365   1.49545  </span></span>
<span id="cb208-10"><a href="logistic.html#cb208-10"></a><span class="co">## </span></span>
<span id="cb208-11"><a href="logistic.html#cb208-11"></a><span class="co">## Coefficients:</span></span>
<span id="cb208-12"><a href="logistic.html#cb208-12"></a><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb208-13"><a href="logistic.html#cb208-13"></a><span class="co">## (Intercept) -1.19620    0.11845 -10.099  &lt; 2e-16 ***</span></span>
<span id="cb208-14"><a href="logistic.html#cb208-14"></a><span class="co">## log(Area)   -0.29710    0.05485  -5.416 6.08e-08 ***</span></span>
<span id="cb208-15"><a href="logistic.html#cb208-15"></a><span class="co">## ---</span></span>
<span id="cb208-16"><a href="logistic.html#cb208-16"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb208-17"><a href="logistic.html#cb208-17"></a><span class="co">## </span></span>
<span id="cb208-18"><a href="logistic.html#cb208-18"></a><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb208-19"><a href="logistic.html#cb208-19"></a><span class="co">## </span></span>
<span id="cb208-20"><a href="logistic.html#cb208-20"></a><span class="co">##     Null deviance: 45.338  on 17  degrees of freedom</span></span>
<span id="cb208-21"><a href="logistic.html#cb208-21"></a><span class="co">## Residual deviance: 12.062  on 16  degrees of freedom</span></span>
<span id="cb208-22"><a href="logistic.html#cb208-22"></a><span class="co">## AIC: 75.394</span></span>
<span id="cb208-23"><a href="logistic.html#cb208-23"></a><span class="co">## </span></span>
<span id="cb208-24"><a href="logistic.html#cb208-24"></a><span class="co">## Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
<p>We have <span class="math inline">\(18-2 = 16\)</span> degrees of freedom for our model, so the p-value is equal to
<span class="math display">\[
p-value = 1- P(\chi^2 &gt; 12.062) = 1- pchisq(12.062, df=16) = 0.7397
\]</span></p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="logistic.html#cb209-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="kw">pchisq</span>(<span class="fl">12.062</span>, <span class="dt">df=</span><span class="dv">16</span>)</span>
<span id="cb209-2"><a href="logistic.html#cb209-2"></a><span class="co">## [1] 0.7397009</span></span></code></pre></div>
<p>The large p-value means that we do not reject the null hypothesis. Our model for the probability of extinction given log-area looks to be adequate.</p>
<p>Note that if we hadn’t used log of area in our model our conclusions from the GOF would suggest something different:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="logistic.html#cb210-1"></a><span class="op">&gt;</span><span class="st"> </span>krunnit.glmBad &lt;-<span class="st"> </span><span class="kw">glm</span>(Extinct<span class="op">/</span>AtRisk <span class="op">~</span><span class="st"> </span>Area, <span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>, <span class="dt">weights=</span>AtRisk, <span class="dt">data=</span>island)</span>
<span id="cb210-2"><a href="logistic.html#cb210-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(krunnit.glmBad)</span>
<span id="cb210-3"><a href="logistic.html#cb210-3"></a><span class="co">## </span></span>
<span id="cb210-4"><a href="logistic.html#cb210-4"></a><span class="co">## Call:</span></span>
<span id="cb210-5"><a href="logistic.html#cb210-5"></a><span class="co">## glm(formula = Extinct/AtRisk ~ Area, family = &quot;binomial&quot;, data = island, </span></span>
<span id="cb210-6"><a href="logistic.html#cb210-6"></a><span class="co">##     weights = AtRisk)</span></span>
<span id="cb210-7"><a href="logistic.html#cb210-7"></a><span class="co">## </span></span>
<span id="cb210-8"><a href="logistic.html#cb210-8"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb210-9"><a href="logistic.html#cb210-9"></a><span class="co">##     Min       1Q   Median       3Q      Max  </span></span>
<span id="cb210-10"><a href="logistic.html#cb210-10"></a><span class="co">## -1.6526  -1.0661  -0.1877   1.0038   2.1860  </span></span>
<span id="cb210-11"><a href="logistic.html#cb210-11"></a><span class="co">## </span></span>
<span id="cb210-12"><a href="logistic.html#cb210-12"></a><span class="co">## Coefficients:</span></span>
<span id="cb210-13"><a href="logistic.html#cb210-13"></a><span class="co">##              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb210-14"><a href="logistic.html#cb210-14"></a><span class="co">## (Intercept) -1.305957   0.117339 -11.130  &lt; 2e-16 ***</span></span>
<span id="cb210-15"><a href="logistic.html#cb210-15"></a><span class="co">## Area        -0.010121   0.002684  -3.771 0.000163 ***</span></span>
<span id="cb210-16"><a href="logistic.html#cb210-16"></a><span class="co">## ---</span></span>
<span id="cb210-17"><a href="logistic.html#cb210-17"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb210-18"><a href="logistic.html#cb210-18"></a><span class="co">## </span></span>
<span id="cb210-19"><a href="logistic.html#cb210-19"></a><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb210-20"><a href="logistic.html#cb210-20"></a><span class="co">## </span></span>
<span id="cb210-21"><a href="logistic.html#cb210-21"></a><span class="co">##     Null deviance: 45.338  on 17  degrees of freedom</span></span>
<span id="cb210-22"><a href="logistic.html#cb210-22"></a><span class="co">## Residual deviance: 24.661  on 16  degrees of freedom</span></span>
<span id="cb210-23"><a href="logistic.html#cb210-23"></a><span class="co">## AIC: 87.993</span></span>
<span id="cb210-24"><a href="logistic.html#cb210-24"></a><span class="co">## </span></span>
<span id="cb210-25"><a href="logistic.html#cb210-25"></a><span class="co">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb210-26"><a href="logistic.html#cb210-26"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="kw">pchisq</span>(<span class="fl">24.661</span>, <span class="dt">df=</span><span class="dv">16</span>)</span>
<span id="cb210-27"><a href="logistic.html#cb210-27"></a><span class="co">## [1] 0.07602884</span></span></code></pre></div>
<p>The residual deviance for this model is about double the deviance of the log-area model. The much smaller p-value of 0.076 suggest that the null model may not be adequate, which our initial EDA for the log-odds suggested.</p>
</div>
</div>
<div id="logistic-assump" class="section level2">
<h2><span class="header-section-number">4.11</span> Checking Assumptions</h2>
<p>Assumptions in a binomial logistic model include the same assumptions as binary models (Section @(logistic-assump)): cases are independent and log-odds are a linear function of predictors.</p>
<ul>
<li>Independence of cases takes an understanding of how the data was collected.</li>
<li>Log-odds linearity can be checked with an empirical log-odds plot against quantitative predictors (as done in Section <a href="logistic.html#logistic-BinomEDAex">4.9.1.1</a>) and residual plots.</li>
</ul>
<p>A third assumption is that given predictor values, the counts of successes <span class="math inline">\(Y_i\)</span> has a binomial distribution. This means that for each case <span class="math inline">\(i\)</span></p>
<ul>
<li>the <span class="math inline">\(m_i\)</span> trials are independent events, and a success or failure for one trial doesn’t affect the outcome of another trial, and</li>
<li>the probability of success <span class="math inline">\(\pi(X_i)\)</span> is the same for all <span class="math inline">\(m_i\)</span> trials.</li>
</ul>
<p>If one, or both, of these assumptions is violated, then it often induces <strong>extra-binomial variation</strong> (a.k.a. <strong>overdispersion</strong>). This means that the actual variation in our response <span class="math inline">\(SD(Y\mid X_i)\)</span> is <strong>larger</strong> than the binomial SD of <span class="math inline">\(\sqrt{m_i\pi(X_i)(1-\pi(X_i))}\)</span> that our model assumes. So the response variation is more dispersed than what our model assumes, making our reported <strong>standard errors and p-values too small</strong> and we could be over-reporting statistical significance.</p>
<p>We can use the goodness-of-fit test (<a href="logistic.html#logistic-gof">4.10.1</a>), when <span class="math inline">\(m_i\)</span> are large enough, to check our binomial distribution assumption. If we do find evidence of lack-of-fit in our binomial model, then you should</p>
<ul>
<li>Check deviance residuals as case influence stats to see if an outlier(s) is affecting GOF results.</li>
<li>Check the log odds form and see if transformations of quantitative predictors are needed</li>
<li>If outliers and transformations aren’t a concern, then consider an alternative model:
<ul>
<li>binary logistic model if trial-level predictors are available</li>
<li>quasi-binmial logistic model (Section <a href="logistic.html#logistic-quasi">4.13</a>)</li>
<li>a model that allows for correlated trials (like a mixed-effects logistic model)</li>
</ul></li>
</ul>
<div id="example-krunnit-islands-archipelago-sleuth-case-study-21.1-2" class="section level3">
<h3><span class="header-section-number">4.11.1</span> Example: Krunnit Islands archipelago (Sleuth Case Study 21.1)</h3>
<p>How might the Krunnit Island extinction counts violate the binomial counts model assumptions:</p>
<ul>
<li><p><strong>Independence</strong>: This assumption implies that the extinction, or not, of all at risk species on an island are independent events. This could be violated if the extinction of one species makes the extinction of a second more likely. This might occur if the prey of a predator species goes extinct, making extinction of the predator species more likely.</p></li>
<li><p><strong>Probability</strong>: This assumption implies that the probability <span class="math inline">\(\pi(X_i)\)</span> of extinction on island <span class="math inline">\(i\)</span> is the same for all at risk species on island <span class="math inline">\(i\)</span>. This could be violated if, for example, species living primarily on the interior of the island had a lower chance of extinction than species living on the coastal region. Since location of each at risk species is unaccounted for in our model, then the overall number of extinct species on the island is not a binomial variable.</p></li>
</ul>
</div>
</div>
<div id="logistic-binomResid" class="section level2">
<h2><span class="header-section-number">4.12</span> Residuals and case influence for binomial responses</h2>
<p>We have a few options for residuals for a binomial logistic model. The two most common residuals to consider are Pearson residuals and deviance residuals.</p>
<p><strong>Pearson residuals</strong> are basically response residuals standardized based on the binomial SD:
<span class="math display">\[
pr_i = \dfrac{ y_i - m_i\hat{\pi}(X_i)}{\sqrt{m_i\hat{\pi}(X_i)(1-\hat{\pi}(X_i))}}
\]</span>
We can get these residuals by requesting the “pearson” type of residual:</p>
<ul>
<li><code>resid(my.glm, type = "pearson")</code></li>
<li><code>augment(my.glm,  type.residuals = "pearson")</code></li>
</ul>
<p><strong>Deviance residuals</strong> are each case’s contribution to the residual deviance, with a <span class="math inline">\(\pm\)</span> based on whether we over- or under-estimate a case’s response (the <span class="math inline">\(\pm\)</span> is denoted by <span class="math inline">\(sign(y_i - m_i\hat{\pi}(X_i))\)</span>):
<span class="math display">\[
Dres_i =  sign(y_i - m_i\hat{\pi}(X_i)) \sqrt{2 \left[ y_i \ln \left( \dfrac{y_i}{m_i\hat{\pi}(X_i)} \right) + (m_i- y_i) \ln \left( \dfrac{m_i-y_i}{m_i-m_i\hat{\pi}(X_i)} \right) \right] }
\]</span>
We can get these residuals by requesting the default residual values:</p>
<ul>
<li><code>resid(my.glm)</code></li>
<li><code>augment(my.glm)</code></li>
</ul>
<p>Pearson residuals are “easy” to interpret as the number of estimated SD’s a response is from it’s estimated mean. Deviance residuals are good to check if you find significant results in a GOF test. When <span class="math inline">\(m_i\)</span>’s are large (at least 5), both types of residuals should be similar in value and have a <span class="math inline">\(N(0,1)\)</span> distribution (approximately). This means that most cases (~95%) should have residual values no more extreme than <span class="math inline">\(\pm 2\)</span>. Regardless of size of <span class="math inline">\(m_i\)</span>, we should plot residuals vs. quantitative predictors to assess linearity of the log odds.</p>
<p>Case influence stats of leverage and Cook’s distance can also be used to look for outliers. In a GLM, leverage measures both a cases’s “extremeness” in terms of it’s predictor values <strong>and</strong> it’s extremeness in terms of it’s <strong>weight</strong> <span class="math inline">\(m_i\)</span> in the model. A case with high value of <span class="math inline">\(m_i\)</span> has a high number of trials and we are better able to estimate the probability of success for this case compared to a case with a smaller number of trials. For this reason, cases with higher value of <span class="math inline">\(m_i\)</span> are given more weight, and hence higher leverage, in the fitted model (e.g. in the estiamtes of <span class="math inline">\(\hat{\beta}\)</span>). The value of Cook’s distance also takes into account a cases leverage (measured both by predictor values and by <span class="math inline">\(m_i\)</span> size) and a case’s residual value.</p>
<p>You can get Pearson residuals, leverage and Cook’s distance with <code>plot(my.glm, which = 5)</code>. You can also get leverage and Cook’s distance vs. predictor values with <code>ggnostic(my.glm, columnsY = c(".hat",".cooksd"))</code> from the <code>GGally</code> package.</p>
<div id="example-krunnit-islands-archipelago-sleuth-case-study-21.1-3" class="section level3">
<h3><span class="header-section-number">4.12.1</span> Example: Krunnit Islands archipelago (Sleuth Case Study 21.1)</h3>
<p>Here we use the <code>augment</code> command to get both sets of residuals for the logistic regression of extinction on log area. Neither plot shows an obvious trend, so the linearity assumption looks to be met.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="logistic.html#cb211-1"></a><span class="op">&gt;</span><span class="st"> </span>island.aug &lt;-<span class="st"> </span><span class="kw">augment</span>(krunnit.glm, <span class="dt">type.residual=</span><span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb211-2"><a href="logistic.html#cb211-2"></a><span class="op">&gt;</span><span class="st"> </span>plotA &lt;-<span class="st"> </span><span class="kw">ggplot</span>(island.aug, <span class="kw">aes</span>(<span class="dt">x=</span>log.Area., <span class="dt">y=</span>.resid)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb211-3"><a href="logistic.html#cb211-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>()  <span class="op">+</span><span class="st"> </span></span>
<span id="cb211-4"><a href="logistic.html#cb211-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>)  <span class="op">+</span><span class="st"> </span></span>
<span id="cb211-5"><a href="logistic.html#cb211-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Pearson residual plot&quot;</span>)</span>
<span id="cb211-6"><a href="logistic.html#cb211-6"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb211-7"><a href="logistic.html#cb211-7"></a><span class="er">&gt;</span><span class="st"> </span>island.aug &lt;-<span class="st"> </span><span class="kw">augment</span>(krunnit.glm)</span>
<span id="cb211-8"><a href="logistic.html#cb211-8"></a><span class="op">&gt;</span><span class="st"> </span>plotB &lt;-<span class="st"> </span><span class="kw">ggplot</span>(island.aug, <span class="kw">aes</span>(<span class="dt">x=</span>log.Area., <span class="dt">y=</span>.resid)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb211-9"><a href="logistic.html#cb211-9"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>()  <span class="op">+</span><span class="st"> </span></span>
<span id="cb211-10"><a href="logistic.html#cb211-10"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>)  <span class="op">+</span><span class="st"> </span></span>
<span id="cb211-11"><a href="logistic.html#cb211-11"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Deviance residual plot&quot;</span>)</span>
<span id="cb211-12"><a href="logistic.html#cb211-12"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb211-13"><a href="logistic.html#cb211-13"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(gridExtra)</span>
<span id="cb211-14"><a href="logistic.html#cb211-14"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">grid.arrange</span>(plotA, plotB, <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-225-1.png" width="672" /></p>
<p>Since all at risk counts are rather large (all cases are 6 or larger), we can expect the residuals to be approximately <span class="math inline">\(N(0,1)\)</span>. The residual plots above show no cases that are extreme is magnitude. A normal QQ plot shows rough normality with the min and max residuals case deviating a bit from the reference line.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="logistic.html#cb212-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(krunnit.glm, <span class="dt">which=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-226-1.png" width="672" /></p>
<p>We can plot residuals and case influence stats with all 18 cases identified with the <code>plot</code> command. Here we see that rows 1,2 and 17 have largest leverage while case 3 looks to have the highest Cook’s distance value.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="logistic.html#cb213-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(krunnit.glm, <span class="dt">which=</span><span class="dv">5</span>, <span class="dt">id.n=</span><span class="dv">18</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-227-1.png" width="672" /></p>
<p>Here we see that the case influence stats against log area and against the model weights, number at risk:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="logistic.html#cb214-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(GGally)</span>
<span id="cb214-2"><a href="logistic.html#cb214-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggnostic</span>(krunnit.glm, <span class="dt">columnsY =</span> <span class="kw">c</span>(<span class="st">&quot;.hat&quot;</span>,<span class="st">&quot;.cooksd&quot;</span>))</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-228-1.png" width="672" /></p>
<p>Finally, we dig a bit deeper and look at the data for the four highlighted cases above. We also plot weight (number at risk) against log area and highlight the small residual cases in blue (cases 2 and 3) and the larger residual cases (1, 17).</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="logistic.html#cb215-1"></a><span class="op">&gt;</span><span class="st"> </span>island.aug &lt;-<span class="st"> </span><span class="kw">augment</span>(krunnit.glm, <span class="dt">data=</span>island, <span class="dt">type.predict =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb215-2"><a href="logistic.html#cb215-2"></a><span class="op">&gt;</span><span class="st"> </span>island.aug <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">17</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>.se.fit, <span class="op">-</span>.sigma)</span>
<span id="cb215-3"><a href="logistic.html#cb215-3"></a><span class="co">## # A tibble: 4 x 11</span></span>
<span id="cb215-4"><a href="logistic.html#cb215-4"></a><span class="co">##   Island  Area AtRisk Extinct   prop logOdds .fitted  .resid  .hat .cooksd</span></span>
<span id="cb215-5"><a href="logistic.html#cb215-5"></a><span class="co">##   &lt;fct&gt;  &lt;dbl&gt;  &lt;int&gt;   &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb215-6"><a href="logistic.html#cb215-6"></a><span class="co">## 1 Ulkok~ 186.      75       5 0.0667  -2.64   0.0602  0.233  0.293 1.63e-2</span></span>
<span id="cb215-7"><a href="logistic.html#cb215-7"></a><span class="co">## 2 Maakr~ 106.      67       3 0.0448  -3.06   0.0704 -0.874  0.242 1.41e-1</span></span>
<span id="cb215-8"><a href="logistic.html#cb215-8"></a><span class="co">## 3 Risti~  30.7     66      10 0.152   -1.72   0.0985  1.35   0.185 2.89e-1</span></span>
<span id="cb215-9"><a href="logistic.html#cb215-9"></a><span class="co">## 4 Tiira~   0.2     40      13 0.325   -0.731  0.328  -0.0381 0.266 3.59e-4</span></span>
<span id="cb215-10"><a href="logistic.html#cb215-10"></a><span class="co">## # ... with 1 more variable: .std.resid &lt;dbl&gt;</span></span>
<span id="cb215-11"><a href="logistic.html#cb215-11"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">select</span>(island.aug, Area, AtRisk))</span>
<span id="cb215-12"><a href="logistic.html#cb215-12"></a><span class="co">##       Area             AtRisk     </span></span>
<span id="cb215-13"><a href="logistic.html#cb215-13"></a><span class="co">##  Min.   :  0.070   Min.   : 6.00  </span></span>
<span id="cb215-14"><a href="logistic.html#cb215-14"></a><span class="co">##  1st Qu.:  0.625   1st Qu.:22.00  </span></span>
<span id="cb215-15"><a href="logistic.html#cb215-15"></a><span class="co">##  Median :  2.150   Median :31.00  </span></span>
<span id="cb215-16"><a href="logistic.html#cb215-16"></a><span class="co">##  Mean   : 19.804   Mean   :35.11  </span></span>
<span id="cb215-17"><a href="logistic.html#cb215-17"></a><span class="co">##  3rd Qu.:  4.725   3rd Qu.:42.25  </span></span>
<span id="cb215-18"><a href="logistic.html#cb215-18"></a><span class="co">##  Max.   :185.800   Max.   :75.00</span></span>
<span id="cb215-19"><a href="logistic.html#cb215-19"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(island.aug, <span class="kw">aes</span>(<span class="dt">x=</span>Area, <span class="dt">y=</span>AtRisk, <span class="dt">size=</span>.hat)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb215-20"><a href="logistic.html#cb215-20"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb215-21"><a href="logistic.html#cb215-21"></a><span class="op">+</span><span class="st">   </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb215-22"><a href="logistic.html#cb215-22"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">data=</span><span class="kw">slice</span>(island.aug, <span class="dv">1</span>,<span class="dv">17</span>), <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb215-23"><a href="logistic.html#cb215-23"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">data=</span><span class="kw">slice</span>(island.aug, <span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb215-24"><a href="logistic.html#cb215-24"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;at risk vs. area, size denotes leverage&quot;</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-229-1.png" width="672" /></p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="logistic.html#cb216-1"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb216-2"><a href="logistic.html#cb216-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(island.aug, <span class="kw">aes</span>(<span class="dt">x=</span>Area, <span class="dt">y=</span>AtRisk, <span class="dt">size=</span>.cooksd)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb216-3"><a href="logistic.html#cb216-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb216-4"><a href="logistic.html#cb216-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb216-5"><a href="logistic.html#cb216-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">data=</span><span class="kw">slice</span>(island.aug, <span class="dv">1</span>,<span class="dv">17</span>), <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb216-6"><a href="logistic.html#cb216-6"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">data=</span><span class="kw">slice</span>(island.aug, <span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb216-7"><a href="logistic.html#cb216-7"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;at risk vs. area, size denotes Cook&#39;s distance&quot;</span>)</span></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-229-2.png" width="672" /></p>
<ul>
<li><p>Case 1 (Ulkokrunni) is the island with the largest area and the largest number at risk (<span class="math inline">\(m_i\)</span>). For this reason case 1 has largest leverage but it doesn’t have an large residual value so it doesn’t have high Cook’s distance. (See the fitted probability curve in Section <a href="logistic.html#logistic-exViz">4.9.1.3</a>).</p></li>
<li><p>Case 17 (Tiirakari) has the <em>second smallest</em> area but a large number of at risk species given its small size. For this reason it has <em>larger</em> leverage than case 18 which has the smallest area but smaller number at risk. The fitted probability curve is very close to this case, though, so it has a small residual and low Cook’s distance.</p></li>
</ul>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="logistic.html#cb217-1"></a><span class="op">&gt;</span><span class="st"> </span>island.aug <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">18</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>.se.fit, <span class="op">-</span>.sigma)</span>
<span id="cb217-2"><a href="logistic.html#cb217-2"></a><span class="co">## # A tibble: 1 x 11</span></span>
<span id="cb217-3"><a href="logistic.html#cb217-3"></a><span class="co">##   Island  Area AtRisk Extinct  prop logOdds .fitted .resid   .hat .cooksd</span></span>
<span id="cb217-4"><a href="logistic.html#cb217-4"></a><span class="co">##   &lt;fct&gt;  &lt;dbl&gt;  &lt;int&gt;   &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb217-5"><a href="logistic.html#cb217-5"></a><span class="co">## 1 Risti~  0.07      6       3   0.5       0   0.400  0.496 0.0708  0.0103</span></span>
<span id="cb217-6"><a href="logistic.html#cb217-6"></a><span class="co">## # ... with 1 more variable: .std.resid &lt;dbl&gt;</span></span></code></pre></div>
<ul>
<li>Case 3 (Ristikari) has the third largest area (30.7) but it’s number at risk (66) is only one smaller than case 2 (Maakrunni) which is the second largest area (106). Case 3 also has a much larger residual than case 2, which results in it having the highest Cook’s distance value in the data set.</li>
</ul>
<p>In the end, though, none of these cases is overly influential in the model it and removal of case 3, the highest Cook’s distance, changes the estamate of <span class="math inline">\(\beta_1\)</span> from 0.30 to 0.33 and it’s significance doesn’t change. No cases need to be omitted from our analysis.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="logistic.html#cb218-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">glm</span>(Extinct<span class="op">/</span>AtRisk <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(Area), <span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>, <span class="dt">weights=</span>AtRisk, <span class="dt">data=</span>island, <span class="dt">subset=</span><span class="op">-</span><span class="dv">3</span>))</span>
<span id="cb218-2"><a href="logistic.html#cb218-2"></a><span class="co">## </span></span>
<span id="cb218-3"><a href="logistic.html#cb218-3"></a><span class="co">## Call:</span></span>
<span id="cb218-4"><a href="logistic.html#cb218-4"></a><span class="co">## glm(formula = Extinct/AtRisk ~ log(Area), family = &quot;binomial&quot;, </span></span>
<span id="cb218-5"><a href="logistic.html#cb218-5"></a><span class="co">##     data = island, weights = AtRisk, subset = -3)</span></span>
<span id="cb218-6"><a href="logistic.html#cb218-6"></a><span class="co">## </span></span>
<span id="cb218-7"><a href="logistic.html#cb218-7"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb218-8"><a href="logistic.html#cb218-8"></a><span class="co">##      Min        1Q    Median        3Q       Max  </span></span>
<span id="cb218-9"><a href="logistic.html#cb218-9"></a><span class="co">## -1.69885  -0.51675   0.02167   0.56804   1.47846  </span></span>
<span id="cb218-10"><a href="logistic.html#cb218-10"></a><span class="co">## </span></span>
<span id="cb218-11"><a href="logistic.html#cb218-11"></a><span class="co">## Coefficients:</span></span>
<span id="cb218-12"><a href="logistic.html#cb218-12"></a><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb218-13"><a href="logistic.html#cb218-13"></a><span class="co">## (Intercept) -1.21921    0.11994 -10.165  &lt; 2e-16 ***</span></span>
<span id="cb218-14"><a href="logistic.html#cb218-14"></a><span class="co">## log(Area)   -0.33234    0.06148  -5.405 6.47e-08 ***</span></span>
<span id="cb218-15"><a href="logistic.html#cb218-15"></a><span class="co">## ---</span></span>
<span id="cb218-16"><a href="logistic.html#cb218-16"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb218-17"><a href="logistic.html#cb218-17"></a><span class="co">## </span></span>
<span id="cb218-18"><a href="logistic.html#cb218-18"></a><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb218-19"><a href="logistic.html#cb218-19"></a><span class="co">## </span></span>
<span id="cb218-20"><a href="logistic.html#cb218-20"></a><span class="co">##     Null deviance: 45.1373  on 16  degrees of freedom</span></span>
<span id="cb218-21"><a href="logistic.html#cb218-21"></a><span class="co">## Residual deviance:  9.7483  on 15  degrees of freedom</span></span>
<span id="cb218-22"><a href="logistic.html#cb218-22"></a><span class="co">## AIC: 69.087</span></span>
<span id="cb218-23"><a href="logistic.html#cb218-23"></a><span class="co">## </span></span>
<span id="cb218-24"><a href="logistic.html#cb218-24"></a><span class="co">## Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
</div>
</div>
<div id="logistic-quasi" class="section level2">
<h2><span class="header-section-number">4.13</span> Quasi-binomial logistic model</h2>
<p>A quasi-binomial logistic regression model is one model option when your GOF test suggests that your binomial model assumptions of independent trials and/or constant probability of success across trials are not met. The idea behind this model is to estimate the amount of “overdispersion” and use this value to correct your binimial model SEs.</p>
<p>In a quasi-binomial model we let <span class="math inline">\(\psi\)</span> measure overdispersion so that the responce variance equals:
<span class="math display">\[
V_{quasi}(Y_i \mid X_i)= \psi m_i \pi(X_i)(1-\pi(X_i))  =\psi V_{binom}(Y_i \mid X_i)
\]</span>
If <span class="math inline">\(\psi&gt;1\)</span>, then our responses are more variable than binomial responses should be and <span class="math inline">\(V_{quasi}(Y_i \mid X_i) &gt; V_{binom}(Y_i \mid X_i)\)</span>. It is possible to have underdispersion, where <span class="math inline">\(\psi &lt; 1\)</span> in which case <span class="math inline">\(V_{quasi}(Y_i \mid X_i) &lt; V_{binom}(Y_i \mid X_i)\)</span>.</p>
<p>A “quasi” model is not a real model in the sense that we are defining a probability model and likelihood for the <span class="math inline">\(Y_i\)</span>’s. Rather, we are still going to fit a binomial model and use MLE estimates from the binomial likelihood for our estimated parameters. We then estimate <span class="math inline">\(\psi\)</span> and adjust our binomial model SE accordingly to adjust over overdispersion.</p>
<p>Steps to fitting a quasi-binomial model:</p>
<ol style="list-style-type: decimal">
<li><p>Fit the binomial logistic regression model, then estimate the dispersion parameter by comparing the model residual deviance to <span class="math inline">\(n-(p+1)\)</span> which is it’s expected value if the model was adequate:
<span class="math display">\[
\hat{\psi} = \dfrac{G^2}{n-(p+1)}
\]</span></p></li>
<li><p>Parameter estimates for <span class="math inline">\(\beta\)</span> are from the binomial model.</p></li>
<li><p>Standard errors for <span class="math inline">\(\hat{\beta}\)</span>’s are expanded (if <span class="math inline">\(\hat{\psi}&gt;1\)</span>) to account for overdispersion by a factor of <span class="math inline">\(\sqrt{\hat{\psi}}\)</span>:
<span class="math display">\[
SE_{quasi}(\hat{\beta}_i) = \sqrt{\hat{\psi}}SE_{binom}(\hat{\beta}_i)
\]</span></p></li>
<li><p>Conduct “z”-inference (Wald tests/CI) using SEs equal to <span class="math inline">\(SE_{quasi}(\hat{\beta}_i)\)</span></p></li>
<li><p>Compare quasi-binomial models using a F-test stat equal to
<span class="math display">\[
F = \dfrac{G^2/(\textrm{# terms tested})}{\hat{\psi}}
\]</span>
using an F-distribution with degrees of freedom equal to the number of terms tested and <span class="math inline">\(n-(p+1)\)</span>. (The “usual” df for an ANOVA F test.)</p></li>
</ol>
<p>We can get inference results for steps 1-4 above by adding <code>family = quasibinomial</code> to our <code>glm</code> regression fit:</p>
<pre><code>glm(y/m ~ x1 + x2, family = quasibinomial, weights = m, data=mydata)</code></pre>
<p>We can get compare quasi-binomial models using deviance with the command</p>
<pre><code>anova(red.quasi, full.quasi, test = &quot;F&quot;)</code></pre>
<p>Note that the method of estimation dispersion as <span class="math inline">\(G^2/(n-(p+1))\)</span> is <em>one</em> way to estimate this parameter. This idea is based on the fact that the <span class="math inline">\(G^2\)</span> value will have an approximate <span class="math inline">\(\chi^2\)</span> distribution with expected value of <span class="math inline">\(n-(p+1)\)</span> when the binomial model is adequate. Comparing the actual value of <span class="math inline">\(G^2\)</span> to this expectation tells us our dispersion rate. Another way to compute this value is to look at the <strong>sum of the squared Pearson residuals</strong>, which should also have an expected value of <span class="math inline">\(n-(p+1)\)</span>. The ratio of these two quantities is actually what the <code>glm</code> function uses to compute the dispersion parameter. Often there is no pratical difference between these two ways of estimation the dispersion parameter.</p>
<div id="example-moth-predation-case-study-21.2" class="section level3">
<h3><span class="header-section-number">4.13.1</span> Example: Moth predation (Case Study 21.2)</h3>
<p>Sleuth case study 21.2 models the probability that a moth is “removed” from a tree (eaten by a bird) as a function of the color of the moth (<code>morph</code>, light or dark) and the distance the moth was from Liverpool (<code>Distance</code>, one of 7 locations, measured in km). The number of moths available at each location and in each color group is measured by <code>Place</code>.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="logistic.html#cb221-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(Sleuth3)</span>
<span id="cb221-2"><a href="logistic.html#cb221-2"></a><span class="op">&gt;</span><span class="st"> </span>moth &lt;-<span class="st"> </span>case2102</span>
<span id="cb221-3"><a href="logistic.html#cb221-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">dim</span>(moth)</span>
<span id="cb221-4"><a href="logistic.html#cb221-4"></a><span class="co">## [1] 14  4</span></span>
<span id="cb221-5"><a href="logistic.html#cb221-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(moth)</span>
<span id="cb221-6"><a href="logistic.html#cb221-6"></a><span class="co">##    Morph      Distance         Placed         Removed     </span></span>
<span id="cb221-7"><a href="logistic.html#cb221-7"></a><span class="co">##  dark :7   Min.   : 0.00   Min.   :52.00   Min.   : 9.00  </span></span>
<span id="cb221-8"><a href="logistic.html#cb221-8"></a><span class="co">##  light:7   1st Qu.:11.43   1st Qu.:57.00   1st Qu.:16.25  </span></span>
<span id="cb221-9"><a href="logistic.html#cb221-9"></a><span class="co">##            Median :30.20   Median :60.00   Median :20.00  </span></span>
<span id="cb221-10"><a href="logistic.html#cb221-10"></a><span class="co">##            Mean   :27.23   Mean   :69.14   Mean   :21.86  </span></span>
<span id="cb221-11"><a href="logistic.html#cb221-11"></a><span class="co">##            3rd Qu.:40.23   3rd Qu.:83.00   3rd Qu.:23.75  </span></span>
<span id="cb221-12"><a href="logistic.html#cb221-12"></a><span class="co">##            Max.   :51.20   Max.   :92.00   Max.   :40.00</span></span></code></pre></div>
<p>To make our <code>glm</code> results match those of the textbook (which have an indicator for the <code>dark</code> level), we will relevel <code>Morph</code> to make <code>dark</code> the second level (Section <a href="rreview.html#factors">C.4</a>):</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="logistic.html#cb222-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(forcats)</span>
<span id="cb222-2"><a href="logistic.html#cb222-2"></a><span class="op">&gt;</span><span class="st"> </span>moth<span class="op">$</span>Morph2 &lt;-<span class="st"> </span><span class="kw">fct_relevel</span>(moth<span class="op">$</span>Morph, <span class="st">&quot;light&quot;</span>, <span class="st">&quot;dark&quot;</span>)</span>
<span id="cb222-3"><a href="logistic.html#cb222-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">levels</span>(moth<span class="op">$</span>Morph2)</span>
<span id="cb222-4"><a href="logistic.html#cb222-4"></a><span class="co">## [1] &quot;light&quot; &quot;dark&quot;</span></span></code></pre></div>
<p>We will now fit the binomial logistic regression of number removed on the interaction of morph color and distance:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="logistic.html#cb223-1"></a><span class="op">&gt;</span><span class="st"> </span>moth.glm &lt;-<span class="st"> </span><span class="kw">glm</span>(Removed<span class="op">/</span>Placed <span class="op">~</span><span class="st"> </span>Morph2<span class="op">*</span>Distance, </span>
<span id="cb223-2"><a href="logistic.html#cb223-2"></a><span class="op">+</span><span class="st">                 </span><span class="dt">family=</span>binomial, <span class="dt">weights=</span> Placed, <span class="dt">data=</span>moth)</span>
<span id="cb223-3"><a href="logistic.html#cb223-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(moth.glm)</span>
<span id="cb223-4"><a href="logistic.html#cb223-4"></a><span class="co">## </span></span>
<span id="cb223-5"><a href="logistic.html#cb223-5"></a><span class="co">## Call:</span></span>
<span id="cb223-6"><a href="logistic.html#cb223-6"></a><span class="co">## glm(formula = Removed/Placed ~ Morph2 * Distance, family = binomial, </span></span>
<span id="cb223-7"><a href="logistic.html#cb223-7"></a><span class="co">##     data = moth, weights = Placed)</span></span>
<span id="cb223-8"><a href="logistic.html#cb223-8"></a><span class="co">## </span></span>
<span id="cb223-9"><a href="logistic.html#cb223-9"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb223-10"><a href="logistic.html#cb223-10"></a><span class="co">##      Min        1Q    Median        3Q       Max  </span></span>
<span id="cb223-11"><a href="logistic.html#cb223-11"></a><span class="co">## -2.21183  -0.39883   0.01155   0.68292   1.31242  </span></span>
<span id="cb223-12"><a href="logistic.html#cb223-12"></a><span class="co">## </span></span>
<span id="cb223-13"><a href="logistic.html#cb223-13"></a><span class="co">## Coefficients:</span></span>
<span id="cb223-14"><a href="logistic.html#cb223-14"></a><span class="co">##                      Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb223-15"><a href="logistic.html#cb223-15"></a><span class="co">## (Intercept)         -0.717729   0.190205  -3.773 0.000161 ***</span></span>
<span id="cb223-16"><a href="logistic.html#cb223-16"></a><span class="co">## Morph2dark          -0.411257   0.274490  -1.498 0.134066    </span></span>
<span id="cb223-17"><a href="logistic.html#cb223-17"></a><span class="co">## Distance            -0.009287   0.005788  -1.604 0.108629    </span></span>
<span id="cb223-18"><a href="logistic.html#cb223-18"></a><span class="co">## Morph2dark:Distance  0.027789   0.008085   3.437 0.000588 ***</span></span>
<span id="cb223-19"><a href="logistic.html#cb223-19"></a><span class="co">## ---</span></span>
<span id="cb223-20"><a href="logistic.html#cb223-20"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb223-21"><a href="logistic.html#cb223-21"></a><span class="co">## </span></span>
<span id="cb223-22"><a href="logistic.html#cb223-22"></a><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb223-23"><a href="logistic.html#cb223-23"></a><span class="co">## </span></span>
<span id="cb223-24"><a href="logistic.html#cb223-24"></a><span class="co">##     Null deviance: 35.385  on 13  degrees of freedom</span></span>
<span id="cb223-25"><a href="logistic.html#cb223-25"></a><span class="co">## Residual deviance: 13.230  on 10  degrees of freedom</span></span>
<span id="cb223-26"><a href="logistic.html#cb223-26"></a><span class="co">## AIC: 83.904</span></span>
<span id="cb223-27"><a href="logistic.html#cb223-27"></a><span class="co">## </span></span>
<span id="cb223-28"><a href="logistic.html#cb223-28"></a><span class="co">## Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
<p>A goodness-of-fit test doesn’t give a <em>strong</em> indication of overdispersion, but as the book suggests, given the design of the study, it is completely reasonable to assume there are other factors besides distance from Liverpool that could affect the probability of removal at each location. Since these factors aren’t accounted for in the model, we may want to use a quasi-binomial model that accounts for this unmodeled variation.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="logistic.html#cb224-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="kw">pchisq</span>(<span class="fl">13.23</span>, <span class="dt">df=</span><span class="dv">10</span>)   <span class="co"># GOF p-value</span></span>
<span id="cb224-2"><a href="logistic.html#cb224-2"></a><span class="co">## [1] 0.2110951</span></span></code></pre></div>
<p>Using the <code>glm</code> results for the binomial fit, our estimated dispersion parameter is
<span class="math display">\[
\hat{\psi} = \dfrac{G^2}{n-(p+1)} = \dfrac{13.23}{14-(3+1)} = 1.323
\]</span></p>
<p>In a quasi-binomial model, the SE’s will be larger than the binomial model SE’s by a factor of <span class="math inline">\(\sqrt{1.323} = 1.150\)</span>, or about 15% larger. For example, the quasi-binomial SE for the interaction term will be
<span class="math display">\[
SE_{quasi} = \sqrt{1.323} \times 0.008085 \approx 0.0092995
\]</span></p>
<p>We can fit this quasi-binomial model in R, and get these dispersion and SE values as follows:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="logistic.html#cb225-1"></a><span class="op">&gt;</span><span class="st"> </span>moth.quasi &lt;-<span class="st"> </span><span class="kw">glm</span>(Removed<span class="op">/</span>Placed <span class="op">~</span><span class="st"> </span>Morph2<span class="op">*</span>Distance, </span>
<span id="cb225-2"><a href="logistic.html#cb225-2"></a><span class="op">+</span><span class="st">                 </span><span class="dt">family=</span>quasibinomial, <span class="dt">weights=</span> Placed, <span class="dt">data=</span>moth)</span>
<span id="cb225-3"><a href="logistic.html#cb225-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(moth.quasi)</span>
<span id="cb225-4"><a href="logistic.html#cb225-4"></a><span class="co">## </span></span>
<span id="cb225-5"><a href="logistic.html#cb225-5"></a><span class="co">## Call:</span></span>
<span id="cb225-6"><a href="logistic.html#cb225-6"></a><span class="co">## glm(formula = Removed/Placed ~ Morph2 * Distance, family = quasibinomial, </span></span>
<span id="cb225-7"><a href="logistic.html#cb225-7"></a><span class="co">##     data = moth, weights = Placed)</span></span>
<span id="cb225-8"><a href="logistic.html#cb225-8"></a><span class="co">## </span></span>
<span id="cb225-9"><a href="logistic.html#cb225-9"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb225-10"><a href="logistic.html#cb225-10"></a><span class="co">##      Min        1Q    Median        3Q       Max  </span></span>
<span id="cb225-11"><a href="logistic.html#cb225-11"></a><span class="co">## -2.21183  -0.39883   0.01155   0.68292   1.31242  </span></span>
<span id="cb225-12"><a href="logistic.html#cb225-12"></a><span class="co">## </span></span>
<span id="cb225-13"><a href="logistic.html#cb225-13"></a><span class="co">## Coefficients:</span></span>
<span id="cb225-14"><a href="logistic.html#cb225-14"></a><span class="co">##                      Estimate Std. Error t value Pr(&gt;|t|)   </span></span>
<span id="cb225-15"><a href="logistic.html#cb225-15"></a><span class="co">## (Intercept)         -0.717729   0.214423  -3.347   0.0074 **</span></span>
<span id="cb225-16"><a href="logistic.html#cb225-16"></a><span class="co">## Morph2dark          -0.411257   0.309439  -1.329   0.2134   </span></span>
<span id="cb225-17"><a href="logistic.html#cb225-17"></a><span class="co">## Distance            -0.009287   0.006525  -1.423   0.1851   </span></span>
<span id="cb225-18"><a href="logistic.html#cb225-18"></a><span class="co">## Morph2dark:Distance  0.027789   0.009115   3.049   0.0123 * </span></span>
<span id="cb225-19"><a href="logistic.html#cb225-19"></a><span class="co">## ---</span></span>
<span id="cb225-20"><a href="logistic.html#cb225-20"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb225-21"><a href="logistic.html#cb225-21"></a><span class="co">## </span></span>
<span id="cb225-22"><a href="logistic.html#cb225-22"></a><span class="co">## (Dispersion parameter for quasibinomial family taken to be 1.270859)</span></span>
<span id="cb225-23"><a href="logistic.html#cb225-23"></a><span class="co">## </span></span>
<span id="cb225-24"><a href="logistic.html#cb225-24"></a><span class="co">##     Null deviance: 35.385  on 13  degrees of freedom</span></span>
<span id="cb225-25"><a href="logistic.html#cb225-25"></a><span class="co">## Residual deviance: 13.230  on 10  degrees of freedom</span></span>
<span id="cb225-26"><a href="logistic.html#cb225-26"></a><span class="co">## AIC: NA</span></span>
<span id="cb225-27"><a href="logistic.html#cb225-27"></a><span class="co">## </span></span>
<span id="cb225-28"><a href="logistic.html#cb225-28"></a><span class="co">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb225-29"><a href="logistic.html#cb225-29"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="fl">1.270859</span>)</span>
<span id="cb225-30"><a href="logistic.html#cb225-30"></a><span class="co">## [1] 1.127324</span></span></code></pre></div>
<p>Notice that the dispersion parameter is estimated as 1.27 by the <code>glm</code> function, using the ratio of the sum of squared Pearson residuals against degrees of freedom:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="logistic.html#cb226-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">resid</span>(moth.glm, <span class="dt">type=</span><span class="st">&quot;pearson&quot;</span>)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">10</span></span>
<span id="cb226-2"><a href="logistic.html#cb226-2"></a><span class="co">## [1] 1.270859</span></span></code></pre></div>
<p>Both dispersion estimates, either 1.32 or 1.27, are valid estimates and both indicate that the binomial model SEs are expanded by a factor of about 1.13-1.15. The quasi-binomial SE for the interaction term is reported to be about 0.009 which is what we computed by hand above.</p>
<p>We can compare the model with and without the interaction term with a quasi-binomial F test comparison:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="logistic.html#cb227-1"></a><span class="op">&gt;</span><span class="st"> </span>moth.quasi2 &lt;-<span class="st"> </span><span class="kw">glm</span>(Removed<span class="op">/</span>Placed <span class="op">~</span><span class="st"> </span>Morph2 <span class="op">+</span><span class="st"> </span>Distance, </span>
<span id="cb227-2"><a href="logistic.html#cb227-2"></a><span class="op">+</span><span class="st">                 </span><span class="dt">family=</span>quasibinomial, <span class="dt">weights=</span> Placed, <span class="dt">data=</span>moth)</span>
<span id="cb227-3"><a href="logistic.html#cb227-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(moth.quasi2)</span>
<span id="cb227-4"><a href="logistic.html#cb227-4"></a><span class="co">## </span></span>
<span id="cb227-5"><a href="logistic.html#cb227-5"></a><span class="co">## Call:</span></span>
<span id="cb227-6"><a href="logistic.html#cb227-6"></a><span class="co">## glm(formula = Removed/Placed ~ Morph2 + Distance, family = quasibinomial, </span></span>
<span id="cb227-7"><a href="logistic.html#cb227-7"></a><span class="co">##     data = moth, weights = Placed)</span></span>
<span id="cb227-8"><a href="logistic.html#cb227-8"></a><span class="co">## </span></span>
<span id="cb227-9"><a href="logistic.html#cb227-9"></a><span class="co">## Deviance Residuals: </span></span>
<span id="cb227-10"><a href="logistic.html#cb227-10"></a><span class="co">##      Min        1Q    Median        3Q       Max  </span></span>
<span id="cb227-11"><a href="logistic.html#cb227-11"></a><span class="co">## -2.28292  -1.16122   0.00237   1.03757   1.98945  </span></span>
<span id="cb227-12"><a href="logistic.html#cb227-12"></a><span class="co">## </span></span>
<span id="cb227-13"><a href="logistic.html#cb227-13"></a><span class="co">## Coefficients:</span></span>
<span id="cb227-14"><a href="logistic.html#cb227-14"></a><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb227-15"><a href="logistic.html#cb227-15"></a><span class="co">## (Intercept) -1.136742   0.235365  -4.830 0.000528 ***</span></span>
<span id="cb227-16"><a href="logistic.html#cb227-16"></a><span class="co">## Morph2dark   0.404052   0.209269   1.931 0.079680 .  </span></span>
<span id="cb227-17"><a href="logistic.html#cb227-17"></a><span class="co">## Distance     0.005314   0.006008   0.884 0.395404    </span></span>
<span id="cb227-18"><a href="logistic.html#cb227-18"></a><span class="co">## ---</span></span>
<span id="cb227-19"><a href="logistic.html#cb227-19"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb227-20"><a href="logistic.html#cb227-20"></a><span class="co">## </span></span>
<span id="cb227-21"><a href="logistic.html#cb227-21"></a><span class="co">## (Dispersion parameter for quasibinomial family taken to be 2.25436)</span></span>
<span id="cb227-22"><a href="logistic.html#cb227-22"></a><span class="co">## </span></span>
<span id="cb227-23"><a href="logistic.html#cb227-23"></a><span class="co">##     Null deviance: 35.385  on 13  degrees of freedom</span></span>
<span id="cb227-24"><a href="logistic.html#cb227-24"></a><span class="co">## Residual deviance: 25.161  on 11  degrees of freedom</span></span>
<span id="cb227-25"><a href="logistic.html#cb227-25"></a><span class="co">## AIC: NA</span></span>
<span id="cb227-26"><a href="logistic.html#cb227-26"></a><span class="co">## </span></span>
<span id="cb227-27"><a href="logistic.html#cb227-27"></a><span class="co">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb227-28"><a href="logistic.html#cb227-28"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">anova</span>(moth.quasi2, moth.quasi, <span class="dt">test=</span><span class="st">&quot;F&quot;</span>)</span>
<span id="cb227-29"><a href="logistic.html#cb227-29"></a><span class="co">## Analysis of Deviance Table</span></span>
<span id="cb227-30"><a href="logistic.html#cb227-30"></a><span class="co">## </span></span>
<span id="cb227-31"><a href="logistic.html#cb227-31"></a><span class="co">## Model 1: Removed/Placed ~ Morph2 + Distance</span></span>
<span id="cb227-32"><a href="logistic.html#cb227-32"></a><span class="co">## Model 2: Removed/Placed ~ Morph2 * Distance</span></span>
<span id="cb227-33"><a href="logistic.html#cb227-33"></a><span class="co">##   Resid. Df Resid. Dev Df Deviance      F  Pr(&gt;F)  </span></span>
<span id="cb227-34"><a href="logistic.html#cb227-34"></a><span class="co">## 1        11     25.161                             </span></span>
<span id="cb227-35"><a href="logistic.html#cb227-35"></a><span class="co">## 2        10     13.230  1   11.931 9.3885 0.01196 *</span></span>
<span id="cb227-36"><a href="logistic.html#cb227-36"></a><span class="co">## ---</span></span>
<span id="cb227-37"><a href="logistic.html#cb227-37"></a><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span></code></pre></div>
<p>The F test stat is computed as the drop in deviance between the two models, divided by the number of terms tested and the dispersion parameter:
<span class="math display">\[
F = \dfrac{(25.161 - 13.230)/1}{1.323} = \dfrac{11.931/1}{1.323} \approx 9.0181406
\]</span>
This test stat yields a p-value of 0.013 which, along with the Wald z-test, supports the conclusion that the interaction term is statistically significant.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="logistic.html#cb228-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="kw">pf</span>(<span class="fl">9.02</span>, <span class="dv">1</span>, <span class="dv">10</span>)  <span class="co">#1=numerator df, 10=denominator df</span></span>
<span id="cb228-2"><a href="logistic.html#cb228-2"></a><span class="co">## [1] 0.01326791</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mlr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="poisson.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
