<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Multiple Regression | Math 245 Notes</title>
  <meta name="description" content="Course notes and examples for Applied Regression Analysis" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Multiple Regression | Math 245 Notes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Course notes and examples for Applied Regression Analysis" />
  <meta name="github-repo" content="kstclair/Math245notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Multiple Regression | Math 245 Notes" />
  
  <meta name="twitter:description" content="Course notes and examples for Applied Regression Analysis" />
  

<meta name="author" content="Katie St. Clair, Carleton College" />


<meta name="date" content="2019-10-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="slr.html"/>
<link rel="next" href="logistic.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.46.1/plotly-latest.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Math 245 Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Getting Started</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#getting-help"><i class="fa fa-check"></i>Getting help</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="review.html"><a href="review.html"><i class="fa fa-check"></i><b>1</b> Review of Statistical Inference</a><ul>
<li class="chapter" data-level="1.1" data-path="review.html"><a href="review.html#sampling-distribution"><i class="fa fa-check"></i><b>1.1</b> Sampling Distribution</a></li>
<li class="chapter" data-level="1.2" data-path="review.html"><a href="review.html#central-limit-theorem"><i class="fa fa-check"></i><b>1.2</b> Central Limit Theorem</a><ul>
<li class="chapter" data-level="1.2.1" data-path="review.html"><a href="review.html#standard-error"><i class="fa fa-check"></i><b>1.2.1</b> Standard error</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="review.html"><a href="review.html#hypothesis-testing"><i class="fa fa-check"></i><b>1.3</b> Hypothesis testing</a></li>
<li class="chapter" data-level="1.4" data-path="review.html"><a href="review.html#confidence-intervals"><i class="fa fa-check"></i><b>1.4</b> Confidence Intervals</a></li>
<li class="chapter" data-level="1.5" data-path="review.html"><a href="review.html#review_activity"><i class="fa fa-check"></i><b>1.5</b> Review activity (day 2)</a><ul>
<li class="chapter" data-level="1.5.1" data-path="review.html"><a href="review.html#general-questions"><i class="fa fa-check"></i><b>1.5.1</b> General questions</a></li>
<li class="chapter" data-level="1.5.2" data-path="review.html"><a href="review.html#comparing-two-means"><i class="fa fa-check"></i><b>1.5.2</b> Comparing two means</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="slr.html"><a href="slr.html"><i class="fa fa-check"></i><b>2</b> Simple Linear Regression</a><ul>
<li class="chapter" data-level="2.1" data-path="slr.html"><a href="slr.html#the-variables"><i class="fa fa-check"></i><b>2.1</b> The variables</a></li>
<li class="chapter" data-level="2.2" data-path="slr.html"><a href="slr.html#slr-model"><i class="fa fa-check"></i><b>2.2</b> The model form</a><ul>
<li class="chapter" data-level="2.2.1" data-path="slr.html"><a href="slr.html#interpretation"><i class="fa fa-check"></i><b>2.2.1</b> Interpretation</a></li>
<li class="chapter" data-level="2.2.2" data-path="slr.html"><a href="slr.html#slr-model-ex"><i class="fa fa-check"></i><b>2.2.2</b> Example: Woodpecker nests</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="slr.html"><a href="slr.html#slr-est"><i class="fa fa-check"></i><b>2.3</b> Theory: Estimation</a><ul>
<li class="chapter" data-level="2.3.1" data-path="slr.html"><a href="slr.html#sampling-distributions-for-slr-estimates"><i class="fa fa-check"></i><b>2.3.1</b> Sampling Distributions for SLR estimates</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="slr.html"><a href="slr.html#slr-sim"><i class="fa fa-check"></i><b>2.4</b> SLR model simulation</a><ul>
<li class="chapter" data-level="2.4.1" data-path="slr.html"><a href="slr.html#simulation-function"><i class="fa fa-check"></i><b>2.4.1</b> Simulation function</a></li>
<li class="chapter" data-level="2.4.2" data-path="slr.html"><a href="slr.html#run-the-function-once"><i class="fa fa-check"></i><b>2.4.2</b> Run the function once</a></li>
<li class="chapter" data-level="2.4.3" data-path="slr.html"><a href="slr.html#simulated-sampling-distribution-for-hatbeta_1"><i class="fa fa-check"></i><b>2.4.3</b> Simulated sampling distribution for <span class="math inline">\(\hat{\beta}_1\)</span></a></li>
<li class="chapter" data-level="2.4.4" data-path="slr.html"><a href="slr.html#slr-simcor"><i class="fa fa-check"></i><b>2.4.4</b> Are slope and intercept estimates correlated?</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="slr.html"><a href="slr.html#slr-inf"><i class="fa fa-check"></i><b>2.5</b> Inference for mean parameters</a><ul>
<li class="chapter" data-level="2.5.1" data-path="slr.html"><a href="slr.html#confidence-intervals-1"><i class="fa fa-check"></i><b>2.5.1</b> Confidence Intervals</a></li>
<li class="chapter" data-level="2.5.2" data-path="slr.html"><a href="slr.html#hypothesis-tests"><i class="fa fa-check"></i><b>2.5.2</b> Hypothesis tests</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="slr.html"><a href="slr.html#slr-inf2"><i class="fa fa-check"></i><b>2.6</b> Inference for average or predicted response</a><ul>
<li class="chapter" data-level="2.6.1" data-path="slr.html"><a href="slr.html#confidence-intervals-for-mu_y-mid-x"><i class="fa fa-check"></i><b>2.6.1</b> Confidence intervals for <span class="math inline">\(\mu_{y \mid x}\)</span></a></li>
<li class="chapter" data-level="2.6.2" data-path="slr.html"><a href="slr.html#prediction-intervals-for-new-cases"><i class="fa fa-check"></i><b>2.6.2</b> Prediction intervals for new cases</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="slr.html"><a href="slr.html#slr-example1"><i class="fa fa-check"></i><b>2.7</b> Example: SLR model (day 3)</a><ul>
<li class="chapter" data-level="2.7.1" data-path="slr.html"><a href="slr.html#load-data"><i class="fa fa-check"></i><b>2.7.1</b> Load data</a></li>
<li class="chapter" data-level="2.7.2" data-path="slr.html"><a href="slr.html#eda-1"><i class="fa fa-check"></i><b>2.7.2</b> EDA</a></li>
<li class="chapter" data-level="2.7.3" data-path="slr.html"><a href="slr.html#the-least-squares-line-the-estimated-slr-model"><i class="fa fa-check"></i><b>2.7.3</b> The least squares line (the estimated SLR model):</a></li>
<li class="chapter" data-level="2.7.4" data-path="slr.html"><a href="slr.html#inference-for-coefficients"><i class="fa fa-check"></i><b>2.7.4</b> Inference for coefficients</a></li>
<li class="chapter" data-level="2.7.5" data-path="slr.html"><a href="slr.html#additional-lm-information"><i class="fa fa-check"></i><b>2.7.5</b> Additional <code>lm</code> information</a></li>
<li class="chapter" data-level="2.7.6" data-path="slr.html"><a href="slr.html#slr-broom"><i class="fa fa-check"></i><b>2.7.6</b> <code>broom</code> package: Tidy <code>lm</code> output</a></li>
<li class="chapter" data-level="2.7.7" data-path="slr.html"><a href="slr.html#inference-for-the-mean-and-predicted-response"><i class="fa fa-check"></i><b>2.7.7</b> Inference for the mean and predicted response</a></li>
<li class="chapter" data-level="2.7.8" data-path="slr.html"><a href="slr.html#adding-confidence-bands-to-a-scatterplot"><i class="fa fa-check"></i><b>2.7.8</b> Adding confidence bands to a scatterplot</a></li>
<li class="chapter" data-level="2.7.9" data-path="slr.html"><a href="slr.html#tools-for-displaying-your-model"><i class="fa fa-check"></i><b>2.7.9</b> Tools for displaying your model</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="slr.html"><a href="slr.html#slr-assump"><i class="fa fa-check"></i><b>2.8</b> Checking model assumptions and fit</a><ul>
<li class="chapter" data-level="2.8.1" data-path="slr.html"><a href="slr.html#residuals"><i class="fa fa-check"></i><b>2.8.1</b> Residuals</a></li>
<li class="chapter" data-level="2.8.2" data-path="slr.html"><a href="slr.html#residual-plot-linearity-and-constant-variance"><i class="fa fa-check"></i><b>2.8.2</b> Residual plot: linearity and constant variance</a></li>
<li class="chapter" data-level="2.8.3" data-path="slr.html"><a href="slr.html#slr-normality"><i class="fa fa-check"></i><b>2.8.3</b> Residual normal QQ plot</a></li>
<li class="chapter" data-level="2.8.4" data-path="slr.html"><a href="slr.html#slr-indep"><i class="fa fa-check"></i><b>2.8.4</b> Independence</a></li>
<li class="chapter" data-level="2.8.5" data-path="slr.html"><a href="slr.html#slr-robust"><i class="fa fa-check"></i><b>2.8.5</b> Robustness against violations</a></li>
<li class="chapter" data-level="2.8.6" data-path="slr.html"><a href="slr.html#fixes-to-violations"><i class="fa fa-check"></i><b>2.8.6</b> “Fixes” to violations</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="slr.html"><a href="slr.html#slr-example2"><i class="fa fa-check"></i><b>2.9</b> Example: SLR assumptions (day 4/5)</a><ul>
<li class="chapter" data-level="2.9.1" data-path="slr.html"><a href="slr.html#drug-offender-sentences"><i class="fa fa-check"></i><b>2.9.1</b> Drug offender sentences</a></li>
<li class="chapter" data-level="2.9.2" data-path="slr.html"><a href="slr.html#case-study-15.2---global-warming"><i class="fa fa-check"></i><b>2.9.2</b> Case study 15.2 - Global Warming</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="slr.html"><a href="slr.html#slr-trans"><i class="fa fa-check"></i><b>2.10</b> Transformations</a><ul>
<li class="chapter" data-level="2.10.1" data-path="slr.html"><a href="slr.html#transformation-choices"><i class="fa fa-check"></i><b>2.10.1</b> Transformation choices</a></li>
<li class="chapter" data-level="2.10.2" data-path="slr.html"><a href="slr.html#transformations-in-r"><i class="fa fa-check"></i><b>2.10.2</b> Transformations in R</a></li>
<li class="chapter" data-level="2.10.3" data-path="slr.html"><a href="slr.html#interpretation-1"><i class="fa fa-check"></i><b>2.10.3</b> Interpretation</a></li>
<li class="chapter" data-level="2.10.4" data-path="slr.html"><a href="slr.html#slr-logs"><i class="fa fa-check"></i><b>2.10.4</b> Review: Logarithms</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="slr.html"><a href="slr.html#examples-transformations-day-6"><i class="fa fa-check"></i><b>2.11</b> Examples: Transformations (day 6)</a><ul>
<li class="chapter" data-level="2.11.1" data-path="slr.html"><a href="slr.html#cars-2004"><i class="fa fa-check"></i><b>2.11.1</b> Cars 2004</a></li>
<li class="chapter" data-level="2.11.2" data-path="slr.html"><a href="slr.html#residential-energy-survey-recs"><i class="fa fa-check"></i><b>2.11.2</b> 2005 Residential Energy Survey (RECS)</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="slr.html"><a href="slr.html#r2-and-anova-for-slr"><i class="fa fa-check"></i><b>2.12</b> <span class="math inline">\(R^2\)</span> and ANOVA for SLR</a><ul>
<li class="chapter" data-level="2.12.1" data-path="slr.html"><a href="slr.html#example-r2"><i class="fa fa-check"></i><b>2.12.1</b> Example: <span class="math inline">\(R^2\)</span></a></li>
<li class="chapter" data-level="2.12.2" data-path="slr.html"><a href="slr.html#slr-anova"><i class="fa fa-check"></i><b>2.12.2</b> ANOVA for SLR</a></li>
<li class="chapter" data-level="2.12.3" data-path="slr.html"><a href="slr.html#example-anova"><i class="fa fa-check"></i><b>2.12.3</b> Example: ANOVA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mlr.html"><a href="mlr.html"><i class="fa fa-check"></i><b>3</b> Multiple Regression</a><ul>
<li class="chapter" data-level="3.1" data-path="mlr.html"><a href="mlr.html#the-variables-1"><i class="fa fa-check"></i><b>3.1</b> The variables</a></li>
<li class="chapter" data-level="3.2" data-path="mlr.html"><a href="mlr.html#mlr-model"><i class="fa fa-check"></i><b>3.2</b> The model form</a><ul>
<li class="chapter" data-level="3.2.1" data-path="mlr.html"><a href="mlr.html#mlr-interpretation"><i class="fa fa-check"></i><b>3.2.1</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="mlr.html"><a href="mlr.html#mlr-example1"><i class="fa fa-check"></i><b>3.3</b> Example: MLR fit and visuals</a><ul>
<li class="chapter" data-level="3.3.1" data-path="mlr.html"><a href="mlr.html#lm-fit"><i class="fa fa-check"></i><b>3.3.1</b> <code>lm</code> fit</a></li>
<li class="chapter" data-level="3.3.2" data-path="mlr.html"><a href="mlr.html#graphics-for-mlr"><i class="fa fa-check"></i><b>3.3.2</b> Graphics for MLR</a></li>
<li class="chapter" data-level="3.3.3" data-path="mlr.html"><a href="mlr.html#mlr-resid1"><i class="fa fa-check"></i><b>3.3.3</b> Residual plots for MLR</a></li>
<li class="chapter" data-level="3.3.4" data-path="mlr.html"><a href="mlr.html#eda-for-interactions"><i class="fa fa-check"></i><b>3.3.4</b> EDA for interactions</a></li>
<li class="chapter" data-level="3.3.5" data-path="mlr.html"><a href="mlr.html#quadratic-models-corn-yields-exercise-9.15"><i class="fa fa-check"></i><b>3.3.5</b> Quadratic models: Corn yields (exercise 9.15)</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="mlr.html"><a href="mlr.html#mlr-cat"><i class="fa fa-check"></i><b>3.4</b> Categorical Predictors</a><ul>
<li class="chapter" data-level="3.4.1" data-path="mlr.html"><a href="mlr.html#interpretation-adding-a-categorical"><i class="fa fa-check"></i><b>3.4.1</b> Interpretation: adding a categorical</a></li>
<li class="chapter" data-level="3.4.2" data-path="mlr.html"><a href="mlr.html#interpretation-adding-a-categorical-interaction"><i class="fa fa-check"></i><b>3.4.2</b> Interpretation: adding a categorical interaction</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="mlr.html"><a href="mlr.html#mlr-inf"><i class="fa fa-check"></i><b>3.5</b> Inference for MLR</a><ul>
<li class="chapter" data-level="3.5.1" data-path="mlr.html"><a href="mlr.html#mlr-inf2"><i class="fa fa-check"></i><b>3.5.1</b> Inference for a linear combination of <span class="math inline">\(\beta\)</span>’s</a></li>
<li class="chapter" data-level="3.5.2" data-path="mlr.html"><a href="mlr.html#mlr-agstrat2"><i class="fa fa-check"></i><b>3.5.2</b> Example: Agstrat</a></li>
<li class="chapter" data-level="3.5.3" data-path="mlr.html"><a href="mlr.html#mlr-sleep2"><i class="fa fa-check"></i><b>3.5.3</b> Example: Sleep</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="mlr.html"><a href="mlr.html#mlr-anova"><i class="fa fa-check"></i><b>3.6</b> ANOVA for MLR</a><ul>
<li class="chapter" data-level="3.6.1" data-path="mlr.html"><a href="mlr.html#mean-squares"><i class="fa fa-check"></i><b>3.6.1</b> Mean Squares</a></li>
<li class="chapter" data-level="3.6.2" data-path="mlr.html"><a href="mlr.html#r2-and-adjusted-r2"><i class="fa fa-check"></i><b>3.6.2</b> <span class="math inline">\(R^2\)</span> and adjusted <span class="math inline">\(R^2\)</span></a></li>
<li class="chapter" data-level="3.6.3" data-path="mlr.html"><a href="mlr.html#anova-f-tests"><i class="fa fa-check"></i><b>3.6.3</b> ANOVA F-tests</a></li>
<li class="chapter" data-level="3.6.4" data-path="mlr.html"><a href="mlr.html#mlr-sleep3"><i class="fa fa-check"></i><b>3.6.4</b> Example: Sleep</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="mlr.html"><a href="mlr.html#model-checking"><i class="fa fa-check"></i><b>3.7</b> Model Checking</a><ul>
<li class="chapter" data-level="3.7.1" data-path="mlr.html"><a href="mlr.html#residual-plots"><i class="fa fa-check"></i><b>3.7.1</b> Residual plots</a></li>
<li class="chapter" data-level="3.7.2" data-path="mlr.html"><a href="mlr.html#outliers"><i class="fa fa-check"></i><b>3.7.2</b> Outliers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="logistic.html"><a href="logistic.html"><i class="fa fa-check"></i><b>4</b> Logistic Regression</a></li>
<li class="chapter" data-level="5" data-path="poisson.html"><a href="poisson.html"><i class="fa fa-check"></i><b>5</b> Poisson Regression</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="rrstudio.html"><a href="rrstudio.html"><i class="fa fa-check"></i><b>A</b> R and Rstudio</a><ul>
<li class="chapter" data-level="A.1" data-path="rrstudio.html"><a href="rrstudio.html#running-rstudio"><i class="fa fa-check"></i><b>A.1</b> Running Rstudio</a></li>
<li class="chapter" data-level="A.2" data-path="rrstudio.html"><a href="rrstudio.html#r"><i class="fa fa-check"></i><b>A.2</b> Installing R</a></li>
<li class="chapter" data-level="A.3" data-path="rrstudio.html"><a href="rrstudio.html#rstudio"><i class="fa fa-check"></i><b>A.3</b> Installing Rstudio</a></li>
<li class="chapter" data-level="A.4" data-path="rrstudio.html"><a href="rrstudio.html#packages"><i class="fa fa-check"></i><b>A.4</b> Installing R packages</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="renviron.html"><a href="renviron.html"><i class="fa fa-check"></i><b>B</b> The R enviroment</a><ul>
<li class="chapter" data-level="B.1" data-path="renviron.html"><a href="renviron.html#workspace"><i class="fa fa-check"></i><b>B.1</b> Workspace</a></li>
<li class="chapter" data-level="B.2" data-path="renviron.html"><a href="renviron.html#working-directory"><i class="fa fa-check"></i><b>B.2</b> Working directory</a></li>
<li class="chapter" data-level="B.3" data-path="renviron.html"><a href="renviron.html#project"><i class="fa fa-check"></i><b>B.3</b> Rstudio projects</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="rreview.html"><a href="rreview.html"><i class="fa fa-check"></i><b>C</b> R for basic data analysis</a><ul>
<li class="chapter" data-level="C.1" data-path="rreview.html"><a href="rreview.html#basics"><i class="fa fa-check"></i><b>C.1</b> Basics</a><ul>
<li class="chapter" data-level="C.1.1" data-path="rreview.html"><a href="rreview.html#quick-tips"><i class="fa fa-check"></i><b>C.1.1</b> Quick Tips</a></li>
<li class="chapter" data-level="C.1.2" data-path="rreview.html"><a href="rreview.html#objects"><i class="fa fa-check"></i><b>C.1.2</b> Objects</a></li>
<li class="chapter" data-level="C.1.3" data-path="rreview.html"><a href="rreview.html#vectors"><i class="fa fa-check"></i><b>C.1.3</b> Vectors</a></li>
<li class="chapter" data-level="C.1.4" data-path="rreview.html"><a href="rreview.html#arithmetic"><i class="fa fa-check"></i><b>C.1.4</b> Arithmetic</a></li>
<li class="chapter" data-level="C.1.5" data-path="rreview.html"><a href="rreview.html#subsetting"><i class="fa fa-check"></i><b>C.1.5</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="review.html"><a href="review.html#data"><i class="fa fa-check"></i><b>C.2</b> Data</a><ul>
<li class="chapter" data-level="C.2.1" data-path="rreview.html"><a href="rreview.html#reading-data-into-r"><i class="fa fa-check"></i><b>C.2.1</b> Reading Data into R</a></li>
<li class="chapter" data-level="C.2.2" data-path="rreview.html"><a href="rreview.html#investigating-a-data-frame"><i class="fa fa-check"></i><b>C.2.2</b> Investigating a Data Frame</a></li>
<li class="chapter" data-level="C.2.3" data-path="rreview.html"><a href="rreview.html#access"><i class="fa fa-check"></i><b>C.2.3</b> Accessing Data</a></li>
<li class="chapter" data-level="C.2.4" data-path="rreview.html"><a href="rreview.html#Rreview-subset"><i class="fa fa-check"></i><b>C.2.4</b> Subsetting a Data Frame</a></li>
<li class="chapter" data-level="C.2.5" data-path="rreview.html"><a href="rreview.html#creating-a-data-frame"><i class="fa fa-check"></i><b>C.2.5</b> Creating a data frame</a></li>
<li class="chapter" data-level="C.2.6" data-path="rreview.html"><a href="rreview.html#adding-a-new-column-to-a-data-frame"><i class="fa fa-check"></i><b>C.2.6</b> Adding a new column to a data frame</a></li>
<li class="chapter" data-level="C.2.7" data-path="rreview.html"><a href="rreview.html#missing-data"><i class="fa fa-check"></i><b>C.2.7</b> Missing Data</a></li>
</ul></li>
<li class="chapter" data-level="C.3" data-path="review.html"><a href="review.html#eda"><i class="fa fa-check"></i><b>C.3</b> EDA</a><ul>
<li class="chapter" data-level="C.3.1" data-path="rreview.html"><a href="rreview.html#categorical"><i class="fa fa-check"></i><b>C.3.1</b> Categorical:</a></li>
<li class="chapter" data-level="C.3.2" data-path="rreview.html"><a href="rreview.html#quantitative"><i class="fa fa-check"></i><b>C.3.2</b> Quantitative:</a></li>
<li class="chapter" data-level="C.3.3" data-path="rreview.html"><a href="rreview.html#Rreview-stats"><i class="fa fa-check"></i><b>C.3.3</b> Quantitative grouped by a categorical</a></li>
<li class="chapter" data-level="C.3.4" data-path="rreview.html"><a href="rreview.html#Rreview-graphs"><i class="fa fa-check"></i><b>C.3.4</b> Graphs</a></li>
<li class="chapter" data-level="C.3.5" data-path="rreview.html"><a href="rreview.html#reporting-results"><i class="fa fa-check"></i><b>C.3.5</b> Reporting Results</a></li>
</ul></li>
<li class="chapter" data-level="C.4" data-path="rreview.html"><a href="rreview.html#factors"><i class="fa fa-check"></i><b>C.4</b> Factor variables</a><ul>
<li class="chapter" data-level="C.4.1" data-path="rreview.html"><a href="rreview.html#renaming-factor-levels"><i class="fa fa-check"></i><b>C.4.1</b> Renaming factor levels</a></li>
<li class="chapter" data-level="C.4.2" data-path="rreview.html"><a href="rreview.html#recode-a-categorical-variable-with-many-levels"><i class="fa fa-check"></i><b>C.4.2</b> Recode a categorical variable with many levels</a></li>
<li class="chapter" data-level="C.4.3" data-path="rreview.html"><a href="rreview.html#converting-some-factor-levels-to-nas"><i class="fa fa-check"></i><b>C.4.3</b> Converting some factor levels to <code>NA</code>s</a></li>
<li class="chapter" data-level="C.4.4" data-path="rreview.html"><a href="rreview.html#changing-the-order-of-levels"><i class="fa fa-check"></i><b>C.4.4</b> Changing the order of levels</a></li>
<li class="chapter" data-level="C.4.5" data-path="rreview.html"><a href="rreview.html#recode-a-numerically-coded-categorical-variable"><i class="fa fa-check"></i><b>C.4.5</b> Recode a numerically coded categorical variable</a></li>
<li class="chapter" data-level="C.4.6" data-path="rreview.html"><a href="rreview.html#recode-a-factor-into-a-numeric"><i class="fa fa-check"></i><b>C.4.6</b> Recode a factor into a numeric</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="D" data-path="markdown.html"><a href="markdown.html"><i class="fa fa-check"></i><b>D</b> R Markdown</a><ul>
<li class="chapter" data-level="D.1" data-path="markdown.html"><a href="markdown.html#how-to-write-an-r-markdown-document"><i class="fa fa-check"></i><b>D.1</b> How to write an R Markdown document</a></li>
<li class="chapter" data-level="D.2" data-path="markdown.html"><a href="markdown.html#changing-r-markdown-chunk-evaluation-behavior"><i class="fa fa-check"></i><b>D.2</b> Changing R Markdown chunk evaluation behavior</a></li>
<li class="chapter" data-level="D.3" data-path="markdown.html"><a href="markdown.html#creating-a-new-r-markdown-document"><i class="fa fa-check"></i><b>D.3</b> Creating a new R Markdown document</a></li>
<li class="chapter" data-level="D.4" data-path="markdown.html"><a href="markdown.html#markdown-graphs"><i class="fa fa-check"></i><b>D.4</b> Extra: Graph formatting</a><ul>
<li class="chapter" data-level="D.4.1" data-path="markdown.html"><a href="markdown.html#adding-figure-numbers-and-captions"><i class="fa fa-check"></i><b>D.4.1</b> Adding figure numbers and captions</a></li>
<li class="chapter" data-level="D.4.2" data-path="markdown.html"><a href="markdown.html#resizing-graphs-in-markdown"><i class="fa fa-check"></i><b>D.4.2</b> Resizing graphs in Markdown</a></li>
<li class="chapter" data-level="D.4.3" data-path="markdown.html"><a href="markdown.html#changing-graph-formatting-in-r"><i class="fa fa-check"></i><b>D.4.3</b> Changing graph formatting in R</a></li>
<li class="chapter" data-level="D.4.4" data-path="markdown.html"><a href="markdown.html#hiding-r-commands"><i class="fa fa-check"></i><b>D.4.4</b> Hiding R commands</a></li>
<li class="chapter" data-level="D.4.5" data-path="markdown.html"><a href="markdown.html#global-changes-in-graph-format"><i class="fa fa-check"></i><b>D.4.5</b> Global changes in graph format</a></li>
<li class="chapter" data-level="D.4.6" data-path="markdown.html"><a href="markdown.html#comments"><i class="fa fa-check"></i><b>D.4.6</b> Comments:</a></li>
</ul></li>
<li class="chapter" data-level="D.5" data-path="markdown.html"><a href="markdown.html#markdown-tables"><i class="fa fa-check"></i><b>D.5</b> Extra: Table formatting</a><ul>
<li class="chapter" data-level="D.5.1" data-path="markdown.html"><a href="markdown.html#hiding-r-commands-and-r-output"><i class="fa fa-check"></i><b>D.5.1</b> Hiding R commands and R output</a></li>
<li class="chapter" data-level="D.5.2" data-path="markdown.html"><a href="markdown.html#markdown-tables-1"><i class="fa fa-check"></i><b>D.5.2</b> Markdown tables</a></li>
<li class="chapter" data-level="D.5.3" data-path="markdown.html"><a href="markdown.html#markdown-tables-via-kable"><i class="fa fa-check"></i><b>D.5.3</b> Markdown tables via <code>kable</code></a></li>
<li class="chapter" data-level="D.5.4" data-path="markdown.html"><a href="markdown.html#the-pander-package"><i class="fa fa-check"></i><b>D.5.4</b> The <code>pander</code> package</a></li>
<li class="chapter" data-level="D.5.5" data-path="markdown.html"><a href="markdown.html#the-stargazer-package"><i class="fa fa-check"></i><b>D.5.5</b> The <code>stargazer</code> package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="E" data-path="mathreview.html"><a href="mathreview.html"><i class="fa fa-check"></i><b>E</b> Math review</a><ul>
<li class="chapter" data-level="E.1" data-path="mathreview.html"><a href="mathreview.html#math-linear"><i class="fa fa-check"></i><b>E.1</b> Linear equations</a></li>
<li class="chapter" data-level="E.2" data-path="mathreview.html"><a href="mathreview.html#math-log"><i class="fa fa-check"></i><b>E.2</b> Logarithms</a><ul>
<li class="chapter" data-level="E.2.1" data-path="mathreview.html"><a href="mathreview.html#interpreting-logged-variables-1"><i class="fa fa-check"></i><b>E.2.1</b> Interpreting logged variables</a></li>
<li class="chapter" data-level="E.2.2" data-path="mathreview.html"><a href="mathreview.html#inverse-i.e.-reversing-the-log-getting-rid-of-the-log-1"><i class="fa fa-check"></i><b>E.2.2</b> Inverse (i.e. reversing the log, getting rid of the log, …)</a></li>
<li class="chapter" data-level="E.2.3" data-path="mathreview.html"><a href="mathreview.html#logarithms-in-r"><i class="fa fa-check"></i><b>E.2.3</b> Logarithms in R</a></li>
</ul></li>
<li class="chapter" data-level="E.3" data-path="mathreview.html"><a href="mathreview.html#math-exercises"><i class="fa fa-check"></i><b>E.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Math 245 Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mlr" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Multiple Regression</h1>
<p>This chapter covers material from chapters 9-12 of Sleuth.</p>
<div id="the-variables-1" class="section level2">
<h2><span class="header-section-number">3.1</span> The variables</h2>
<p>Suppose we have a quantitative response variable <span class="math inline">\(y\)</span> that we want to relate to <span class="math inline">\(p\)</span> explantory variable (aka predictors, covariates) <span class="math inline">\(x_1, \dotsc, x_p\)</span>. There is no restriction on the type of covariates, they can be both quantitative and categorical variables.</p>
</div>
<div id="mlr-model" class="section level2">
<h2><span class="header-section-number">3.2</span> The model form</h2>
<p>This section describes the <strong>multiple linear regression</strong> (MLR) model for a particular <strong>population</strong> of interest. Another way to frame the model is that it describes a hypothetical <strong>data generating process (DGP)</strong> that was used to generate the sample of data that we have on hand.</p>
<p>The major change in the MLR model compared to the SLR model is that now the <strong>mean</strong> function <span class="math inline">\(\mu_{y\mid x_1, \dotsc, x_p}\)</span> is a function of all covariates. The expression for <span class="math inline">\(\mu\)</span> must be linear with respect to the <span class="math inline">\(\beta\)</span> parameters even if we used a function of a predictor like <span class="math inline">\(\log(x)\)</span>. The expression for <span class="math inline">\(\mu\)</span> is can even involve polynomial functions of <span class="math inline">\(x\)</span> like <span class="math inline">\(x^2\)</span> or interactions of predictors like <span class="math inline">\(x_1 \times x_p\)</span>. In this section, we will describe the basic MLR with the simplest form it can take:
<span class="math display">\[
\mu_{y\mid  x_1, \dotsc, x_p} = \beta_0 + \beta_1 x_{1,i} + \beta_2 x_{2,i} + \dotsm \beta_p x_{p,i}
\]</span>
More complicated forms will be described later in this chapter.</p>
<p>Let <span class="math inline">\(Y_i\)</span> be the response from unit <span class="math inline">\(i\)</span> that has explanatory (aka predictor) values <span class="math inline">\(x_{1,i}, x_{2,i}, \dotsc, x_{p,i}\)</span>. There are two <strong>equivalent</strong> ways to express the SLR model for <span class="math inline">\(Y\)</span>:</p>
<ul>
<li><p>Conditional normal model:
<span class="math display">\[
Y_i \mid x_{1,i}, x_{2,i}, \dotsc, x_{p,i}\sim N(\mu_{y\mid x} = \beta_0 + \beta_1 x_{1,i} + \beta_2 x_{2,i} + \dotsm \beta_p x_{p,i}, \sigma)
\]</span></p></li>
<li><p>Mean + error:
<span class="math display">\[\begin{equation}
Y_i = \beta_0 + \beta_1 x_{1,i} + \beta_2 x_{2,i} + \dotsm \beta_p x_{p,i} + \epsilon_i \ \ \ \ \ \epsilon_i \sim N(0, \sigma)
\end{equation}\]</span></p></li>
</ul>
<p><strong>Both</strong> expressions of the MLR model above say the same thing:</p>
<ul>
<li><strong>Linear Mean:</strong> <span class="math inline">\(\mu_{y\mid x}\)</span> describes the population mean value of <span class="math inline">\(Y\)</span> given all predictor values and it is linear with respect to the <span class="math inline">\(\beta\)</span> parametrs. (We still have a “linear” model even if we used <span class="math inline">\(\log(x)\)</span> or <span class="math inline">\(x^2\)</span>!)</li>
<li><strong>Constant SD:</strong> <span class="math inline">\(SD(Y\mid x)=\sigma\)</span> describes the SD of <span class="math inline">\(Y\)</span>’s in the population around a given mean value <span class="math inline">\(\mu_{y\mid x}\)</span>. The fact that this SD <strong>does not</strong> depend on the value of <span class="math inline">\(x\)</span> is called the contant variance, or homoscedastic, assumption.</li>
<li><strong>Normality:</strong> The shape of population response values around <span class="math inline">\(\mu_{y\mid x}\)</span> is described by a normal distribution model.<br />
</li>
<li><strong>Indepedence:</strong> Given a predictor value of <span class="math inline">\(x\)</span>, all responses <span class="math inline">\(Y\)</span> occur independently of each other.</li>
</ul>
<p>There are a total of <strong><span class="math inline">\(\pmb{p+1}\)</span> parameters</strong> in this MLR model:</p>
<ul>
<li>the <span class="math inline">\(p\)</span> mean parameters <span class="math inline">\(\beta_0, \beta_1, \dotsc, \beta_p\)</span></li>
<li>the SD parameter <span class="math inline">\(\sigma\)</span></li>
</ul>
<div id="mlr-interpretation" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Interpretation</h3>
<p>How a predictor influences the mean response is determined by the form of the <span class="math inline">\(\mu\)</span> function. Some common forms are discussed here.</p>
<div id="planar-model" class="section level4">
<h4><span class="header-section-number">3.2.1.1</span> Planar model</h4>
<p>The mean model described above models the relationship between <span class="math inline">\(y\)</span> and all corvariates as a <span class="math inline">\((p+1)-\)</span>dimensional plane:
<span class="math display">\[
\mu_{y\mid  x_1, \dotsc, x_p} = \beta_0 + \beta_1 x_{1} + \beta_2 x_{2} + \dotsm \beta_p x_{p}
\]</span>
When <span class="math inline">\(p=1\)</span>, we have a SLR and this “plane” simplifies to a 2-d line. When <span class="math inline">\(p=2\)</span>, the mean “surface” is a 3-D plane. The plot below displays an example of a sample of point triples <span class="math inline">\((x_{1,i}, x_{2,i}, y_i)\)</span> that form a point “cloud” that is floating in the x-y-z coordinate system. The mean function is a plane that floats through the “middle” of the point cloud, hitting the mean value of <span class="math inline">\(y\)</span> for each combination of <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>. Notice that when we “fix” one of the predictor values, the trend between <span class="math inline">\(y\)</span> and the other predictor is linear. E.g. Pick any place on the mean surface, then any place you “trace” along the surface will result in a line.</p>
<div id="htmlwidget-781c96c21810d1ab81fe" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-781c96c21810d1ab81fe">{"x":{"visdat":{"2540196072ff":["function () ","plotlyVisDat"]},"cur_data":"2540196072ff","attrs":{"2540196072ff":{"x":{},"y":{},"z":{},"mode":"markers","opacity":0.8,"color":["black"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"},"2540196072ff.1":{"x":[-2,-1,0,1,2],"y":[-2,-1,0,1,2],"z":[[-3.17872706730034,-2.06798440859822,-0.957241749896101,0.153500908806021,1.26424356750814],[-2.23034182608305,-1.11959916738093,-0.00885650867881171,1.10188615002331,2.21262880872543],[-1.28195658486577,-0.171213926163644,0.939528732538477,2.0502713912406,3.16101404994272],[-0.333571343648477,0.777171315053645,1.88791397375577,2.99865663245789,4.10939929116001],[0.614813897568813,1.72555655627093,2.83629921497306,3.94704187367518,5.0577845323773]],"mode":"markers","opacity":0.8,"color":["black"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","showscale":true,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"x1"},"yaxis":{"title":"x2"},"zaxis":{"title":"y"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[1.33910116259505,1.49485796021989,-1.58939171929036,1.50810360139238,-0.187231977202893,0.0809655767879528,1.95497708789741,0.723763717113234,1.12740097757686,0.312164330074626,1.23693687405495,1.10237207034703,0.0633750531178844,-0.525982678959611,0.43912407602382,-0.848978225658408,-1.18711144592941,1.0159751182762,-0.271520356809693,0.56060896347213,-0.524954260945637,1.05494832837075,-1.36377436241915,0.244498817978827,-1.61831114550517,1.62780940085012,0.365764029147336,-0.267389931166212,0.107129731514312,0.20994641161105,1.74560174435373,1.07506833636984,-0.995346464694542,-0.621068102396197,-1.03117046399026,0.131354146784194,1.67963140016891,0.62855778689359,-0.102567660453717,0.980825289850261,1.0466816252862,-0.580611321963225,0.0340666701643887,0.444122468527898,-0.455310593613694,0.0912910312846446,-0.704319563370064,-0.258038128524151,0.754125662169786,1.49249336491633,-1.19230872651868,1.28531788311537,-1.26734494061668,1.12965358501956,-0.775540198236337,-0.330068947966294,-0.55958233649182,-1.36840487367117,0.852282349597438,0.256586768925067,-1.21828740594306,-0.384156998280941,0.574979011413633,0.884835697495601,0.126402224018284,0.394944554305705,-0.103304251228192,-0.43826396768638,0.550121668724212,-0.088248023344475,0.436292199854728,2.63903253399935,-0.410596308345681,0.224673240847673,1.02484015246628,-0.376479095848361,1.12699402227658,-0.749633037390965,0.468811190574154,-1.31424636042928,1.24745537036077,-1.42545432463241,-1.10035535697266,0.456031843477979,0.745762036896821,-0.55243747389073,-0.29294753146916,-0.394549390369441,-1.20557902960753,0.0479552580905826,0.449051623411284,0.2552229696887,-0.0347957783159608,0.352420721496801,0.314210746411169,0.570706588380879,-1.66507406109855,0.384505104354754,0.866762014623283,0.444444095983789],"y":[-1.46621993512112,-0.965562811056711,0.292052906886091,-1.05523843606367,0.694321589418724,-0.730228686284544,1.67084662069323,2.79739588725487,-0.512499368805077,-0.233510686386286,-0.789094174515791,-0.228479392441486,0.207210254353369,-1.58181596918901,0.677241246019918,1.06806648489973,-0.271139048745053,-0.167923741693916,-0.646042924458952,-0.306184982865925,0.231458959300626,-2.27158020010483,0.393859568693034,-0.675279445929923,-0.38287575701478,0.0204814230212158,0.656311503955588,0.677035690238377,-0.53754842920983,0.956587214273662,-0.0349710058561169,0.0510986834658049,0.393315501366076,-1.20357718611344,-0.746045289336768,1.22536284364822,0.335105319776708,1.31309030381711,1.91197738464998,-0.77724379206775,-0.772835934096685,1.37322793630255,1.08265452562814,1.1938696840359,1.87148008532529,0.886078189664847,0.527127537258993,-1.41125554582071,-0.99148315321653,1.58102231360123,-0.084166268715377,0.0432298534497103,1.21278038571969,0.633639388700325,0.0575509956687007,0.320421084402694,-0.396901393826299,-0.414838530877356,-0.188369405447087,0.339073815509075,2.50915014419233,-1.10105264428677,-0.656171370848866,-0.362533180818594,0.510685902260962,2.02436495231415,-0.375471091844939,0.951618373574625,0.198734789015086,0.71473430598371,0.111438194412145,0.946782472632706,-0.929850027922802,0.82848727012808,-0.437594893249472,-0.319111326354358,2.06938997482705,0.350442691172507,-0.0218798721152323,0.731652328386138,-1.36446696861446,-0.382537871913112,0.259130894842055,1.50362354238487,0.962453095865844,0.915817345870066,-0.576891820926153,0.641824619279362,2.81009624109494,0.277991576020115,1.62619040571581,-0.746048598121584,0.505853812631746,0.600729842777831,2.81796384465821,-2.00726199464191,0.49042183713526,1.32418002798472,-0.51365578712971,0.231365962510916],"z":[0.302499319932357,3.00759545886786,0.36791756086474,0.613564740383266,1.60110552732935,0.845551013245416,4.93568473294854,4.8176422884455,1.06405247498795,0.265684168186252,1.92568168316705,2.6852039716161,1.19102589377332,-0.659825851938281,2.37179423531392,2.5256666019082,-1.33981710042791,2.097871492126,-0.185516525505777,1.76450183179487,0.928070298816711,-0.86356354680064,-1.6390808787985,-0.0363943677081286,-0.787901426118758,2.74140227527722,1.64123211830051,1.39845174624737,1.29327295272316,0.656887151061846,2.58960651048209,1.9100099078826,-0.772602980136558,-0.611478608305525,-0.749665145458281,1.96657339488917,2.41605415491011,2.27268369120378,1.79996446343182,-0.173650587195454,1.43541668836719,1.6607248564458,2.73259461227274,3.43356410382321,2.35028846062756,1.34968981013103,0.868825106264311,-0.149782290506989,1.45719286925157,4.30552885008185,-1.03423654012491,1.96539871242846,0.0978366049584896,2.78703551336616,-0.113605945230655,0.371938984041708,-0.597548254080144,-0.992033893500379,1.04814980489897,1.54310514607647,1.72995879164255,-1.22849156340079,2.202498447618,1.90904528521122,1.14942268161257,2.33658328670661,0.691248818808467,0.53763853091162,1.67951511747488,2.58266132633817,-0.0163290822695281,5.94387227105357,0.435320755859241,1.18655954799207,2.94292732709933,0.641053346665717,3.46457869742038,1.14258262773272,1.79369174244732,0.467716372346073,1.75534540454244,-1.99845349321918,0.408049159544947,2.57881604408484,2.0051838855403,2.14972163050553,0.594149899518169,1.75411240736945,2.50900040589094,2.21400990330918,4.23160154490744,0.6835692664072,2.0204410451936,1.42516131219351,3.85301482820254,-1.39335490250069,-0.323913846255981,2.64556599514554,1.48259099137714,1.80193745963317],"mode":"markers","opacity":0.8,"type":"scatter3d","marker":{"color":"rgba(0,0,0,1)","line":{"color":"rgba(0,0,0,1)"}},"textfont":{"color":"rgba(0,0,0,1)"},"error_y":{"color":"rgba(0,0,0,1)"},"error_x":{"color":"rgba(0,0,0,1)"},"line":{"color":"rgba(0,0,0,1)"},"frame":null},{"x":[-2,-1,0,1,2],"y":[-2,-1,0,1,2],"z":[[-3.17872706730034,-2.06798440859822,-0.957241749896101,0.153500908806021,1.26424356750814],[-2.23034182608305,-1.11959916738093,-0.00885650867881171,1.10188615002331,2.21262880872543],[-1.28195658486577,-0.171213926163644,0.939528732538477,2.0502713912406,3.16101404994272],[-0.333571343648477,0.777171315053645,1.88791397375577,2.99865663245789,4.10939929116001],[0.614813897568813,1.72555655627093,2.83629921497306,3.94704187367518,5.0577845323773]],"mode":"markers","opacity":0.8,"type":"surface","showscale":true,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>How should we interpret the <span class="math inline">\(\beta\)</span>’s in our planar mean function?</p>
<ul>
<li><span class="math inline">\(\beta_0\)</span> is the mean response when all predictor values are 0 since <span class="math inline">\(\mu_{y \mid 0} = \beta_0 + \beta_1(0) + \dotsm + \beta_p (0)= \beta_0\)</span>.</li>
<li><span class="math inline">\(\beta_j\)</span> tells us how the mean response changes for a one unit increase in <span class="math inline">\(x_j\)</span> <strong>holding all other predictors fixed</strong>. We can illustrate this for the the predictor <span class="math inline">\(x_1\)</span>. The mean function at <span class="math inline">\(x_1 + 1\)</span>, holding <span class="math inline">\(x_2, \dotsc, x_p\)</span> fixed, is
<span class="math display">\[
\begin{split}
\mu(y \mid  x_1+1, x_2, \dotsc, x_p) &amp;= \beta_0 + \beta_1 (x_{1}+1) + \beta_2 x_{2} + \dotsm + \beta_p x_p \\
&amp; = \beta_0 + \beta_1 x_{1} + \beta_1 + \beta_2 x_{2}  + \dotsm + \beta_p x_p \\
&amp; = \mu(y \mid  x_1, x_2, \dotsc, x_p) + \beta_1 
\end{split}
\]</span>
This shows that a 1 unit increase in <span class="math inline">\(x_1\)</span> is associated with a <span class="math inline">\(\beta_1\)</span> change in the mean response <strong>holding all other predictors fixed</strong>. This holds in general too: a 1 unit increase in <span class="math inline">\(x_j\)</span> is associated with a <span class="math inline">\(\beta_j\)</span> change in the mean response <strong>holding all other predictors fixed</strong>.</li>
</ul>
</div>
<div id="mlr-quad" class="section level4">
<h4><span class="header-section-number">3.2.1.2</span> Quadratic model</h4>
<p>A model that incorporates <em>polynomial</em> functions of predictors, like <span class="math inline">\(x^2, x^3\)</span>, etc, is also a MLR model. Here is an example that says the mean of <span class="math inline">\(y\)</span> is a quadratic function of <span class="math inline">\(x_1\)</span> but a linear function of <span class="math inline">\(x_2\)</span>:
<span class="math display">\[
\mu_{y\mid  x_1, x_2} = \beta_0 + \beta_1 x_{1} + \beta_2 x_{1}^2 + \beta_3 x_{2}
\]</span>
Notice that this model has <strong>two</strong> covariates <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> but <strong>four</strong> mean function parameters <span class="math inline">\(\beta_0 - \beta_4\)</span> due to the extra quadratic term. An example of this model is visualized below (with all <span class="math inline">\(\beta\)</span>’s equal to 1). You see the quadratic relationship with <span class="math inline">\(x_1\)</span> when you orient the <span class="math inline">\(x_1\)</span> axis to be the left-to-right axes with the <span class="math inline">\(x_2\)</span> axis coming out of the page. When these axes are flipped, you see a linear relationship.</p>
<div id="htmlwidget-a6b161bfca0fbf753c96" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-a6b161bfca0fbf753c96">{"x":{"visdat":{"254048ee3886":["function () ","plotlyVisDat"]},"cur_data":"254048ee3886","attrs":{"254048ee3886":{"x":{},"y":{},"z":{},"mode":"markers","opacity":0.8,"color":["black"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"},"254048ee3886.1":{"x":[-2,-1,0,1,2],"y":[-2,-1,0,1,2],"z":[[0.825903897432338,-1.14489195789767,-1.14745567183695,0.818212755614501,4.75211332445668],[1.94644584299238,-0.0243500123376236,-0.0269137262769028,1.93875470117454,5.87265527001672],[3.06698778855243,1.09619193322242,1.09362821928314,3.05929664673459,6.99319721557676],[4.18752973411247,2.21673387878246,2.21417016484319,4.17983859229463,8.11373916113681],[5.30807167967251,3.33727582434251,3.33471211040323,5.30038053785468,9.23428110669685]],"mode":"markers","opacity":0.8,"color":["black"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","showscale":true,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"x1"},"yaxis":{"title":"x2"},"zaxis":{"title":"y"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-0.173401837506208,0.643161285625134,-1.15783401673742,0.152792497895761,-0.2889668292218,0.440875735100016,-0.442574649722657,0.344733333844546,-1.6395926113525,0.324297121180613,0.487293989510108,0.525000212533027,-0.532841005801528,0.196712370264628,2.20815624590911,0.186931154859022,-1.05978681233004,-0.299544186260116,0.314420937195633,1.27128213197224,1.0901202917826,0.761954887805687,-1.4541895164674,-0.0199901415394949,0.0401295545526874,-2.19627030033728,0.0161856836415831,1.64285046157965,2.27389226491733,-1.12517914526077,-1.03562539997017,-0.281723849019628,1.13278327886401,1.96216778618928,0.0924533982952621,0.887117044199439,0.332299921469158,1.94035935195186,0.600431716081408,-1.26099499631659,0.360303863692309,-0.353089333263841,1.81720069865701,0.252005984079659,-0.82589144143346,2.02024659640307,-0.478091552957698,-0.246874653649953,0.890766836165666,0.116183124402898,-0.868586571843088,-0.518042405957363,-1.40255293033853,-1.02321360445909,1.5864933928231,0.601456485005826,1.18317723944262,-0.768472122857198,-0.616540205477512,-0.880131082483167,0.318733659938373,1.27820641210086,0.414162860489023,-0.138918759401129,0.030448519894547,-1.1976299634789,-2.14773717276087,0.372760113434695,0.324289491125512,0.712958128667729,-1.68717518587689,-0.350009462939774,-0.839323905478965,-1.06072925509285,0.601609275203571,0.123204020688359,0.946647623531839,1.05876234957354,-1.99604549828454,-0.678277328250607,-1.15569135607306,0.422855230469024,-0.988683001541318,0.507662328769845,2.87778181182708,-0.658065887921385,-0.553175837641012,0.618659522035829,-0.25577144294414,-0.374946337024505,-1.02383011195291,0.785039336536259,0.368723109550008,1.13461471013931,-1.38715053243637,-0.00123267844908506,-0.469018896649213,-0.549302301105587,1.20704647255177,0.721264134472423],"y":[0.685184985314928,-0.737176746620672,-0.550197949425012,0.113045442689024,-0.66988076977588,0.991019396733878,0.219916889414243,0.855343569269628,1.15431141503902,-1.74617099978552,-0.610745048219488,-0.766164493527908,-0.564750520372314,-1.74874139351334,0.269277890354246,-0.515616035351964,-0.00732709648583113,-0.886687238160897,0.944316304401267,-0.980923042656112,0.559145346380442,1.40970911600371,-0.403730758264551,-0.601812974688138,1.63121873911359,-0.468820065898289,0.0105321662281673,-1.52238777054707,0.319637728286998,0.850538191210046,-1.37567510737708,1.27560949758108,0.858583875613038,1.05837346800795,-1.09854356796107,-1.33587183976084,0.132169790959782,2.11076233493587,0.303256513923436,-0.41518274605999,-0.0620703329305622,-0.159612197369327,-2.3398544112395,0.0313805254352926,-0.930204461466135,0.874472471337244,-2.10373208393195,-0.213003568507735,-0.160678018552683,0.743442499039958,-0.117119521523417,-0.18791444890002,-0.0825223300665328,0.345077610612966,0.255700061669243,1.26076272381654,-0.0580914906887285,-2.23397292161165,-0.0420778299033217,0.465217326500653,0.105576718725201,0.319828814565021,2.88621887370466,1.55914070782025,-0.622552597512574,-0.452622504024857,-2.22075404338335,-1.34157887015154,1.14273818933049,1.68017698434616,-1.73291903395481,-0.234617813630169,-1.00144425620464,0.451472718084829,0.694259595233661,-1.44116970115949,-0.0547645128158938,-1.65939098952109,-0.444428936630786,0.188342391755399,0.46089588965323,-1.58068478431781,1.09316033274137,-0.672049574266955,-0.454865104198042,-0.424414044296929,0.171332493854092,-0.0218386761519793,0.0405465703378903,-0.531113932614794,-0.326036790390791,0.314644642040896,-0.382771163556623,-0.191224026677356,-0.336836219603431,-1.00915844197779,0.242562357048795,0.741654469488682,-0.922321874127053,-0.977482980763215],"z":[0.456198840005712,1.31596051895958,-0.210686211892572,1.34948073584297,-0.818805442561779,2.73610835469966,0.453727796308639,3.86608302972655,2.94858401511131,0.130790235493674,0.843386539705085,1.18262538786006,1.66794170955894,-0.323523652776436,8.72879921302232,0.839432892975563,1.56020986097334,0.461440427646173,3.03214260673475,1.43209639109217,3.19436450765031,3.08826600697047,1.37565304191456,1.4862606303251,3.80693328762173,2.22109903943931,1.68407710550649,4.43672333333821,8.35334170700951,2.91294893319394,-1.12983093880961,2.12055400446245,3.87203176834749,7.84365344014811,0.383271956248763,1.95035414026969,0.545763412219963,9.71384288315415,1.36672062698368,0.613599896179314,1.56254319209896,0.0678150867230657,2.6911630328188,2.56592255131109,-0.267108861438335,8.23713267853869,-1.88266689591979,1.36506740271123,3.93506858641797,1.57234920136719,0.441354064600061,0.292690161122008,3.1763767161609,2.34924393730122,4.70770658026673,3.5394059652914,3.97561145924048,-1.22845473809627,0.802492790613622,1.0980966718454,0.861299602031217,3.63113445830261,5.04065614345908,1.70340719561334,-0.761357714949931,-0.552921961366556,1.63028271622708,0.367383477947993,2.88987055252329,4.19893998287673,-0.710511396510985,0.378133520893403,0.53146574922061,1.54301242789472,3.00022794494642,0.499303062253409,3.89909367431014,-0.450483643103837,3.34650796037083,1.27569476782578,2.13196729399615,0.39209678516246,1.93015384249037,1.04185062236398,12.1640305250103,1.00815734694742,0.88299782786807,2.71821464556953,0.342932183440269,0.812184908085063,1.00727201325578,2.93423419642875,-0.605906602131098,4.09398256510867,1.02235305462106,-0.0769458433448426,1.2101867780446,2.74484737663045,2.33719288545658,1.688310212588],"mode":"markers","opacity":0.8,"type":"scatter3d","marker":{"color":"rgba(0,0,0,1)","line":{"color":"rgba(0,0,0,1)"}},"textfont":{"color":"rgba(0,0,0,1)"},"error_y":{"color":"rgba(0,0,0,1)"},"error_x":{"color":"rgba(0,0,0,1)"},"line":{"color":"rgba(0,0,0,1)"},"frame":null},{"x":[-2,-1,0,1,2],"y":[-2,-1,0,1,2],"z":[[0.825903897432338,-1.14489195789767,-1.14745567183695,0.818212755614501,4.75211332445668],[1.94644584299238,-0.0243500123376236,-0.0269137262769028,1.93875470117454,5.87265527001672],[3.06698778855243,1.09619193322242,1.09362821928314,3.05929664673459,6.99319721557676],[4.18752973411247,2.21673387878246,2.21417016484319,4.17983859229463,8.11373916113681],[5.30807167967251,3.33727582434251,3.33471211040323,5.30038053785468,9.23428110669685]],"mode":"markers","opacity":0.8,"type":"surface","showscale":true,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>How should we interpret the <span class="math inline">\(\beta\)</span>’s in this quadratic mean function?</p>
<ul>
<li><span class="math inline">\(\beta_0\)</span> is the mean response when all predictor values are 0.</li>
<li><span class="math inline">\(\beta_3\)</span> tells us how the mean response changes for a one unit increase in <span class="math inline">\(x_2\)</span> <strong>holding <span class="math inline">\(\pmb{x_1}\)</span> fixed</strong>.</li>
<li><span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> tell us how the mean response changes as a function of <span class="math inline">\(x_1\)</span>, but since it is quadratic the exact change in the mean response depends on the value of <span class="math inline">\(x_1\)</span>. E.g. the closer the <span class="math inline">\(x_1\)</span> value is to the “top” or “bottom” of the quadratic curve, the smaller the changes in the mean response. We can illustrate this for the the predictor <span class="math inline">\(x_1\)</span>. The mean function at <span class="math inline">\(x_1 + 1\)</span>, holding <span class="math inline">\(x_2\)</span> fixed, is
<span class="math display">\[
\begin{split}
\mu(y \mid  x_1+1, x_2) &amp;= \beta_0 + \beta_1 (x_{1}+1)+ \beta_2 (x_{1}+1)^2 + \beta_3 x_{2}  \\
&amp; = \beta_0 + \beta_1 x_{1} + \beta_1 + \beta_2 x_{1}^2 + \beta_2 2x_1 + \beta_2  + \beta_3 x_2 \\
&amp; = \mu(y \mid  x_1, x_2) + \beta_1 + \beta_2(2x_1+1) 
\end{split}
\]</span>
This shows that a 1 unit increase in <span class="math inline">\(x_1\)</span> is associated with a <span class="math inline">\(\beta_1 + \beta_2(2x_1+1)\)</span> change in the mean response <strong>holding all other predictors fixed</strong>. For example, if <span class="math inline">\(x_1 = 1\)</span> the mean change is <span class="math inline">\(\beta_1 + 3\beta_2\)</span>.</li>
</ul>
</div>
<div id="mlr-int" class="section level4">
<h4><span class="header-section-number">3.2.1.3</span> Interactions</h4>
<p>A model that incorporates predictor <em>interactions</em> says that the effect of one predictor is dependent on the value of the other predictor, and vica versa. Here is an example that has the interaction of <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>:
<span class="math display">\[
\mu_{y\mid  x_1, x_2} = \beta_0 + \beta_1 x_{1} + \beta_2 x_{2} + \beta_3 x_1x_{2}
\]</span>
An example of this model is visualized below (with all <span class="math inline">\(\beta\)</span>’s equal to 1). We obviously don’t see a planar surface. It’s a bit hard to see, but any “slice” you take from the surface along the <span class="math inline">\(x_1\)</span> axis will create a linear function along the <span class="math inline">\(x_2\)</span> axis. The trend, or steepness, of this line depends on the value you chose for <span class="math inline">\(x_1\)</span>. Switching the <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> variables results in the same observation. The effect of each predictor is linear, but its slope, or <em>effect size</em>, is a function of the other predictor.</p>
<div id="htmlwidget-f4648a9f0a847769f92e" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-f4648a9f0a847769f92e">{"x":{"visdat":{"254054f45d2b":["function () ","plotlyVisDat"]},"cur_data":"254054f45d2b","attrs":{"254054f45d2b":{"x":{},"y":{},"z":{},"mode":"markers","opacity":0.8,"color":["black"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"},"254054f45d2b.1":{"x":[-2,-1,0,1,2],"y":[-2,-1,0,1,2],"z":[[0.976443741120313,-0.0918632627296003,-1.16017026657951,-2.22847727042943,-3.29678427427934],[0.0427125012276854,-0.000354277324161378,-0.0434210558760078,-0.0864878344278543,-0.129554612979701],[-0.891018738664943,0.0911547080812779,1.0733281548275,2.05550160157372,3.03767504831994],[-1.82474997855757,0.182663693486717,2.19007736553101,4.19749103757529,6.20490470961958],[-2.7584812184502,0.274172678892156,3.30682657623451,6.33948047357687,9.37213437091922]],"mode":"markers","opacity":0.8,"color":["black"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","showscale":true,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"x1"},"yaxis":{"title":"x2"},"zaxis":{"title":"y"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-0.173401837506208,0.643161285625134,-1.15783401673742,0.152792497895761,-0.2889668292218,0.440875735100016,-0.442574649722657,0.344733333844546,-1.6395926113525,0.324297121180613,0.487293989510108,0.525000212533027,-0.532841005801528,0.196712370264628,2.20815624590911,0.186931154859022,-1.05978681233004,-0.299544186260116,0.314420937195633,1.27128213197224,1.0901202917826,0.761954887805687,-1.4541895164674,-0.0199901415394949,0.0401295545526874,-2.19627030033728,0.0161856836415831,1.64285046157965,2.27389226491733,-1.12517914526077,-1.03562539997017,-0.281723849019628,1.13278327886401,1.96216778618928,0.0924533982952621,0.887117044199439,0.332299921469158,1.94035935195186,0.600431716081408,-1.26099499631659,0.360303863692309,-0.353089333263841,1.81720069865701,0.252005984079659,-0.82589144143346,2.02024659640307,-0.478091552957698,-0.246874653649953,0.890766836165666,0.116183124402898,-0.868586571843088,-0.518042405957363,-1.40255293033853,-1.02321360445909,1.5864933928231,0.601456485005826,1.18317723944262,-0.768472122857198,-0.616540205477512,-0.880131082483167,0.318733659938373,1.27820641210086,0.414162860489023,-0.138918759401129,0.030448519894547,-1.1976299634789,-2.14773717276087,0.372760113434695,0.324289491125512,0.712958128667729,-1.68717518587689,-0.350009462939774,-0.839323905478965,-1.06072925509285,0.601609275203571,0.123204020688359,0.946647623531839,1.05876234957354,-1.99604549828454,-0.678277328250607,-1.15569135607306,0.422855230469024,-0.988683001541318,0.507662328769845,2.87778181182708,-0.658065887921385,-0.553175837641012,0.618659522035829,-0.25577144294414,-0.374946337024505,-1.02383011195291,0.785039336536259,0.368723109550008,1.13461471013931,-1.38715053243637,-0.00123267844908506,-0.469018896649213,-0.549302301105587,1.20704647255177,0.721264134472423],"y":[0.685184985314928,-0.737176746620672,-0.550197949425012,0.113045442689024,-0.66988076977588,0.991019396733878,0.219916889414243,0.855343569269628,1.15431141503902,-1.74617099978552,-0.610745048219488,-0.766164493527908,-0.564750520372314,-1.74874139351334,0.269277890354246,-0.515616035351964,-0.00732709648583113,-0.886687238160897,0.944316304401267,-0.980923042656112,0.559145346380442,1.40970911600371,-0.403730758264551,-0.601812974688138,1.63121873911359,-0.468820065898289,0.0105321662281673,-1.52238777054707,0.319637728286998,0.850538191210046,-1.37567510737708,1.27560949758108,0.858583875613038,1.05837346800795,-1.09854356796107,-1.33587183976084,0.132169790959782,2.11076233493587,0.303256513923436,-0.41518274605999,-0.0620703329305622,-0.159612197369327,-2.3398544112395,0.0313805254352926,-0.930204461466135,0.874472471337244,-2.10373208393195,-0.213003568507735,-0.160678018552683,0.743442499039958,-0.117119521523417,-0.18791444890002,-0.0825223300665328,0.345077610612966,0.255700061669243,1.26076272381654,-0.0580914906887285,-2.23397292161165,-0.0420778299033217,0.465217326500653,0.105576718725201,0.319828814565021,2.88621887370466,1.55914070782025,-0.622552597512574,-0.452622504024857,-2.22075404338335,-1.34157887015154,1.14273818933049,1.68017698434616,-1.73291903395481,-0.234617813630169,-1.00144425620464,0.451472718084829,0.694259595233661,-1.44116970115949,-0.0547645128158938,-1.65939098952109,-0.444428936630786,0.188342391755399,0.46089588965323,-1.58068478431781,1.09316033274137,-0.672049574266955,-0.454865104198042,-0.424414044296929,0.171332493854092,-0.0218386761519793,0.0405465703378903,-0.531113932614794,-0.326036790390791,0.314644642040896,-0.382771163556623,-0.191224026677356,-0.336836219603431,-1.00915844197779,0.242562357048795,0.741654469488682,-0.922321874127053,-0.977482980763215],"z":[0.307318307269909,0.428180535543097,-0.91422792042343,1.34340768399394,-0.708733948953486,2.97865334593311,0.160525835430902,4.04210739847978,-1.63228038338825,-0.540656615631877,0.30831871637199,0.504763642762929,1.68494440739748,-0.706218473889442,4.44745286214586,0.708104935366462,0.44482693361302,0.637315715346073,3.23019489842673,-1.43109180494827,2.61553794523927,3.58182550724275,-0.151913071745387,1.49789135111065,3.87078298785176,-1.57284860576973,1.68398559946218,-0.76328975732075,3.90957743248617,0.689912989266828,-0.777666824566594,1.68181605985148,3.56142326927029,6.07025734367181,0.273160239359017,-0.0216971877573706,0.479260185568086,10.0444859047877,1.18828721037513,-0.452965119217544,1.4103601371318,-0.000499626191726055,-4.86304041724086,2.51032361549239,-0.180957630963271,5.92238640212776,-1.10546188991533,1.35670549029799,2.99847637977784,1.64522615532353,-0.211360124490139,0.121669879974233,1.32496392961287,0.949189751177638,2.59641175317808,3.9359499782289,2.50697054971722,-0.102258228228519,0.448313639538011,-0.0859862796705366,0.793359310017074,2.40613006791849,6.06448993318156,1.46751488103761,-0.781240632464463,-1.44516521782401,1.78710376350166,-0.271653716039132,3.15528486437651,4.88852652823336,-0.633333511127398,0.337745351690814,0.667537235149303,-0.061024444663982,3.0559672368271,0.306565929862542,2.95110925526061,-3.32836205890482,0.249410707418126,0.687886259530819,0.263691387772316,-0.45511058954414,-0.128129273987023,0.442955330390816,2.5733998448316,0.854399039008219,0.482217324715374,2.32196433641385,0.267142497612783,0.870739376013566,0.29285019872085,2.56495585755193,-0.882999907319999,2.58966643104397,-0.434591003650694,-0.0757033949778632,0.876441723558894,2.03572185191518,-0.233053666165472,0.463064844830043],"mode":"markers","opacity":0.8,"type":"scatter3d","marker":{"color":"rgba(0,0,0,1)","line":{"color":"rgba(0,0,0,1)"}},"textfont":{"color":"rgba(0,0,0,1)"},"error_y":{"color":"rgba(0,0,0,1)"},"error_x":{"color":"rgba(0,0,0,1)"},"line":{"color":"rgba(0,0,0,1)"},"frame":null},{"x":[-2,-1,0,1,2],"y":[-2,-1,0,1,2],"z":[[0.976443741120313,-0.0918632627296003,-1.16017026657951,-2.22847727042943,-3.29678427427934],[0.0427125012276854,-0.000354277324161378,-0.0434210558760078,-0.0864878344278543,-0.129554612979701],[-0.891018738664943,0.0911547080812779,1.0733281548275,2.05550160157372,3.03767504831994],[-1.82474997855757,0.182663693486717,2.19007736553101,4.19749103757529,6.20490470961958],[-2.7584812184502,0.274172678892156,3.30682657623451,6.33948047357687,9.37213437091922]],"mode":"markers","opacity":0.8,"type":"surface","showscale":true,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>How should we interpret the <span class="math inline">\(\beta\)</span>’s in this interaction mean function?</p>
<ul>
<li><span class="math inline">\(\beta_0\)</span> is the mean response when all predictor values are 0.</li>
<li><span class="math inline">\(\beta_1\)</span> tells us how the mean response changes for a one unit increase in <span class="math inline">\(x_1\)</span> <strong>when <span class="math inline">\(\pmb{x_2=0}\)</span></strong>.</li>
<li><span class="math inline">\(\beta_2\)</span> tells us how the mean response changes for a one unit increase in <span class="math inline">\(x_2\)</span> <strong>when <span class="math inline">\(\pmb{x_1=0}\)</span></strong>.</li>
<li><span class="math inline">\(\beta_3\)</span> is the interaction effect that tells us how the effect of <span class="math inline">\(x_1\)</span> varies as a function of <span class="math inline">\(x_2\)</span>, and vice versa. We can illustrate this for the the predictor <span class="math inline">\(x_1\)</span>. The mean function at <span class="math inline">\(x_1 + 1\)</span>, holding <span class="math inline">\(x_2\)</span> fixed, is
<span class="math display">\[
\begin{split}
\mu(y \mid  x_1+1, x_2) &amp;= \beta_0 + \beta_1 (x_{1}+1)+ \beta_2 x_2+ \beta_3 (x_1+1)x_{2}  \\
&amp; = \beta_0 + \beta_1 x_{1} + \beta_1 + \beta_2 x_{2} + \beta_3x_1x_2 + \beta_3x_2 \\
&amp; = \mu(y \mid  x_1, x_2) + \beta_1 + \beta_3x_2 
\end{split}
\]</span>
This shows that a 1 unit increase in <span class="math inline">\(x_1\)</span> is associated with a <span class="math inline">\(\beta_1 + \beta_3x_2\)</span> change in the mean response <strong>holding all other predictors fixed</strong>. For example, if <span class="math inline">\(x_2 = 5\)</span> the mean change is <span class="math inline">\(\beta_1 + 5\beta_3\)</span>. Similary, a 1 unit increase in <span class="math inline">\(x_2\)</span> is associated with a <span class="math inline">\(\beta_2 + \beta_3x_1\)</span> change in the mean response <strong>holding all other predictors fixed</strong>.</li>
</ul>
</div>
</div>
</div>
<div id="mlr-example1" class="section level2">
<h2><span class="header-section-number">3.3</span> Example: MLR fit and visuals</h2>
<div id="lm-fit" class="section level3">
<h3><span class="header-section-number">3.3.1</span> <code>lm</code> fit</h3>
<p>We fit a MLR model in R using the same command as a SLR model, but we add model predictors on the right-hand side of the formula. Examples include:</p>
<ul>
<li>planar model: <code>lm(y ~ x1 + x2 + x3, data=, subset=)</code></li>
<li>interaction model: <code>lm(y ~ x1 + x2 + x1:x2 + x3, data=, subset=)</code> or <code>lm(y ~ x1*x2 + x3, data=, subset=)</code></li>
<li>quadratic model: <code>lm(y ~ x1 + I(x1^2) + x2, data=, subset=)</code>. This uses the “as is” operator <code>I()</code> that tells R that <code>^</code> is interpreted as a power rather than as its symbolic use in a formula (see <code>?formula</code> for more details)</li>
</ul>
<p>Here is the multiple linear regression of brain weight (g) on gestation (days), body size (kg) and litter size from <strong>Case Study 9.2</strong>:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(Sleuth3)</a>
<a class="sourceLine" id="cb76-2" title="2"><span class="op">&gt;</span><span class="st"> </span>brain &lt;-<span class="st"> </span>case0902</a>
<a class="sourceLine" id="cb76-3" title="3"><span class="op">&gt;</span><span class="st"> </span>brain.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(Brain <span class="op">~</span><span class="st"> </span>Gestation <span class="op">+</span><span class="st"> </span>Body <span class="op">+</span><span class="st"> </span>Litter, <span class="dt">data=</span>brain )</a>
<a class="sourceLine" id="cb76-4" title="4"><span class="op">&gt;</span><span class="st"> </span>brain.lm</a>
<a class="sourceLine" id="cb76-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb76-6" title="6"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb76-7" title="7"><span class="co">## lm(formula = Brain ~ Gestation + Body + Litter, data = brain)</span></a>
<a class="sourceLine" id="cb76-8" title="8"><span class="co">## </span></a>
<a class="sourceLine" id="cb76-9" title="9"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb76-10" title="10"><span class="co">## (Intercept)    Gestation         Body       Litter  </span></a>
<a class="sourceLine" id="cb76-11" title="11"><span class="co">##   -225.2921       1.8087       0.9859      27.6486</span></a></code></pre></div>
<p>The estimated mean function is
<span class="math display">\[
\hat{\mu}(brain \mid gest,body,litter) =  -225.2921    +   1.8087 Gestation     + 0.9859  Body   + 27.6486  Litter
\]</span>
Holding gestation length and body weight fixed, increasing litter size by one baby increases estimated mean brain weight by 27.6g. But is this an appropriate model to use? <strong>This interpretation is meaningless if the model doesn’t fit the data!</strong> We need to check this with scatterplots and residual plots.</p>
</div>
<div id="graphics-for-mlr" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Graphics for MLR</h3>
<p>If we have <span class="math inline">\(p\)</span> predictors in our model, then the MLR model can be viewed in a (at least) <span class="math inline">\(p\)</span>-dimensional picture! Viewing this is difficult, if not impossible. The best we can do is look at 2-d scatterplots of <span class="math inline">\(y\)</span> vs. all the predictor variables. (But, unfortunately, what we see in these 2-d graphs doesn’t always explain to us what we will “see” in the MLR model.)</p>
<div id="scatterplot-matrix" class="section level4">
<h4><span class="header-section-number">3.3.2.1</span> Scatterplot matrix</h4>
<p>A scatterplot matrix plots all pairs of variables used in a model. The primary plots of interest will have the response <span class="math inline">\(y\)</span> on the y-axis and the predictors on the x-axis. But the predictor plots (e.g. <span class="math inline">\(x_1\)</span> vs. <span class="math inline">\(x_2\)</span>) are useful to see if any predictors are related, which is a topic dicussed in more detail later in these notes.</p>
<p>The basic scatterplot matrix command <code>pairs</code> takes in a data frame, minus any columns you don’t want plotted:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">names</span>(brain)</a>
<a class="sourceLine" id="cb77-2" title="2"><span class="co">## [1] &quot;Species&quot;   &quot;Brain&quot;     &quot;Body&quot;      &quot;Gestation&quot; &quot;Litter&quot;</span></a>
<a class="sourceLine" id="cb77-3" title="3"><span class="op">&gt;</span><span class="st"> </span><span class="co"># we want to omit column 1 (Species) from our graph:</span></a>
<a class="sourceLine" id="cb77-4" title="4"><span class="er">&gt;</span><span class="st"> </span><span class="kw">pairs</span>(brain[,<span class="op">-</span><span class="dv">1</span>])</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>The top row shows scatterplots of the response <code>Brain</code> vs. the three predictors. All three indicate that transformations of all variables should be explored.</p>
<p>A slightly nicer version that includes univariate density curves and correlation coefficients is made using <code>ggpairs</code> in the <code>GGally</code> package. This option fits a smoother curve to the scatterplots:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(GGally)</a>
<a class="sourceLine" id="cb78-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggpairs</span>(brain, <span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">&quot;Body&quot;</span>,<span class="st">&quot;Gestation&quot;</span>, <span class="st">&quot;Litter&quot;</span>,<span class="st">&quot;Brain&quot;</span>), </a>
<a class="sourceLine" id="cb78-3" title="3"><span class="op">+</span><span class="st">         </span><span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> <span class="st">&quot;smooth&quot;</span>))</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>In this plot command, we select variables from <code>brain</code> in the <code>columns</code> argument with the response <code>Brain</code> listed <strong>last</strong> to make the lower row of the plot show the response <code>Brain</code> on the y-axis vs. all three predictors on the x-axes.</p>
<p>Conclusion: transformations are likely needed. Since all variables have positive values, we can try logs first.</p>
<p>We can’t use a <code>scale</code> argument in a scatterplot matrix to explore transformations. Instead, we can use the <code>dplyr</code> package to transform all variables (except <code>Species</code>) using the <code>mutate_all</code> function, then we plot using <code>ggpairs</code> again. Here we also added the <code>ggpairs</code> argument <code>columnLabels</code> to remind us what transformations were made:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb79-2" title="2"><span class="op">&gt;</span><span class="st"> </span>brain <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># omit species</span></a>
<a class="sourceLine" id="cb79-3" title="3"><span class="op">+</span><span class="st">   </span><span class="kw">mutate_all</span>(<span class="dt">.funs =</span> log) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># apply the log function to all variables</span></a>
<a class="sourceLine" id="cb79-4" title="4"><span class="op">+</span><span class="st">   </span><span class="kw">ggpairs</span>(<span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">&quot;Body&quot;</span>,<span class="st">&quot;Gestation&quot;</span>, <span class="st">&quot;Litter&quot;</span>,<span class="st">&quot;Brain&quot;</span>),   </a>
<a class="sourceLine" id="cb79-5" title="5"><span class="op">+</span><span class="st">           </span><span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> <span class="st">&quot;smooth&quot;</span>), </a>
<a class="sourceLine" id="cb79-6" title="6"><span class="op">+</span><span class="st">           </span><span class="dt">columnLabels =</span> <span class="kw">c</span>(<span class="st">&quot;log(Body)&quot;</span>,<span class="st">&quot;log(Gestation)&quot;</span>, <span class="st">&quot;log(Litter)&quot;</span>,<span class="st">&quot;log(Brain)&quot;</span>))</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>Does <code>Litter</code> need to be logged? If we don’t want to log all variables, we can use <code>mutate_at</code> instead of <code>mutate_all</code>:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1"><span class="op">&gt;</span><span class="st"> </span>brain <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># omit species</span></a>
<a class="sourceLine" id="cb80-2" title="2"><span class="op">+</span><span class="st">   </span><span class="kw">mutate_at</span>(<span class="dt">.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Brain&quot;</span>,<span class="st">&quot;Body&quot;</span>,<span class="st">&quot;Gestation&quot;</span>), <span class="dt">.funs =</span> log) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># pick variables to log</span></a>
<a class="sourceLine" id="cb80-3" title="3"><span class="op">+</span><span class="st">   </span><span class="kw">ggpairs</span>(<span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">&quot;Body&quot;</span>,<span class="st">&quot;Gestation&quot;</span>, <span class="st">&quot;Litter&quot;</span>,<span class="st">&quot;Brain&quot;</span>), </a>
<a class="sourceLine" id="cb80-4" title="4"><span class="op">+</span><span class="st">           </span><span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> <span class="st">&quot;smooth&quot;</span>), </a>
<a class="sourceLine" id="cb80-5" title="5"><span class="op">+</span><span class="st">           </span><span class="dt">columnLabels =</span> <span class="kw">c</span>(<span class="st">&quot;log(Body)&quot;</span>,<span class="st">&quot;log(Gestation)&quot;</span>, <span class="st">&quot;Litter&quot;</span>,<span class="st">&quot;log(Brain)&quot;</span>))</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
</div>
<div id="jittered-scatterplot" class="section level4">
<h4><span class="header-section-number">3.3.2.2</span> Jittered scatterplot:</h4>
<p>Jittered plots are useful when data points overlap (discrete variables like litter) and your sample size isn’t huge. Change the <code>alpha</code> transparency value with large data sets. Here we compare <code>geom_point()</code> against <code>geom_jitter</code>, using <code>grid.arrange</code> from the <code>gridExtra</code> package to put these plots side-by-side:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1"><span class="op">&gt;</span><span class="st"> </span>base &lt;-<span class="st"> </span><span class="kw">ggplot</span>(brain, <span class="kw">aes</span>(<span class="dt">x=</span>Litter, <span class="dt">y=</span>Brain)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>()</a>
<a class="sourceLine" id="cb81-2" title="2"><span class="op">&gt;</span><span class="st"> </span>plotA &lt;-<span class="st"> </span>base <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;unjittered&quot;</span>)</a>
<a class="sourceLine" id="cb81-3" title="3"><span class="op">&gt;</span><span class="st"> </span>plotB &lt;-<span class="st"> </span>base <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">width=</span>.<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;jittered&quot;</span>)</a>
<a class="sourceLine" id="cb81-4" title="4"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb81-5" title="5"><span class="op">&gt;</span><span class="st"> </span><span class="kw">grid.arrange</span>(plotA,plotB, <span class="dt">nrow=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<p>The <code>width=.1</code> amount specifies how much to jitter the points (we changed it here because the default amount didn’t display enough of a change). We can see the jittering most in the points clustered around <code>Litter=0</code>.</p>
</div>
</div>
<div id="mlr-resid1" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Residual plots for MLR</h3>
<p>If we have <span class="math inline">\(p\)</span> predictors, then there are <span class="math inline">\(p+1\)</span> residual plots to check:</p>
<ul>
<li>plot <span class="math inline">\(r_i\)</span> against all predictors <span class="math inline">\(x_1, \dotsc, _p\)</span>. The motivation for these plots is the same as SLR (residuals should not be related to the <span class="math inline">\(x\)</span>’s)</li>
<li>plot <span class="math inline">\(r_i\)</span> against the <em>fitted</em> values <span class="math inline">\(\hat{y}_i\)</span>. The motivation for this may be less clear, but the fitted values are simply a linear function of the predictor values:
<span class="math display">\[
\hat{y}_i = \hat{\beta}_0 + \hat{\beta}_1 x_{1,i}  + \hat{\beta}_2 x_{2,i} + \dotsm  + \hat{\beta}_p x_{p,i}
\]</span>
so the residuals should not be related to the fitted values if the model fits.</li>
</ul>
<p>All <span class="math inline">\(p+1\)</span> plots should be checked. A quick starting point is the fitted value plot which is the first plot when <code>plot</code>-ing the <code>lm</code>. Here is the residuals vs. fitted plot for the untransformed variable model:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="co"># check residuals vs. fitted (y-hat) values:</span></a>
<a class="sourceLine" id="cb82-2" title="2"><span class="er">&gt;</span><span class="st"> </span><span class="kw">plot</span>(brain.lm, <span class="dt">which=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-84-1.png" width="384" /></p>
<p>This plot indicates non-linearity and non-constant variance. Here is the same residual plot for the model will all variables logged except <code>Litter</code>:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1"><span class="op">&gt;</span><span class="st"> </span>brain.lm2 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(Brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(Gestation) <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(Body) <span class="op">+</span><span class="st"> </span>Litter, <span class="dt">data=</span>brain)</a>
<a class="sourceLine" id="cb83-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(brain.lm2, <span class="dt">which=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-85-1.png" width="384" /></p>
<p>We can use the <code>ggnostic</code> function in <code>GGally</code> to get plots of residuals vs. all predictors:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggnostic</span>(brain.lm2, <span class="dt">columnsY =</span> <span class="st">&quot;.resid&quot;</span>)  <span class="co"># from GGally</span></a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
<p>The residual plots reveal some outliers that should be explored but the overall fit, while not perfect, is much better than the untransformed version.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb85-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb85-3" title="3"><span class="op">&gt;</span><span class="st"> </span><span class="kw">kable</span>(<span class="kw">tidy</span>(brain.lm2), <span class="dt">digits=</span><span class="dv">4</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.8234</td>
<td align="right">0.6621</td>
<td align="right">1.2437</td>
<td align="right">0.2168</td>
</tr>
<tr class="even">
<td align="left">log(Gestation)</td>
<td align="right">0.4396</td>
<td align="right">0.1370</td>
<td align="right">3.2095</td>
<td align="right">0.0018</td>
</tr>
<tr class="odd">
<td align="left">log(Body)</td>
<td align="right">0.5745</td>
<td align="right">0.0326</td>
<td align="right">17.6009</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">Litter</td>
<td align="right">-0.1104</td>
<td align="right">0.0423</td>
<td align="right">-2.6115</td>
<td align="right">0.0105</td>
</tr>
</tbody>
</table>
<p>The estimated median function for this model is
<span class="math display">\[
\widehat{median}(y \mid x) = e^{0.8234}(Gest)^{0.4396}(Body)^{0.5745}e^{-0.1104(Litter)} 
\]</span></p>
<p>The effect of <code>Gestation</code> is interpreted as you would in a <strong>power</strong> model (both variables logged). For example, doubling gestational days is associated with an estimated $(2^{0.4396}-1)100%=$35.6% increase in median brain weight, holding body weight and litter size constant.</p>
<p>The effect of <code>Litter</code> is interpreted as you would in an <strong>exponential</strong> model (with just the response logged). For example, after controlling for body size and gestation time, each additional offspring decreases estimated median brain weight by 10.5% (work is <span class="math inline">\((e^{-0.1104}-1)100%=\)</span>).</p>
</div>
<div id="eda-for-interactions" class="section level3">
<h3><span class="header-section-number">3.3.4</span> EDA for interactions</h3>
<p>We visualize interactions by using a graphic that looks at the relationship between <span class="math inline">\(y\)</span> and <span class="math inline">\(x_1\)</span> while holding the value of <span class="math inline">\(x_2\)</span> fixed (or almost fixed), and vice versa for flipping the role of <span class="math inline">\(x\)</span> variables. An interaction may be needed if the relationship between <span class="math inline">\(y\)</span> and <span class="math inline">\(x_1\)</span> depends on the value of <span class="math inline">\(x_2\)</span>.</p>
<div id="predictors-one-quantitative-and-one-categorical" class="section level4">
<h4><span class="header-section-number">3.3.4.1</span> Predictors: one quantitative and one categorical</h4>
<p>For example, if <span class="math inline">\(x_1\)</span> is quantitative and <span class="math inline">\(x_2\)</span> is categorical, then we use <code>facet_wrap</code> (or <code>facet_grid</code>) to split the scatterplot of <span class="math inline">\(y\)</span> vs. <span class="math inline">\(x_1\)</span> by group of <span class="math inline">\(x_2\)</span>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(mydata, <span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y=</span>y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb86-2" title="2"><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb86-3" title="3"><span class="op">+</span><span class="st">   </span><span class="kw">facet_wrap</span>(<span class="op">~</span>x2)</a></code></pre></div>
</div>
<div id="predictors-both-quantitative" class="section level4">
<h4><span class="header-section-number">3.3.4.2</span> Predictors: both quantitative</h4>
<p>We use the same <code>facet_wrap</code> function, but we need to group the data into similar cases with respect to their <span class="math inline">\(x_2\)</span> value, which is now assumed to be quantitative. One way to do this is to use the <code>ntile(n=)</code> function from <code>dplyr</code> package where <code>n</code> determines how many groups the data will be divided into.</p>
<p>Is there an interaction between body weight and gestation?? <strong>Does the relationship between brain weight and gestation length change as we vary body weight?</strong> If yes, then we should include an interaction term between gestation and body weight.</p>
<p>Here we hold body weight “fixed” by using the <code>ntile</code> command from the <code>dplyr</code> package to divide the data into chunks of animals with similar body weights. Here we pick <code>n=4</code> for this function which divides the cases into 4 equal sized chunks based on the quartiles (4) of <code>Body</code>. In the plot below the cases in “1” are the lower 25% of body weights, “2” are the 25-50th percentile values of Body weights, etc.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(brain, <span class="kw">aes</span>(<span class="dt">x=</span>Gestation, <span class="dt">y=</span>Brain)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-2" title="2"><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb87-3" title="3"><span class="op">+</span><span class="st">   </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-4" title="4"><span class="op">+</span><span class="st">   </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">ntile</span>(Body, <span class="dt">n=</span><span class="dv">4</span>))</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<p>Conclusion: the trend within each level of body weight is about the same. No obvious interactive effect of body weight and gestation length on brain weight. Of course we can always check significance by adding interaction term to model:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1"><span class="op">&gt;</span><span class="st"> </span>brain.lm3 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(Brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(Gestation) <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(Body) <span class="op">+</span><span class="st"> </span>Litter <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(Gestation)<span class="op">:</span><span class="kw">log</span>(Body), <span class="dt">data=</span>brain)</a>
<a class="sourceLine" id="cb88-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(brain.lm3)</a>
<a class="sourceLine" id="cb88-3" title="3"><span class="co">## </span></a>
<a class="sourceLine" id="cb88-4" title="4"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb88-5" title="5"><span class="co">## lm(formula = log(Brain) ~ log(Gestation) + log(Body) + Litter + </span></a>
<a class="sourceLine" id="cb88-6" title="6"><span class="co">##     log(Gestation):log(Body), data = brain)</span></a>
<a class="sourceLine" id="cb88-7" title="7"><span class="co">## </span></a>
<a class="sourceLine" id="cb88-8" title="8"><span class="co">## Residuals:</span></a>
<a class="sourceLine" id="cb88-9" title="9"><span class="co">##      Min       1Q   Median       3Q      Max </span></a>
<a class="sourceLine" id="cb88-10" title="10"><span class="co">## -0.95837 -0.29354  0.01594  0.27960  1.62013 </span></a>
<a class="sourceLine" id="cb88-11" title="11"><span class="co">## </span></a>
<a class="sourceLine" id="cb88-12" title="12"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb88-13" title="13"><span class="co">##                          Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb88-14" title="14"><span class="co">## (Intercept)               0.64124    0.67137   0.955 0.342050    </span></a>
<a class="sourceLine" id="cb88-15" title="15"><span class="co">## log(Gestation)            0.48758    0.14051   3.470 0.000797 ***</span></a>
<a class="sourceLine" id="cb88-16" title="16"><span class="co">## log(Body)                 0.69602    0.09268   7.510 3.91e-11 ***</span></a>
<a class="sourceLine" id="cb88-17" title="17"><span class="co">## Litter                   -0.10050    0.04264  -2.357 0.020566 *  </span></a>
<a class="sourceLine" id="cb88-18" title="18"><span class="co">## log(Gestation):log(Body) -0.02678    0.01914  -1.399 0.165080    </span></a>
<a class="sourceLine" id="cb88-19" title="19"><span class="co">## ---</span></a>
<a class="sourceLine" id="cb88-20" title="20"><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb88-21" title="21"><span class="co">## </span></a>
<a class="sourceLine" id="cb88-22" title="22"><span class="co">## Residual standard error: 0.4731 on 91 degrees of freedom</span></a>
<a class="sourceLine" id="cb88-23" title="23"><span class="co">## Multiple R-squared:  0.9545, Adjusted R-squared:  0.9525 </span></a>
<a class="sourceLine" id="cb88-24" title="24"><span class="co">## F-statistic: 477.4 on 4 and 91 DF,  p-value: &lt; 2.2e-16</span></a></code></pre></div>
</div>
</div>
<div id="quadratic-models-corn-yields-exercise-9.15" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Quadratic models: Corn yields (exercise 9.15)</h3>
<p>This final example illustrates a quadratic model fit and scatterplot. Consider the corn yield data in textbook exercise 9.15. How is corn yield (measured bushels/acre) in a year related to the amount of rainfall (inches) in that summer?</p>
<p>A linear model for yield against rainfall is not appropriate:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" title="1"><span class="op">&gt;</span><span class="st"> </span>corn &lt;-<span class="st"> </span>ex0915</a>
<a class="sourceLine" id="cb89-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(corn)</a>
<a class="sourceLine" id="cb89-3" title="3"><span class="co">##       Year          Yield          Rainfall     </span></a>
<a class="sourceLine" id="cb89-4" title="4"><span class="co">##  Min.   :1890   Min.   :19.40   Min.   : 6.800  </span></a>
<a class="sourceLine" id="cb89-5" title="5"><span class="co">##  1st Qu.:1899   1st Qu.:29.95   1st Qu.: 9.425  </span></a>
<a class="sourceLine" id="cb89-6" title="6"><span class="co">##  Median :1908   Median :32.15   Median :10.500  </span></a>
<a class="sourceLine" id="cb89-7" title="7"><span class="co">##  Mean   :1908   Mean   :31.92   Mean   :10.784  </span></a>
<a class="sourceLine" id="cb89-8" title="8"><span class="co">##  3rd Qu.:1918   3rd Qu.:35.20   3rd Qu.:12.075  </span></a>
<a class="sourceLine" id="cb89-9" title="9"><span class="co">##  Max.   :1927   Max.   :38.30   Max.   :16.500</span></a>
<a class="sourceLine" id="cb89-10" title="10"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(corn, <span class="kw">aes</span>(<span class="dt">x=</span>Rainfall, <span class="dt">y=</span>Yield)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb89-11" title="11"><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb89-12" title="12"><span class="op">+</span><span class="st">   </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb89-13" title="13"><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;SLR model&quot;</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1"><span class="op">&gt;</span><span class="st"> </span>corn.lm1&lt;-<span class="kw">lm</span>(Yield <span class="op">~</span><span class="st"> </span>Rainfall, <span class="dt">data =</span>corn)</a>
<a class="sourceLine" id="cb90-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(corn.lm1, <span class="dt">which=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-91-2.png" width="672" /></p>
<p>We can add a quadratic term (using the <code>I()</code> operator):</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1"><span class="op">&gt;</span><span class="st"> </span>corn.lm2 &lt;-<span class="st"> </span><span class="kw">lm</span>(Yield <span class="op">~</span><span class="st"> </span>Rainfall <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(Rainfall<span class="op">^</span><span class="dv">2</span>), <span class="dt">data =</span>corn)</a></code></pre></div>
<p>Alternatively, we can update model 1 (SLR) using the <code>update</code> command: on right side of formula the <code>~ . + newstuff</code> says to add the <code>newstuff</code> to the old model formula which is denoted with the period <code>.</code> .</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1"><span class="op">&gt;</span><span class="st"> </span>corn.lm2 &lt;-<span class="st"> </span><span class="kw">update</span>(corn.lm1, <span class="op">~</span><span class="st"> </span>. <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(Rainfall<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb92-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(corn.lm2) </a>
<a class="sourceLine" id="cb92-3" title="3"><span class="co">## </span></a>
<a class="sourceLine" id="cb92-4" title="4"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb92-5" title="5"><span class="co">## lm(formula = Yield ~ Rainfall + I(Rainfall^2), data = corn)</span></a>
<a class="sourceLine" id="cb92-6" title="6"><span class="co">## </span></a>
<a class="sourceLine" id="cb92-7" title="7"><span class="co">## Residuals:</span></a>
<a class="sourceLine" id="cb92-8" title="8"><span class="co">##     Min      1Q  Median      3Q     Max </span></a>
<a class="sourceLine" id="cb92-9" title="9"><span class="co">## -8.4642 -2.3236 -0.1265  3.5151  7.1597 </span></a>
<a class="sourceLine" id="cb92-10" title="10"><span class="co">## </span></a>
<a class="sourceLine" id="cb92-11" title="11"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb92-12" title="12"><span class="co">##               Estimate Std. Error t value Pr(&gt;|t|)   </span></a>
<a class="sourceLine" id="cb92-13" title="13"><span class="co">## (Intercept)   -5.01467   11.44158  -0.438  0.66387   </span></a>
<a class="sourceLine" id="cb92-14" title="14"><span class="co">## Rainfall       6.00428    2.03895   2.945  0.00571 **</span></a>
<a class="sourceLine" id="cb92-15" title="15"><span class="co">## I(Rainfall^2) -0.22936    0.08864  -2.588  0.01397 * </span></a>
<a class="sourceLine" id="cb92-16" title="16"><span class="co">## ---</span></a>
<a class="sourceLine" id="cb92-17" title="17"><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb92-18" title="18"><span class="co">## </span></a>
<a class="sourceLine" id="cb92-19" title="19"><span class="co">## Residual standard error: 3.763 on 35 degrees of freedom</span></a>
<a class="sourceLine" id="cb92-20" title="20"><span class="co">## Multiple R-squared:  0.2967, Adjusted R-squared:  0.2565 </span></a>
<a class="sourceLine" id="cb92-21" title="21"><span class="co">## F-statistic: 7.382 on 2 and 35 DF,  p-value: 0.002115</span></a>
<a class="sourceLine" id="cb92-22" title="22"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(corn.lm2, <span class="dt">which=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<p>This residual plot looks much better for this quadratic model compared to the linear model.</p>
<p>We can visualize this quadratic model using the <code>geom_smooth(method="lm")</code> function but we have to specify this model form since the default is a SLR. This is done in the <code>formula</code> argument, using <code>y</code> and <code>x</code> to denote the <code>x</code> and <code>y</code> that you specify in the <code>aes</code> argument.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(corn, <span class="kw">aes</span>(<span class="dt">x=</span>Rainfall, <span class="dt">y=</span>Yield)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-2" title="2"><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-3" title="3"><span class="op">+</span><span class="st">   </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">formula=</span> y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x<span class="op">^</span><span class="dv">2</span>),  <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-4" title="4"><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;quadratic fit!&quot;</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<p>The model fit is</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">kable</span>(<span class="kw">tidy</span>(corn.lm2), <span class="dt">digits =</span> <span class="dv">4</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-5.0147</td>
<td align="right">11.4416</td>
<td align="right">-0.4383</td>
<td align="right">0.6639</td>
</tr>
<tr class="even">
<td align="left">Rainfall</td>
<td align="right">6.0043</td>
<td align="right">2.0389</td>
<td align="right">2.9448</td>
<td align="right">0.0057</td>
</tr>
<tr class="odd">
<td align="left">I(Rainfall^2)</td>
<td align="right">-0.2294</td>
<td align="right">0.0886</td>
<td align="right">-2.5877</td>
<td align="right">0.0140</td>
</tr>
</tbody>
</table>
<p>so
<span class="math display">\[
\hat{\mu}(yield \mid rain) = -5.0147 + 6.0043(rain)- 0.2294(rain)^2
\]</span>
An increase from 9 to 10 inches of rainfall is associated with a mean yield increase of 1.646 bushels per acre.
<span class="math display">\[
6.0043- 0.2294(2\times 9 + 1) = 1.646
\]</span>
An increase from 14 to 15 inches of rainfall is associated with a mean yield decrease of 0.648 bushels per acre.
<span class="math display">\[
6.0043- 0.2294(2\times 14 + 1) = -0.648
\]</span></p>
</div>
</div>
<div id="mlr-cat" class="section level2">
<h2><span class="header-section-number">3.4</span> Categorical Predictors</h2>
<p>Categorical predictors can be included in a regression model the same way that a quantitative predictor can. But since a categorical variable doesn’t have a numerical scaling, we don’t have a “linearity” assumption that needs to be met (though the three other assumptions still hold). A categorical variable is included by using one or more <em>indicator</em> variables (aka dummy variables) which indicate different levels of the variable.</p>
<ul>
<li>An <strong>indicator variable</strong> equals 1 to indicate the level of interest, and is 0 otherwise.</li>
<li>The <strong>baseline level</strong> of an indicator variable is the level of the factor variable that doesn’t have an indicator variable made for it.</li>
<li>R will create indicator variables for us in an <code>lm</code>, so there is no need to do this “by hand”.</li>
</ul>
<p>If a variable, which is stored as a <code>factor</code> in R, has <span class="math inline">\(k\)</span> levels then we need <span class="math inline">\(k-1\)</span> indicator variables. Consider the following examples to illustrate this idea.</p>
<p>Suppose we are looking at how gender and education level are associated with income. If there are two genders in our data, here recorded as <code>Female</code> and <code>Male</code>, then we need one indicator to indicate one of the two levels. R will create an indicator for the <strong>second</strong> level, ordered alphabetically. If a case has <code>Indicator_Male=1</code> then the case is <code>Male</code> but if the case has <code>Indicator_Male=0</code> then the case is <code>Female</code>. So this one indicator variable can classify two levels and the baseline level is <code>Female</code>.</p>
<table>
<thead>
<tr class="header">
<th align="center">Gender</th>
<th align="center">Indicator_Male</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Female</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">Male</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>Suppose we are looking at how number of farms per county in 1992 is related to number of farms in 1987 and region of the country. If there are four regions in our data, here recorded as <code>NC</code>, <code>NE</code>, <code>S</code> and <code>W</code>, then we need three indicators. R will create an indicator for all but the first level of <code>NC</code>. If a case has <code>Indicator_NE=1</code> then the case is <code>NE</code>, if the case has <code>Indicator_S=1</code> then the case is <code>S</code>, if the case has <code>Indicator_W=1</code> then the case is <code>W</code>. If a case has <em>all</em> indicator values equal to 0, then the case is the <strong>baseline</strong> level of <code>NC</code>. So we need three indicators to classify the four region levels.</p>
<table>
<thead>
<tr class="header">
<th align="center">Region</th>
<th align="center">Indicator_NE</th>
<th align="center">Indicator_S</th>
<th align="center">Indicator_W</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">NC</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">NE</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">S</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">W</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<div id="interpretation-adding-a-categorical" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Interpretation: adding a categorical</h3>
<p>You add a categorical predictor <code>x2</code> to the <code>lm</code> function just as you would any quantitative predictor: <code>lm(y ~ x1 + x2, data)</code>. R automatically creates indicator variables for <code>x2</code>. When <em>adding</em> a categorical <code>x2</code> which has, say levels <code>A</code>, <code>B</code> and <code>C</code>, the basic mean function form looks like:
<span class="math display">\[
\mu(Y \mid x_1, x_2) = \beta_0 + \beta_1 x_1 + \beta_3 LevelB + \beta_4 LevelC
\]</span>
The mean function for cases where <span class="math inline">\(x_2=A\)</span> sets the indicators for levels <code>B</code> and <code>C</code> <strong>equal to 0</strong>:
<span class="math display">\[
\mu(Y \mid x_1, x_2=A) = \beta_0 + \beta_1 x_1 + \beta_3 (0) + \beta_4 (0) = \beta_0 + \beta_1 x_1 
\]</span>
The mean function for cases where <span class="math inline">\(x_2=B\)</span> sets the indicator for level <code>B</code> equalt to 1 and the indicator for level <code>C</code> equal to 0:
<span class="math display">\[
\mu(Y \mid x_1, x_2=B) = \beta_0 + \beta_1 x_1 + \beta_3 (1) + \beta_4 (0) = \beta_0 + \beta_1 x_1 + \beta_3
\]</span>
The mean function for cases where <span class="math inline">\(x_2=C\)</span> sets the indicator for level <code>C</code> equalt to 1 and the indicator for level <code>B</code> equal to 0:
<span class="math display">\[
\mu(Y \mid x_1, x_2=C) = \beta_0 + \beta_1 x_1 + \beta_3 (0) + \beta_4 (1) = \beta_0 + \beta_1 x_1 + \beta_4
\]</span></p>
<p>Interpretation of indicator effects:</p>
<ul>
<li><span class="math inline">\(\beta_3\)</span> is the difference between <span class="math inline">\(\mu(Y \mid x_1, x_2=B)\)</span> and <span class="math inline">\(\mu(Y \mid x_1, x_2=A)\)</span>, so it measures the mean change between levels <code>B</code> and <code>A</code>, holding <span class="math inline">\(x_1\)</span> fixed.</li>
<li><span class="math inline">\(\beta_4\)</span> is the difference between <span class="math inline">\(\mu(Y \mid x_1, x_2=C)\)</span> and <span class="math inline">\(\mu(Y \mid x_1, x_2=A)\)</span>, so it measures the mean change between levels <code>C</code> and <code>A</code>, holding <span class="math inline">\(x_1\)</span> fixed.</li>
<li><span class="math inline">\(\beta_3-\beta_4\)</span> is the difference between <span class="math inline">\(\mu(Y \mid x_1, x_2=B)\)</span> and <span class="math inline">\(\mu(Y \mid x_1, x_2=C)\)</span>, so it measures the mean change between levels <code>B</code> and <code>C</code>, holding <span class="math inline">\(x_1\)</span> fixed.</li>
</ul>
<div id="mlr-agstrat1" class="section level4">
<h4><span class="header-section-number">3.4.1.1</span> Example: Agstrat</h4>
<p>Consider the <code>agstrat</code> data again, fitting the regression of square root of <code>farms92</code> (number of farms/county in 1992) against square root of <code>farms87</code> and <code>region</code>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1"><span class="op">&gt;</span><span class="st"> </span>agstrat&lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://people.carleton.edu/~kstclair/data/agstrat.csv&quot;</span>)</a>
<a class="sourceLine" id="cb95-2" title="2"><span class="op">&gt;</span><span class="st"> </span>farms.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">sqrt</span>(farms92) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(farms87) <span class="op">+</span><span class="st"> </span>region, <span class="dt">data=</span>agstrat)</a>
<a class="sourceLine" id="cb95-3" title="3"><span class="op">&gt;</span><span class="st"> </span>farms.lm</a>
<a class="sourceLine" id="cb95-4" title="4"><span class="co">## </span></a>
<a class="sourceLine" id="cb95-5" title="5"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb95-6" title="6"><span class="co">## lm(formula = sqrt(farms92) ~ sqrt(farms87) + region, data = agstrat)</span></a>
<a class="sourceLine" id="cb95-7" title="7"><span class="co">## </span></a>
<a class="sourceLine" id="cb95-8" title="8"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb95-9" title="9"><span class="co">##   (Intercept)  sqrt(farms87)       regionNE        regionS        regionW  </span></a>
<a class="sourceLine" id="cb95-10" title="10"><span class="co">##       -0.9369         0.9798        -0.0826         0.7214         1.0100</span></a></code></pre></div>
<p>The fitted model mean function is estimated as
<span class="math display">\[
\begin{split}
\hat{\mu}(\sqrt{farms92} \mid \sqrt{farms92}, region) &amp;  = -0.9369 + 0.9798 \sqrt{farms92}  -0.0826(regionNE) + \\
 &amp; 0.7214(regionS) + 1.0100(regionW)
\end{split}
\]</span></p>
<p>For the baseline <code>NC</code> region, the estimated mean function is
<span class="math display">\[\begin{split}
\hat{\mu}(\sqrt{farms92} \mid \sqrt{farms92}, region=NC) &amp; = -0.9369 + 0.9798 \sqrt{farms92}  -0.0826(0) + \\
&amp; 0.7214(0)+  1.0100(0) \\
&amp; = -0.9369 + 0.9798 \sqrt{farms92}
\end{split}
\]</span>
For the <code>S</code> region, the estimated mean function is
<span class="math display">\[\begin{split}
\hat{\mu}(\sqrt{farms92} \mid \sqrt{farms92}, region=S) &amp; = -0.9369 + 0.9798 \sqrt{farms92}  -0.0826(0) + \\
&amp; 0.7214(1)+  1.0100(0)\\
&amp; = -0.9369 + 0.9798 \sqrt{farms92}+ 0.7214 \\
&amp; = -0.2155+ 0.9798 \sqrt{farms92}
\end{split}
\]</span></p>
<p><strong>Interpretation</strong> <span class="math inline">\(\hat{\beta}_3 = 0.7214\)</span> tells us that the mean square root <code>farms92</code> is estimated to be 0.7214 units higher in the <code>S</code> compared to the <code>NC</code> region, holding <code>farms87</code> constant. But the effect of <code>farms87</code> is the same, regardless of region: holding region constant, a one unit increase in the square root of <code>farms87</code> is associated with a 0.9798 unit increase in the mean square root of <code>farms92</code>.</p>
<p>With one quatitative preditor and one categorical predictor, we can visual this data by coloring plot symbols by <code>region</code>. We can also add <strong>parallel</strong> lines that show how <code>farms87</code> is related to <code>farms92</code> in each region. We do this by adding the model’s fitted values (<span class="math inline">\(\hat{y}\)</span>’s) to the augmented data frame and plotting lines, by region, with these fitted values as the y-axis measurement.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb96-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb96-3" title="3"><span class="op">&gt;</span><span class="st"> </span>agstrat.aug &lt;-<span class="st"> </span><span class="kw">augment</span>(farms.lm)</a>
<a class="sourceLine" id="cb96-4" title="4"><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(agstrat.aug)</a>
<a class="sourceLine" id="cb96-5" title="5"><span class="co">## # A tibble: 6 x 10</span></a>
<a class="sourceLine" id="cb96-6" title="6"><span class="co">##   sqrt.farms92. sqrt.farms87. region .fitted .se.fit  .resid    .hat .sigma</span></a>
<a class="sourceLine" id="cb96-7" title="7"><span class="co">##           &lt;dbl&gt;         &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb96-8" title="8"><span class="co">## 1          26.9          29.3 NC        27.7  0.0895 -0.821  0.00977  0.906</span></a>
<a class="sourceLine" id="cb96-9" title="9"><span class="co">## 2          25.7          25.9 NC        24.4  0.0902  1.21   0.00992  0.905</span></a>
<a class="sourceLine" id="cb96-10" title="10"><span class="co">## 3          39.8          41.6 NC        39.9  0.121  -0.0895 0.0178   0.907</span></a>
<a class="sourceLine" id="cb96-11" title="11"><span class="co">## 4          34.1          35.7 NC        34.1  0.100   0.0269 0.0123   0.907</span></a>
<a class="sourceLine" id="cb96-12" title="12"><span class="co">## 5          21.2          22.0 NC        20.6  0.0965  0.569  0.0113   0.907</span></a>
<a class="sourceLine" id="cb96-13" title="13"><span class="co">## 6          24.1          26.4 NC        25.0  0.0898 -0.823  0.00983  0.906</span></a>
<a class="sourceLine" id="cb96-14" title="14"><span class="co">## # ... with 2 more variables: .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb96-15" title="15"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(agstrat.aug,  <span class="kw">aes</span>(<span class="dt">x=</span>sqrt.farms87., <span class="dt">y=</span>sqrt.farms92., <span class="dt">color=</span>region)) <span class="op">+</span></a>
<a class="sourceLine" id="cb96-16" title="16"><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb96-17" title="17"><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="dt">data=</span>agstrat.aug, <span class="kw">aes</span>(<span class="dt">y=</span>.fitted), <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb96-18" title="18"><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Parallel line model&quot;</span>,</a>
<a class="sourceLine" id="cb96-19" title="19"><span class="op">+</span><span class="st">        </span><span class="dt">x=</span><span class="st">&quot;square root of number of farms in 1987&quot;</span>,</a>
<a class="sourceLine" id="cb96-20" title="20"><span class="op">+</span><span class="st">        </span><span class="dt">y=</span><span class="st">&quot;square root of number of farms in 1992&quot;</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-99-1.png" width="672" /></p>
<p>The difference of <span class="math inline">\(\hat{\beta}_3 = 0.7214\)</span> is shown by the fact that the blue South line is always 0.7214 units above the red North Central line for any value of <code>farms87</code>. The small value of <span class="math inline">\(\hat{\beta}_2 = -0.0826\)</span> for the <code>NE</code> indicator show that there is basically no difference between the <code>NE</code> and <code>NC</code> lines, which can be seen by the almost overlapping red and green lines.</p>
</div>
</div>
<div id="interpretation-adding-a-categorical-interaction" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Interpretation: adding a categorical interaction</h3>
<p>What if we thought that the effect of <span class="math inline">\(x_1\)</span> depends on the level of the categorical variable <span class="math inline">\(x_2\)</span>. E.g. What if the slopes for each region in the above scatterplot were allowed different? To create a <strong>separate lines model</strong> we would add the interaction of <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>: <code>lm(y ~ x1 * x2, data)</code>. When <em>adding</em> a categorical <code>x2</code> which has, say levels <code>A</code>, <code>B</code> and <code>C</code>, the basic mean function form looks like:
<span class="math display">\[
\mu(Y \mid x_1, x_2) = \beta_0 + \beta_1 x_1 + \beta_3 LevelB + \beta_4 LevelC + \beta_5 x_1LevelB + \beta_6 x_1LevelC
\]</span>
The mean function for cases where <span class="math inline">\(x_2=A\)</span> sets the indicators for levels <code>B</code> and <code>C</code> <strong>equal to 0</strong>:
<span class="math display">\[
\mu(Y \mid x_1, x_2=A) = \beta_0 + \beta_1 x_1 + \beta_3 (0) + \beta_4 (0) = \beta_0 + \beta_1 x_1 + \beta_5 x_1(0) + \beta_6 x_1(0) =  \beta_0 + \beta_1 x_1
\]</span>
The mean function for cases where <span class="math inline">\(x_2=B\)</span> sets the indicator for level <code>B</code> equalt to 1 and the indicator for level <code>C</code> equal to 0:
<span class="math display">\[
\mu(Y \mid x_1, x_2=B) = \beta_0 + \beta_1 x_1 + \beta_3 (1) + \beta_4 (0)  + \beta_5 x_1(1) + \beta_6 x_1(0) = (\beta_0+ \beta_3) + (\beta_1+\beta_5) x_1 
\]</span>
The mean function for cases where <span class="math inline">\(x_2=C\)</span> sets the indicator for level <code>C</code> equalt to 1 and the indicator for level <code>B</code> equal to 0:
<span class="math display">\[
\mu(Y \mid x_1, x_2=C) = \beta_0 + \beta_1 x_1 + \beta_3 (0) + \beta_4 (1)  + \beta_5 x_1(0) + \beta_6 x_1(1)= (\beta_0+ \beta_4) + (\beta_1+\beta_6) x_1 
\]</span></p>
<p>Interpretation of indicator effects:</p>
<ul>
<li><span class="math inline">\(\beta_3\)</span> is the difference between <span class="math inline">\(\mu(Y \mid x_1=0, x_2=B)\)</span> and <span class="math inline">\(\mu(Y \mid x_1=0, x_2=A)\)</span> at the intercept where <span class="math inline">\(x_1=0\)</span>.</li>
<li><span class="math inline">\(\beta_4\)</span> is the difference between <span class="math inline">\(\mu(Y \mid x_1=0, x_2=C)\)</span> and <span class="math inline">\(\mu(Y \mid x_1=0, x_2=A)\)</span> at the intercept where <span class="math inline">\(x_1=0\)</span>.</li>
<li><span class="math inline">\(\beta_1\)</span> is the effect of <span class="math inline">\(x_1\)</span> when <span class="math inline">\(x_2 = A\)</span> (level A)</li>
<li><span class="math inline">\(\beta_1+\beta_5\)</span> is the effect of <span class="math inline">\(x_1\)</span> when <span class="math inline">\(x_2 = B\)</span> (level B)</li>
<li><span class="math inline">\(\beta_5\)</span> measures how much more or less the effect of <span class="math inline">\(x_1\)</span> is in level B compared to level A (difference in slopes of the two lines)</li>
<li><span class="math inline">\(\beta_1+\beta_6\)</span> is the effect of <span class="math inline">\(x_1\)</span> when <span class="math inline">\(x_2 = C\)</span> (level C)</li>
<li><span class="math inline">\(\beta_6\)</span> measures how much more or less the effect of <span class="math inline">\(x_1\)</span> is in level C compared to level A (difference in slopes of the two lines)</li>
</ul>
<div id="mlr-sleep1" class="section level4">
<h4><span class="header-section-number">3.4.2.1</span> Example: Sleep</h4>
<p>This data <code>sleep</code> contains information on the sleep and physical characteristics of 62 species of mammals. Our goal is to see how the total amount of sleep (hours) that an animal gets in 24 hours is related to its body weight (kg) and the amount of danger (low danger to high danger) to which it is exposed.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://math.carleton.edu/kstclair/data/sleep.csv&quot;</span>)</a>
<a class="sourceLine" id="cb97-2" title="2"><span class="op">&gt;</span><span class="st"> </span>sleep <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(TS, BodyWt, D) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()</a>
<a class="sourceLine" id="cb97-3" title="3"><span class="co">##        TS            BodyWt               D        </span></a>
<a class="sourceLine" id="cb97-4" title="4"><span class="co">##  Min.   : 2.60   Min.   :   0.005   Min.   :1.000  </span></a>
<a class="sourceLine" id="cb97-5" title="5"><span class="co">##  1st Qu.: 8.05   1st Qu.:   0.600   1st Qu.:1.000  </span></a>
<a class="sourceLine" id="cb97-6" title="6"><span class="co">##  Median :10.45   Median :   3.342   Median :2.000  </span></a>
<a class="sourceLine" id="cb97-7" title="7"><span class="co">##  Mean   :10.53   Mean   : 198.790   Mean   :2.613  </span></a>
<a class="sourceLine" id="cb97-8" title="8"><span class="co">##  3rd Qu.:13.20   3rd Qu.:  48.203   3rd Qu.:4.000  </span></a>
<a class="sourceLine" id="cb97-9" title="9"><span class="co">##  Max.   :19.90   Max.   :6654.000   Max.   :5.000  </span></a>
<a class="sourceLine" id="cb97-10" title="10"><span class="co">##  NA&#39;s   :4</span></a></code></pre></div>
<p>Our EDA above shows that danger level<code>D</code> is numerically coded, with a “1” indicating very low danger level up to “5” indicating very high danger. If we used this version in our model that forces a linear relationship, which means a constant change in TS for each bump up in danger level, which is a strong assumption to make given the categorical nature of this variable. Plus, this constant rate of change does not look to be the case based on EDA:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">boxplot</span>(TS <span class="op">~</span><span class="st"> </span>D, <span class="dt">data=</span>sleep)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
<p>We must make a factor version of this variable to correctly use it in our model. We will use the <code>fct_recode</code> command from the <code>forcats</code> package:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(sleep<span class="op">$</span>D)   <span class="co"># EDA counts for each level</span></a>
<a class="sourceLine" id="cb99-2" title="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb99-3" title="3"><span class="co">##  1  2  3  4  5 </span></a>
<a class="sourceLine" id="cb99-4" title="4"><span class="co">## 19 14 10 10  9</span></a>
<a class="sourceLine" id="cb99-5" title="5"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(forcats)</a>
<a class="sourceLine" id="cb99-6" title="6"><span class="op">&gt;</span><span class="st"> </span>sleep<span class="op">$</span>danger &lt;-<span class="st"> </span><span class="kw">fct_recode</span>(<span class="kw">factor</span>(sleep<span class="op">$</span>D), </a>
<a class="sourceLine" id="cb99-7" title="7"><span class="op">+</span><span class="st">                               &quot;very low&quot;</span> =<span class="st"> &quot;1&quot;</span>,</a>
<a class="sourceLine" id="cb99-8" title="8"><span class="op">+</span><span class="st">                               &quot;low&quot;</span> =<span class="st"> &quot;2&quot;</span>,</a>
<a class="sourceLine" id="cb99-9" title="9"><span class="op">+</span><span class="st">                               &quot;moderate&quot;</span> =<span class="st"> &quot;3&quot;</span>,</a>
<a class="sourceLine" id="cb99-10" title="10"><span class="op">+</span><span class="st">                               &quot;high&quot;</span> =<span class="st"> &quot;4&quot;</span>,</a>
<a class="sourceLine" id="cb99-11" title="11"><span class="op">+</span><span class="st">                               &quot;very high&quot;</span> =<span class="st"> &quot;5&quot;</span>)</a>
<a class="sourceLine" id="cb99-12" title="12"><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(sleep<span class="op">$</span>danger)   <span class="co"># check that we recoded correctly</span></a>
<a class="sourceLine" id="cb99-13" title="13"><span class="co">## </span></a>
<a class="sourceLine" id="cb99-14" title="14"><span class="co">##  very low       low  moderate      high very high </span></a>
<a class="sourceLine" id="cb99-15" title="15"><span class="co">##        19        14        10        10         9</span></a>
<a class="sourceLine" id="cb99-16" title="16"><span class="op">&gt;</span><span class="st"> </span><span class="kw">levels</span>(sleep<span class="op">$</span>danger)   <span class="co"># very low is the first=baseline level</span></a>
<a class="sourceLine" id="cb99-17" title="17"><span class="co">## [1] &quot;very low&quot;  &quot;low&quot;       &quot;moderate&quot;  &quot;high&quot;      &quot;very high&quot;</span></a></code></pre></div>
<p>Always do an EDA check (here, checking counts) when manipulating or recoding a variable. Our <code>factor</code> variable <code>danger</code>’s first level is <code>very low</code> which will be the baseline level for any model fit in R.</p>
<p>When we add <code>lm</code> lines to a scatterplot with color coded points, then <code>ggplot</code> will fit <strong>separate lines</strong> for each color. Here we plot <code>TS</code> (total sleep) against the logged version of <code>BodyWt</code> since we don’t have a linear relationship on the untransformed scale.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb100-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(sleep, <span class="kw">aes</span>(<span class="dt">x=</span>BodyWt, <span class="dt">y=</span>TS, <span class="dt">color=</span>danger)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb100-3" title="3"><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb100-4" title="4"><span class="op">+</span><span class="st">   </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb100-5" title="5"><span class="op">+</span><span class="st">   </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb100-6" title="6"><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;daily sleep vs. body weight by danger level&quot;</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-103-1.png" width="672" /></p>
<p>This plot suggests that there may be an interaction between <code>danger</code> and <code>BodyWt</code> since the <code>lm</code> lines have some variation in slope across danger levels. The model we will fit has ten parameters ($_0-_9) due to the four indicator variables that are also interacted with body weight:</p>
<p><span class="math display">\[\begin{split}
\mu(TS \mid body, danger) &amp;= \beta_0 + \beta_1 \log(body) + \beta_2 low + \beta_3 moderate + \beta_4 high + \\ 
&amp; \beta_5 veryhigh  + \beta_6 \log(body)low + \beta_7 \log(body)moderate + \\ 
&amp; \beta_8 \log(body)high + \beta_9 \log(body)veryhigh
\end{split}
\]</span></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(TS <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt)<span class="op">*</span>danger, <span class="dt">data=</span>sleep)</a>
<a class="sourceLine" id="cb101-2" title="2"><span class="op">&gt;</span><span class="st"> </span>sleep.lm</a>
<a class="sourceLine" id="cb101-3" title="3"><span class="co">## </span></a>
<a class="sourceLine" id="cb101-4" title="4"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb101-5" title="5"><span class="co">## lm(formula = TS ~ log(BodyWt) * danger, data = sleep)</span></a>
<a class="sourceLine" id="cb101-6" title="6"><span class="co">## </span></a>
<a class="sourceLine" id="cb101-7" title="7"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb101-8" title="8"><span class="co">##                 (Intercept)                  log(BodyWt)  </span></a>
<a class="sourceLine" id="cb101-9" title="9"><span class="co">##                    13.86818                     -0.58104  </span></a>
<a class="sourceLine" id="cb101-10" title="10"><span class="co">##                   dangerlow               dangermoderate  </span></a>
<a class="sourceLine" id="cb101-11" title="11"><span class="co">##                    -2.35924                     -3.50087  </span></a>
<a class="sourceLine" id="cb101-12" title="12"><span class="co">##                  dangerhigh              dangervery high  </span></a>
<a class="sourceLine" id="cb101-13" title="13"><span class="co">##                    -4.22738                     -7.03108  </span></a>
<a class="sourceLine" id="cb101-14" title="14"><span class="co">##       log(BodyWt):dangerlow   log(BodyWt):dangermoderate  </span></a>
<a class="sourceLine" id="cb101-15" title="15"><span class="co">##                    -0.03446                     -0.34437  </span></a>
<a class="sourceLine" id="cb101-16" title="16"><span class="co">##      log(BodyWt):dangerhigh  log(BodyWt):dangervery high  </span></a>
<a class="sourceLine" id="cb101-17" title="17"><span class="co">##                     0.16966                     -0.09638</span></a></code></pre></div>
<p>The estimated mean function is
<span class="math display">\[\begin{split}
\mu(TS \mid body, danger) &amp;= 13.868 -0.581 \log(body)-2.359 low -3.501 moderate -4.227 high - \\ 
&amp; 7.031 veryhigh  -0.034 \log(body)low -0.344\log(body)moderate + \\ 
&amp; 0.170 \log(body)high -0.096 \log(body)veryhigh
\end{split}
\]</span></p>
<p>There are many parameters to interpret, so here are a few examples:</p>
<ul>
<li><p><span class="math inline">\(\beta_1\)</span> is the effect of body weight for species in the “very low” danger level. To see this, write out the mean functions for the two levels. For very low level:
<span class="math display">\[\begin{split}
\mu(TS \mid body, danger=verylow) &amp;= \beta_0 + \beta_1 \log(body) + \beta_2 (0) + \beta_3 (0) + \beta_4 (0) + \beta_5 (0) \\
&amp; + \beta_6 \log(body)(0) + \beta_7 \log(body)(0) + \beta_8 \log(body)(0) + \beta_9 \log(body)(0) \\
&amp; = \beta_0 + \beta_1 \log(body) 
\end{split}\]</span></p></li>
<li><p><span class="math inline">\(\beta_9\)</span> tells us how the effect of body weight differs for the very low and very high danger levels. Compare the mean response for very low to the mean response for the very high level:
<span class="math display">\[\begin{split}
\mu(TS \mid body, danger=veryhigh) &amp;= \beta_0 + \beta_1 \log(body) + \beta_2 (0) + \beta_3 (0) + \beta_4 (0) + \beta_5 (1) \\
&amp; + \beta_6 \log(body)(0) + \beta_7 \log(body)(0) + \beta_8 \log(body)(0) + \beta_9 \log(body)(1) \\
&amp; = (\beta_0 + \beta_5) + (\beta_1 + \beta_9) \log(body) 
\end{split}\]</span>
In the “very low” model, <span class="math inline">\(\beta_1\)</span> measures the effect of body weight on mean sleep while in the “very high” model, <span class="math inline">\(\beta_1 + \beta_9\)</span> measures this effect. So the parameter <span class="math inline">\(\beta_9\)</span> tells us how this effect differs for the two danger levels. The small estimated value <span class="math inline">\(\hat{\beta}_9 = -0.096\)</span>, along with the separate lines scatterplot, suggest little difference in the effect of body weight in these two danger groups.</p></li>
<li><p>The parameter function <span class="math inline">\(\beta_5 + \beta_9 \log(body)\)</span> tells us the difference in total sleep between the very high and very low danger levels at a given value of body weight. Recall that in this interaction model, the effect of danger should depend on the value of body weight. For example, for animals that are 1kg in weight, the parameter <span class="math inline">\(\beta_5 + \beta_9\log(1) = \beta_5\)</span> measures the difference in mean total sleep for the very high and very low levels. The estimated parameter value of <span class="math inline">\(\hat{\beta}_5 = -7.031\)</span> and the large difference shown in the scatterplot suggest that for 1 kg animals, that the average total sleep for animals with very high danger is about 7 hours less than for animals in very low danger.</p></li>
<li><p>To determine if the effect of body weight on mean total sleep differs for “high” and “moderate” levels of danger, we would test the hypotheses
<span class="math display">\[
H_0: \beta_8 = \beta_7 \ \ \ \ vs. \ \ \ \ H_A: \beta_8 \neq \beta_7
\]</span>
Again, write down the mean equations for these two levels. For “high” all dummy variables equal 0 expect <code>high</code> equals 1:
<span class="math display">\[\begin{split}
\mu(TS \mid body, danger=high) &amp;= \beta_0 + \beta_1 \log(body) + \beta_2 (0) + \beta_3 (0) + \beta_4 (1) + \beta_5 (0) \\
&amp; + \beta_6 \log(body)(0) + \beta_7 \log(body)(0) + \beta_8 \log(body)(1) + \beta_9 \log(body)(0) \\
&amp; = (\beta_0 + \beta_4) + (\beta_1 + \beta_8) \log(body) 
\end{split}
\]</span>
for “moderate” all dummy variables equal 0 expect <code>moderate</code> equals 1.
<span class="math display">\[\begin{split}
\mu(TS \mid body, danger=moderate) &amp;= \beta_0 + \beta_1 \log(body) + \beta_2 (0) + \beta_3 (1) + \beta_4 (0) + \beta_5 (0) \\
&amp; + \beta_6 \log(body)(0) + \beta_7 \log(body)(1) + \beta_8 \log(body)(0) + \beta_9 \log(body)(0) \\
&amp; = (\beta_0 + \beta_3) + (\beta_1 + \beta_7) \log(body) 
\end{split}\]</span>
In the “high” model, <span class="math inline">\(\beta_1 + \beta_8\)</span> measures the effect of body weight on mean sleep while in the “moderate” model, <span class="math inline">\(\beta_1 + \beta_7\)</span> measures this effect. Our null hypothesis would state that these two effects are equal:
<span class="math display">\[
H_0: \beta_1 + \beta_8 = \beta_1 + \beta_7
\]</span>
which simplifies to the hypothesis given above.</p></li>
</ul>
</div>
</div>
</div>
<div id="mlr-inf" class="section level2">
<h2><span class="header-section-number">3.5</span> Inference for MLR</h2>
<p>Inference methods for <em>individual</em> <span class="math inline">\(\beta\)</span>-parameters, the mean function <span class="math inline">\(\mu\)</span> and predictions are all very similar to the inference methods outlined for SLR models in Sections <a href="slr.html#slr-inf">2.5</a> and <a href="slr.html#slr-inf2">2.6</a>. The biggest difference is that we now use a t-distribution with <strong>degrees of freedom equal to <span class="math inline">\(\pmb{n-(p+1)}\)</span></strong> where <span class="math inline">\(p+1\)</span> is equal to the number of <span class="math inline">\(\beta\)</span>’s in the mean function.</p>
<p>To review:</p>
<ul>
<li><p><strong>Confidence Intervals for <span class="math inline">\(\pmb{\beta}_i\)</span>:</strong> A <span class="math inline">\(C\)</span>% confidence for <span class="math inline">\(\beta_i\)</span> has the form:
<span class="math display">\[
\hat{\beta}_i \pm t^* SE(\hat{\beta}_i)
\]</span>
where <span class="math inline">\(t^*\)</span> is the <span class="math inline">\((100-C)/2\)</span> percentile from the t-distribution with <span class="math inline">\(df=n-(p+1)\)</span> degrees of freedom.</p></li>
<li><p><strong>Hypothesis tests</strong> We can test the hypothesis
<span class="math display">\[
H_0: \beta_i =  0  \ \ \ \ vs. \ \ \ \ H_A: \beta_i \neq  0 
\]</span>
with the following t-test statistic:
<span class="math display">\[
t =\dfrac{\hat{\beta}_i - 0}{SE(\hat{\beta}_i)}
\]</span>
The t-distribution with <span class="math inline">\(n-(p+1)\)</span> degrees of freedom is used to compute the p-value that is appropriate for whatever <span class="math inline">\(H_A\)</span> is specified. <strong>Interpretation of results:</strong> Recall the general interpretation for the planar model: <span class="math inline">\(\beta_i\)</span> is the effect of a one unit increase in <span class="math inline">\(x_i\)</span>, holding all other predictors constant. <strong>Testing <span class="math inline">\(\pmb{\beta}_i =0\)</span></strong> is the same as asking: <strong>Is the observed effect of <span class="math inline">\(x_i\)</span> on <span class="math inline">\(\mu\)</span> statistically significant after accounting for all other terms in the model?</strong> For this reason, an individual t-test is only good for determing if <span class="math inline">\(x_i\)</span> is needed in a model that contains <strong>all other terms</strong>. If you want to test the significance of <strong>multiple</strong> predictors at once, you need to conduct an F-test using ANOVA (Section <a href="mlr.html#mlr-anova">3.6</a>.</p></li>
<li><p><strong>Inference for <span class="math inline">\(\pmb{\mu(Y \mid X_0)}\)</span> and <span class="math inline">\(\pmb{pred(Y \mid X_0)}\)</span>:</strong> Confidence and prediction intervals calculations are very similar to SLR in Section <a href="mlr.html#mlr-inf2">3.5.1</a>, except for the change in the degrees of freedom and a slightly more complex form for the SE of the estimated mean response <span class="math inline">\(SE(\hat{\mu}(Y \mid X_0))\)</span> which now involves more than one predictor.</p></li>
</ul>
<div id="mlr-inf2" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Inference for a linear combination of <span class="math inline">\(\beta\)</span>’s</h3>
<p>One new inference method which is sometimes needed in MLR models, is to make inferences about a <strong>linear combination</strong> of <span class="math inline">\(\beta_i\)</span>’s. A linear combination is of the form:
<span class="math display">\[
\gamma = c_i \beta_i + c_j \beta_j
\]</span>
where <span class="math inline">\(c_i\)</span> and <span class="math inline">\(c_j\)</span> are known numbers.</p>
<p>Some examples of a linear combination include:</p>
<ul>
<li><p>Suppose we fit the quadratic model in Section <a href="mlr.html#mlr-quad">3.2.1.2</a> and want to estimate the change in the mean response for a change in <span class="math inline">\(x_1\)</span> from 9 to 10. This change is measured by the parameter
<span class="math display">\[
\gamma = \beta_1 + \beta_2(2\times 9+1) =  \beta_1 + 19\beta_2
\]</span>
so <span class="math inline">\(c_1 = 1\)</span> and <span class="math inline">\(c_2 = 19\)</span>.</p></li>
<li><p>Suppose we fit the interaction model in Section <a href="mlr.html#mlr-int">3.2.1.3</a> and want to estimate the change in the mean response for a 1 unit increase in <span class="math inline">\(x_1\)</span>, holding <span class="math inline">\(x_2\)</span> constant at the value of -5. This change is measured by the parameter
<span class="math display">\[
\gamma = \beta_1 + \beta_3 (-5) = \beta_1 -5 \beta_3
\]</span>
so <span class="math inline">\(c_1 = 1\)</span> and <span class="math inline">\(c_3 = -5\)</span>.</p></li>
</ul>
<p>Any inference for this new <span class="math inline">\(\gamma\)</span> parameter will rely on an estimate, <span class="math inline">\(\hat{\gamma}\)</span> and standard error <span class="math inline">\(SE(\hat{\gamma})\)</span>.</p>
<ul>
<li><strong>Estimation:</strong> Just plug in our <span class="math inline">\(\beta\)</span> estimates!
<span class="math display">\[
\hat{\gamma} = c_i \hat{\beta}_i + c_j \hat{\beta}_j
\]</span></li>
<li><strong>SE:</strong> This is more complex of a calculation because the estimates <span class="math inline">\(\hat{\beta}_i\)</span> and <span class="math inline">\(\hat{\beta}_i\)</span> are <strong>correlated</strong>. We can see this for <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span> in the SLR simulation in Section <a href="slr.html#slr-simcor">2.4.4</a>. We use probabilities rules for the linear combination of two correlated random variables to derive our SE as
<span class="math display">\[
SE(\hat{\gamma}) = \sqrt{c^2_i Var(\hat{\beta}_i) + c^2_j Var(\hat{\beta}_j) + 2c_i c_j Cov(\hat{\beta}_i, \hat{\beta}_j) }
\]</span>
The variances (<span class="math inline">\(Var\)</span>) values are the squared SE’s for each estimate, e.g. <span class="math inline">\(Var(\hat{\beta}_i) = SE(\hat{\beta}_i)^2\)</span>. The covariance (<span class="math inline">\(Cov\)</span>) value measures how the two estiamtes co-vary together over many, many samples from the populations (just like SE tells us how each estimate varies by itself). Positive values of covariance means the two estimates are positively correlated, negative means negatively correlated. The magnitude of the covariance is a function of each estimate’s SE. In R, we will get these variance and covariance values from a MLR model’s estimated <strong>covariance matrix</strong>, which for a MLR planar model with two predictors will look like a 3x3 matrix with variance values on the diagonal and covariance values on the off-diagonals:
<span class="math display">\[
\begin{pmatrix}
Var(\hat{\beta}_0) &amp; Cov(\hat{\beta}_0, \hat{\beta}_1) &amp; Cov(\hat{\beta}_0, \hat{\beta}_2) \\
Cov(\hat{\beta}_1, \hat{\beta}_0) &amp; Var(\hat{\beta}_1)&amp; Cov(\hat{\beta}_1, \hat{\beta}_2) \\
Cov(\hat{\beta}_2, \hat{\beta}_0)&amp; Cov(\hat{\beta}_2, \hat{\beta}_1)&amp; Var(\hat{\beta}_2)
\end{pmatrix}  
\]</span>
Note that covariance is symmetric so that <span class="math inline">\(Cov(\hat{\beta}_i, \hat{\beta}_j) = Cov(\hat{\beta}_j, \hat{\beta}_i)\)</span>.</li>
</ul>
<p>Inference for <span class="math inline">\(\gamma\)</span> then looks like:</p>
<ul>
<li><strong>Confidence interval for <span class="math inline">\(\pmb{\gamma}\)</span>:</strong> <span class="math inline">\(\hat{\gamma} \pm t^*_{df} SE(\hat{\gamma})\)</span></li>
<li><strong>Hypothesis test for <span class="math inline">\(\pmb{H_0: \gamma = \gamma^*}\)</span>:</strong> uses the test statistic
<span class="math display">\[
t = \dfrac{\hat{\gamma} - \gamma^*}{SE(\hat{\gamma})}
\]</span>
and a p-value from a t-distribution with model degrees of freedom.</li>
</ul>
</div>
<div id="mlr-agstrat2" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Example: Agstrat</h3>
<p>Let’s continue with inference for the parallel lines model for modeling the number of farms in 1992 as a function of region and number of farms in 1987 (Section <a href="mlr.html#mlr-agstrat1">3.4.1.1</a>). The mean model form is</p>
<p><span class="math display">\[
\begin{split}
\mu(\sqrt{farms92} \mid \sqrt{farms92}, region) &amp;  = \beta_0 + \beta_1 \sqrt{farms92}  + \beta_2(regionNE) + \\
&amp;  \beta_3(regionS) + \beta_4(regionW)
\end{split}
\]</span></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1"><span class="op">&gt;</span><span class="st"> </span>agstrat&lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://people.carleton.edu/~kstclair/data/agstrat.csv&quot;</span>)</a>
<a class="sourceLine" id="cb102-2" title="2"><span class="op">&gt;</span><span class="st"> </span>farms.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">sqrt</span>(farms92) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(farms87) <span class="op">+</span><span class="st"> </span>region, <span class="dt">data=</span>agstrat)</a>
<a class="sourceLine" id="cb102-3" title="3"><span class="op">&gt;</span><span class="st"> </span><span class="kw">kable</span>(<span class="kw">tidy</span>(farms.lm, <span class="dt">conf.int=</span><span class="ot">TRUE</span>), <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-0.937</td>
<td align="right">0.191</td>
<td align="right">-4.905</td>
<td align="right">0.000</td>
<td align="right">-1.313</td>
<td align="right">-0.561</td>
</tr>
<tr class="even">
<td align="left">sqrt(farms87)</td>
<td align="right">0.980</td>
<td align="right">0.006</td>
<td align="right">162.869</td>
<td align="right">0.000</td>
<td align="right">0.968</td>
<td align="right">0.992</td>
</tr>
<tr class="odd">
<td align="left">regionNE</td>
<td align="right">-0.083</td>
<td align="right">0.219</td>
<td align="right">-0.377</td>
<td align="right">0.706</td>
<td align="right">-0.514</td>
<td align="right">0.349</td>
</tr>
<tr class="even">
<td align="left">regionS</td>
<td align="right">0.721</td>
<td align="right">0.123</td>
<td align="right">5.884</td>
<td align="right">0.000</td>
<td align="right">0.480</td>
<td align="right">0.963</td>
</tr>
<tr class="odd">
<td align="left">regionW</td>
<td align="right">1.010</td>
<td align="right">0.170</td>
<td align="right">5.933</td>
<td align="right">0.000</td>
<td align="right">0.675</td>
<td align="right">1.345</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Compare S to NC</strong>: <span class="math inline">\(\hat{\beta}_3 = 0.721\)</span> tells us that the mean square root <code>farms92</code> is estimated to be 0.721 units higher in the <code>S</code> compared to the <code>NC</code> region, holding <code>farms87</code> constant. The t-test results in the summary output test <span class="math inline">\(H_0: \beta_3 = 0\)</span>, which has a t-test statistic of <span class="math inline">\(t = 0.721/0.123 = 5.884\)</span> which gives a p-value that is less than 0.001. <strong>Interpretation:</strong> Holding all other model terms constant (including other indicators for W and NE), there is a statistically significant difference between the mean number of farms in 1992 between South and North Central regions for any given value of farms in 1987. I am 95% confident that the average square root of farms in 1992 is anywhere from 0.48 to 0.963 units higher in the south than in the north central regions, holding the number of farms in 1987 fixed.</p></li>
<li><p><strong>Compare NE to NC</strong>: <span class="math inline">\(\hat{\beta}_2 = -0.083\)</span> tells us that the mean square root <code>farms92</code> is estimated to be 0.083 units lower in the <code>NE</code> compared to the <code>NC</code> region, holding <code>farms87</code> constant. The t-test results in the summary output test <span class="math inline">\(H_0: \beta_2 = 0\)</span>, which has a t-test statistic of <span class="math inline">\(t = -0.377\)</span> which gives a p-value that is 0.706. <strong>Interpretation:</strong> Holding all other model terms constant (including other indicators for S and W), there is no statistically significant difference between the mean number of farms in 1992 between Northeast and North Central regions for any given value of farms in 1987.</p></li>
<li><p><strong>Compare S to W</strong>: In the parallel line model, we would like to know if there is a difference in the mean number of farms in 1992 in the S and W regions, after controlling for the number of farms in 1987. The question can be answered by comparing
<span class="math display">\[
\mu(farms92 \mid farms87, region=S) - \mu(farms92 \mid farms87, region=W) = \beta_3 - \beta_4
\]</span>
The hypotheses are then
<span class="math display">\[
H_0: \beta_3 - \beta_4 = 0 \ \ vs. \ \ H_A: \beta_3 - \beta_4 \neq 0
\]</span>
Note that this is <strong>not</strong> the same as asking if each parameter <strong>equals 0</strong>. We just want to know if they are the same value, so we cannot use a t-test given in the summary output. This is a question about a <strong>linear combination</strong> of parameters:
<span class="math display">\[
\gamma = \beta_3 - \beta_4
\]</span>
where <span class="math inline">\(c_3 = 1\)</span> and <span class="math inline">\(c_4 = -1\)</span>. Our estimated parameter difference is
<span class="math display">\[
\hat{\gamma} = \hat{\beta}_3 - \hat{\beta}_4 = 0.7214 - 1.0100 = -0.2886
\]</span></p></li>
</ul>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1"><span class="op">&gt;</span><span class="st"> </span>farms.lm</a>
<a class="sourceLine" id="cb103-2" title="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb103-3" title="3"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb103-4" title="4"><span class="co">## lm(formula = sqrt(farms92) ~ sqrt(farms87) + region, data = agstrat)</span></a>
<a class="sourceLine" id="cb103-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb103-6" title="6"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb103-7" title="7"><span class="co">##   (Intercept)  sqrt(farms87)       regionNE        regionS        regionW  </span></a>
<a class="sourceLine" id="cb103-8" title="8"><span class="co">##       -0.9369         0.9798        -0.0826         0.7214         1.0100</span></a>
<a class="sourceLine" id="cb103-9" title="9"><span class="op">&gt;</span><span class="st"> </span><span class="co"># estimate of beta3 - beta4 (do S and W lines have same intercepts?)</span></a>
<a class="sourceLine" id="cb103-10" title="10"><span class="er">&gt;</span><span class="st"> </span>est &lt;-<span class="st"> </span><span class="fl">0.7214</span> <span class="op">-</span><span class="st"> </span><span class="fl">1.0100</span></a>
<a class="sourceLine" id="cb103-11" title="11"><span class="op">&gt;</span><span class="st"> </span>est</a>
<a class="sourceLine" id="cb103-12" title="12"><span class="co">## [1] -0.2886</span></a></code></pre></div>
<p>We use the <code>vcov(my.lm)</code> command to get the estimated model’s covariance matrix:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">vcov</span>(farms.lm)</a>
<a class="sourceLine" id="cb104-2" title="2"><span class="co">##                (Intercept) sqrt(farms87)      regionNE      regionS</span></a>
<a class="sourceLine" id="cb104-3" title="3"><span class="co">## (Intercept)    0.036481631 -1.015899e-03 -0.0132540419 -0.013273838</span></a>
<a class="sourceLine" id="cb104-4" title="4"><span class="co">## sqrt(farms87) -0.001015899  3.619176e-05  0.0001884077  0.000189113</span></a>
<a class="sourceLine" id="cb104-5" title="5"><span class="co">## regionNE      -0.013254042  1.884077e-04  0.0480149402  0.008949944</span></a>
<a class="sourceLine" id="cb104-6" title="6"><span class="co">## regionS       -0.013273838  1.891130e-04  0.0089499443  0.015030978</span></a>
<a class="sourceLine" id="cb104-7" title="7"><span class="co">## regionW       -0.013332531  1.912040e-04  0.0089608296  0.008964555</span></a>
<a class="sourceLine" id="cb104-8" title="8"><span class="co">##                    regionW</span></a>
<a class="sourceLine" id="cb104-9" title="9"><span class="co">## (Intercept)   -0.013332531</span></a>
<a class="sourceLine" id="cb104-10" title="10"><span class="co">## sqrt(farms87)  0.000191204</span></a>
<a class="sourceLine" id="cb104-11" title="11"><span class="co">## regionNE       0.008960830</span></a>
<a class="sourceLine" id="cb104-12" title="12"><span class="co">## regionS        0.008964555</span></a>
<a class="sourceLine" id="cb104-13" title="13"><span class="co">## regionW        0.028986383</span></a></code></pre></div>
<p>The parts we need are <span class="math inline">\(Var(\hat{\beta}_3) = 0.015030978\)</span>, <span class="math inline">\(Var(\hat{\beta}_4) = 0.028986383\)</span>, and <span class="math inline">\(Cov(\hat{\beta}_3, \hat{\beta}_4) = 0.008964555\)</span>. The SE of our estimated difference is then
<span class="math display">\[
SE(\hat{\gamma}) = \sqrt{(1)^20.015030978 + (-1)^20.028986383 + 2(1)(-1)0.008964555} = 0.1615186
\]</span></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="co"># SE of this estimate</span></a>
<a class="sourceLine" id="cb105-2" title="2"><span class="er">&gt;</span><span class="st"> </span>se.est &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="fl">0.015030978</span> <span class="op">+</span><span class="st"> </span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span><span class="op">*</span><span class="fl">0.028986383</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="fl">0.008964555</span>)</a>
<a class="sourceLine" id="cb105-3" title="3"><span class="op">&gt;</span><span class="st"> </span>se.est</a>
<a class="sourceLine" id="cb105-4" title="4"><span class="co">## [1] 0.1615186</span></a></code></pre></div>
<p>The test statistic is then <span class="math inline">\(t = (-0.2886 - 0)/0.1615186 = -1.786791\)</span> which yields a 2-sided p-value of 0.075. This suggests that there is moderately weak evidence that there is a difference in means between the south and west, holding farms in 1987 fixed, but it is not statistically significant at the 5% level.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="co"># test stat</span></a>
<a class="sourceLine" id="cb106-2" title="2"><span class="er">&gt;</span><span class="st"> </span>t &lt;-<span class="st"> </span>(est <span class="op">-</span><span class="st"> </span><span class="dv">0</span>)<span class="op">/</span>se.est</a>
<a class="sourceLine" id="cb106-3" title="3"><span class="op">&gt;</span><span class="st"> </span>t</a>
<a class="sourceLine" id="cb106-4" title="4"><span class="co">## [1] -1.786791</span></a>
<a class="sourceLine" id="cb106-5" title="5"><span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span><span class="kw">pt</span>(t,<span class="dt">df=</span><span class="dv">295</span>)</a>
<a class="sourceLine" id="cb106-6" title="6"><span class="co">## [1] 0.07499793</span></a></code></pre></div>
</div>
<div id="mlr-sleep2" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Example: Sleep</h3>
<p>Let’s continue with inference for the separate lines model for modeling the amount of daily sleep for variety of animals as a function of their body size and danger level (Section <a href="mlr.html#mlr-sleep1">3.4.2.1</a>). The interaction model looks liked
<span class="math display">\[\begin{split}
\mu(TS \mid body, danger) &amp;= \beta_0 + \beta_1 \log(body) + \beta_2 low + \beta_3 moderate + \beta_4 high + \\ 
&amp; \beta_5 veryhigh  + \beta_6 \log(body)low + \beta_7 \log(body)moderate + \\ 
&amp; \beta_8 \log(body)high + \beta_9 \log(body)veryhigh
\end{split}
\]</span></p>
<p>The estimated model parameters from the model fit in Section <a href="mlr.html#mlr-sleep1">3.4.2.1</a> is</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(sleep.lm)</a>
<a class="sourceLine" id="cb107-2" title="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb107-3" title="3"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb107-4" title="4"><span class="co">## lm(formula = TS ~ log(BodyWt) * danger, data = sleep)</span></a>
<a class="sourceLine" id="cb107-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb107-6" title="6"><span class="co">## Residuals:</span></a>
<a class="sourceLine" id="cb107-7" title="7"><span class="co">##     Min      1Q  Median      3Q     Max </span></a>
<a class="sourceLine" id="cb107-8" title="8"><span class="co">## -7.5685 -2.0181 -0.2475  1.7083  6.6108 </span></a>
<a class="sourceLine" id="cb107-9" title="9"><span class="co">## </span></a>
<a class="sourceLine" id="cb107-10" title="10"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb107-11" title="11"><span class="co">##                             Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb107-12" title="12"><span class="co">## (Intercept)                 13.86818    0.89109  15.563   &lt;2e-16 ***</span></a>
<a class="sourceLine" id="cb107-13" title="13"><span class="co">## log(BodyWt)                 -0.58104    0.27659  -2.101   0.0409 *  </span></a>
<a class="sourceLine" id="cb107-14" title="14"><span class="co">## dangerlow                   -2.35924    1.30538  -1.807   0.0770 .  </span></a>
<a class="sourceLine" id="cb107-15" title="15"><span class="co">## dangermoderate              -3.50087    1.40445  -2.493   0.0162 *  </span></a>
<a class="sourceLine" id="cb107-16" title="16"><span class="co">## dangerhigh                  -4.22738    1.58186  -2.672   0.0103 *  </span></a>
<a class="sourceLine" id="cb107-17" title="17"><span class="co">## dangervery high             -7.03108    3.32910  -2.112   0.0399 *  </span></a>
<a class="sourceLine" id="cb107-18" title="18"><span class="co">## log(BodyWt):dangerlow       -0.03446    0.72333  -0.048   0.9622    </span></a>
<a class="sourceLine" id="cb107-19" title="19"><span class="co">## log(BodyWt):dangermoderate  -0.34437    0.42848  -0.804   0.4255    </span></a>
<a class="sourceLine" id="cb107-20" title="20"><span class="co">## log(BodyWt):dangerhigh       0.16966    0.41793   0.406   0.6866    </span></a>
<a class="sourceLine" id="cb107-21" title="21"><span class="co">## log(BodyWt):dangervery high -0.09638    0.76994  -0.125   0.9009    </span></a>
<a class="sourceLine" id="cb107-22" title="22"><span class="co">## ---</span></a>
<a class="sourceLine" id="cb107-23" title="23"><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb107-24" title="24"><span class="co">## </span></a>
<a class="sourceLine" id="cb107-25" title="25"><span class="co">## Residual standard error: 3.432 on 48 degrees of freedom</span></a>
<a class="sourceLine" id="cb107-26" title="26"><span class="co">##   (4 observations deleted due to missingness)</span></a>
<a class="sourceLine" id="cb107-27" title="27"><span class="co">## Multiple R-squared:  0.5326, Adjusted R-squared:  0.4449 </span></a>
<a class="sourceLine" id="cb107-28" title="28"><span class="co">## F-statistic: 6.076 on 9 and 48 DF,  p-value: 1.177e-05</span></a>
<a class="sourceLine" id="cb107-29" title="29"><span class="op">&gt;</span><span class="st"> </span><span class="kw">kable</span>(<span class="kw">tidy</span>(sleep.lm, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>), <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">13.868</td>
<td align="right">0.891</td>
<td align="right">15.563</td>
<td align="right">0.000</td>
<td align="right">12.077</td>
<td align="right">15.660</td>
</tr>
<tr class="even">
<td align="left">log(BodyWt)</td>
<td align="right">-0.581</td>
<td align="right">0.277</td>
<td align="right">-2.101</td>
<td align="right">0.041</td>
<td align="right">-1.137</td>
<td align="right">-0.025</td>
</tr>
<tr class="odd">
<td align="left">dangerlow</td>
<td align="right">-2.359</td>
<td align="right">1.305</td>
<td align="right">-1.807</td>
<td align="right">0.077</td>
<td align="right">-4.984</td>
<td align="right">0.265</td>
</tr>
<tr class="even">
<td align="left">dangermoderate</td>
<td align="right">-3.501</td>
<td align="right">1.404</td>
<td align="right">-2.493</td>
<td align="right">0.016</td>
<td align="right">-6.325</td>
<td align="right">-0.677</td>
</tr>
<tr class="odd">
<td align="left">dangerhigh</td>
<td align="right">-4.227</td>
<td align="right">1.582</td>
<td align="right">-2.672</td>
<td align="right">0.010</td>
<td align="right">-7.408</td>
<td align="right">-1.047</td>
</tr>
<tr class="even">
<td align="left">dangervery high</td>
<td align="right">-7.031</td>
<td align="right">3.329</td>
<td align="right">-2.112</td>
<td align="right">0.040</td>
<td align="right">-13.725</td>
<td align="right">-0.337</td>
</tr>
<tr class="odd">
<td align="left">log(BodyWt):dangerlow</td>
<td align="right">-0.034</td>
<td align="right">0.723</td>
<td align="right">-0.048</td>
<td align="right">0.962</td>
<td align="right">-1.489</td>
<td align="right">1.420</td>
</tr>
<tr class="even">
<td align="left">log(BodyWt):dangermoderate</td>
<td align="right">-0.344</td>
<td align="right">0.428</td>
<td align="right">-0.804</td>
<td align="right">0.426</td>
<td align="right">-1.206</td>
<td align="right">0.517</td>
</tr>
<tr class="odd">
<td align="left">log(BodyWt):dangerhigh</td>
<td align="right">0.170</td>
<td align="right">0.418</td>
<td align="right">0.406</td>
<td align="right">0.687</td>
<td align="right">-0.671</td>
<td align="right">1.010</td>
</tr>
<tr class="even">
<td align="left">log(BodyWt):dangervery high</td>
<td align="right">-0.096</td>
<td align="right">0.770</td>
<td align="right">-0.125</td>
<td align="right">0.901</td>
<td align="right">-1.644</td>
<td align="right">1.452</td>
</tr>
</tbody>
</table>
<p>Here are some inferences we can make:</p>
<ul>
<li><strong>Body weight effect for very low danger:</strong> Recall from above that <span class="math inline">\(\beta_1\)</span> is the effect of body weight for species in the “very low” danger level. The coefficients table above provide results for testing <span class="math inline">\(H_0: \beta_1 = 0\)</span> vs. <span class="math inline">\(H_A: \beta_1 \neq 0\)</span>. The results of this test show that the effect of body weight is moderately significant for the very low danger subpopulation (t=-2.101, df=48, p=0.0409). A doubling of body weight for the low danger population is associated with a decrease in mean total sleep of anywhere from 0.02 to 0.80 hours.</li>
</ul>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="co"># logarithmic model : additive change in mean(y) = beta*log(m)</span></a>
<a class="sourceLine" id="cb108-2" title="2"><span class="er">&gt;</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span>)<span class="op">*-</span><span class="fl">0.581</span></a>
<a class="sourceLine" id="cb108-3" title="3"><span class="co">## [1] -0.4027185</span></a>
<a class="sourceLine" id="cb108-4" title="4"><span class="op">&gt;</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span>)<span class="op">*-</span><span class="fl">1.137</span></a>
<a class="sourceLine" id="cb108-5" title="5"><span class="co">## [1] -0.7881083</span></a>
<a class="sourceLine" id="cb108-6" title="6"><span class="op">&gt;</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span>)<span class="op">*-</span><span class="fl">0.025</span></a>
<a class="sourceLine" id="cb108-7" title="7"><span class="co">## [1] -0.01732868</span></a></code></pre></div>
<ul>
<li><p><strong>Difference between body weight effect in very low and very high danger levels:</strong> <span class="math inline">\(\beta_9\)</span> tells us how the effect of body weight differs for the very low and very high danger levels. The small estimated value <span class="math inline">\(\hat{\beta}_9 = -0.096\)</span>, along with the separate lines scatterplot, suggest little difference in the effect of body weight in these two danger groups. The summary output gives test results for <span class="math inline">\(H_0: \beta_9 = 0\)</span> vs. <span class="math inline">\(H_A: \beta_9 \neq 0\)</span>. The test results suggest that the difference effects of body weight on mean total sleep in the two groups is not statistically significant (t=-0.125, df=48, p=0.9).</p></li>
<li><p><strong>Difference between body weight effect in high and moderate danger levels:</strong> As explained in Section <a href="mlr.html#mlr-sleep1">3.4.2.1</a>, to determine if the effect of body weight on mean total sleep differs for “high” and “moderate” levels of danger, we would test the hypotheses
<span class="math display">\[
H_0: \beta_8 = \beta_7 \ \ \ \ vs. \ \ \ \ H_A: \beta_8 \neq \beta_7
\]</span></p></li>
</ul>
<p>We can rearrange to look at the difference:
<span class="math display">\[
H_0: \beta_8 - \beta_7 = 0 \ \ vs. \ \  H_A: \beta_8 - \beta_7 \neq 0
\]</span></p>
<p>This difference is a linear combination of parameters:
<span class="math display">\[
\gamma = \beta_8 - \beta_7
\]</span>
where we know constants <span class="math inline">\(c_8 = 1\)</span> and <span class="math inline">\(c_7 = -1\)</span>. The estimated mean difference is
<span class="math display">\[
\hat{\gamma} = \hat{\beta}_8 - \hat{\beta}_7  = 0.16966 - (-0.34437) \approx 0.51403
\]</span>
The SE of this estimate uses the SE’s of <span class="math inline">\(Var(\hat{\beta}_8) = 0.17466548\)</span> and $Var(_7) = 0.18359650 $, along with their covariance term <span class="math inline">\(Cov(\hat{\beta}_8,\hat{\beta}_7) = 0.07650199\)</span>.
<span class="math display">\[
SE(\hat{\gamma}) = \sqrt{ 0.17466548 + 0.18359650(-1)^2 + 2(1)(-1)(0.07650199)} \approx 0.45305
\]</span>
The test stat is
<span class="math display">\[
t = \dfrac{0.51403 - 0}{0.45305} = 1.1346
\]</span>
The p-value is the area above 1.1346 and below -1.1346 (or double the lower tail area). The p-value is about 26%, which means we cannot conclude that the effect of body weight on mean total sleep differs between animals in moderate danger and high danger.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">vcov</span>(sleep.lm)  <span class="co"># really big!</span></a>
<a class="sourceLine" id="cb109-2" title="2"><span class="co">##                             (Intercept) log(BodyWt)   dangerlow</span></a>
<a class="sourceLine" id="cb109-3" title="3"><span class="co">## (Intercept)                   0.7940483 -0.10333697 -0.79404832</span></a>
<a class="sourceLine" id="cb109-4" title="4"><span class="co">## log(BodyWt)                  -0.1033370  0.07650199  0.10333697</span></a>
<a class="sourceLine" id="cb109-5" title="5"><span class="co">## dangerlow                    -0.7940483  0.10333697  1.70402151</span></a>
<a class="sourceLine" id="cb109-6" title="6"><span class="co">## dangermoderate               -0.7940483  0.10333697  0.79404832</span></a>
<a class="sourceLine" id="cb109-7" title="7"><span class="co">## dangerhigh                   -0.7940483  0.10333697  0.79404832</span></a>
<a class="sourceLine" id="cb109-8" title="8"><span class="co">## dangervery high              -0.7940483  0.10333697  0.79404832</span></a>
<a class="sourceLine" id="cb109-9" title="9"><span class="co">## log(BodyWt):dangerlow         0.1033370 -0.07650199  0.07161464</span></a>
<a class="sourceLine" id="cb109-10" title="10"><span class="co">## log(BodyWt):dangermoderate    0.1033370 -0.07650199 -0.10333697</span></a>
<a class="sourceLine" id="cb109-11" title="11"><span class="co">## log(BodyWt):dangerhigh        0.1033370 -0.07650199 -0.10333697</span></a>
<a class="sourceLine" id="cb109-12" title="12"><span class="co">## log(BodyWt):dangervery high   0.1033370 -0.07650199 -0.10333697</span></a>
<a class="sourceLine" id="cb109-13" title="13"><span class="co">##                             dangermoderate dangerhigh dangervery high</span></a>
<a class="sourceLine" id="cb109-14" title="14"><span class="co">## (Intercept)                     -0.7940483 -0.7940483      -0.7940483</span></a>
<a class="sourceLine" id="cb109-15" title="15"><span class="co">## log(BodyWt)                      0.1033370  0.1033370       0.1033370</span></a>
<a class="sourceLine" id="cb109-16" title="16"><span class="co">## dangerlow                        0.7940483  0.7940483       0.7940483</span></a>
<a class="sourceLine" id="cb109-17" title="17"><span class="co">## dangermoderate                   1.9724931  0.7940483       0.7940483</span></a>
<a class="sourceLine" id="cb109-18" title="18"><span class="co">## dangerhigh                       0.7940483  2.5022880       0.7940483</span></a>
<a class="sourceLine" id="cb109-19" title="19"><span class="co">## dangervery high                  0.7940483  0.7940483      11.0829102</span></a>
<a class="sourceLine" id="cb109-20" title="20"><span class="co">## log(BodyWt):dangerlow           -0.1033370 -0.1033370      -0.1033370</span></a>
<a class="sourceLine" id="cb109-21" title="21"><span class="co">## log(BodyWt):dangermoderate      -0.1099700 -0.1033370      -0.1033370</span></a>
<a class="sourceLine" id="cb109-22" title="22"><span class="co">## log(BodyWt):dangerhigh          -0.1033370 -0.3013217      -0.1033370</span></a>
<a class="sourceLine" id="cb109-23" title="23"><span class="co">## log(BodyWt):dangervery high     -0.1033370 -0.1033370      -2.2112565</span></a>
<a class="sourceLine" id="cb109-24" title="24"><span class="co">##                             log(BodyWt):dangerlow</span></a>
<a class="sourceLine" id="cb109-25" title="25"><span class="co">## (Intercept)                            0.10333697</span></a>
<a class="sourceLine" id="cb109-26" title="26"><span class="co">## log(BodyWt)                           -0.07650199</span></a>
<a class="sourceLine" id="cb109-27" title="27"><span class="co">## dangerlow                              0.07161464</span></a>
<a class="sourceLine" id="cb109-28" title="28"><span class="co">## dangermoderate                        -0.10333697</span></a>
<a class="sourceLine" id="cb109-29" title="29"><span class="co">## dangerhigh                            -0.10333697</span></a>
<a class="sourceLine" id="cb109-30" title="30"><span class="co">## dangervery high                       -0.10333697</span></a>
<a class="sourceLine" id="cb109-31" title="31"><span class="co">## log(BodyWt):dangerlow                  0.52320246</span></a>
<a class="sourceLine" id="cb109-32" title="32"><span class="co">## log(BodyWt):dangermoderate             0.07650199</span></a>
<a class="sourceLine" id="cb109-33" title="33"><span class="co">## log(BodyWt):dangerhigh                 0.07650199</span></a>
<a class="sourceLine" id="cb109-34" title="34"><span class="co">## log(BodyWt):dangervery high            0.07650199</span></a>
<a class="sourceLine" id="cb109-35" title="35"><span class="co">##                             log(BodyWt):dangermoderate</span></a>
<a class="sourceLine" id="cb109-36" title="36"><span class="co">## (Intercept)                                 0.10333697</span></a>
<a class="sourceLine" id="cb109-37" title="37"><span class="co">## log(BodyWt)                                -0.07650199</span></a>
<a class="sourceLine" id="cb109-38" title="38"><span class="co">## dangerlow                                  -0.10333697</span></a>
<a class="sourceLine" id="cb109-39" title="39"><span class="co">## dangermoderate                             -0.10997000</span></a>
<a class="sourceLine" id="cb109-40" title="40"><span class="co">## dangerhigh                                 -0.10333697</span></a>
<a class="sourceLine" id="cb109-41" title="41"><span class="co">## dangervery high                            -0.10333697</span></a>
<a class="sourceLine" id="cb109-42" title="42"><span class="co">## log(BodyWt):dangerlow                       0.07650199</span></a>
<a class="sourceLine" id="cb109-43" title="43"><span class="co">## log(BodyWt):dangermoderate                  0.18359650</span></a>
<a class="sourceLine" id="cb109-44" title="44"><span class="co">## log(BodyWt):dangerhigh                      0.07650199</span></a>
<a class="sourceLine" id="cb109-45" title="45"><span class="co">## log(BodyWt):dangervery high                 0.07650199</span></a>
<a class="sourceLine" id="cb109-46" title="46"><span class="co">##                             log(BodyWt):dangerhigh</span></a>
<a class="sourceLine" id="cb109-47" title="47"><span class="co">## (Intercept)                             0.10333697</span></a>
<a class="sourceLine" id="cb109-48" title="48"><span class="co">## log(BodyWt)                            -0.07650199</span></a>
<a class="sourceLine" id="cb109-49" title="49"><span class="co">## dangerlow                              -0.10333697</span></a>
<a class="sourceLine" id="cb109-50" title="50"><span class="co">## dangermoderate                         -0.10333697</span></a>
<a class="sourceLine" id="cb109-51" title="51"><span class="co">## dangerhigh                             -0.30132171</span></a>
<a class="sourceLine" id="cb109-52" title="52"><span class="co">## dangervery high                        -0.10333697</span></a>
<a class="sourceLine" id="cb109-53" title="53"><span class="co">## log(BodyWt):dangerlow                   0.07650199</span></a>
<a class="sourceLine" id="cb109-54" title="54"><span class="co">## log(BodyWt):dangermoderate              0.07650199</span></a>
<a class="sourceLine" id="cb109-55" title="55"><span class="co">## log(BodyWt):dangerhigh                  0.17466548</span></a>
<a class="sourceLine" id="cb109-56" title="56"><span class="co">## log(BodyWt):dangervery high             0.07650199</span></a>
<a class="sourceLine" id="cb109-57" title="57"><span class="co">##                             log(BodyWt):dangervery high</span></a>
<a class="sourceLine" id="cb109-58" title="58"><span class="co">## (Intercept)                                  0.10333697</span></a>
<a class="sourceLine" id="cb109-59" title="59"><span class="co">## log(BodyWt)                                 -0.07650199</span></a>
<a class="sourceLine" id="cb109-60" title="60"><span class="co">## dangerlow                                   -0.10333697</span></a>
<a class="sourceLine" id="cb109-61" title="61"><span class="co">## dangermoderate                              -0.10333697</span></a>
<a class="sourceLine" id="cb109-62" title="62"><span class="co">## dangerhigh                                  -0.10333697</span></a>
<a class="sourceLine" id="cb109-63" title="63"><span class="co">## dangervery high                             -2.21125653</span></a>
<a class="sourceLine" id="cb109-64" title="64"><span class="co">## log(BodyWt):dangerlow                        0.07650199</span></a>
<a class="sourceLine" id="cb109-65" title="65"><span class="co">## log(BodyWt):dangermoderate                   0.07650199</span></a>
<a class="sourceLine" id="cb109-66" title="66"><span class="co">## log(BodyWt):dangerhigh                       0.07650199</span></a>
<a class="sourceLine" id="cb109-67" title="67"><span class="co">## log(BodyWt):dangervery high                  0.59281009</span></a>
<a class="sourceLine" id="cb109-68" title="68"><span class="op">&gt;</span><span class="st"> </span><span class="kw">vcov</span>(sleep.lm)[<span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">8</span>)<span class="op">+</span><span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">8</span>)<span class="op">+</span><span class="dv">1</span>]  <span class="co"># get the 8/9th rows/columns for beta7,beta8</span></a>
<a class="sourceLine" id="cb109-69" title="69"><span class="co">##                            log(BodyWt):dangermoderate</span></a>
<a class="sourceLine" id="cb109-70" title="70"><span class="co">## log(BodyWt):dangermoderate                 0.18359650</span></a>
<a class="sourceLine" id="cb109-71" title="71"><span class="co">## log(BodyWt):dangerhigh                     0.07650199</span></a>
<a class="sourceLine" id="cb109-72" title="72"><span class="co">##                            log(BodyWt):dangerhigh</span></a>
<a class="sourceLine" id="cb109-73" title="73"><span class="co">## log(BodyWt):dangermoderate             0.07650199</span></a>
<a class="sourceLine" id="cb109-74" title="74"><span class="co">## log(BodyWt):dangerhigh                 0.17466548</span></a>
<a class="sourceLine" id="cb109-75" title="75"><span class="op">&gt;</span><span class="st"> </span>(est &lt;-<span class="st"> </span><span class="fl">0.16966</span> <span class="op">-</span><span class="st"> </span>(<span class="op">-</span><span class="fl">0.34437</span>))</a>
<a class="sourceLine" id="cb109-76" title="76"><span class="co">## [1] 0.51403</span></a>
<a class="sourceLine" id="cb109-77" title="77"><span class="op">&gt;</span><span class="st"> </span>(se.est &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="fl">0.17466548</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.18359650</span><span class="op">*</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="fl">0.07650199</span>))</a>
<a class="sourceLine" id="cb109-78" title="78"><span class="co">## [1] 0.4530541</span></a>
<a class="sourceLine" id="cb109-79" title="79"><span class="op">&gt;</span><span class="st"> </span>(tstat &lt;-<span class="st"> </span>est<span class="op">/</span>se.est )</a>
<a class="sourceLine" id="cb109-80" title="80"><span class="co">## [1] 1.134589</span></a>
<a class="sourceLine" id="cb109-81" title="81"><span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span><span class="kw">pt</span>(<span class="op">-</span>tstat, <span class="dt">df=</span><span class="dv">48</span>)</a>
<a class="sourceLine" id="cb109-82" title="82"><span class="co">## [1] 0.2621821</span></a></code></pre></div>
</div>
</div>
<div id="mlr-anova" class="section level2">
<h2><span class="header-section-number">3.6</span> ANOVA for MLR</h2>
<p>Recall the discussion of Analysis of Variance (ANOVA) for SLR models in Section <a href="slr.html#slr-anova">2.12.2</a>. The same idea holds in MLR models, we decompose the total squared variation in a response (<span class="math inline">\(SST\)</span>) into parts explained by a certain model (<span class="math inline">\(SSreg\)</span>) and unexplained by the model (<span class="math inline">\(SSR\)</span>):</p>
<p><span class="math display">\[
\sum_{i=1}^n (y_i - \bar{y})^2 = \sum_{i=1}^n  (y_i - \hat{y}_i)^2 + \sum_{i=1}^n  (\hat{y}_i - \bar{y})^2
\]</span></p>
<p>The three components are called:</p>
<ul>
<li><strong>total variation:</strong> <span class="math inline">\(SST = \sum_{i=1}^n (y_i - \bar{y})^2 = (n-1)s^2_y\)</span></li>
<li><strong>regression (explained) variation:</strong> <span class="math inline">\(SSreg = \sum_{i=1}^n (\hat{y}_i - \bar{y})^2\)</span></li>
<li><strong>residual (unexplained) variation:</strong> <span class="math inline">\(SSR = \sum_{i=1}^n (y_i - \hat{y}_i)^2 = (n-(p+1))\hat{\sigma}^2\)</span> where <span class="math inline">\(n-(p+1)\)</span> is the model degrees of freedom (sample size minus number of <span class="math inline">\(\beta\)</span>’s)</li>
</ul>
<p>Both the regression and residual SS depends on which MLR model you fit to make predictions <span class="math inline">\(\hat{y}_i\)</span>, with different models (for the same response) producing different <span class="math inline">\(SSR\)</span> and <span class="math inline">\(SSref\)</span> values. The total variation in the response, <span class="math inline">\(SST\)</span>, <em>always</em> remains the same, regardless of model fit. We often compare regression and residual SS for different models. When doing this we make reference to the model terms. For example, <span class="math inline">\(SSreg(x_1, x_2, x_2^2)\)</span> would be the regression SS for fitting the regression of <span class="math inline">\(y\)</span> on <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span> and <span class="math inline">\(x_2^2\)</span>. Similar notation is used for <span class="math inline">\(SSR\)</span>.</p>
<p>We often are interested in comparing a large (“full”) model to a smaller nested (“reduced”) model. A <strong>nested model</strong> contains a smaller subset of terms compared to a larger model. We can form a nested model by setting some <span class="math inline">\(\beta\)</span>’s in a larger model equal to zero. For example, if our larger model is
<span class="math display">\[
\mu(y \mid X) = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 + \beta_4 x_3^2
\]</span>
then the following is a nested model found by setting <span class="math inline">\(\beta_1 = \beta_2 = 0\)</span>:
<span class="math display">\[
\mu(y \mid X) = \beta_0  + \beta_3 x_3 + \beta_4 x_3^2
\]</span></p>
<p>We often are interested in comparing models, is a full model “better” than a smaller, nested model? Or can the smaller model “fit” the data as well as a larger model? We can assess the significance of terms in a model on a one-by-one basis using t-test (i.e. is <span class="math inline">\(x_i\)</span> needed assuming <em>all</em> other terms are in the model). To test <em>more</em> than one term at a time, we look at the <strong>extra sum of squares</strong> that the terms constribute to the regression SS.</p>
<ul>
<li><strong>Extra sum of squares</strong>: the amount by which <span class="math inline">\(SSreg\)</span> is increased by adding one or more terms to a model, or, equivalently, the amount by which <span class="math inline">\(SSR\)</span> is decreased by adding these terms.</li>
<li>For the models above, the extra SS for adding <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> to the reduce (nested) model would be equal to
<span class="math display">\[
extraSS = SSreg(x_1,x_2,x_3,x_3^2) - SSreg(x_3,x_3^2) = SSR(x_3,x_3^2)  -  SSR(x_1,x_2,x_3,x_3^2)
\]</span></li>
<li>Extra sum of squares is always a <strong>positive</strong> value, due to the fact that you never “lose” regression SS by adding terms. So <span class="math inline">\(SSreg\)</span> increases as you add model terms while <span class="math inline">\(SSR\)</span> will decrease.</li>
</ul>
<div id="mean-squares" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Mean Squares</h3>
<p>Mean square measures of variation are equal to a SS measure divided by the <em>degrees of freedom</em> associated with that measure. The degrees of freedom capture, roughly, now many terms are being added up in the SS measure. Here are the mean square values for a MLR model:</p>
<ul>
<li><strong>Mean square of total:</strong> <span class="math inline">\(MST = \dfrac{SST}{n-1} = s^2_y\)</span> which equals the sample variance of the response</li>
<li><strong>Mean square for regression:</strong> <span class="math inline">\(MSreg = \dfrac{SSreg}{p}\)</span> where <span class="math inline">\(p\)</span> is the number of terms in the model</li>
<li><strong>Mean square for residuals (error):</strong> <span class="math inline">\(MSR = \dfrac{SSR}{n-(p+1)} = \hat{\sigma}^2\)</span>, which is the estimated model SD</li>
</ul>
</div>
<div id="r2-and-adjusted-r2" class="section level3">
<h3><span class="header-section-number">3.6.2</span> <span class="math inline">\(R^2\)</span> and adjusted <span class="math inline">\(R^2\)</span></h3>
<p><span class="math inline">\(R^2\)</span> has the same interpretation and calculation as it did in SLR, it measures the proportion of variation in the response that is explained by a MLR model:
<span class="math display">\[
R^2 = 1- \dfrac{SSR}{SST} = \dfrac{SSreg}{SST}
\]</span>
As we add terms to a model, <span class="math inline">\(R^2\)</span> always increases, even if the terms don’t add much information about the response.</p>
<p>Adjusted <span class="math inline">\(R^2\)</span> is similar to <span class="math inline">\(R^2\)</span>, but it uses mean SS which can help us assess whether the increased gain in <span class="math inline">\(SSreg\)</span> is worth the addition (or complexity) of another term.
<span class="math display">\[
R^2_{adjust} = 1- \dfrac{MSR}{MST} 
\]</span>
Unlike <span class="math inline">\(R^2\)</span>, it is possible for <span class="math inline">\(R^2_a\)</span> to decrease when adding a new term if it adds little extra SS to the model.</p>
</div>
<div id="anova-f-tests" class="section level3">
<h3><span class="header-section-number">3.6.3</span> ANOVA F-tests</h3>
<p>We can use ANOVA to compare nested models.</p>
<ol style="list-style-type: decimal">
<li>The <strong>hypotheses</strong> compare a reduced (nested) to full (larger) model:
<span class="math display">\[
H_0: \textrm{nested model} \ \ \ \ \ H_A: \textrm{full model}
\]</span></li>
</ol>
<p>Consider the nested model example above, the nested model is the null claim
<span class="math display">\[
H_0: \mu(y \mid X) = \beta_0 + \beta_3 x_3 + \beta_4 x_3^2 \ \ \ \ \ \ \  (\beta_1 = \beta_2 = 0)
\]</span>
and the larger model is the alternative claim:
<span class="math display">\[
H_A:  \mu(y \mid X) = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 + \beta_4 x_3^2
\]</span>
Notice that the null model is equivalent to saying that neither <span class="math inline">\(x_1\)</span> nor <span class="math inline">\(x_2\)</span> have an effect on the mean response after accounting for <span class="math inline">\(x_3\)</span> and its quadratic term.</p>
<ol start="2" style="list-style-type: decimal">
<li><p>The <strong>F-test statistic</strong> compares the average extra SS add by the terms being tested to the best estimate of model SD (given by the full model):
<span class="math display">\[
F = \dfrac{extraSS/(\textrm{# terms tested})}{MSR_{full}}
\]</span>
For the example, the F test stat would look like
<span class="math display">\[
F = \dfrac{(SSR(x_3,x_3^2)-SSR(x_1,x_2,x_3,x_3^2))/2}{MSR_{full}}
\]</span></p></li>
<li><p>The <strong>p-value</strong> is found in the <strong>right-tail</strong> of the <span class="math inline">\(F-\)</span>distribution with degrees of freedom equal to the # of terms tested (numerator) and <span class="math inline">\(n-(p+1)\)</span> from the full model (denominator). For the example, the first df is 2 (two terms being tested) and the second would be <span class="math inline">\(n-(4+1)\)</span> (4+1=5 <span class="math inline">\(\beta\)</span>’s in the full model).</p></li>
<li><p>If you have a small p-value, this gives evidence that <strong>at least one</strong> of the tested terms is useful in the model (e.g. reject the smaller model). If you have a larger p-value, then we don’t have much evidence that the terms being tested are useful in the model (e.g. do not reject the smaller model).</p></li>
</ol>
<p>Special cases of ANOVA F-tests:</p>
<ul>
<li><strong>Testing one term:</strong> If our reduced and full models only differ by one term, then the F-test will be exactly the same as the t-test for that term from the full model.</li>
<li><strong>Testing all terms:</strong> This is the “overall F-test” that is part of the summary output for most regression software. It tests a full model against a “null” model of no predictors: <span class="math inline">\(H_0: \mu(y \mid x) = \beta_0\)</span>.</li>
</ul>
</div>
<div id="mlr-sleep3" class="section level3">
<h3><span class="header-section-number">3.6.4</span> Example: Sleep</h3>
<p>We will revisit the animal sleep data from Sections <a href="mlr.html#mlr-sleep1">3.4.2.1</a> and <a href="mlr.html#mlr-sleep2">3.5.3</a>.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(sleep.lm)</a>
<a class="sourceLine" id="cb110-2" title="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb110-3" title="3"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb110-4" title="4"><span class="co">## lm(formula = TS ~ log(BodyWt) * danger, data = sleep)</span></a>
<a class="sourceLine" id="cb110-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb110-6" title="6"><span class="co">## Residuals:</span></a>
<a class="sourceLine" id="cb110-7" title="7"><span class="co">##     Min      1Q  Median      3Q     Max </span></a>
<a class="sourceLine" id="cb110-8" title="8"><span class="co">## -7.5685 -2.0181 -0.2475  1.7083  6.6108 </span></a>
<a class="sourceLine" id="cb110-9" title="9"><span class="co">## </span></a>
<a class="sourceLine" id="cb110-10" title="10"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb110-11" title="11"><span class="co">##                             Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb110-12" title="12"><span class="co">## (Intercept)                 13.86818    0.89109  15.563   &lt;2e-16 ***</span></a>
<a class="sourceLine" id="cb110-13" title="13"><span class="co">## log(BodyWt)                 -0.58104    0.27659  -2.101   0.0409 *  </span></a>
<a class="sourceLine" id="cb110-14" title="14"><span class="co">## dangerlow                   -2.35924    1.30538  -1.807   0.0770 .  </span></a>
<a class="sourceLine" id="cb110-15" title="15"><span class="co">## dangermoderate              -3.50087    1.40445  -2.493   0.0162 *  </span></a>
<a class="sourceLine" id="cb110-16" title="16"><span class="co">## dangerhigh                  -4.22738    1.58186  -2.672   0.0103 *  </span></a>
<a class="sourceLine" id="cb110-17" title="17"><span class="co">## dangervery high             -7.03108    3.32910  -2.112   0.0399 *  </span></a>
<a class="sourceLine" id="cb110-18" title="18"><span class="co">## log(BodyWt):dangerlow       -0.03446    0.72333  -0.048   0.9622    </span></a>
<a class="sourceLine" id="cb110-19" title="19"><span class="co">## log(BodyWt):dangermoderate  -0.34437    0.42848  -0.804   0.4255    </span></a>
<a class="sourceLine" id="cb110-20" title="20"><span class="co">## log(BodyWt):dangerhigh       0.16966    0.41793   0.406   0.6866    </span></a>
<a class="sourceLine" id="cb110-21" title="21"><span class="co">## log(BodyWt):dangervery high -0.09638    0.76994  -0.125   0.9009    </span></a>
<a class="sourceLine" id="cb110-22" title="22"><span class="co">## ---</span></a>
<a class="sourceLine" id="cb110-23" title="23"><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb110-24" title="24"><span class="co">## </span></a>
<a class="sourceLine" id="cb110-25" title="25"><span class="co">## Residual standard error: 3.432 on 48 degrees of freedom</span></a>
<a class="sourceLine" id="cb110-26" title="26"><span class="co">##   (4 observations deleted due to missingness)</span></a>
<a class="sourceLine" id="cb110-27" title="27"><span class="co">## Multiple R-squared:  0.5326, Adjusted R-squared:  0.4449 </span></a>
<a class="sourceLine" id="cb110-28" title="28"><span class="co">## F-statistic: 6.076 on 9 and 48 DF,  p-value: 1.177e-05</span></a>
<a class="sourceLine" id="cb110-29" title="29"><span class="op">&gt;</span><span class="st"> </span><span class="kw">kable</span>(<span class="kw">tidy</span>(sleep.lm, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>), <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">13.868</td>
<td align="right">0.891</td>
<td align="right">15.563</td>
<td align="right">0.000</td>
<td align="right">12.077</td>
<td align="right">15.660</td>
</tr>
<tr class="even">
<td align="left">log(BodyWt)</td>
<td align="right">-0.581</td>
<td align="right">0.277</td>
<td align="right">-2.101</td>
<td align="right">0.041</td>
<td align="right">-1.137</td>
<td align="right">-0.025</td>
</tr>
<tr class="odd">
<td align="left">dangerlow</td>
<td align="right">-2.359</td>
<td align="right">1.305</td>
<td align="right">-1.807</td>
<td align="right">0.077</td>
<td align="right">-4.984</td>
<td align="right">0.265</td>
</tr>
<tr class="even">
<td align="left">dangermoderate</td>
<td align="right">-3.501</td>
<td align="right">1.404</td>
<td align="right">-2.493</td>
<td align="right">0.016</td>
<td align="right">-6.325</td>
<td align="right">-0.677</td>
</tr>
<tr class="odd">
<td align="left">dangerhigh</td>
<td align="right">-4.227</td>
<td align="right">1.582</td>
<td align="right">-2.672</td>
<td align="right">0.010</td>
<td align="right">-7.408</td>
<td align="right">-1.047</td>
</tr>
<tr class="even">
<td align="left">dangervery high</td>
<td align="right">-7.031</td>
<td align="right">3.329</td>
<td align="right">-2.112</td>
<td align="right">0.040</td>
<td align="right">-13.725</td>
<td align="right">-0.337</td>
</tr>
<tr class="odd">
<td align="left">log(BodyWt):dangerlow</td>
<td align="right">-0.034</td>
<td align="right">0.723</td>
<td align="right">-0.048</td>
<td align="right">0.962</td>
<td align="right">-1.489</td>
<td align="right">1.420</td>
</tr>
<tr class="even">
<td align="left">log(BodyWt):dangermoderate</td>
<td align="right">-0.344</td>
<td align="right">0.428</td>
<td align="right">-0.804</td>
<td align="right">0.426</td>
<td align="right">-1.206</td>
<td align="right">0.517</td>
</tr>
<tr class="odd">
<td align="left">log(BodyWt):dangerhigh</td>
<td align="right">0.170</td>
<td align="right">0.418</td>
<td align="right">0.406</td>
<td align="right">0.687</td>
<td align="right">-0.671</td>
<td align="right">1.010</td>
</tr>
<tr class="even">
<td align="left">log(BodyWt):dangervery high</td>
<td align="right">-0.096</td>
<td align="right">0.770</td>
<td align="right">-0.125</td>
<td align="right">0.901</td>
<td align="right">-1.644</td>
<td align="right">1.452</td>
</tr>
</tbody>
</table>
<p>The <code>anova</code> command for this model gives the <span class="math inline">\(SSR\)</span> and <span class="math inline">\(MSR\)</span> for a model, along with the extra SS for adding a term to the model above it in the table:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">anova</span>(sleep.lm)</a>
<a class="sourceLine" id="cb111-2" title="2"><span class="co">## Analysis of Variance Table</span></a>
<a class="sourceLine" id="cb111-3" title="3"><span class="co">## </span></a>
<a class="sourceLine" id="cb111-4" title="4"><span class="co">## Response: TS</span></a>
<a class="sourceLine" id="cb111-5" title="5"><span class="co">##                    Df Sum Sq Mean Sq F value    Pr(&gt;F)    </span></a>
<a class="sourceLine" id="cb111-6" title="6"><span class="co">## log(BodyWt)         1 343.44  343.44 29.1537 2.043e-06 ***</span></a>
<a class="sourceLine" id="cb111-7" title="7"><span class="co">## danger              4 285.01   71.25  6.0485 0.0005036 ***</span></a>
<a class="sourceLine" id="cb111-8" title="8"><span class="co">## log(BodyWt):danger  4  15.76    3.94  0.3345 0.8534077    </span></a>
<a class="sourceLine" id="cb111-9" title="9"><span class="co">## Residuals          48 565.46   11.78                      </span></a>
<a class="sourceLine" id="cb111-10" title="10"><span class="co">## ---</span></a>
<a class="sourceLine" id="cb111-11" title="11"><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a></code></pre></div>
<p>Here we have:</p>
<ul>
<li><span class="math inline">\(SSreg(log(BodyWt)) = 343.44\)</span> gives the regression SS for the regression of total sleep on log-body weight.</li>
<li><span class="math inline">\(SSreg(log(BodyWt), danger) - SSreg(log(BodyWt)) = 285.01\)</span> gives the extra SS for adding the factor variable <code>danger</code> (with 5 levels) to the model that already includes log-body weight.</li>
<li><span class="math inline">\(SSreg(log(BodyWt), danger, log(BodyWt):danger) - SSreg(log(BodyWt), danger) = 15.76\)</span> gives the extra SS for adding the interaction term to the model that already includes danger level and log-body weight.</li>
<li><span class="math inline">\(SSR(log(BodyWt), danger, log(BodyWt):danger) = 565.46\)</span> is the residual SS for the interaction model and <span class="math inline">\(MSR=11.78 = \hat{\sigma}\)</span> is the estimated model SD for this model.</li>
<li><span class="math inline">\(SSreg(log(BodyWt), danger, log(BodyWt):danger) = 343.44 + 285.01 + 15.76 = 644.21\)</span> is the regression SS for the interaction model.</li>
</ul>
<div id="are-any-terms-significant" class="section level4">
<h4><span class="header-section-number">3.6.4.1</span> Are any terms significant?</h4>
<p>The <code>summary</code> output above shows results for the overall <span class="math inline">\(F-\)</span>test:
<span class="math display">\[\begin{split}
H_0: \mu(TS \mid body, danger) &amp;= \beta_0 
\end{split}
\]</span>
vs. 
<span class="math display">\[\begin{split}
H_A: \mu(TS \mid body, danger) &amp;= \beta_0 + \beta_1 \log(body) + \beta_2 low + \beta_3 moderate + \beta_4 high + \\ 
&amp; \beta_5 veryhigh  + \beta_6 \log(body)low + \beta_7 \log(body)moderate + \\ 
&amp; \beta_8 \log(body)high + \beta_9 \log(body)veryhigh
\end{split}
\]</span></p>
<p>The F-test statistic that is given has a value of 6.076 and the p-value has a value less than 0.0001 using an F-distribution with 9 and 48 degrees of freedom. The test stat is the ratio of regression MS to residual MS:
<span class="math display">\[
F = \dfrac{MSreg(log(BodyWt), danger, log(BodyWt):danger)}{MSR(log(BodyWt), danger, log(BodyWt):danger)} = \dfrac{644.21/9}{3.432^2} = 6.077
\]</span></p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="st"> </span><span class="kw">pf</span>(<span class="fl">6.077</span>, <span class="dv">9</span>, <span class="dv">48</span>)   <span class="co"># p-value</span></a>
<a class="sourceLine" id="cb112-2" title="2"><span class="co">## [1] 1.174811e-05</span></a></code></pre></div>
</div>
<div id="do-we-need-the-interaction-of-sleep-and-body-weight-in-the-model-for-total-sleep" class="section level4">
<h4><span class="header-section-number">3.6.4.2</span> Do we need the interaction of sleep and body weight in the model for total sleep?</h4>
<p>I.e. are any of the slopes for the different danger levels different?</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(sleep, <span class="kw">aes</span>(<span class="dt">x=</span>BodyWt, <span class="dt">y=</span>TS, <span class="dt">color=</span>danger)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-2" title="2"><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-3" title="3"><span class="op">+</span><span class="st">   </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-4" title="4"><span class="op">+</span><span class="st">   </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-5" title="5"><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;daily sleep vs. body weight by danger level&quot;</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-116-1.png" width="672" /></p>
<p>We can’t answer this with individual t-tests which only compare the slopes (effects of body weight) of danger levels two at a time. An F-test can address this question. We will test a model with no interaction to the full model with an interaction:
<span class="math display">\[\begin{split}
H_0: \mu(TS \mid body, danger) &amp;= \beta_0 + \beta_1 \log(body) + \beta_2 low + \beta_3 moderate + \beta_4 high +  \beta_5 veryhigh 
\end{split}
\]</span>
vs. 
<span class="math display">\[\begin{split}
H_A: \mu(TS \mid body, danger) &amp;= \beta_0 + \beta_1 \log(body) + \beta_2 low + \beta_3 moderate + \beta_4 high + \\ 
&amp; \beta_5 veryhigh  + \beta_6 \log(body)low + \beta_7 \log(body)moderate + \\ 
&amp; \beta_8 \log(body)high + \beta_9 \log(body)veryhigh
\end{split}
\]</span></p>
<p>The ANOVA command above gives the results for this hypothesis test because the interaction, with 4 terms in it, was added <em>last</em> in the <code>lm</code> command. The results are in the row for the interaction term <code>log(BodyWt):danger</code>. It compares the extra SS for adding the interaction (which has 4 terms in it!) to the full model:
<span class="math display">\[
F = \dfrac{15.76/4}{11.78} = 0.3345
\]</span>
and the p-value is
<span class="math display">\[
P(F_{4,48} \geq 0.3345) = 1-pf(0.3345, 4, 48)  = 0.863 
\]</span></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="kw">pf</span>(.<span class="dv">3345</span>, <span class="dv">4</span>, <span class="dv">48</span>)</a>
<a class="sourceLine" id="cb114-2" title="2"><span class="co">## [1] 0.8533796</span></a></code></pre></div>
<p>The command <code>anova(my.lm)</code> will only give <strong>valid F-test results for the last term added</strong> in the <code>lm</code>. The other F-tests shows aren’t valid because they aren’t using the correct full model SD estimate (e.g. the denomiator is wrong).</p>
<p>Another use of the <code>anova</code> command is to compare a reduced and full <code>lm</code> fit: <code>anova(reduced.lm, full.lm)</code>. Here we fit the reduced model without an interaction term then compare it to the full interaction model:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep.lm2 &lt;-<span class="st"> </span><span class="kw">lm</span>(TS <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt) <span class="op">+</span><span class="st"> </span>danger, <span class="dt">data=</span>sleep)</a>
<a class="sourceLine" id="cb115-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">anova</span>(sleep.lm2, sleep.lm)</a>
<a class="sourceLine" id="cb115-3" title="3"><span class="co">## Analysis of Variance Table</span></a>
<a class="sourceLine" id="cb115-4" title="4"><span class="co">## </span></a>
<a class="sourceLine" id="cb115-5" title="5"><span class="co">## Model 1: TS ~ log(BodyWt) + danger</span></a>
<a class="sourceLine" id="cb115-6" title="6"><span class="co">## Model 2: TS ~ log(BodyWt) * danger</span></a>
<a class="sourceLine" id="cb115-7" title="7"><span class="co">##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)</span></a>
<a class="sourceLine" id="cb115-8" title="8"><span class="co">## 1     52 581.22                           </span></a>
<a class="sourceLine" id="cb115-9" title="9"><span class="co">## 2     48 565.46  4     15.76 0.3345 0.8534</span></a></code></pre></div>
<p>Here we get the <span class="math inline">\(SSR\)</span> values for both models, the extra SS for the added terms (15.76), the F-test statistic (0.3345) and the p-value (0.8534).</p>
<p><strong>Conclusion:</strong> Even though we see some different between the effect of body weight in the high danger level, compared to other levels, these overall differences is slopes aren’t statistically significant after accounting for danger level and body weight.</p>
</div>
<div id="r2-and-r2_a" class="section level4">
<h4><span class="header-section-number">3.6.4.3</span> <span class="math inline">\(R^2\)</span> and <span class="math inline">\(R^2_a\)</span></h4>
<p>As you can see at the top of this example section, the <code>summary</code> function gives both coefficient estimates and ANOVA info about the overall F-test and <span class="math inline">\(R^2\)</span> values. The <code>broom</code> package’s <code>glance</code> function isolates just the model fit info like <span class="math inline">\(R^2\)</span> and the overall <span class="math inline">\(F-\)</span> test:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb116-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">glance</span>(sleep.lm)</a>
<a class="sourceLine" id="cb116-3" title="3"><span class="co">## # A tibble: 1 x 11</span></a>
<a class="sourceLine" id="cb116-4" title="4"><span class="co">##   r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC</span></a>
<a class="sourceLine" id="cb116-5" title="5"><span class="co">##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb116-6" title="6"><span class="co">## 1     0.533         0.445  3.43      6.08 1.18e-5    10  -148.  319.  341.</span></a>
<a class="sourceLine" id="cb116-7" title="7"><span class="co">## # ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</span></a>
<a class="sourceLine" id="cb116-8" title="8"><span class="op">&gt;</span><span class="st"> </span><span class="kw">glance</span>(sleep.lm2)</a>
<a class="sourceLine" id="cb116-9" title="9"><span class="co">## # A tibble: 1 x 11</span></a>
<a class="sourceLine" id="cb116-10" title="10"><span class="co">##   r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC</span></a>
<a class="sourceLine" id="cb116-11" title="11"><span class="co">##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb116-12" title="12"><span class="co">## 1     0.520         0.473  3.34      11.2 2.23e-7     6  -149.  312.  327.</span></a>
<a class="sourceLine" id="cb116-13" title="13"><span class="co">## # ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</span></a></code></pre></div>
<p>The larger model, <code>sleep.lm</code>, will have the larger <span class="math inline">\(R^2\)</span> value. The model with the interaction will explain about 53.3% of the variation in total sleep while the model without the interaction explains about 52% of the variation in total sleep. But are these 4 extra interaction terms worth it to gain only 1.3% more explanatory power? The adjusted <span class="math inline">\(R^2\)</span> for the <em>smaller</em> model is 0.473 which is a larger value than adjusted <span class="math inline">\(R^2\)</span> for the larger model (0.445). This, along with our F-test above, indicates that the interaction terms don’t add sufficient information about the response when the other two terms (danger level and body weight) are already included in the model.</p>
</div>
<div id="comparing-models-when-values-are-missing" class="section level4">
<h4><span class="header-section-number">3.6.4.4</span> Comparing models when values are missing</h4>
<p>The <code>summary</code> output let’s us know when there are cases with at least one value missing for the predictors and/or response:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(sleep.lm2)</a>
<a class="sourceLine" id="cb117-2" title="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb117-3" title="3"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb117-4" title="4"><span class="co">## lm(formula = TS ~ log(BodyWt) + danger, data = sleep)</span></a>
<a class="sourceLine" id="cb117-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb117-6" title="6"><span class="co">## Residuals:</span></a>
<a class="sourceLine" id="cb117-7" title="7"><span class="co">##     Min      1Q  Median      3Q     Max </span></a>
<a class="sourceLine" id="cb117-8" title="8"><span class="co">## -7.6165 -1.8447 -0.0214  1.9043  6.7414 </span></a>
<a class="sourceLine" id="cb117-9" title="9"><span class="co">## </span></a>
<a class="sourceLine" id="cb117-10" title="10"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb117-11" title="11"><span class="co">##                 Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb117-12" title="12"><span class="co">## (Intercept)      13.9325     0.8173  17.046  &lt; 2e-16 ***</span></a>
<a class="sourceLine" id="cb117-13" title="13"><span class="co">## log(BodyWt)      -0.6287     0.1606  -3.914 0.000266 ***</span></a>
<a class="sourceLine" id="cb117-14" title="14"><span class="co">## dangerlow        -2.4287     1.2238  -1.985 0.052479 .  </span></a>
<a class="sourceLine" id="cb117-15" title="15"><span class="co">## dangermoderate   -3.5836     1.3347  -2.685 0.009714 ** </span></a>
<a class="sourceLine" id="cb117-16" title="16"><span class="co">## dangerhigh       -3.8535     1.3691  -2.815 0.006879 ** </span></a>
<a class="sourceLine" id="cb117-17" title="17"><span class="co">## dangervery high  -7.2945     1.5525  -4.699 1.96e-05 ***</span></a>
<a class="sourceLine" id="cb117-18" title="18"><span class="co">## ---</span></a>
<a class="sourceLine" id="cb117-19" title="19"><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb117-20" title="20"><span class="co">## </span></a>
<a class="sourceLine" id="cb117-21" title="21"><span class="co">## Residual standard error: 3.343 on 52 degrees of freedom</span></a>
<a class="sourceLine" id="cb117-22" title="22"><span class="co">##   (4 observations deleted due to missingness)</span></a>
<a class="sourceLine" id="cb117-23" title="23"><span class="co">## Multiple R-squared:  0.5195, Adjusted R-squared:  0.4733 </span></a>
<a class="sourceLine" id="cb117-24" title="24"><span class="co">## F-statistic: 11.25 on 5 and 52 DF,  p-value: 2.23e-07</span></a></code></pre></div>
<p>There are 4 cases that have at least one value missing for <code>TS</code>, <code>danger</code> and <code>BodyWt</code>. Here we select these three variables (only), then use the <code>filter</code> command to find the cases that are “not” (<code>!</code>) complete cases. The period in the <code>complete.cases</code> function tells R to map the data frame into the function.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb118-2" title="2"><span class="op">+</span><span class="st">   </span><span class="kw">select</span>(TS, BodyWt, danger) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-3" title="3"><span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">complete.cases</span>(.))</a>
<a class="sourceLine" id="cb118-4" title="4"><span class="co">##   TS BodyWt    danger</span></a>
<a class="sourceLine" id="cb118-5" title="5"><span class="co">## 1 NA 529.00 very high</span></a>
<a class="sourceLine" id="cb118-6" title="6"><span class="co">## 2 NA  35.00      high</span></a>
<a class="sourceLine" id="cb118-7" title="7"><span class="co">## 3 NA 250.00 very high</span></a>
<a class="sourceLine" id="cb118-8" title="8"><span class="co">## 4 NA   4.05  very low</span></a></code></pre></div>
<p>The offending variable here is <code>TS</code>, with missing values for all 4 cases.</p>
<p>Suppose we wanted to include <code>Life</code> in the model, which measures an animal’s typical life span (in years). EDA suggests that we should log the life span variable:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-2" title="2"><span class="op">+</span><span class="st">   </span><span class="kw">mutate_at</span>(<span class="dt">.vars=</span><span class="kw">c</span>(<span class="st">&quot;BodyWt&quot;</span>,  <span class="st">&quot;Life&quot;</span>), <span class="dt">.funs =</span> log) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-3" title="3"><span class="op">+</span><span class="st">   </span><span class="kw">ggpairs</span>( <span class="kw">aes</span>(<span class="dt">color=</span>danger), </a>
<a class="sourceLine" id="cb119-4" title="4"><span class="op">+</span><span class="st">         </span><span class="dt">columns=</span><span class="kw">c</span>(<span class="st">&quot;BodyWt&quot;</span>,<span class="st">&quot;Life&quot;</span>,<span class="st">&quot;TS&quot;</span>), </a>
<a class="sourceLine" id="cb119-5" title="5"><span class="op">+</span><span class="st">         </span><span class="dt">lower=</span><span class="kw">list</span>(<span class="dt">continuous =</span> <span class="kw">wrap</span>(<span class="st">&quot;smooth&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>)), </a>
<a class="sourceLine" id="cb119-6" title="6"><span class="op">+</span><span class="st">         </span><span class="dt">columnLabels =</span> <span class="kw">c</span>(<span class="st">&quot;log(BodyWt)&quot;</span>, <span class="st">&quot;log(Life)&quot;</span>, <span class="st">&quot;TS&quot;</span>))</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-122-1.png" width="672" /></p>
<p>We fit the model, then use ANOVA (cause why not) instead of a t-test to compare the model with <code>Life</code> to the model without:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep.lm3 &lt;-<span class="st"> </span><span class="kw">lm</span>(TS <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt)<span class="op">+</span>danger <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(Life), <span class="dt">data=</span>sleep)</a>
<a class="sourceLine" id="cb120-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">anova</span>(sleep.lm2, sleep.lm3)  <span class="co"># reduced, full</span></a>
<a class="sourceLine" id="cb120-3" title="3"><span class="co">## Error in anova.lmlist(object, ...): models were not all fitted to the same size of dataset</span></a></code></pre></div>
<p>The error occurs because there are 4 additional cases that are missing values for <code>Life</code>. We can see this in the <code>summary</code> output and in the <code>filter</code>ing command:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(sleep.lm3)</a>
<a class="sourceLine" id="cb121-2" title="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb121-3" title="3"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb121-4" title="4"><span class="co">## lm(formula = TS ~ log(BodyWt) + danger + log(Life), data = sleep)</span></a>
<a class="sourceLine" id="cb121-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb121-6" title="6"><span class="co">## Residuals:</span></a>
<a class="sourceLine" id="cb121-7" title="7"><span class="co">##     Min      1Q  Median      3Q     Max </span></a>
<a class="sourceLine" id="cb121-8" title="8"><span class="co">## -8.3841 -1.5295  0.2586  1.6906  5.2957 </span></a>
<a class="sourceLine" id="cb121-9" title="9"><span class="co">## </span></a>
<a class="sourceLine" id="cb121-10" title="10"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb121-11" title="11"><span class="co">##                 Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb121-12" title="12"><span class="co">## (Intercept)      16.9876     1.8716   9.077 6.63e-12 ***</span></a>
<a class="sourceLine" id="cb121-13" title="13"><span class="co">## log(BodyWt)      -0.4509     0.2066  -2.183 0.034082 *  </span></a>
<a class="sourceLine" id="cb121-14" title="14"><span class="co">## dangerlow        -2.8939     1.2283  -2.356 0.022700 *  </span></a>
<a class="sourceLine" id="cb121-15" title="15"><span class="co">## dangermoderate   -5.5467     1.4679  -3.779 0.000444 ***</span></a>
<a class="sourceLine" id="cb121-16" title="16"><span class="co">## dangerhigh       -4.1830     1.3249  -3.157 0.002781 ** </span></a>
<a class="sourceLine" id="cb121-17" title="17"><span class="co">## dangervery high  -7.5354     1.4943  -5.043 7.28e-06 ***</span></a>
<a class="sourceLine" id="cb121-18" title="18"><span class="co">## log(Life)        -1.0948     0.6784  -1.614 0.113251    </span></a>
<a class="sourceLine" id="cb121-19" title="19"><span class="co">## ---</span></a>
<a class="sourceLine" id="cb121-20" title="20"><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb121-21" title="21"><span class="co">## </span></a>
<a class="sourceLine" id="cb121-22" title="22"><span class="co">## Residual standard error: 3.207 on 47 degrees of freedom</span></a>
<a class="sourceLine" id="cb121-23" title="23"><span class="co">##   (8 observations deleted due to missingness)</span></a>
<a class="sourceLine" id="cb121-24" title="24"><span class="co">## Multiple R-squared:  0.5878, Adjusted R-squared:  0.5351 </span></a>
<a class="sourceLine" id="cb121-25" title="25"><span class="co">## F-statistic: 11.17 on 6 and 47 DF,  p-value: 1.033e-07</span></a>
<a class="sourceLine" id="cb121-26" title="26"><span class="op">&gt;</span><span class="st"> </span>sleep <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb121-27" title="27"><span class="op">+</span><span class="st">   </span><span class="kw">select</span>(TS, BodyWt, danger, Life) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-28" title="28"><span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">complete.cases</span>(.))</a>
<a class="sourceLine" id="cb121-29" title="29"><span class="co">##     TS  BodyWt    danger Life</span></a>
<a class="sourceLine" id="cb121-30" title="30"><span class="co">## 1 16.5   0.920  moderate   NA</span></a>
<a class="sourceLine" id="cb121-31" title="31"><span class="co">## 2 10.3   0.550       low   NA</span></a>
<a class="sourceLine" id="cb121-32" title="32"><span class="co">## 3   NA 529.000 very high 28.0</span></a>
<a class="sourceLine" id="cb121-33" title="33"><span class="co">## 4   NA  35.000      high 16.3</span></a>
<a class="sourceLine" id="cb121-34" title="34"><span class="co">## 5 10.6   0.122  very low   NA</span></a>
<a class="sourceLine" id="cb121-35" title="35"><span class="co">## 6 11.2   1.350  moderate   NA</span></a>
<a class="sourceLine" id="cb121-36" title="36"><span class="co">## 7   NA 250.000 very high 23.6</span></a>
<a class="sourceLine" id="cb121-37" title="37"><span class="co">## 8   NA   4.050  very low 13.0</span></a></code></pre></div>
<p>We need to make sure that any ANOVA model comparisons are done using the <em>same</em> cases in the data set. To do this, create a version of the data that only contains complete cases for all four variables using the <code>tidyr</code> function <code>drop_na</code>:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb122-2" title="2"><span class="op">&gt;</span><span class="st"> </span>sleep.noNA &lt;-<span class="st"> </span><span class="kw">drop_na</span>(sleep, TS, BodyWt, Life, danger)</a>
<a class="sourceLine" id="cb122-3" title="3"><span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(sleep)</a>
<a class="sourceLine" id="cb122-4" title="4"><span class="co">## [1] 62</span></a>
<a class="sourceLine" id="cb122-5" title="5"><span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(sleep.noNA)</a>
<a class="sourceLine" id="cb122-6" title="6"><span class="co">## [1] 54</span></a></code></pre></div>
<p>Using <code>drop_na</code> ensures us that <em>only</em> cases with <code>NA</code>s in the listed variables are removed from the data set. Now you can compare the two models:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep.lm2.noNA &lt;-<span class="st"> </span><span class="kw">lm</span>(TS <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt)<span class="op">+</span>danger, <span class="dt">data=</span>sleep.noNA)</a>
<a class="sourceLine" id="cb123-2" title="2"><span class="op">&gt;</span><span class="st"> </span>sleep.lm3.noNA &lt;-<span class="st"> </span><span class="kw">lm</span>(TS <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt)<span class="op">+</span>danger <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(Life), <span class="dt">data=</span>sleep.noNA)</a>
<a class="sourceLine" id="cb123-3" title="3"><span class="op">&gt;</span><span class="st"> </span><span class="kw">anova</span>(sleep.lm2.noNA, sleep.lm3.noNA)</a>
<a class="sourceLine" id="cb123-4" title="4"><span class="co">## Analysis of Variance Table</span></a>
<a class="sourceLine" id="cb123-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb123-6" title="6"><span class="co">## Model 1: TS ~ log(BodyWt) + danger</span></a>
<a class="sourceLine" id="cb123-7" title="7"><span class="co">## Model 2: TS ~ log(BodyWt) + danger + log(Life)</span></a>
<a class="sourceLine" id="cb123-8" title="8"><span class="co">##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)</span></a>
<a class="sourceLine" id="cb123-9" title="9"><span class="co">## 1     48 510.27                           </span></a>
<a class="sourceLine" id="cb123-10" title="10"><span class="co">## 2     47 483.48  1    26.793 2.6046 0.1133</span></a></code></pre></div>
<p><strong>More on missing data:</strong> R’s default <code>na.action</code> for the <code>lm</code> command is to omit <code>NA</code> cases from the data before fitting the model. Any action done on the <code>lm</code>, like getting residuals, returns values only for the complete cases. For example, the regression of total sleep on body weight and danger using the <strong>complete</strong> data set will give 58 residual and fitted values because there are only 58 complete cases.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(sleep)  <span class="co"># 62 cases in the data</span></a>
<a class="sourceLine" id="cb124-2" title="2"><span class="co">## [1] 62</span></a>
<a class="sourceLine" id="cb124-3" title="3"><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">resid</span>(sleep.lm2))</a>
<a class="sourceLine" id="cb124-4" title="4"><span class="co">## [1] 58</span></a>
<a class="sourceLine" id="cb124-5" title="5"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb124-6" title="6"><span class="op">&gt;</span><span class="st"> </span>sleep.lm2.aug &lt;-<span class="st"> </span><span class="kw">augment</span>(sleep.lm2)  <span class="co"># danger + bodywt</span></a>
<a class="sourceLine" id="cb124-7" title="7"><span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(sleep.lm2.aug)  <span class="co"># only 58 residuals and fitted values (62-4)</span></a>
<a class="sourceLine" id="cb124-8" title="8"><span class="co">## [1] 58</span></a></code></pre></div>
<p>If we change the <code>na.action</code> argument in the <code>lm</code> to exclude the <code>NA</code> cases during the model fit, then they won’t be use in the model estimation but they will be preserved in the model attributes like the residuals. Here those cases are given <code>NA</code> values in the residual vector:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep.lm2.exclude &lt;-<span class="st"> </span><span class="kw">lm</span>(TS <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt) <span class="op">+</span><span class="st"> </span>danger, <span class="dt">data=</span>sleep, <span class="dt">na.action=</span>na.exclude)</a>
<a class="sourceLine" id="cb125-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">resid</span>(sleep.lm2.exclude))</a>
<a class="sourceLine" id="cb125-3" title="3"><span class="co">## [1] 62</span></a>
<a class="sourceLine" id="cb125-4" title="4"><span class="op">&gt;</span><span class="st"> </span><span class="kw">resid</span>(sleep.lm2.exclude)</a>
<a class="sourceLine" id="cb125-5" title="5"><span class="co">##          1          2          3          4          5          6 </span></a>
<a class="sourceLine" id="cb125-6" title="6"><span class="co">## -1.5149212 -2.0489364 -0.6659516  6.0986456 -1.2487150  1.2021519 </span></a>
<a class="sourceLine" id="cb125-7" title="7"><span class="co">##          7          8          9         10         11         12 </span></a>
<a class="sourceLine" id="cb125-8" title="8"><span class="co">##  3.3960550 -0.6885106  1.3180609 -1.7466097  1.8830495  1.1231940 </span></a>
<a class="sourceLine" id="cb125-9" title="9"><span class="co">##         13         14         15         16         17         18 </span></a>
<a class="sourceLine" id="cb125-10" title="10"><span class="co">## -1.5796181 -0.2491280 -7.1608811 -2.2131403 -0.9559651 -1.8155640 </span></a>
<a class="sourceLine" id="cb125-11" title="11"><span class="co">##         19         20         21         22         23         24 </span></a>
<a class="sourceLine" id="cb125-12" title="12"><span class="co">## -7.6165033  6.7414197         NA -0.7508961  1.5633040  1.4199273 </span></a>
<a class="sourceLine" id="cb125-13" title="13"><span class="co">##         25         26         27         28         29         30 </span></a>
<a class="sourceLine" id="cb125-14" title="14"><span class="co">## -4.9396162  1.3260241  2.0097921 -1.8543773  0.1946797 -0.2374482 </span></a>
<a class="sourceLine" id="cb125-15" title="15"><span class="co">##         31         32         33         34         35         36 </span></a>
<a class="sourceLine" id="cb125-16" title="16"><span class="co">##         NA -4.3098363  3.0724442 -3.3379668 -4.6550207  1.0397253 </span></a>
<a class="sourceLine" id="cb125-17" title="17"><span class="co">##         37         38         39         40         41         42 </span></a>
<a class="sourceLine" id="cb125-18" title="18"><span class="co">##  0.4796206  0.5421249  5.8010790  4.2550511         NA  5.0348020 </span></a>
<a class="sourceLine" id="cb125-19" title="19"><span class="co">##         43         44         45         46         47         48 </span></a>
<a class="sourceLine" id="cb125-20" title="20"><span class="co">##  2.2684934  2.4994925  1.6261064  2.3380130  1.9114196  2.0508100 </span></a>
<a class="sourceLine" id="cb125-21" title="21"><span class="co">##         49         50         51         52         53         54 </span></a>
<a class="sourceLine" id="cb125-22" title="22"><span class="co">## -3.2251148 -0.6987071 -5.0846383 -4.1436735 -2.3427576 -0.3131049 </span></a>
<a class="sourceLine" id="cb125-23" title="23"><span class="co">##         55         56         57         58         59         60 </span></a>
<a class="sourceLine" id="cb125-24" title="24"><span class="co">## -0.2922619 -2.9724451  1.7299787 -4.5131873  2.8733432  1.1216380 </span></a>
<a class="sourceLine" id="cb125-25" title="25"><span class="co">##         61         62 </span></a>
<a class="sourceLine" id="cb125-26" title="26"><span class="co">##  6.2550511         NA</span></a></code></pre></div>
<p>The <code>augment</code> function gives you a warning that it doesn’t include these missing value cases when it creates the augmented data set with residuals and fitted values. Here we still get a 58 cases augmented data frame:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep.lm2.exclude.aug &lt;-<span class="st"> </span><span class="kw">augment</span>(sleep.lm2.exclude)  <span class="co"># danger + bodywt</span></a>
<a class="sourceLine" id="cb126-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(sleep.lm2.exclude.aug)  <span class="co"># only 58 residuals and fitted values (62-4)</span></a>
<a class="sourceLine" id="cb126-3" title="3"><span class="co">## [1] 58</span></a></code></pre></div>
<p>Add the <code>data=sleep</code> argument to preserve the length of the original <code>sleep</code> data frame (62 cases) but to put <code>NA</code> values in for <code>.fitted</code> and <code>.resid</code> values since these cases were not used to fit the model.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep.lm2.exclude.aug &lt;-<span class="st"> </span><span class="kw">augment</span>(sleep.lm2.exclude, <span class="dt">data=</span>sleep)  <span class="co"># danger + bodywt</span></a>
<a class="sourceLine" id="cb127-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(sleep.lm2.exclude.aug)  <span class="co"># all 62 cases</span></a>
<a class="sourceLine" id="cb127-3" title="3"><span class="co">## [1] 62</span></a>
<a class="sourceLine" id="cb127-4" title="4"><span class="op">&gt;</span><span class="st"> </span>sleep.lm2.exclude.aug <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># but no resid/fitted provided for missing cases</span></a>
<a class="sourceLine" id="cb127-5" title="5"><span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(<span class="kw">is.na</span>(.resid))</a>
<a class="sourceLine" id="cb127-6" title="6"><span class="co">## # A tibble: 4 x 19</span></a>
<a class="sourceLine" id="cb127-7" title="7"><span class="co">##     SWS    PS    TS BodyWt BrainWt  Life    GP     P    SE     D Species</span></a>
<a class="sourceLine" id="cb127-8" title="8"><span class="co">##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt;  </span></a>
<a class="sourceLine" id="cb127-9" title="9"><span class="co">## 1    NA   0.3    NA 529        680  28     400     5     5     5 Giraffe</span></a>
<a class="sourceLine" id="cb127-10" title="10"><span class="co">## 2    NA  NA      NA  35         56  16.3    33     3     5     4 Kangar~</span></a>
<a class="sourceLine" id="cb127-11" title="11"><span class="co">## 3    NA   1      NA 250        490  23.6   440     5     5     5 Okapi  </span></a>
<a class="sourceLine" id="cb127-12" title="12"><span class="co">## 4    NA  NA      NA   4.05      17  13      38     3     1     1 Yellow~</span></a>
<a class="sourceLine" id="cb127-13" title="13"><span class="co">## # ... with 8 more variables: danger &lt;fct&gt;, .fitted &lt;dbl&gt;, .se.fit &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb127-14" title="14"><span class="co">## #   .resid &lt;dbl&gt;, .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;, .cooksd &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb127-15" title="15"><span class="co">## #   .std.resid &lt;dbl&gt;</span></a></code></pre></div>
</div>
</div>
</div>
<div id="model-checking" class="section level2">
<h2><span class="header-section-number">3.7</span> Model Checking</h2>
<p>After fitting a potential MLR model to a data set, we use residuals to help diagnosis any issues in the “fit” of our model. I.e. are any of our MLR model assumptions violated. We can also use residuals, along with a other measures, to determine if there are any cases that could be influencing our model fit.</p>
<p><strong>Timing:</strong> You should always check model fit and outliers affects <strong>before</strong> any model testing or interpretation! Even though this section is after all our inference sections, you need to make sure your choice of model doesn’t violate our model assumptions. Using an ill-fitting model to determine which predictors are “statistically significant” or how they change the mean function is irrelevant if the model is not correctly specificied, or if an outlier or two is seriously influencing the model fit.</p>
<p>We will use the same methods as SLR to check the model assumptions of independence (Section <a href="slr.html#slr-indep">2.8.4</a>) and normality of errors (Section <a href="slr.html#slr-normality">2.8.3</a>) and when the model is robust (or not) against violations (Section <a href="slr.html#slr-robust">2.8.5</a></p>
<div id="residual-plots" class="section level3">
<h3><span class="header-section-number">3.7.1</span> Residual plots</h3>
<p>Residual plots for MLR were first discussed in Section <a href="mlr.html#mlr-resid1">3.3.3</a> and they are used to check the <strong>linearity</strong> and <strong>constant variance</strong> MLR model assumptions.</p>
<p>We typically look at <span class="math inline">\(p+1\)</span> plots: residuals vs. <span class="math inline">\(\hat{y}_i\)</span> and residuals vs. all <span class="math inline">\(p\)</span> predictors. (Here, <span class="math inline">\(p\)</span> tells us how many predictors are in the model, terms like interactions are not used to produce residual plots.)</p>
<p>Recall that <code>plot(my.lm, which=1)</code> gives the residuals vs. fitted values. For the regression of total sleep on (log) body weight, life span and danger level (Section <a href="mlr.html#mlr-sleep3">3.6.4</a>), the residual vs. fitted plot is:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(sleep.lm3, <span class="dt">which=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
<p>If you don’t have a ton of data points, it is sometime nice to turn the smoother off since it is sensitive to areas in the plot with only a few data points:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(sleep.lm3, <span class="dt">which=</span><span class="dv">1</span>, <span class="dt">add.smooth =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-133-1.png" width="672" /></p>
<p>One option for plotting residuals vs. all predictors is the function <code>ggnostic</code> from the <code>GGally</code> package:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(GGally)</a>
<a class="sourceLine" id="cb130-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggnostic</span>(sleep.lm3, <span class="dt">columnsY =</span> <span class="st">&quot;.resid&quot;</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
<p>Again, if we want to turn both the smoother and error ribbon off, you need to add the <code>continuous</code> argument shown below (just setting <code>se=FALSE</code> will remove the ribbon but keep the smoother):</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggnostic</span>(sleep.lm3, <span class="dt">columnsY =</span> <span class="st">&quot;.resid&quot;</span>, </a>
<a class="sourceLine" id="cb131-2" title="2"><span class="op">+</span><span class="st">          </span><span class="dt">continuous =</span> <span class="kw">list</span>(<span class="dt">.resid=</span><span class="kw">wrap</span>(<span class="st">&quot;nostic_resid&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">method=</span><span class="ot">NULL</span>)))</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-135-1.png" width="672" /></p>
<p><strong>Conclusion:</strong> The mean function linearity assumptions seems to be adequately met, since the “middle” of each slice of points is roughly centered at 0. For the boxplot of residuals with danger level, we are looking for each boxplot to be roughly centered around 0 (holding a danger level constant for each boxplot). But there are some concerns about the constant variance assumption:</p>
<ul>
<li>for low fitted values (low predicted total sleep), we see less variation in residuals than for high fitted values.</li>
<li>we see less variation in residuals for high levels of danger and high values of body weight and life span. Note that from EDA (above), we see that the association between these predictors and total sleep is negative, meaning these high values of predictors correspond to the <strong>low</strong> fitted values for predicted sleep.</li>
</ul>
<p>At this stage, you should consider an alternative model version. To help “spread out” the lower sleep values we could try a log-transformation of <code>TS</code>:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep.lm3a &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(TS) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt)<span class="op">+</span>danger <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(Life), <span class="dt">data=</span>sleep)</a>
<a class="sourceLine" id="cb132-2" title="2"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(sleep.lm3, <span class="dt">which=</span><span class="dv">1</span>, <span class="dt">add.smooth =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-136-1.png" width="672" /></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggnostic</span>(sleep.lm3a, <span class="dt">columnsY =</span> <span class="st">&quot;.resid&quot;</span>, </a>
<a class="sourceLine" id="cb133-2" title="2"><span class="op">+</span><span class="st">          </span><span class="dt">continuous =</span> <span class="kw">list</span>(<span class="dt">.resid=</span><span class="kw">wrap</span>(<span class="st">&quot;nostic_resid&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">method=</span><span class="ot">NULL</span>)))</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-136-2.png" width="672" /></p>
<p>Overall, these residual plots look “better” than before. It looks like the model that best meets our MLR linearity and constant variance assumptions. The normality assumption is violated (see the QQ plot below), but with a little over 50 cases we should be able to trust inferences that involve the mean function (but not prediction intervals). Independence would only be violated if there were predator-prey relationships that would cause a correlation in total sleep among certain groups of species.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(sleep.lm3a, <span class="dt">which =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-137-1.png" width="672" /></p>
</div>
<div id="outliers" class="section level3">
<h3><span class="header-section-number">3.7.2</span> Outliers</h3>
<p>When analyzing one variable, a case that is “far enough” from the mean or median of that variable’s distribution could be deemed “unusual” and called an <em>outlier</em>. In regression modeling, we need to broaden this notion of “unusual” or outlying cases because we have more than one variable involved. There are three common statistics used to measure the “unusualness” of a case: leverage, standardized residual, and Cook’s distance. These are all examples of <strong>case influence statistics</strong>.</p>
<div id="mlr-leverage" class="section level4">
<h4><span class="header-section-number">3.7.2.1</span> Leverage</h4>
<p>Leverage is a statistic that assesses how <strong>unusual a case’s predictor values</strong> are compared to average predictor values for all cases. This statistic doesn’t consider a case’s response at all.</p>
<p>For <strong>SLR</strong>, the leverage of case <span class="math inline">\(i\)</span> equals
<span class="math display">\[
h_i = \dfrac{1}{n-1}\left(\dfrac{x_i - \bar{x}}{s_x}\right)^2 + \dfrac{1}{n}
\]</span>
This basically measures how far <span class="math inline">\(x_i\)</span> is from the mean predictor value, a larger deviation means higher leverage. In the plots below for a SLR model, we see an “outlier” in red in all three scatterplots of <span class="math inline">\(y\)</span> vs. <span class="math inline">\(x\)</span>. But only when the red case has an extreme predictor value (along the <span class="math inline">\(x\)</span>-axis) will it have high leverage (shown in the bottom plots). The first case will have a large residual but not a large leverage value.</p>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-141-1.png" width="864" /></p>
<p>In a MLR model, with more than one predictor, leverage <span class="math inline">\(h_i\)</span> is computed in the same spirit as the SLR formula but using matrix algebra to measure how far a case’s predictor values are from the main “point cloud” of predictor values. Visualizing points with large leverage is harder because we are usually only using 2-dimensional graphs. The plots below show scatterplots for a regression with two predictors, <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>. In all three cases the outlier point in red is a similar distance to the “middle” of the point cloud (shown by the green triangle). Because of this, all three cases have roughly the same leverage value (bottom graphs).</p>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-144-1.png" width="864" /></p>
<p>Mathematically:</p>
<ul>
<li><span class="math inline">\(\dfrac{1}{n} \leq h_i &lt; 1\)</span></li>
<li>average leverage across all cases is <span class="math inline">\(\bar{h} = (p+1)/n\)</span>.</li>
</ul>
<p>Guidelines for “large” leverage are based on the average leverage value:</p>
<ul>
<li><span class="math inline">\(h_i &gt; 2(p+1)/n\)</span>: potential for some influence</li>
<li><span class="math inline">\(h_i &gt; 3(p+1)/n\)</span>: potential for large influence</li>
</ul>
<p><strong>Why care about leverage?</strong> A case with high leverage has the <strong>potential</strong> to be influential in the regression the fit of the regression line or surface. A regression line/surface <em>could be</em> pulled towards cases with high leverage. This is due to the fact that the SE of each observed residual <span class="math inline">\(r_i = y_i - \hat{y}_i\)</span> is inversely related to leverage:
<span class="math display">\[
SE(r_i) = \hat{\sigma}\sqrt{1-h_i}
\]</span>
This SE tells us how much variability we will see in case <span class="math inline">\(i\)</span>’s residual when computing the residual for case <span class="math inline">\(i\)</span> for many, many regression fits from many, many sample responses taken from a population with predictor values fixed. (Think back to the SLR simulation in Chapter 2.)</p>
<ul>
<li>A case with <span class="math inline">\(h_i \approx 1\)</span>, means that it’s residual has little variability and all possible regression lines/surfaces will result in <span class="math inline">\(\hat{y_i}\)</span> being very close to <span class="math inline">\(Y_i\)</span> (since the expected value of each residual is 0).
<ul>
<li>If <span class="math inline">\(Y_i\)</span> for case <span class="math inline">\(i\)</span> is not following the “trend” of the other <span class="math inline">\(n-1\)</span> cases, then this case will be very influential on where the estimated regression line/surface goes.</li>
</ul></li>
<li>A case with <span class="math inline">\(h_i \approx 1/n\)</span>, means that if <span class="math inline">\(n\)</span> is large, it’s residual has variability of about <span class="math inline">\(\sigma\)</span> and all possible regression lines/surfaces will result in <span class="math inline">\(\hat{y_i}\)</span> that can vary widely from <span class="math inline">\(Y_i\)</span>.</li>
</ul>
</div>
<div id="standardized-internally-studentized-residuals" class="section level4">
<h4><span class="header-section-number">3.7.2.2</span> Standardized (internally studentized) residuals</h4>
<p>Standardized residuals, also known as internally <em>studentized</em> residuals, are the ratio of a residual to its SE:
<span class="math display">\[
studr_i = \dfrac{r_i}{SE(r_i)} = \dfrac{y_i - \hat{y}_i}{\hat{\sigma}\sqrt{1-h_i}}
\]</span></p>
<p>The reasons for a case with a large standardized residual are</p>
<ul>
<li>a large <span class="math inline">\(r_i\)</span> value (just poorly predicted) but “regular” leverage value. These cases will have typical predictor values but an unusual response.</li>
<li>a “regular” <span class="math inline">\(r_i\)</span> value but a small SE due to a large leverage value.</li>
</ul>
<p>If our normality model assumption holds, then these standardized residuals should behave, roughly, like standard normal values (N(0,1)). Guidelines to flag unusual cases are</p>
<ul>
<li><span class="math inline">\(| studr_i| &gt; 2\)</span> for smaller data sets</li>
<li><span class="math inline">\(| studr_i| &gt; 4\)</span> for large data sets</li>
</ul>
<p>In the plots below we see</p>
<ul>
<li><strong>Y outlier</strong>: This red case has a very large residual value <span class="math inline">\(r_i\)</span> but it doesn’t have high leverage. The extremely high residual value leads to a large standardized residual value.</li>
<li><strong>X outlier</strong>: This red case has a large negative standardized residual due to its large residual value and small SE (due to large leverage, shown above).</li>
<li><strong>X and Y outlier</strong>: The left case doesn’t have an unusual standardized residual value because though it has large leverage (shown above), its residual is still small (because it follows the trend of the other cases). The right case has the same leverage as the left case, but this time it has a larger residual because it deviates a bit from the overall trend. For this reason, the right case has a larger standardized residual than the left case.</li>
</ul>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-147-1.png" width="864" /></p>
</div>
<div id="cooks-distance" class="section level4">
<h4><span class="header-section-number">3.7.2.3</span> Cook’s distance</h4>
<p>Cook’s distance, <span class="math inline">\(D_i\)</span>, is a measure of a case’s influence on the fitted regression line/surface. It is computed for case <span class="math inline">\(i\)</span> by removing case <span class="math inline">\(i\)</span> from the data, then fitting a regression model and predicting responses for all cases <span class="math inline">\(\hat{Y}_{j(-i)}\)</span>. These “remove <span class="math inline">\(i\)</span>” predictions are compared to the predictions we get when including case <span class="math inline">\(i\)</span>, <span class="math inline">\(\hat{Y}_i\)</span>. If these two predictions deviate a lot, overall all cases, then we would say that case <span class="math inline">\(i\)</span> is influential in the regression fit.
<span class="math display">\[
D_i = \sum_{j=1}^n \dfrac{(\hat{Y}_{j(-i)} - \hat{Y}_{j})^2}{(p+1)\hat{\sigma}^2} = \dfrac{studr_i}{p+1} \dfrac{h_i}{1-h_i}
\]</span>
Note in the equation above shows that the measure of the “remove <span class="math inline">\(i\)</span>” predictions from overall predictions can be expressed in terms of a cases’s leverage and standardized residual. A case can have high Cook’s distance if it has high standardized residual, high leverage, or a combination of both. A case should be flagged as likely influential if is has a Cook’s distance for 1 or larger.</p>
<p>In the plots below, the red regression line was fit including the red point and the black line was fit without the red point. A case where the red and black lines deviate a lot means that the red point in influential.</p>
<ul>
<li><strong>Y outlier</strong>: This red case has a very large residual value <span class="math inline">\(r_i\)</span> but it doesn’t have high leverage. It is not very influential.</li>
<li><strong>X outlier</strong>: This red case has a large negative standardized residual and large leverage, so it is very influential (<span class="math inline">\(D_i \approx 6\)</span>).</li>
<li><strong>X and Y outlier</strong>: The left case doesn’t have an unusual standardized residual value though it has large leverage, so it isn’t very influential because it follows the trend of the other cases. The right case has the same leverage as the left case, but this time it has a larger standardized residual than the left case and it is deemed to be influential (<span class="math inline">\(D_i &gt; 3\)</span>).</li>
</ul>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-149-1.png" width="864" /></p>
</div>
<div id="example-sleep" class="section level4">
<h4><span class="header-section-number">3.7.2.4</span> Example: Sleep</h4>
<p>Consider the regression of log of total sleep on log-body weight, log-life span and danger level.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb135-2" title="2"><span class="op">&gt;</span><span class="st"> </span>sleep.noNA &lt;-<span class="st"> </span><span class="kw">drop_na</span>(sleep, TS, BodyWt, Life, danger)</a>
<a class="sourceLine" id="cb135-3" title="3"><span class="op">&gt;</span><span class="st"> </span>sleep.lm3a &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(TS) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt)<span class="op">+</span>danger <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(Life), <span class="dt">data=</span>sleep.noNA)</a>
<a class="sourceLine" id="cb135-4" title="4"><span class="op">&gt;</span><span class="st"> </span>sleep.lm3a</a>
<a class="sourceLine" id="cb135-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb135-6" title="6"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb135-7" title="7"><span class="co">## lm(formula = log(TS) ~ log(BodyWt) + danger + log(Life), data = sleep.noNA)</span></a>
<a class="sourceLine" id="cb135-8" title="8"><span class="co">## </span></a>
<a class="sourceLine" id="cb135-9" title="9"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb135-10" title="10"><span class="co">##     (Intercept)      log(BodyWt)        dangerlow   dangermoderate  </span></a>
<a class="sourceLine" id="cb135-11" title="11"><span class="co">##         2.87435         -0.05598         -0.23465         -0.56386  </span></a>
<a class="sourceLine" id="cb135-12" title="12"><span class="co">##      dangerhigh  dangervery high        log(Life)  </span></a>
<a class="sourceLine" id="cb135-13" title="13"><span class="co">##        -0.35383         -0.99515         -0.09913</span></a></code></pre></div>
<p>We can use the <code>plot(my.lm, which = 4)</code> command to plot Cook’s distance against row number. Adding <code>id.n=5</code> will tell R to identify the row number of the 5 largest Cook’s distance cases. Note that this is just a tool for identifying cases, it doesn’t mean that they are influential cases if their values are all well below 1.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(sleep.lm3a, <span class="dt">which=</span><span class="dv">4</span>, <span class="dt">id.n =</span> <span class="dv">5</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<p>We can use the <code>plot(my.lm, which = 5)</code> command to plot standardized residuals (y-axis) against leverage (x-axis) with contours given by Cook’s distance. For this model fit, we have two cases (15, 19) with standardized residuals below -2 but these are mid-range leverage cases and all Cook’s distances are below 0.5. THe largest Cook’s distance case, 32, has the third largest leverage value.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(sleep.lm3a, <span class="dt">which=</span><span class="dv">5</span>, <span class="dt">id.n=</span><span class="dv">5</span>)</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-152-1.png" width="672" /></p>
<p>The four cases that have the highest Cook’s distance are rows 15, 19, 32 and 46 <strong>in the original <code>sleep</code> data set</strong>! These are the (hidden) row names that are being used by the <code>plot</code> command to ID cases. So using the <strong>original</strong> data frame, <code>sleep</code>, we can ID these cases:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">select</span>(Species, TS, BodyWt, Life) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb138-2" title="2"><span class="op">+</span><span class="st">   </span><span class="kw">slice</span>(<span class="dv">15</span>, <span class="dv">19</span>, <span class="dv">32</span>, <span class="dv">46</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Species</th>
<th align="right">TS</th>
<th align="right">BodyWt</th>
<th align="right">Life</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Eastern_American_mole</td>
<td align="right">8.4</td>
<td align="right">0.075</td>
<td align="right">3.5</td>
</tr>
<tr class="even">
<td align="left">Genet</td>
<td align="right">6.1</td>
<td align="right">1.410</td>
<td align="right">34.0</td>
</tr>
<tr class="odd">
<td align="left">Lesser_short-tailed_shrew</td>
<td align="right">9.1</td>
<td align="right">0.005</td>
<td align="right">2.6</td>
</tr>
<tr class="even">
<td align="left">Rabbit</td>
<td align="right">8.4</td>
<td align="right">2.500</td>
<td align="right">18.0</td>
</tr>
</tbody>
</table>
<p>We can make the augmented data frame to see the case influence stat values for cases. When creating the augmented data frame, I enter the data set <code>sleep.noNA</code> that was used to fit the model <code>sleep.lm3a</code>. This command creates a column, <code>.rownames</code>, that contains the <strong>row numbers of the original</strong> <code>sleep</code> data frame. We can’t <code>slice</code> the augmented data frame because its row numbers done match those of the original data (54 cases vs. 62). So, instead, we can use <code>filter</code> to find the augmented data rows that have the <code>.rownames</code> of 15, 19, 32, and 46. We can see that these Cook’s distance values align with those shown in the Cook’s plot above.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb139-2" title="2"><span class="op">&gt;</span><span class="st"> </span>sleep.noNA.aug &lt;-<span class="st"> </span><span class="kw">augment</span>(<span class="dt">data=</span>sleep.noNA, sleep.lm3a)</a>
<a class="sourceLine" id="cb139-3" title="3"><span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(sleep)</a>
<a class="sourceLine" id="cb139-4" title="4"><span class="co">## [1] 62</span></a>
<a class="sourceLine" id="cb139-5" title="5"><span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(sleep.noNA.aug)</a>
<a class="sourceLine" id="cb139-6" title="6"><span class="co">## [1] 54</span></a>
<a class="sourceLine" id="cb139-7" title="7"><span class="op">&gt;</span><span class="st"> </span>sleep.noNA.aug <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb139-8" title="8"><span class="op">+</span><span class="st">   </span><span class="kw">select</span>(.rownames, Species, TS, BodyWt, Life, danger, .cooksd, .std.resid, .hat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-9" title="9"><span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(.rownames <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">19</span>, <span class="dv">32</span>, <span class="dv">46</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb139-10" title="10"><span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(<span class="kw">desc</span>(.cooksd)) <span class="co"># report in descending order according to cook&#39;s D</span></a>
<a class="sourceLine" id="cb139-11" title="11"><span class="co">## # A tibble: 4 x 9</span></a>
<a class="sourceLine" id="cb139-12" title="12"><span class="co">##   .rownames Species         TS BodyWt  Life danger .cooksd .std.resid  .hat</span></a>
<a class="sourceLine" id="cb139-13" title="13"><span class="co">##   &lt;chr&gt;     &lt;fct&gt;        &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb139-14" title="14"><span class="co">## 1 32        Lesser_shor~   9.1  0.005   2.6 high    0.162       -1.87 0.246</span></a>
<a class="sourceLine" id="cb139-15" title="15"><span class="co">## 2 15        Eastern_Ame~   8.4  0.075   3.5 very ~  0.133       -2.58 0.123</span></a>
<a class="sourceLine" id="cb139-16" title="16"><span class="co">## 3 46        Rabbit         8.4  2.5    18   very ~  0.121        2.03 0.170</span></a>
<a class="sourceLine" id="cb139-17" title="17"><span class="co">## 4 19        Genet          6.1  1.41   34   very ~  0.0902      -2.32 0.105</span></a></code></pre></div>
<p>The R package <code>GGally</code> also has plotting options for case influence stats, plotted against predictor variables. Reference lines for leverage (<code>.hat</code>) are average leverage and twice average leverage.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggnostic</span>(sleep.lm3a, <span class="dt">columnsY =</span> <span class="kw">c</span>(<span class="st">&quot;.std.resid&quot;</span>, <span class="st">&quot;.hat&quot;</span>, <span class="st">&quot;.cooksd&quot;</span>))</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-155-1.png" width="672" /></p>
<p>Here we remove the SE ribbon and smoother from the standardized residual plot.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggnostic</span>(sleep.lm3a, <span class="dt">columnsY =</span> <span class="kw">c</span>(<span class="st">&quot;.std.resid&quot;</span>, <span class="st">&quot;.hat&quot;</span>, <span class="st">&quot;.cooksd&quot;</span>), </a>
<a class="sourceLine" id="cb141-2" title="2"><span class="op">+</span><span class="st">          </span><span class="dt">continuous =</span> <span class="kw">list</span>(<span class="dt">.std.resid=</span><span class="kw">wrap</span>(<span class="st">&quot;nostic_resid&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">method=</span><span class="ot">NULL</span>)))</a></code></pre></div>
<p><img src="Math245notes_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
<p>We can use the <code>GGally</code> plots of case influence stats against predictors to help us understand the characteristics of cases that have concerning case influence stats. For example, the <strong>smallest body weight</strong> case, 0.005kg, corresponds to the high Cook’s distance value (Lesser short-tailed shrew).</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(sleep.noNA.aug <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(BodyWt, Life))</a>
<a class="sourceLine" id="cb142-2" title="2"><span class="co">##      BodyWt              Life        </span></a>
<a class="sourceLine" id="cb142-3" title="3"><span class="co">##  Min.   :   0.005   Min.   :  2.000  </span></a>
<a class="sourceLine" id="cb142-4" title="4"><span class="co">##  1st Qu.:   0.548   1st Qu.:  6.125  </span></a>
<a class="sourceLine" id="cb142-5" title="5"><span class="co">##  Median :   3.342   Median : 13.850  </span></a>
<a class="sourceLine" id="cb142-6" title="6"><span class="co">##  Mean   : 213.037   Mean   : 19.852  </span></a>
<a class="sourceLine" id="cb142-7" title="7"><span class="co">##  3rd Qu.:  48.203   3rd Qu.: 27.750  </span></a>
<a class="sourceLine" id="cb142-8" title="8"><span class="co">##  Max.   :6654.000   Max.   :100.000</span></a></code></pre></div>
<p>This shrew has a higher leverage value, in part because it also has one of the smallest life spans of 2.6 (min life span is 2). The <strong>second smallest body weight</strong> species also has high leverage, but it doesn’t not have a high Cook’s distance. Why? The standardized residual plot shows that this second smallest body weight case has a standardized residual below 1. Meaning that while it has higher leverage, it’s response is not as far from the regression surface as the smallest body weight shrew. For the shrew, the combo of higher leverage and larger residual combine to give it the highest Cook’s distance value.</p>
<p>We can remove a case(s) from a <code>lm</code> fit by either creating a data frame without the case(s) or by using the <code>subset</code> command in the <code>lm</code> fit: <code>lm(y ~ x, data = , subset = -c(row numbers))</code>. This second option is quick and easy for comparing model fits with and without a case. Here we remove row 32 (Lesser short-tailed shrew) from the model fit:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(sleep.lm3a)</a>
<a class="sourceLine" id="cb143-2" title="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb143-3" title="3"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb143-4" title="4"><span class="co">## lm(formula = log(TS) ~ log(BodyWt) + danger + log(Life), data = sleep.noNA)</span></a>
<a class="sourceLine" id="cb143-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb143-6" title="6"><span class="co">## Residuals:</span></a>
<a class="sourceLine" id="cb143-7" title="7"><span class="co">##      Min       1Q   Median       3Q      Max </span></a>
<a class="sourceLine" id="cb143-8" title="8"><span class="co">## -0.76693 -0.12239  0.05347  0.21708  0.58685 </span></a>
<a class="sourceLine" id="cb143-9" title="9"><span class="co">## </span></a>
<a class="sourceLine" id="cb143-10" title="10"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb143-11" title="11"><span class="co">##                 Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb143-12" title="12"><span class="co">## (Intercept)      2.87435    0.18518  15.522  &lt; 2e-16 ***</span></a>
<a class="sourceLine" id="cb143-13" title="13"><span class="co">## log(BodyWt)     -0.05598    0.02044  -2.739 0.008683 ** </span></a>
<a class="sourceLine" id="cb143-14" title="14"><span class="co">## dangerlow       -0.23465    0.12154  -1.931 0.059565 .  </span></a>
<a class="sourceLine" id="cb143-15" title="15"><span class="co">## dangermoderate  -0.56386    0.14524  -3.882 0.000322 ***</span></a>
<a class="sourceLine" id="cb143-16" title="16"><span class="co">## dangerhigh      -0.35383    0.13109  -2.699 0.009631 ** </span></a>
<a class="sourceLine" id="cb143-17" title="17"><span class="co">## dangervery high -0.99515    0.14785  -6.731 2.09e-08 ***</span></a>
<a class="sourceLine" id="cb143-18" title="18"><span class="co">## log(Life)       -0.09913    0.06712  -1.477 0.146359    </span></a>
<a class="sourceLine" id="cb143-19" title="19"><span class="co">## ---</span></a>
<a class="sourceLine" id="cb143-20" title="20"><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb143-21" title="21"><span class="co">## </span></a>
<a class="sourceLine" id="cb143-22" title="22"><span class="co">## Residual standard error: 0.3173 on 47 degrees of freedom</span></a>
<a class="sourceLine" id="cb143-23" title="23"><span class="co">## Multiple R-squared:  0.6872, Adjusted R-squared:  0.6473 </span></a>
<a class="sourceLine" id="cb143-24" title="24"><span class="co">## F-statistic: 17.21 on 6 and 47 DF,  p-value: 2.105e-10</span></a>
<a class="sourceLine" id="cb143-25" title="25"><span class="op">&gt;</span><span class="st"> </span><span class="co"># we must use original sleep data to remove the correct</span></a>
<a class="sourceLine" id="cb143-26" title="26"><span class="er">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">lm</span>(<span class="kw">log</span>(TS) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt) <span class="op">+</span><span class="st"> </span>danger <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(Life), <span class="dt">data=</span>sleep, <span class="dt">subset =</span> <span class="dv">-32</span>))</a>
<a class="sourceLine" id="cb143-27" title="27"><span class="co">## </span></a>
<a class="sourceLine" id="cb143-28" title="28"><span class="co">## Call:</span></a>
<a class="sourceLine" id="cb143-29" title="29"><span class="co">## lm(formula = log(TS) ~ log(BodyWt) + danger + log(Life), data = sleep, </span></a>
<a class="sourceLine" id="cb143-30" title="30"><span class="co">##     subset = -32)</span></a>
<a class="sourceLine" id="cb143-31" title="31"><span class="co">## </span></a>
<a class="sourceLine" id="cb143-32" title="32"><span class="co">## Residuals:</span></a>
<a class="sourceLine" id="cb143-33" title="33"><span class="co">##      Min       1Q   Median       3Q      Max </span></a>
<a class="sourceLine" id="cb143-34" title="34"><span class="co">## -0.82496 -0.11298  0.04157  0.18939  0.55285 </span></a>
<a class="sourceLine" id="cb143-35" title="35"><span class="co">## </span></a>
<a class="sourceLine" id="cb143-36" title="36"><span class="co">## Coefficients:</span></a>
<a class="sourceLine" id="cb143-37" title="37"><span class="co">##                 Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb143-38" title="38"><span class="co">## (Intercept)      2.92357    0.18194  16.069  &lt; 2e-16 ***</span></a>
<a class="sourceLine" id="cb143-39" title="39"><span class="co">## log(BodyWt)     -0.06537    0.02048  -3.193 0.002542 ** </span></a>
<a class="sourceLine" id="cb143-40" title="40"><span class="co">## dangerlow       -0.26021    0.11896  -2.187 0.033842 *  </span></a>
<a class="sourceLine" id="cb143-41" title="41"><span class="co">## dangermoderate  -0.59004    0.14193  -4.157 0.000139 ***</span></a>
<a class="sourceLine" id="cb143-42" title="42"><span class="co">## dangerhigh      -0.27344    0.13422  -2.037 0.047408 *  </span></a>
<a class="sourceLine" id="cb143-43" title="43"><span class="co">## dangervery high -0.96593    0.14461  -6.679 2.76e-08 ***</span></a>
<a class="sourceLine" id="cb143-44" title="44"><span class="co">## log(Life)       -0.11153    0.06560  -1.700 0.095880 .  </span></a>
<a class="sourceLine" id="cb143-45" title="45"><span class="co">## ---</span></a>
<a class="sourceLine" id="cb143-46" title="46"><span class="co">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb143-47" title="47"><span class="co">## </span></a>
<a class="sourceLine" id="cb143-48" title="48"><span class="co">## Residual standard error: 0.3087 on 46 degrees of freedom</span></a>
<a class="sourceLine" id="cb143-49" title="49"><span class="co">##   (8 observations deleted due to missingness)</span></a>
<a class="sourceLine" id="cb143-50" title="50"><span class="co">## Multiple R-squared:  0.7104, Adjusted R-squared:  0.6726 </span></a>
<a class="sourceLine" id="cb143-51" title="51"><span class="co">## F-statistic:  18.8 on 6 and 46 DF,  p-value: 6.564e-11</span></a></code></pre></div>
<p>Note that the second model fit needed to be done with the <code>sleep</code> data and <code>subset=-32</code> because the shrew is row 32 of the original data set:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">32</span>)</a>
<a class="sourceLine" id="cb144-2" title="2"><span class="co">##   SWS  PS  TS BodyWt BrainWt Life   GP P SE D                   Species</span></a>
<a class="sourceLine" id="cb144-3" title="3"><span class="co">## 1 7.7 1.4 9.1  0.005    0.14  2.6 21.5 5  2 4 Lesser_short-tailed_shrew</span></a>
<a class="sourceLine" id="cb144-4" title="4"><span class="co">##   danger</span></a>
<a class="sourceLine" id="cb144-5" title="5"><span class="co">## 1   high</span></a>
<a class="sourceLine" id="cb144-6" title="6"><span class="op">&gt;</span><span class="st"> </span>sleep.noNA <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">32</span>)  <span class="co"># wrong case!</span></a>
<a class="sourceLine" id="cb144-7" title="7"><span class="co">##    SWS PS   TS BodyWt BrainWt Life GP P SE D    Species   danger</span></a>
<a class="sourceLine" id="cb144-8" title="8"><span class="co">## 1 10.8  2 12.8  0.048    0.33    2 30 4  1 3 Musk_shrew moderate</span></a></code></pre></div>
<p>But this second option of using <code>subset</code> in the <code>lm</code> command runs the risk of row number confusion when identifying cases in the usual residuals and case influence plots. For example, you can’t <code>augment</code> the <code>sleep</code> or <code>sleep.noNA</code> data frames when a case is removed from the <code>lm</code> using <code>subset</code>. If you plan to omit a case “for good”, the create a subsetted version of your data frame and use this to fit your <code>lm</code>.</p>
<p>If you want to create a “no NA” version of the data set that also excludes the lesser short-tailed shrew, go back and delete row 32 from the original data frame and then omit NA cases:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" title="1"><span class="op">&gt;</span><span class="st"> </span>sleep.noNA.noLSTShrew &lt;-<span class="st"> </span>sleep <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="op">-</span><span class="dv">32</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-2" title="2"><span class="op">+</span><span class="st">   </span><span class="kw">drop_na</span>(TS, BodyWt, Life, danger)</a>
<a class="sourceLine" id="cb145-3" title="3"><span class="op">&gt;</span><span class="st"> </span><span class="co"># refit with subsetted data</span></a>
<a class="sourceLine" id="cb145-4" title="4"><span class="er">&gt;</span><span class="st"> </span>sleep.lm3a.noLSTshrew &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(TS) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(BodyWt) <span class="op">+</span><span class="st"> </span>danger <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(Life), <span class="dt">data =</span> sleep.noNA.noLSTShrew)</a></code></pre></div>
<p>Comparing the model inferences and fit with and without the lesser short-tailed shrew shows <strong>no major changes in our conclusions</strong>. For example, the <code>danger</code> variable is still statistically significant when body weight and life span are included. <code>Life</code> is marginally significant when body weight and danger level are included. We have a slight reduction in SSR when short-tailed shrew is excluded, which reduces SE’s a bit and increases <span class="math inline">\(R^2\)</span>, but this fact along should not justify the removal of this case. We can’t just cherry-pick cases to improve <span class="math inline">\(R^2\)</span>!</p>
<p>So when can we consider excluding a case? Cases can be considered for removal if they <strong>change our inference conclusions</strong>. If this occurs, then consider:</p>
<ul>
<li>Is the case part of a different population compared to all other cases? If yes, then removal of the case is justified.
<ul>
<li>If no, does the case have high leverage? If yes, describe how it is different in predictor value(s), remove the case and explain the new restricted predictor range for your model
<ul>
<li>If no, then there is no clear path! Report results with and without the case and dig into the data and sampling process to try to understand what makes this case different.</li>
</ul></li>
</ul></li>
</ul>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="slr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="logistic.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
